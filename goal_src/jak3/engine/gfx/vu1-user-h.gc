;;-*-Lisp-*-
(in-package goal)

;; name: vu1-user-h.gc
;; name in dgo: vu1-user-h
;; dgos: GAME

;; +++tpage-category
(defenum tpage-category
  :type int8
  (tc0 0) ;;
  (tc1 1)
  (tc2 2)
  (tc3 3)
  (tc4 4)
  (warp 5)
  (tc6 6)
  (sprite 7)
  (hud 8)
  (tc9 9)
  (tc10 10)
  )
;; ---tpage-category

;; +++bucket-id
(defenum bucket-id
  :type int32
  (bucket0 0)
  (bucket1 1)
  (bucket2 2)
  (bucket3 3)
  (tex-lcom-sky-pre 4)
  (bucket5 5)
  (bucket6 6)
  (bucket7 7)
  (bucket8 8)
  (bucket9 9)
  (bucket10 10)
  (bucket11 11)
  (bucket12 12)
  (bucket13 13)
  (bucket14 14)
  (bucket15 15)
  (bucket16 16)
  (bucket17 17)
  (bucket18 18)
  (bucket19 19)
  (bucket20 20)
  (bucket21 21)
  (bucket22 22)
  (bucket23 23)
  (bucket24 24)
  (bucket25 25)
  (bucket26 26)
  (bucket27 27)
  (bucket28 28)
  (bucket29 29)
  (bucket30 30)
  (bucket31 31)
  (bucket32 32)
  (bucket33 33)
  (bucket34 34)
  (bucket35 35)
  (bucket36 36)
  (bucket37 37)
  (bucket38 38)
  (bucket39 39)
  (bucket40 40)
  (bucket41 41)
  (bucket42 42)
  (bucket43 43)
  (bucket44 44)
  (bucket45 45)
  (bucket46 46)
  (bucket47 47)
  (bucket48 48)
  (bucket49 49)
  (bucket50 50)
  (bucket51 51)
  (bucket52 52)
  (bucket53 53)
  (bucket54 54)
  (bucket55 55)
  (bucket56 56)
  (bucket57 57)
  (bucket58 58)
  (bucket59 59)
  (bucket60 60)
  (bucket61 61)
  (bucket62 62)
  (bucket63 63)
  (bucket64 64)
  (bucket65 65)
  (bucket66 66)
  (bucket67 67)
  (bucket68 68)
  (bucket69 69)
  (bucket70 70)
  (bucket71 71)
  (bucket72 72)
  (bucket73 73)
  (bucket74 74)
  (bucket75 75)
  (bucket76 76)
  (bucket77 77)
  (bucket78 78)
  (bucket79 79)
  (bucket80 80)
  (bucket81 81)
  (bucket82 82)
  (bucket83 83)
  (bucket84 84)
  (bucket85 85)
  (bucket86 86)
  (bucket87 87)
  (bucket88 88)
  (bucket89 89)
  (bucket90 90)
  (bucket91 91)
  (bucket92 92)
  (bucket93 93)
  (bucket94 94)
  (bucket95 95)
  (bucket96 96)
  (bucket97 97)
  (bucket98 98)
  (bucket99 99)
  (bucket100 100)
  (bucket101 101)
  (bucket102 102)
  (bucket103 103)
  (bucket104 104)
  (bucket105 105)
  (bucket106 106)
  (bucket107 107)
  (bucket108 108)
  (bucket109 109)
  (bucket110 110)
  (bucket111 111)
  (bucket112 112)
  (bucket113 113)
  (bucket114 114)
  (bucket115 115)
  (bucket116 116)
  (bucket117 117)
  (bucket118 118)
  (bucket119 119)
  (bucket120 120)
  (bucket121 121)
  (bucket122 122)
  (bucket123 123)
  (bucket124 124)
  (bucket125 125)
  (bucket126 126)
  (bucket127 127)
  (bucket128 128)
  (bucket129 129)
  (bucket130 130)
  (bucket131 131)
  (bucket132 132)
  (bucket133 133)
  (bucket134 134)
  (bucket135 135)
  (bucket136 136)
  (bucket137 137)
  (bucket138 138)
  (bucket139 139)
  (bucket140 140)
  (bucket141 141)
  (bucket142 142)
  (bucket143 143)
  (bucket144 144)
  (bucket145 145)
  (bucket146 146)
  (bucket147 147)
  (bucket148 148)
  (bucket149 149)
  (bucket150 150)
  (bucket151 151)
  (bucket152 152)
  (bucket153 153)
  (bucket154 154)
  (bucket155 155)
  (bucket156 156)
  (bucket157 157)
  (bucket158 158)
  (bucket159 159)
  (bucket160 160)
  (bucket161 161)
  (bucket162 162)
  (bucket163 163)
  (bucket164 164)
  (bucket165 165)
  (bucket166 166)
  (bucket167 167)
  (bucket168 168)
  (bucket169 169)
  (bucket170 170)
  (bucket171 171)
  (bucket172 172)
  (bucket173 173)
  (bucket174 174)
  (bucket175 175)
  (bucket176 176)
  (bucket177 177)
  (bucket178 178)
  (bucket179 179)
  (bucket180 180)
  (bucket181 181)
  (bucket182 182)
  (bucket183 183)
  (bucket184 184)
  (bucket185 185)
  (bucket186 186)
  (bucket187 187)
  (bucket188 188)
  (bucket189 189)
  (bucket190 190)
  (bucket191 191)
  (bucket192 192)
  (bucket193 193)
  (bucket194 194)
  (bucket195 195)
  (bucket196 196)
  (bucket197 197)
  (bucket198 198)
  (bucket199 199)
  (bucket200 200)
  (bucket201 201)
  (bucket202 202)
  (bucket203 203)
  (bucket204 204)
  (bucket205 205)
  (bucket206 206)
  (bucket207 207)
  (bucket208 208)
  (bucket209 209)
  (bucket210 210)
  (bucket211 211)
  (bucket212 212)
  (bucket213 213)
  (bucket214 214)
  (bucket215 215)
  (bucket216 216)
  (bucket217 217)
  (bucket218 218)
  (bucket219 219)
  (bucket220 220)
  (bucket221 221)
  (bucket222 222)
  (bucket223 223)
  (bucket224 224)
  (bucket225 225)
  (bucket226 226)
  (bucket227 227)
  (bucket228 228)
  (bucket229 229)
  (bucket230 230)
  (bucket231 231)
  (bucket232 232)
  (bucket233 233)
  (bucket234 234)
  (bucket235 235)
  (bucket236 236)
  (bucket237 237)
  (bucket238 238)
  (bucket239 239)
  (bucket240 240)
  (bucket241 241)
  (bucket242 242)
  (bucket243 243)
  (bucket244 244)
  (bucket245 245)
  (bucket246 246)
  (bucket247 247)
  (bucket248 248)
  (bucket249 249)
  (bucket250 250)
  (bucket251 251)
  (bucket252 252)
  (bucket253 253)
  (bucket254 254)
  (bucket255 255)
  (bucket256 256)
  (bucket257 257)
  (bucket258 258)
  (bucket259 259)
  (bucket260 260)
  (bucket261 261)
  (bucket262 262)
  (bucket263 263)
  (bucket264 264)
  (bucket265 265)
  (bucket266 266)
  (bucket267 267)
  (bucket268 268)
  (bucket269 269)
  (bucket270 270)
  (bucket271 271)
  (bucket272 272)
  (bucket273 273)
  (bucket274 274)
  (bucket275 275)
  (bucket276 276)
  (bucket277 277)
  (bucket278 278)
  (bucket279 279)
  (bucket280 280)
  (bucket281 281)
  (bucket282 282)
  (bucket283 283)
  (bucket284 284)
  (bucket285 285)
  (bucket286 286)
  (bucket287 287)
  (bucket288 288)
  (bucket289 289)
  (bucket290 290)
  (bucket291 291)
  (bucket292 292)
  (bucket293 293)
  (bucket294 294)
  (bucket295 295)
  (bucket296 296)
  (bucket297 297)
  (bucket298 298)
  (bucket299 299)
  (bucket300 300)
  (bucket301 301)
  (bucket302 302)
  (bucket303 303)
  (bucket304 304)
  (bucket305 305)
  (bucket306 306)
  (bucket307 307)
  (bucket308 308)
  (bucket309 309)
  (bucket310 310)
  (bucket311 311)
  (bucket312 312)
  (bucket313 313)
  (bucket314 314)
  (bucket315 315)
  (bucket316 316)
  (bucket317 317)
  (bucket318 318)
  (bucket319 319)
  (bucket320 320)
  (bucket321 321)
  (bucket322 322)
  (bucket323 323)
  (bucket324 324)
  (bucket325 325)
  (bucket326 326)
  (bucket327 327)
  (bucket328 328)
  (bucket329 329)
  (bucket330 330)
  (bucket331 331)
  (bucket332 332)
  (bucket333 333)
  (bucket334 334)
  (bucket335 335)
  (bucket336 336)
  (bucket337 337)
  (bucket338 338)
  (bucket339 339)
  (bucket340 340)
  (bucket341 341)
  (bucket342 342)
  (bucket343 343)
  (bucket344 344)
  (bucket345 345)
  (bucket346 346)
  (bucket347 347)
  (bucket348 348)
  (bucket349 349)
  (shadow 350)
  (bucket351 351)
  (bucket352 352)
  (bucket353 353)
  (bucket354 354)
  (bucket355 355)
  (bucket356 356)
  (bucket357 357)
  (bucket358 358)
  (bucket359 359)
  (bucket360 360)
  (bucket361 361)
  (bucket362 362)
  (bucket363 363)
  (bucket364 364)
  (bucket365 365)
  (bucket366 366)
  (bucket367 367)
  (bucket368 368)
  (bucket369 369)
  (bucket370 370)
  (bucket371 371)
  (bucket372 372)
  (bucket373 373)
  (bucket374 374)
  (bucket375 375)
  (bucket376 376)
  (bucket377 377)
  (bucket378 378)
  (bucket379 379)
  (bucket380 380)
  (bucket381 381)
  (bucket382 382)
  (bucket383 383)
  (bucket384 384)
  (bucket385 385)
  (bucket386 386)
  (bucket387 387)
  (bucket388 388)
  (bucket389 389)
  (bucket390 390)
  (bucket391 391)
  (bucket392 392)
  (bucket393 393)
  (bucket394 394)
  (bucket395 395)
  (bucket396 396)
  (bucket397 397)
  (bucket398 398)
  (bucket399 399)
  (bucket400 400)
  (bucket401 401)
  (bucket402 402)
  (bucket403 403)
  (bucket404 404)
  (bucket405 405)
  (bucket406 406)
  (bucket407 407)
  (bucket408 408)
  (bucket409 409)
  (bucket410 410)
  (bucket411 411)
  (bucket412 412)
  (bucket413 413)
  (bucket414 414)
  (bucket415 415)
  (bucket416 416)
  (bucket417 417)
  (bucket418 418)
  (bucket419 419)
  (bucket420 420)
  (bucket421 421)
  (bucket422 422)
  (bucket423 423)
  (bucket424 424)
  (bucket425 425)
  (bucket426 426)
  (bucket427 427)
  (bucket428 428)
  (bucket429 429)
  (bucket430 430)
  (bucket431 431)
  (bucket432 432)
  (bucket433 433)
  (bucket434 434)
  (bucket435 435)
  (bucket436 436)
  (bucket437 437)
  (bucket438 438)
  (bucket439 439)
  (bucket440 440)
  (bucket441 441)
  (bucket442 442)
  (bucket443 443)
  (bucket444 444)
  (bucket445 445)
  (bucket446 446)
  (bucket447 447)
  (bucket448 448)
  (bucket449 449)
  (bucket450 450)
  (bucket451 451)
  (bucket452 452)
  (bucket453 453)
  (bucket454 454)
  (bucket455 455)
  (bucket456 456)
  (bucket457 457)
  (bucket458 458)
  (bucket459 459)
  (bucket460 460)
  (bucket461 461)
  (bucket462 462)
  (bucket463 463)
  (bucket464 464)
  (bucket465 465)
  (bucket466 466)
  (bucket467 467)
  (bucket468 468)
  (bucket469 469)
  (bucket470 470)
  (bucket471 471)
  (bucket472 472)
  (bucket473 473)
  (bucket474 474)
  (bucket475 475)
  (bucket476 476)
  (bucket477 477)
  (bucket478 478)
  (bucket479 479)
  (bucket480 480)
  (bucket481 481)
  (bucket482 482)
  (bucket483 483)
  (bucket484 484)
  (bucket485 485)
  (bucket486 486)
  (bucket487 487)
  (bucket488 488)
  (bucket489 489)
  (bucket490 490)
  (bucket491 491)
  (bucket492 492)
  (bucket493 493)
  (bucket494 494)
  (bucket495 495)
  (bucket496 496)
  (bucket497 497)
  (bucket498 498)
  (bucket499 499)
  (bucket500 500)
  (bucket501 501)
  (bucket502 502)
  (bucket503 503)
  (bucket504 504)
  (bucket505 505)
  (bucket506 506)
  (bucket507 507)
  (bucket508 508)
  (bucket509 509)
  (bucket510 510)
  (bucket511 511)
  (bucket512 512)
  (bucket513 513)
  (bucket514 514)
  (bucket515 515)
  (bucket516 516)
  (bucket517 517)
  (bucket518 518)
  (bucket519 519)
  (bucket520 520)
  (bucket521 521)
  (bucket522 522)
  (bucket523 523)
  (bucket524 524)
  (bucket525 525)
  (bucket526 526)
  (bucket527 527)
  (bucket528 528)
  (bucket529 529)
  (bucket530 530)
  (bucket531 531)
  (bucket532 532)
  (bucket533 533)
  (bucket534 534)
  (bucket535 535)
  (bucket536 536)
  (bucket537 537)
  (bucket538 538)
  (bucket539 539)
  (bucket540 540)
  (bucket541 541)
  (bucket542 542)
  (bucket543 543)
  (bucket544 544)
  (bucket545 545)
  (bucket546 546)
  (bucket547 547)
  (bucket548 548)
  (bucket549 549)
  (bucket550 550)
  (bucket551 551)
  (bucket552 552)
  (bucket553 553)
  (bucket554 554)
  (bucket555 555)
  (bucket556 556)
  (bucket557 557)
  (bucket558 558)
  (bucket559 559)
  (bucket560 560)
  (bucket561 561)
  (bucket562 562)
  (bucket563 563)
  (bucket564 564)
  (bucket565 565)
  (bucket566 566) ;; default for prim
  (bucket567 567)
  (bucket568 568)
  (bucket569 569)
  (bucket570 570)
  (bucket571 571)
  (shadow2 572)
  (shadow3 573)
  (bucket574 574)
  (bucket575 575)
  (bucket576 576)
  (bucket577 577) ;; debug?
  (bucket578 578)
  (bucket579 579)
  (bucket580 580)
  (bucket581 581)
  (bucket582 582)
  (bucket583 583)
  (debug-no-zbuf2 584)
  (bucket585 585)
  (bucket586 586)
  )
;; ---bucket-id

;; +++vu1-renderer-mask
;; TODO stolen from Jak 2
(defenum vu1-renderer-mask
  :type uint64
  :bitfield #t
  (rn0)
  (rn1)
  (rn2)
  (sky)
  (ocean)
  (ocean-wave)
  (tfrag)
  (tie)
  (tie-envmap)
  (tie-scissor)
  (tie-envmap-scissor)
  (tie-vanish)
  (generic)
  (merc)
  (emerc)
  (shrubbery)
  (shrub-near)
  (billboard)
  (shrubbery-vanish)
  (tfrag-trans)
  (tie-scissor-trans)
  (tie-trans)
  (tie-envmap-trans)
  (tie-envmap-scissor-trans)
  (tfrag-water)
  (tie-scissor-water)
  (tie-water)
  (tie-envmap-water)
  (tie-envmap-scissor-water)
  (sprite)
  (shadow)
  (rn31)
  (rn32)
  (rn33)
  (depth-cue)
  (rn35)
  (rn36)
  (rn37)
  )
;; ---vu1-renderer-mask

;; +++tpage-category-u32
(defenum tpage-category-u32
  :type uint32
  :copy-entries tpage-category
  )
;; ---tpage-category-u32


;; +++texture-enable-mask
(defenum texture-enable-mask
  :type uint64
  :bitfield #t
  (tex0 0)
  (tex1 1)
  (tex2 2)
  (tex3 3)
  (tex4 4)
  (tex5 5)
  (tex6 6)
  (tex7 7)
  (sky 8)
  (tex9 9)
  (tex10 10)
  (tex11 11)
  (tex12 12)
  (tex13 13)
  (tex14 14)
  (tex15 15)
  (tex16 16)
  )
;; ---texture-enable-mask


;; +++texture-enable-mask-u32
(defenum texture-enable-mask-u32
  :type uint32
  :bitfield #t
  :copy-entries texture-enable-mask
  )
;; ---texture-enable-mask-u32


;; DECOMP BEGINS

(deftype dma-foreground-sink (basic)
  "A specification for where a foreground renderer should output its DMA data."
  ((bucket                    bucket-id)
   (foreground-texture-page   tpage-category)
   (foreground-texture-level  int8)
   (foreground-output-bucket  int8)
   )
  )


(deftype generic-bucket-state (structure)
  "The state of buffers for the generic renderer.
When generating generic DMA data, you must know the previous state
of the VU's memory to properly double-buffer the input and output data."
  ((gifbuf-adr  uint32)
   (inbuf-adr   uint32)
   )
  :pack-me
  )


(deftype generic-dma-foreground-sink (dma-foreground-sink)
  "A specification for where a foreground generic renderer should output DMA data,
and the state of the VU memory buffers at the end of the bucket."
  ((state  generic-bucket-state  :inline)
   )
  )
