;;-*-Lisp-*-
(in-package goal)

;; name: mood-tables2.gc
;; name in dgo: mood-tables2
;; dgos: GAME

;; DECOMP BEGINS

;; this file is debug only
(declare-file (debug))

(define *overide-mood-color-table*
  (new 'static 'mood-color-table :data (new 'static 'inline-array mood-color 8
                                         (new 'static 'mood-color
                                           :lgt-color (new 'static 'vector :x 1.375 :y 1.157)
                                           :amb-color (new 'static 'vector :x 0.625 :y 0.553 :z 0.725 :w 1.0)
                                           )
                                         (new 'static 'mood-color
                                           :lgt-color (new 'static 'vector :x 1.473 :y 1.337 :z 1.0)
                                           :amb-color (new 'static 'vector :x 0.527 :y 0.652 :z 0.75 :w 1.0)
                                           )
                                         (new 'static 'mood-color
                                           :lgt-color (new 'static 'vector :x 1.473 :y 1.348 :z 1.15)
                                           :amb-color (new 'static 'vector :x 0.527 :y 0.652 :z 0.75 :w 1.0)
                                           )
                                         (new 'static 'mood-color
                                           :lgt-color (new 'static 'vector :x 1.473 :y 1.337 :z 1.0)
                                           :amb-color (new 'static 'vector :x 0.527 :y 0.652 :z 0.75 :w 1.0)
                                           )
                                         (new 'static 'mood-color
                                           :lgt-color (new 'static 'vector :x 1.5 :y 1.148)
                                           :amb-color (new 'static 'vector :x 0.5 :y 0.562 :z 0.75 :w 1.0)
                                           )
                                         (new 'static 'mood-color
                                           :lgt-color (new 'static 'vector :x 0.05 :y 0.149 :z 0.375)
                                           :amb-color (new 'static 'vector :x 0.35 :y 0.451 :z 0.625 :w 1.0)
                                           )
                                         (new 'static 'mood-color
                                           :lgt-color (new 'static 'vector :x 0.1 :y 0.35 :z 0.5)
                                           :amb-color (new 'static 'vector :x 0.3 :y 0.35 :z 0.5 :w 1.0)
                                           )
                                         (new 'static 'mood-color
                                           :lgt-color (new 'static 'vector :x 0.1 :y 0.575 :z 0.4)
                                           :amb-color (new 'static 'vector :x 0.3 :y 0.425 :z 0.5 :w 1.0)
                                           )
                                         )
                                 )
  )

(define *overide-mood-fog-table*
  (new 'static 'mood-fog-table :data (new 'static 'inline-array mood-fog 8
                                       (new 'static 'mood-fog
                                         :fog-color (new 'static 'vector :x 160.0 :y 150.0 :z 200.0 :w 128.0)
                                         :fog-dists (new 'static 'vector :x 262144.0 :y 3690496.0 :z 255.0 :w 64.0)
                                         :erase-color (new 'static 'vector :w 128.0)
                                         )
                                       (new 'static 'mood-fog
                                         :fog-color (new 'static 'vector :x 150.0 :y 165.0 :z 220.0 :w 128.0)
                                         :fog-dists (new 'static 'vector :x 262144.0 :y 3690496.0 :z 255.0 :w 64.0)
                                         :erase-color (new 'static 'vector :w 128.0)
                                         )
                                       (new 'static 'mood-fog
                                         :fog-color (new 'static 'vector :x 128.0 :y 180.0 :z 243.0 :w 128.0)
                                         :fog-dists (new 'static 'vector :x 262144.0 :y 3690496.0 :z 255.0 :w 64.0)
                                         :erase-color (new 'static 'vector :w 128.0)
                                         )
                                       (new 'static 'mood-fog
                                         :fog-color (new 'static 'vector :x 150.0 :y 165.0 :z 220.0 :w 128.0)
                                         :fog-dists (new 'static 'vector :x 262144.0 :y 3690496.0 :z 255.0 :w 64.0)
                                         :erase-color (new 'static 'vector :w 128.0)
                                         )
                                       (new 'static 'mood-fog
                                         :fog-color (new 'static 'vector :x 160.0 :y 150.0 :z 200.0 :w 128.0)
                                         :fog-dists (new 'static 'vector :x 262144.0 :y 3690496.0 :z 255.0 :w 64.0)
                                         :erase-color (new 'static 'vector :w 128.0)
                                         )
                                       (new 'static 'mood-fog
                                         :fog-color (new 'static 'vector :x 16.0 :y 32.0 :z 100.0 :w 128.0)
                                         :fog-dists (new 'static 'vector :x 262144.0 :y 3690496.0 :z 255.0 :w 64.0)
                                         :erase-color (new 'static 'vector :w 128.0)
                                         )
                                       (new 'static 'mood-fog
                                         :fog-color (new 'static 'vector :y 24.0 :z 64.0 :w 128.0)
                                         :fog-dists (new 'static 'vector :x 262144.0 :y 3690496.0 :z 255.0 :w 64.0)
                                         :erase-color (new 'static 'vector :w 128.0)
                                         )
                                       (new 'static 'mood-fog
                                         :fog-color (new 'static 'vector :y 56.0 :z 72.0 :w 128.0)
                                         :fog-dists (new 'static 'vector :x 262144.0 :y 3690496.0 :z 255.0 :w 64.0)
                                         :erase-color (new 'static 'vector :w 128.0)
                                         )
                                       )
                               )
  )

;; WARN: Return type mismatch pointer vs none.
(defun init-overide-table ((table mood-table))
  "Similar to the beginning of [[init-mood-control]], does the bare minimum to setup the given [[mood-table]]
   @param! table The table to initialize
   @returns [[none]]"
  (set! (-> table mood-fog-table) (new 'debug 'mood-fog-table))
  (set! (-> table mood-color-table) (new 'debug 'mood-color-table))
  (set! (-> table mood-channel-group) *no-cloud-mood-channel-group*)
  (set! (-> table mood-direction-table) *mood-direction-table*)
  (set! (-> table mood-sky-table) *mood-sky-table*)
  (set! (-> table mood-interp-table) *mood-interp-table*)
  (mem-copy! (the-as pointer (-> table mood-fog-table)) (the-as pointer *no-cloud-clear-mood-fog-table*) 384)
  (mem-copy! (the-as pointer (-> table mood-color-table)) (the-as pointer *no-cloud-mood-color-table*) 256)
  (none)
  )

(define *overide-table* (new 'static 'mood-table))

(init-overide-table *overide-table*)

;; WARN: Return type mismatch object vs none.
(defun print-mood-tables ()
  "Generates the GOAL code for defining the current state of [[*overide-table*]]"
  (mem-copy! (the-as pointer (-> *overide-table* mood-fog-table)) (the-as pointer *overide-mood-fog-table*) 384)
  (mem-copy!
    (the-as pointer (-> *overide-table* mood-color-table))
    (the-as pointer *overide-mood-color-table*)
    256
    )
  (dotimes (data-idx 8)
    (vector-float*!
      (the-as vector (-> *overide-table* mood-fog-table data data-idx))
      (the-as vector (-> *overide-table* mood-fog-table data data-idx))
      (-> *overide-table* mood-fog-table data data-idx fog-color w)
      )
    (vector-float*!
      (the-as vector (-> *overide-table* mood-color-table data data-idx))
      (the-as vector (-> *overide-table* mood-color-table data data-idx))
      (-> *overide-table* mood-color-table data data-idx lgt-color w)
      )
    (vector-float*!
      (the-as vector (+ (the-as uint (-> *overide-table* mood-color-table data 0 amb-color)) (* data-idx 32)))
      (the-as vector (+ (the-as uint (-> *overide-table* mood-color-table data 0 amb-color)) (* data-idx 32)))
      (-> *overide-table* mood-color-table data data-idx amb-color w)
      )
    (set! (-> *overide-table* mood-fog-table data data-idx fog-color w) 128.0)
    (set! (-> *overide-table* mood-color-table data data-idx lgt-color w) 0.0)
    (set! (-> *overide-table* mood-color-table data data-idx amb-color w) 1.0)
    )
  (format 0 "(define *overide-mood-color-table*~%")
  (format 0 "    (new 'static 'mood-color-table~%")
  (format 0 "	 :data (new 'static 'inline-array 'mood-color 0~%")
  (dotimes (_color-idx 8)
    (format 0 "		    (new 'static 'mood-color")
    (let ((color-idx _color-idx))
      (cond
        ((zero? color-idx)
         (format 0 "					; sun rise~%")
         )
        ((= color-idx 1)
         (format 0 "					; morning~%")
         )
        ((= color-idx 2)
         (format 0 "					; noon~%")
         )
        ((= color-idx 3)
         (format 0 "					; afternoon~%")
         )
        ((= color-idx 4)
         (format 0 "					; sunset~%")
         )
        ((= color-idx 5)
         (format 0 "					; twilight~%")
         )
        ((= color-idx 6)
         (format 0 "					; evening~%")
         )
        ((= color-idx 7)
         (format 0 "					; green sun~%")
         )
        )
      )
    (format
      0
      "			 :lgt-color (new 'static 'vector :x ~f :y ~f :z ~f :w ~f)~%"
      (-> *overide-table* mood-color-table data _color-idx lgt-color x)
      (-> *overide-table* mood-color-table data _color-idx lgt-color y)
      (-> *overide-table* mood-color-table data _color-idx lgt-color z)
      (-> *overide-table* mood-color-table data _color-idx lgt-color w)
      )
    (format
      0
      "			 :amb-color (new 'static 'vector :x ~f :y ~f :z ~f :w ~f)~%"
      (-> *overide-table* mood-color-table data _color-idx amb-color x)
      (-> *overide-table* mood-color-table data _color-idx amb-color y)
      (-> *overide-table* mood-color-table data _color-idx amb-color z)
      (-> *overide-table* mood-color-table data _color-idx amb-color w)
      )
    (format 0 "			 )~%")
    )
  (format 0 "		    )~%")
  (format 0 "	 )~%")
  (format 0 "  )~%")
  (format 0 "(define *overide-mood-fog-table*~%")
  (format 0 "    (new 'static 'mood-fog-table~%")
  (format 0 "	 :data (new 'static 'inline-array 'mood-fog 0~%")
  (dotimes (_fog-idx 8)
    (format 0 "		    (new 'static 'mood-fog")
    (let ((fog-idx _fog-idx))
      (cond
        ((zero? fog-idx)
         (format 0 "					; sun rise~%")
         )
        ((= fog-idx 1)
         (format 0 "					; morning~%")
         )
        ((= fog-idx 2)
         (format 0 "					; noon~%")
         )
        ((= fog-idx 3)
         (format 0 "					; afternoon~%")
         )
        ((= fog-idx 4)
         (format 0 "					; sunset~%")
         )
        ((= fog-idx 5)
         (format 0 "					; twilight~%")
         )
        ((= fog-idx 6)
         (format 0 "					; evening~%")
         )
        ((= fog-idx 7)
         (format 0 "					; green sun~%")
         )
        )
      )
    (format
      0
      "			 :fog-color (new 'static 'vector :x ~f :y ~f :z ~f :w ~f)~%"
      (-> *overide-table* mood-fog-table data _fog-idx fog-color x)
      (-> *overide-table* mood-fog-table data _fog-idx fog-color y)
      (-> *overide-table* mood-fog-table data _fog-idx fog-color z)
      (-> *overide-table* mood-fog-table data _fog-idx fog-color w)
      )
    (format
      0
      "			 :fog-start (meters ~f) :fog-end (meters ~f) :fog-min ~f :fog-max ~f ~%"
      (-> *overide-table* mood-fog-table data _fog-idx fog-dists x)
      (-> *overide-table* mood-fog-table data _fog-idx fog-dists y)
      (-> *overide-table* mood-fog-table data _fog-idx fog-dists w)
      (-> *overide-table* mood-fog-table data _fog-idx fog-dists z)
      )
    (format 0 "			 :erase-color (new 'static 'vector :x 0.0 :y 0.0 :z 0.0 :w 128.0)~%")
    (format 0 "			 )~%")
    )
  (format 0 "		    )~%")
  (format 0 "	 )~%")
  (format 0 "  )~%")
  (format 0 "(define *overide-table* (new 'static 'mood-table))~%")
  (none)
  )

;; WARN: Return type mismatch object vs none.
(defun desaturate-mood-colors ((arg0 float) (arg1 float) (arg2 float))
  "Unused - Generate GOAL code for a new [[*overide-mood-color-table*]] definition that desaturates the color
   Apply said overrides to the [[*overide-table*]]"
  (mem-copy!
    (the-as pointer (-> *overide-table* mood-color-table))
    (the-as pointer *no-cloud-mood-color-table*)
    256
    )
  (dotimes (data-idx 8)
    (let ((color-data (-> *overide-table* mood-color-table data data-idx))
          (mood-colors
            (the-as
              (inline-array mood-color)
              (-> (the-as (inline-array mood-color) (-> *overide-table* mood-color-table data 0 amb-color)) data-idx)
              )
            )
          )
      (let ((max-light-color
              (fmax (fmax (-> color-data lgt-color x) (-> color-data lgt-color y)) (-> color-data lgt-color z))
              )
            (max-0th-light-color
              (fmax (fmax (-> mood-colors 0 lgt-color x) (-> mood-colors 0 lgt-color y)) (-> mood-colors 0 lgt-color z))
              )
            )
        (set! (-> color-data lgt-color x)
              (* (+ (-> color-data lgt-color x) (* (- max-light-color (-> color-data lgt-color x)) arg0)) arg1)
              )
        (set! (-> color-data lgt-color y)
              (* (+ (-> color-data lgt-color y) (* (- max-light-color (-> color-data lgt-color y)) arg0)) arg1)
              )
        (set! (-> color-data lgt-color z)
              (* (+ (-> color-data lgt-color z) (* (- max-light-color (-> color-data lgt-color z)) arg0)) arg1)
              )
        (set! (-> color-data lgt-color w) 0.0)
        (set! (-> mood-colors 0 lgt-color x)
              (* (+ (-> mood-colors 0 lgt-color x) (* (- max-0th-light-color (-> mood-colors 0 lgt-color x)) arg0)) arg2)
              )
        (set! (-> mood-colors 0 lgt-color y)
              (* (+ (-> mood-colors 0 lgt-color y) (* (- max-0th-light-color (-> mood-colors 0 lgt-color x)) arg0)) arg2)
              )
        (set! (-> mood-colors 0 lgt-color z)
              (* (+ (-> mood-colors 0 lgt-color z) (* (- max-0th-light-color (-> mood-colors 0 lgt-color x)) arg0)) arg2)
              )
        )
      (set! (-> mood-colors 0 lgt-color w) 1.0)
      )
    )
  (format 0 "(define *overide-mood-color-table*~%")
  (format 0 "    (new 'static 'mood-color-table~%")
  (format 0 "	 :data (new 'static 'inline-array 'mood-color 0~%")
  (dotimes (_color-idx 8)
    (format 0 "		    (new 'static 'mood-color")
    (let ((color-idx _color-idx))
      (cond
        ((zero? color-idx)
         (format 0 "					; sun rise~%")
         )
        ((= color-idx 1)
         (format 0 "					; morning~%")
         )
        ((= color-idx 2)
         (format 0 "					; noon~%")
         )
        ((= color-idx 3)
         (format 0 "					; afternoon~%")
         )
        ((= color-idx 4)
         (format 0 "					; sunset~%")
         )
        ((= color-idx 5)
         (format 0 "					; twilight~%")
         )
        ((= color-idx 6)
         (format 0 "					; evening~%")
         )
        ((= color-idx 7)
         (format 0 "					; green sun~%")
         )
        )
      )
    (format
      0
      "			 :lgt-color (new 'static 'vector :x ~f :y ~f :z ~f :w ~f)~%"
      (-> *overide-table* mood-color-table data _color-idx lgt-color x)
      (-> *overide-table* mood-color-table data _color-idx lgt-color y)
      (-> *overide-table* mood-color-table data _color-idx lgt-color z)
      (-> *overide-table* mood-color-table data _color-idx lgt-color w)
      )
    (format
      0
      "			 :amb-color (new 'static 'vector :x ~f :y ~f :z ~f :w ~f)~%"
      (-> *overide-table* mood-color-table data _color-idx amb-color x)
      (-> *overide-table* mood-color-table data _color-idx amb-color y)
      (-> *overide-table* mood-color-table data _color-idx amb-color z)
      (-> *overide-table* mood-color-table data _color-idx amb-color w)
      )
    (format 0 "			 )~%")
    )
  (format 0 "		    )~%")
  (format 0 "	 )~%")
  (format 0 "  )~%")
  (none)
  )

;; WARN: Return type mismatch object vs none.
(defun desaturate-mood-fog ((arg0 (pointer mood-fog-table)) (arg1 float) (arg2 float))
  "Unused - Generate GOAL code for a new [[*overide-mood-fog-table*]] definition that desaturates the fog color
   Apply said overrides to the [[*overide-table*]]"
  (mem-copy! (the-as pointer (-> *overide-table* mood-fog-table)) arg0 384)
  (dotimes (data-idx 8)
    (let ((fog-data (-> *overide-table* mood-fog-table data data-idx)))
      (let ((max-fog-val (fmax (fmax (-> fog-data fog-color x) (-> fog-data fog-color y)) (-> fog-data fog-color z))))
        (set! (-> fog-data fog-color x)
              (* (+ (-> fog-data fog-color x) (* (- max-fog-val (-> fog-data fog-color x)) arg1)) arg2)
              )
        (set! (-> fog-data fog-color y)
              (* (+ (-> fog-data fog-color y) (* (- max-fog-val (-> fog-data fog-color y)) arg1)) arg2)
              )
        (set! (-> fog-data fog-color z)
              (* (+ (-> fog-data fog-color z) (* (- max-fog-val (-> fog-data fog-color z)) arg1)) arg2)
              )
        )
      (set! (-> fog-data fog-color w) 1.0)
      )
    )
  (format 0 "(define *overide-mood-fog-table*~%")
  (format 0 "    (new 'static 'mood-fog-table~%")
  (format 0 "	 :data (new 'static 'inline-array 'mood-fog 0~%")
  (dotimes (_fog-idx 8)
    (format 0 "		    (new 'static 'mood-fog")
    (let ((fog-idx _fog-idx))
      (cond
        ((zero? fog-idx)
         (format 0 "					; sun rise~%")
         )
        ((= fog-idx 1)
         (format 0 "					; morning~%")
         )
        ((= fog-idx 2)
         (format 0 "					; noon~%")
         )
        ((= fog-idx 3)
         (format 0 "					; afternoon~%")
         )
        ((= fog-idx 4)
         (format 0 "					; sunset~%")
         )
        ((= fog-idx 5)
         (format 0 "					; twilight~%")
         )
        ((= fog-idx 6)
         (format 0 "					; evening~%")
         )
        ((= fog-idx 7)
         (format 0 "					; green sun~%")
         )
        )
      )
    (format
      0
      "			 :fog-color (new 'static 'vector :x ~f :y ~f :z ~f :w ~f)~%"
      (-> *overide-table* mood-fog-table data _fog-idx fog-color x)
      (-> *overide-table* mood-fog-table data _fog-idx fog-color y)
      (-> *overide-table* mood-fog-table data _fog-idx fog-color z)
      (-> *overide-table* mood-fog-table data _fog-idx fog-color w)
      )
    (format
      0
      "			 :fog-start (meters ~f) :fog-end (meters ~f) :fog-min ~f :fog-max ~f ~%"
      (* 0.00024414062 (-> *overide-table* mood-fog-table data _fog-idx fog-dists x))
      (* 0.00024414062 (-> *overide-table* mood-fog-table data _fog-idx fog-dists y))
      (-> *overide-table* mood-fog-table data _fog-idx fog-dists w)
      (-> *overide-table* mood-fog-table data _fog-idx fog-dists z)
      )
    (format 0 "			 :erase-color (new 'static 'vector :x 0.0 :y 0.0 :z 0.0 :w 128.0)~%")
    (format 0 "			 )~%")
    )
  (format 0 "		    )~%")
  (format 0 "	 )~%")
  (format 0 "  )~%")
  (none)
  )

(define *debug-mood-color-table* (-> *mood-control* mood-color-table))

(define *debug-mood-fog-table* (-> *mood-control* mood-fog-table))
