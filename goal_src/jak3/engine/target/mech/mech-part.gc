;;-*-Lisp-*-
(in-package goal)

;; name: mech-part.gc
;; name in dgo: mech-part
;; dgos: LMECH

;; DECOMP BEGINS

(defpart 1037
  :init-specs ((:texture (gun-yellow-muzzleflash level-default-sprite))
    (:birth-func 'birth-func-set-quat)
    (:num 1.0)
    (:y (meters 0))
    (:scale-x (meters 1))
    (:scale-y (meters 3))
    (:r 128.0 128.0)
    (:g 64.0 64.0)
    (:b :copy g)
    (:a 128.0 64.0)
    (:timer (seconds 0.017))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3))
    )
  )

(defpart 1038
  :init-specs ((:texture (glow level-default-sprite))
    (:num 1.0)
    (:y (meters -0.3))
    (:scale-x (meters 1.5) (meters 0.1))
    (:rot-x (degrees 2.25))
    (:scale-y :copy scale-x)
    (:r 255.0)
    (:g 64.0 64.0)
    (:b 0.0)
    (:a 16.0 8.0)
    (:timer (seconds 0.017))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 glow))
    (:userdata 409.6)
    )
  )

(defpart 1039
  :init-specs ((:texture (bigpuff level-default-sprite))
    (:num 1.0 4.0)
    (:y (meters 0) (meters -0.25))
    (:scale-x (meters 0.2) (meters 0.2))
    (:rot-z (degrees 0) 1 (degrees 180))
    (:scale-y (meters 1) (meters 0.6))
    (:r 192.0)
    (:g 64.0)
    (:b 0.0)
    (:a 0.0 16.0)
    (:vel-y (meters -0.06666667) (meters -0.016666668))
    (:scalevel-x (meters 0.033333335))
    (:scalevel-y (meters 0.006666667))
    (:fade-r -2.0)
    (:fade-g 2.0)
    (:fade-b 5.0)
    (:fade-a 0.32)
    (:accel-x (meters 0) (meters 0.0016666667))
    (:accel-y (meters 0.00016666666) (meters 0.0005))
    (:friction 0.94)
    (:timer (seconds 1))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-13 sp-cpuinfo-flag-14))
    (:next-time (seconds 0.085))
    (:next-launcher 1040)
    (:rotate-y (degrees 0) (degrees 360))
    )
  )

(defpart 1040
  :init-specs ((:r 64.0 64.0)
    (:g 64.0 64.0)
    (:b 64.0 64.0)
    (:fade-r 0.0)
    (:fade-g 0.0)
    (:fade-b 0.0)
    (:fade-a -0.128 -0.256)
    )
  )

(defpart 1041
  :init-specs ((:texture (hotdot level-default-sprite))
    (:num 0.1 0.1)
    (:y (meters 0.25) (meters -0.5))
    (:scale-x (meters 0.05))
    (:scale-y (meters 0.5))
    (:r 192.0 64.0)
    (:g 0.0 128.0)
    (:b 0.0)
    (:a 128.0)
    (:vel-y (meters -0.033333335) (meters -0.026666667))
    (:scalevel-x (meters 0.001))
    (:scalevel-y (meters -0.017))
    (:fade-g 0.0)
    (:accel-x (meters 0) (meters 0.0016666667))
    (:accel-y (meters 0.00016666666) (meters 0.0005))
    (:friction 0.96)
    (:timer (seconds 0.167) (seconds 0.247))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 sp-cpuinfo-flag-13 sp-cpuinfo-flag-14))
    (:next-time (seconds 0.1))
    (:next-launcher 1042)
    (:rotate-y (degrees 0) (degrees 360))
    )
  )

(defpart 1042
  :init-specs ((:scalevel-x (meters 0)) (:scalevel-y (meters 0)))
  )

(defpart 1043
  :init-specs ((:num 0.6)
    (:rot-x 8)
    (:r 1638.4)
    (:g 1331.2)
    (:b 1433.6)
    (:vel-y (meters -0.06666667) (meters -0.016666668))
    (:fade-r 32.768)
    (:fade-g 26.623999)
    (:fade-b 28.671999)
    (:accel-x (meters 0) (meters 0.0016666667))
    (:friction 0.94)
    (:timer (seconds 0.335))
    (:flags (distort))
    (:next-time (seconds 0.167))
    (:next-launcher 1044)
    (:rotate-y (degrees 0) (degrees 360))
    )
  )

(defpart 1044
  :init-specs ((:fade-r 0.0) (:fade-g 0.0) (:fade-b -4.096))
  )

(defun mech-spawn-thruster ((arg0 mech-info) (arg1 vector) (arg2 vector) (arg3 float) (arg4 float))
  (rlet ((acc :class vf)
         (vf0 :class vf)
         (vf4 :class vf)
         (vf5 :class vf)
         (vf6 :class vf)
         (vf7 :class vf)
         )
    (init-vf0-vector)
    (set! (-> arg0 part-thruster) (-> *part-id-table* 1037))
    (set! (-> arg0 part-thruster-scale-x) (-> *part-id-table* 1037 init-specs 4))
    (set! (-> arg0 part-thruster-scale-y) (-> *part-id-table* 1037 init-specs 5))
    (let ((s1-0 (new 'stack-no-clear 'quaternion))
          (s0-0 (new 'stack-no-clear 'vector))
          )
      (forward-up->quaternion s1-0 arg2 (new 'static 'vector :y 1.0 :w 1.0))
      (quaternion-rotate-local-x! s1-0 s1-0 32768.0)
      (let ((a0-3 s0-0))
        (let ((v1-10 arg1))
          (let ((a1-4 (/ arg4 2)))
            (.mov vf7 a1-4)
            )
          (.lvf vf5 (&-> arg2 quad))
          (.lvf vf4 (&-> v1-10 quad))
          )
        (.add.x.vf vf6 vf0 vf0 :mask #b1000)
        (.mul.x.vf acc vf5 vf7 :mask #b111)
        (.add.mul.w.vf vf6 vf4 vf0 acc :mask #b111)
        (.svf (&-> a0-3 quad) vf6)
        )
      (set! (-> arg0 part-thruster-scale-x initial-valuef) arg3)
      (set! (-> arg0 part-thruster-scale-y initial-valuef) arg4)
      (dotimes (s4-1 2)
        (quaternion-rotate-local-z! s1-0 s1-0 16384.0)
        (quaternion-copy! (-> arg0 part-quat) s1-0)
        (let ((t9-4 sp-launch-particles-var)
              (a0-6 (-> arg0 particle-system-3d))
              (a1-7 (-> arg0 part-thruster))
              (a2-4 *launch-matrix*)
              )
          (set! (-> a2-4 trans quad) (-> s0-0 quad))
          (t9-4
            (the-as sparticle-system a0-6)
            a1-7
            a2-4
            (the-as sparticle-launch-state #f)
            (the-as sparticle-launch-control #f)
            1.0
            )
          )
        )
      )
    (launch-particles (-> *part-id-table* 1043) arg1)
    (launch-particles (-> *part-id-table* 1038) arg1)
    (cond
      ((!= (-> *setting-control* user-current under-water-pitch-mod) 0.0)
       (launch-particles (-> *part-id-table* 1043) arg1)
       )
      (else
        (launch-particles (-> *part-id-table* 1039) arg1)
        (launch-particles (-> *part-id-table* 1041) arg1)
        )
      )
    0
    (none)
    )
  )

(defpart 1045
  :init-specs ((:texture (bigpuff level-default-sprite))
    (:num 3.0)
    (:x (meters -16) (meters 32))
    (:y (meters 0) (meters 12))
    (:z (meters -16) (meters 32))
    (:scale-x (meters 0.1) (meters 0.3))
    (:rot-x 4)
    (:rot-z (degrees 0) (degrees 3600))
    (:scale-y (meters 0.1) (meters 0.1))
    (:r 0.0 64.0)
    (:g 64.0 128.0)
    (:b 64.0 196.0)
    (:a 0.0)
    (:vel-y (meters -0.0033333334) (meters 0.006666667))
    (:rotvel-z (degrees -0.4) (degrees 0.8))
    (:fade-a 0.21333334 0.21333334)
    (:timer (seconds 2.5))
    (:flags (sp-cpuinfo-flag-2))
    (:userdata 0.0)
    (:func 'check-water-level-above-and-die)
    (:next-time (seconds 0.5))
    (:next-launcher 1046)
    (:conerot-x (degrees 0) (degrees 3600))
    (:conerot-y (degrees 0) (degrees 3600))
    (:rotate-y (degrees 0) (degrees 3600))
    (:conerot-radius (meters -3) (meters 8))
    )
  )

(defpart 1046
  :init-specs ((:fade-a 0.0) (:next-time (seconds 1)) (:next-launcher 1047))
  )

(defpart 1047
  :init-specs ((:fade-a -0.21333334 -0.21333334))
  )

(defpart 1048
  :init-specs ((:texture (lakedrop level-default-sprite))
    (:num 0.2)
    (:x (meters -24) (meters 48))
    (:y (meters -4) (meters 4))
    (:z (meters -24) (meters 48))
    (:scale-x (meters 0.15) (meters 0.15))
    (:scale-y (meters 0.1) (meters 0.1))
    (:r 255.0)
    (:g 255.0)
    (:b 255.0)
    (:a 0.0)
    (:vel-y (meters 0.008333334) (meters 0.005))
    (:fade-a 0.16)
    (:timer (seconds 16))
    (:flags (sp-cpuinfo-flag-0 sp-cpuinfo-flag-2 sp-cpuinfo-flag-3))
    (:userdata 0.0)
    (:func 'check-water-level-above-and-die)
    (:next-time (seconds 0.33) (seconds 0.657))
    (:next-launcher 1049)
    (:rotate-y (degrees 0) (degrees 3600))
    )
  )

(defpart 1049
  :init-specs ((:fade-a 0.0) (:next-time (seconds 1) (seconds 5.997)) (:next-launcher 1050))
  )

(defpart 1050
  :init-specs ((:scalevel-x (meters -0.00033333333) (meters -0.00066666666))
    (:scalevel-y :copy scalevel-x)
    (:fade-a -0.16)
    (:accel-y (meters -0.0001) (meters -0.0001))
    )
  )

(defpart 1051
  :init-specs ((:texture (lakedrop level-default-sprite))
    (:num 1.0)
    (:scale-x (meters 0.15) (meters 0.15))
    (:scale-y (meters 0.1) (meters 0.1))
    (:r 255.0)
    (:g 255.0)
    (:b 255.0)
    (:a 0.0)
    (:vel-y (meters 0.008333334) (meters 0.005))
    (:fade-a 0.16)
    (:accel-y (meters 0.0002))
    (:friction 0.97 0.01)
    (:timer (seconds 4))
    (:flags (sp-cpuinfo-flag-0 sp-cpuinfo-flag-2 sp-cpuinfo-flag-3))
    (:userdata 0.0)
    (:func 'check-water-level-above-and-die)
    (:next-time (seconds 0.33) (seconds 0.657))
    (:next-launcher 1052)
    (:conerot-x (degrees 0) (degrees 3600))
    (:conerot-y (degrees 0) (degrees 3600))
    (:conerot-radius (meters 0) (meters 0.5))
    )
  )

(defpart 1052
  :init-specs ((:fade-a 0.0) (:next-time (seconds 1) (seconds 0.997)) (:next-launcher 1050))
  )

(defpartgroup group-mech-explode-death
  :id 236
  :duration (seconds 0.25)
  :linger-duration (seconds 2)
  :bounds (static-bspherem 0 0 0 2)
  :parts ((sp-item 153) (sp-item 154))
  )

(defpart 1053
  :init-specs ((:num 4.0)
    (:x (meters -1) (meters 3))
    (:y (meters 0) (meters 4))
    (:rot-x 6)
    (:r 4096.0)
    (:g 2662.4)
    (:b 2867.2)
    (:vel-y (meters 0.0033333334) (meters 0.01))
    (:accel-y (meters 0.0016666667) (meters 0.00033333333))
    (:friction 0.9)
    (:timer (seconds 0.4))
    (:flags (distort))
    (:next-time (seconds 0.135) (seconds 0.13))
    (:next-launcher 1054)
    (:rotate-y (degrees 0) (degrees 3600))
    )
  )

(defpart 1054
  :init-specs ((:fade-b -5.12))
  )

(defpart 1055
  :init-specs ((:texture (bigpuff level-default-sprite))
    (:birth-func 'birth-func-texture-group)
    (:num 16.0 4.0)
    (:x (meters -1) (meters 3))
    (:y (meters 0) (meters 4))
    (:scale-x (meters 0.5) (meters 0.25))
    (:scale-y (meters 1) (meters 0.25))
    (:r 255.0)
    (:g 0.0 128.0)
    (:b 0.0)
    (:a 32.0 32.0)
    (:vel-y (meters 0.0033333334) (meters 0.01))
    (:scalevel-x (meters 0.013333334) (meters 0.006666667))
    (:scalevel-y :copy scalevel-x)
    (:accel-y (meters 0.0016666667) (meters 0.00033333333))
    (:friction 0.9)
    (:timer (seconds 0.367))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3))
    (:userdata :data (new 'static 'boxed-array :type int32 40 1 0 #x400000 #x400f00 #x400f00))
    (:next-time (seconds 0.167))
    (:next-launcher 1056)
    (:rotate-y (degrees 0) (degrees 3600))
    )
  )

(defpart 1056
  :init-specs ((:fade-a -0.53333336 -0.53333336))
  )

(defpart 1057
  :init-specs ((:texture (glow level-default-sprite))
    (:num 1.0)
    (:scale-x (meters 0.2) (meters 4))
    (:rot-x (degrees 11.25))
    (:rot-z (degrees 0) (degrees 8))
    (:scale-y :copy scale-x)
    (:r 0.0)
    (:g 64.0 64.0)
    (:b 255.0)
    (:a 32.0 64.0)
    (:timer (seconds 0.017))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 glow))
    (:userdata 4096.0)
    (:conerot-x (degrees 0) (degrees 3600))
    (:conerot-y (degrees 0) (degrees 3600))
    (:conerot-radius (meters -0.1) (meters 0.5))
    )
  )

(defpart 1058
  :init-specs ((:texture (motion-blur-part level-default-sprite))
    (:num 2.0 4.0)
    (:scale-x (meters 2.5))
    (:rot-x 4)
    (:scale-y (meters 0.04) (meters 0.03))
    (:r 0.0)
    (:g 64.0 64.0)
    (:b 255.0)
    (:a 128.0)
    (:omega (degrees 0.01125) (degrees 0.01125))
    (:vel-y (meters 0.1) (meters 0.2))
    (:fade-g -2.55 -2.55)
    (:fade-b -2.0)
    (:fade-a -0.64 -0.64)
    (:accel-y (meters -0.0033333334) (meters -0.0033333334))
    (:friction 0.8 0.02)
    (:timer (seconds 0.335))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3))
    (:func 'sparticle-motion-blur)
    (:conerot-x (degrees 0) (degrees 3600))
    (:conerot-y (degrees 0) (degrees 3600))
    )
  )
