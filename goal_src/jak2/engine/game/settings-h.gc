;;-*-Lisp-*-
(in-package goal)

;; name: settings-h.gc
;; name in dgo: settings-h
;; dgos: ENGINE, GAME

;; DECOMP BEGINS

(deftype user-setting-data (structure)
  ((border-mode           symbol               :offset-assert   0)
   (process-mask          process-mask         :offset-assert   4)
   (language              language-enum        :offset         16)
   (movie                 (pointer process)    :offset         40)
   (talking               (pointer process)    :offset-assert  44)
   (spooling              (pointer process)    :offset-assert  48)
   (hint                  (pointer process)    :offset-assert  52)
   (ambient               (pointer process)    :offset-assert  56)
   (video-mode            symbol               :offset-assert  60)
   (aspect-ratio          symbol               :offset-assert  64)
   (auto-save             symbol               :offset         72)
   (bg-r                  float                :offset-assert  76)
   (bg-g                  float                :offset-assert  80)
   (bg-b                  float                :offset-assert  84)
   (bg-a                  float                :offset-assert  88)
   (bg-a-speed            float                :offset-assert  92)
   (bg-a-force            float                :offset-assert  96)
   (allow-progress        symbol               :offset-assert 100)
   (allow-pause           symbol               :offset-assert 104)
   (movie-name            symbol               :offset        120)
   (weather               symbol               :offset-assert 124)
   (task-mask             task-mask            :offset        136)
   (duck                  symbol               :offset        144)
   (attack                symbol               :offset-assert 148)
   (gun                   symbol               :offset-assert 152)
   (board                 symbol               :offset-assert 156)
   (jump                  symbol               :offset-assert 160)
   (speed-mult            float                :offset-assert 164)
   (features              uint64               :offset-assert 168)
   (sfx-volume            float                :offset-assert 176)
   (sfx-movie-volume      float                :offset-assert 180)
   (music-volume          float                :offset-assert 184)
   (music-volume-movie    float                :offset-assert 188)
   (dialog-volume         float                :offset-assert 192)
   (dialog-volume-hint    float                :offset-assert 196)
   (ambient-volume        float                :offset-assert 200)
   (ambient-volume-move   float                :offset-assert 204)
   (sound-flava           uint8                :offset-assert 208)
   (sound-flava-priority  float                :offset-assert 212)
   (mode-sound-bank       uint32               :offset-assert 216)
   (sound-excitement      float                :offset-assert 220)
   (sound-reverb          float                :offset-assert 224)
   (stereo-mode           int32                :offset-assert 228)
   (music                 symbol               :offset-assert 232)
   (sound-stinger         int32                :offset-assert 236)
   (spool-anim            symbol               :offset-assert 240)
   (sound-mode            uint32               :offset-assert 244)
   (task-manager          (pointer process)    :offset-assert 248)
   (task                  symbol               :offset-assert 252)
   (airlock               symbol               :offset-assert 256)
   (minimap               uint16               :offset-assert 260)
   (sound-tune            uint32               :offset-assert 264)
   (allow-continue        symbol               :offset-assert 268)
   (spotlight-color       rgba                 :offset-assert 272)
   (subtitle              symbol               :offset-assert 276)
   (borrow                symbol               :offset-assert 280)
   (doorway               symbol               :offset-assert 284)
   (gen                   symbol               :offset-assert 288)
   (half-speed            symbol               :offset-assert 292)
   (gun-buoy              symbol               :offset-assert 296)
   (double-jump           symbol               :offset-assert 300)
   (pilot                 symbol               :offset-assert 304)
   (pilot-exit            symbol               :offset-assert 308)
   (exclusive-task        int32                :offset-assert 312)
   (speech-control        symbol               :offset-assert 316)
   (vehicle-hijacking     symbol               :offset-assert 320)
   (darkjak               symbol               :offset-assert 324)
   (endlessfall           symbol               :offset-assert 328)
   (rain                  float                :offset-assert 332)
   (snow                  float                :offset-assert 336)
   (exclusive-load        symbol               :offset-assert 340)
   (render                symbol               :offset-assert 344)
   (allow-timeout         symbol               :offset-assert 348)
   (mirror                symbol               :offset-assert 352)
   (movie-skip-frame      float                :offset-assert 356)
   (allow-blackout        symbol               :offset-assert 360)
   (race-minimap          int32                :offset-assert 364)
   (extra-bank            symbol               :offset-assert 368)
   (beard                 symbol               :offset-assert 372)
   (ignore-target         symbol               :offset-assert 376)
   (subtitle-language     language-enum        :offset-assert 384)
   (sound-bank-load       symbol               :offset-assert 392)
   (allow-error           symbol               :offset-assert 396)
   (under-water-pitch-mod float                :offset-assert 400)
   (dummy                 object            31 :offset-assert 404)
   )
  :method-count-assert 11
  :size-assert         #x210
  :flag-assert         #xb00000210
  (:methods
    (user-setting-data-method-9 () none 9)
    (user-setting-data-method-10 () none 10)
    )
  )

;; definition for method 3 of type user-setting-data
(defmethod inspect user-setting-data ((obj user-setting-data))
  (when (not obj)
    (return obj)
    )
  (format #t "[~8x] ~A~%" obj 'user-setting-data)
  (format #t "~1Tborder-mode: ~A~%" (-> obj border-mode))
  (format #t "~1Tprocess-mask: #x~X~%" (-> obj process-mask))
  (let ((t9-3 format)
        (a0-4 #t)
        (a1-3 "~1Tlanguage: #x~X : ~S~%")
        (a2-3 (-> obj language))
        (v1-2 (-> obj language))
        )
    (t9-3 a0-4 a1-3 a2-3 (cond
                           ((= v1-2 (language-enum english))
                            "english"
                            )
                           ((= v1-2 (language-enum uk-english))
                            "uk-english"
                            )
                           ((= v1-2 (language-enum french))
                            "french"
                            )
                           ((= v1-2 (language-enum korean))
                            "korean"
                            )
                           ((= v1-2 (language-enum german))
                            "german"
                            )
                           ((= v1-2 (language-enum spanish))
                            "spanish"
                            )
                           ((= v1-2 (language-enum italian))
                            "italian"
                            )
                           ((= v1-2 (language-enum japanese))
                            "japanese"
                            )
                           (else
                             "*unknown*"
                             )
                           )
          )
    )
  (format #t "~1Tmovie: ~A~%" (ppointer->process (-> obj movie)))
  (format #t "~1Ttalking: ~A~%" (ppointer->process (-> obj talking)))
  (format #t "~1Tspooling: ~A~%" (ppointer->process (-> obj spooling)))
  (format #t "~1Thint: ~A~%" (ppointer->process (-> obj hint)))
  (format #t "~1Tambient: ~A~%" (ppointer->process (-> obj ambient)))
  (format #t "~1Tvideo-mode: ~A~%" (-> obj video-mode))
  (format #t "~1Taspect-ratio: ~A~%" (-> obj aspect-ratio))
  (format #t "~1Tauto-save: ~A~%" (-> obj auto-save))
  (format #t "~1Tbg-r: ~f~%" (-> obj bg-r))
  (format #t "~1Tbg-g: ~f~%" (-> obj bg-g))
  (format #t "~1Tbg-b: ~f~%" (-> obj bg-b))
  (format #t "~1Tbg-a: ~f~%" (-> obj bg-a))
  (format #t "~1Tbg-a-speed: ~f~%" (-> obj bg-a-speed))
  (format #t "~1Tbg-a-force: ~f~%" (-> obj bg-a-force))
  (format #t "~1Tallow-progress: ~A~%" (-> obj allow-progress))
  (format #t "~1Tallow-pause: ~A~%" (-> obj allow-pause))
  (format #t "~1Tmovie-name: ~A~%" (-> obj movie-name))
  (format #t "~1Tweather: ~A~%" (-> obj weather))
  (format #t "~1Ttask-mask: #x~X : (task-mask " (-> obj task-mask))
  (let ((s5-0 (-> obj task-mask)))
    (if (= (logand s5-0 (task-mask task0)) (task-mask task0))
        (format #t "task0 ")
        )
    (if (= (logand s5-0 (task-mask task2)) (task-mask task2))
        (format #t "task2 ")
        )
    (if (= (logand s5-0 (task-mask task4)) (task-mask task4))
        (format #t "task4 ")
        )
    (if (= (logand s5-0 (task-mask task6)) (task-mask task6))
        (format #t "task6 ")
        )
    (if (= (logand s5-0 (task-mask ctywide)) (task-mask ctywide))
        (format #t "ctywide ")
        )
    (if (= (logand s5-0 (task-mask never)) (task-mask never))
        (format #t "never ")
        )
    (if (= (logand (task-mask movie1) s5-0) (task-mask movie1))
        (format #t "movie1 ")
        )
    (if (= (logand s5-0 (task-mask dummy1)) (task-mask dummy1))
        (format #t "dummy1 ")
        )
    (if (= (logand s5-0 (task-mask primary0)) (task-mask primary0))
        (format #t "primary0 ")
        )
    (if (= (logand s5-0 (task-mask task1)) (task-mask task1))
        (format #t "task1 ")
        )
    (if (= (logand s5-0 (task-mask task3)) (task-mask task3))
        (format #t "task3 ")
        )
    (if (= (logand s5-0 (task-mask task5)) (task-mask task5))
        (format #t "task5 ")
        )
    (if (= (logand s5-0 (task-mask task7)) (task-mask task7))
        (format #t "task7 ")
        )
    (if (= (logand (task-mask movie2) s5-0) (task-mask movie2))
        (format #t "movie2 ")
        )
    (if (= (logand s5-0 (task-mask dummy2)) (task-mask dummy2))
        (format #t "dummy2 ")
        )
    (if (= (logand s5-0 (task-mask done)) (task-mask done))
        (format #t "done ")
        )
    (if (= (logand s5-0 (task-mask special)) (task-mask special))
        (format #t "special ")
        )
    (if (= (logand (task-mask movie0) s5-0) (task-mask movie0))
        (format #t "movie0 ")
        )
    (if (= (logand s5-0 (task-mask dummy0)) (task-mask dummy0))
        (format #t "dummy0 ")
        )
    )
  (format #t ")~%")
  (format #t "~1Tduck: ~A~%" (-> obj duck))
  (format #t "~1Tattack: ~A~%" (-> obj attack))
  (format #t "~1Tgun: ~A~%" (-> obj gun))
  (format #t "~1Tboard: ~A~%" (-> obj board))
  (format #t "~1Tjump: ~A~%" (-> obj jump))
  (format #t "~1Tspeed-mult: ~f~%" (-> obj speed-mult))
  (format #t "~1Tfeatures: ~D~%" (-> obj features))
  (format #t "~1Tsfx-volume: ~f~%" (-> obj sfx-volume))
  (format #t "~1Tsfx-volume-movie: ~f~%" (-> obj sfx-movie-volume))
  (format #t "~1Tmusic-volume: ~f~%" (-> obj music-volume))
  (format #t "~1Tmusic-volume-movie: ~f~%" (-> obj music-volume-movie))
  (format #t "~1Tdialog-volume: ~f~%" (-> obj dialog-volume))
  (format #t "~1Tdialog-volume-hint: ~f~%" (-> obj dialog-volume-hint))
  (format #t "~1Tambient-volume: ~f~%" (-> obj ambient-volume))
  (format #t "~1Tambient-volume-movie: ~f~%" (-> obj ambient-volume-move))
  (format #t "~1Tsound-flava: ~D~%" (-> obj sound-flava))
  (format #t "~1Tsound-flava-priority: ~f~%" (-> obj sound-flava-priority))
  (format #t "~1Tmode-sound-bank: ~A~%" (-> obj mode-sound-bank))
  (format #t "~1Tsound-excitement: ~f~%" (-> obj sound-excitement))
  (format #t "~1Tsound-reverb: ~f~%" (-> obj sound-reverb))
  (format #t "~1Tstereo-mode: ~D~%" (-> obj stereo-mode))
  (format #t "~1Tmusic: ~A~%" (-> obj music))
  (format #t "~1Tsound-stinger: ~D~%" (-> obj sound-stinger))
  (format #t "~1Tspool-anim: ~A~%" (-> obj spool-anim))
  (format #t "~1Tsound-mode: ~D~%" (-> obj sound-mode))
  (format #t "~1Ttask-manager: ~A~%" (ppointer->process (-> obj task-manager)))
  (format #t "~1Ttask: ~A~%" (-> obj task))
  (format #t "~1Tairlock: ~A~%" (-> obj airlock))
  (format #t "~1Tminimap: ~D~%" (-> obj minimap))
  (format #t "~1Tsound-tune: ~D~%" (-> obj sound-tune))
  (format #t "~1Tallow-continue: ~A~%" (-> obj allow-continue))
  (format #t "~1Tspotlight-color: ~D~%" (-> obj spotlight-color))
  (format #t "~1Tsubtitle: ~A~%" (-> obj subtitle))
  (format #t "~1Tborrow: ~A~%" (-> obj borrow))
  (format #t "~1Tdoorway: ~A~%" (-> obj doorway))
  (format #t "~1Tgem: ~A~%" (-> obj gen))
  (format #t "~1Thalf-speed: ~A~%" (-> obj half-speed))
  (format #t "~1Tgun-buoy: ~A~%" (-> obj gun-buoy))
  (format #t "~1Tdouble-jump: ~A~%" (-> obj double-jump))
  (format #t "~1Tpilot: ~A~%" (-> obj pilot))
  (format #t "~1Tpilot-exit: ~A~%" (-> obj pilot-exit))
  (format #t "~1Texclusive-task: ~D~%" (-> obj exclusive-task))
  (format #t "~1Tspeech-control: ~A~%" (-> obj speech-control))
  (format #t "~1Tvehicle-hijacking: ~A~%" (-> obj vehicle-hijacking))
  (format #t "~1Tdarkjak: ~A~%" (-> obj darkjak))
  (format #t "~1Tendlessfall: ~A~%" (-> obj endlessfall))
  (format #t "~1Train: ~f~%" (-> obj rain))
  (format #t "~1Tsnow: ~f~%" (-> obj snow))
  (format #t "~1Texclusive-load: ~A~%" (-> obj exclusive-load))
  (format #t "~1Trender: ~A~%" (-> obj render))
  (format #t "~1Tallow-timeout: ~A~%" (-> obj allow-timeout))
  (format #t "~1Tmirror: ~A~%" (-> obj mirror))
  (format #t "~1Tmovie-skip-frame: ~f~%" (-> obj movie-skip-frame))
  (format #t "~1Tallow-blackout: ~A~%" (-> obj allow-blackout))
  (format #t "~1Trace-minimap: ~D~%" (-> obj race-minimap))
  (format #t "~1Textra-bank: ~A~%" (-> obj extra-bank))
  (format #t "~1Tbeard: ~A~%" (-> obj beard))
  (format #t "~1Tignore-target: ~A~%" (-> obj ignore-target))
  (format #t "~1Tsubtitle-language: ~D~%" (-> obj subtitle-language))
  (format #t "~1Tsound-bank-load: ~A~%" (-> obj sound-bank-load))
  (format #t "~1Tallow-error: ~A~%" (-> obj allow-error))
  (format #t "~1Tunder-water-pitch-mod: ~f~%" (-> obj under-water-pitch-mod))
  (format #t "~1Tdummy[31] @ #x~X~%" (-> obj dummy))
  obj
  )

(defenum cam-slave-options
  :type uint64
  :bitfield #t
  (BUTT_CAM)
  (SAME_SIDE)
  (MOVE_SPHERICAL)
  (ALLOW_Z_ROT)
  (JUMP_PITCHES)
  (COLLIDE)
  (FIND_HIDDEN_TARGET)
  (DRAG)
  (PLAYER_MOVING_CAMERA)
  (LINE_OF_SIGHT)
  (MOVEMENT_BLOCKED)
  (SHRINK_MAX_ANGLE)
  (GOTO_GOOD_POINT)
  (BIKE_MODE)
  (NO_ROTATE)
  (STICKY_ANGLE)
  (BLOCK_RIGHT_STICK)
  (ALLOW_SHIFT_BUTTONS)
  (GUN_CAM)
  (WIDE_FOV)
  (RAPID_TRACKING)
  (EASE_SPLINE_IDX)
  (VERTICAL_FOLLOW_MATCHES_CAMERA)
  (HAVE_BUTT_HANDLE)
  )

(defenum cam-master-options
  :type uint64
  :bitfield #t
  (HAVE_TARGET) ;; 1
  (SET_COMBINER_AXIS) ;; 2
  (FLIP_COMBINER) ;; 4
  (HAVE_EASE_TO_POS) ;; 8
  (IN_BASE_REGION) ;; 10
  (IGNORE_ANALOG) ;; 20
  (READ_BUTTONS) ;; 40
  (IMMEDIATE_STRING_MIN_MAX) ;; 80
  )

(deftype cam-setting-data (structure)
  ((fov                           degrees                    :offset-assert   0)
   (pov-handle                    handle                     :offset         16)
   (pov-bone                      int32                      :offset-assert  24)
   (pov-offset                    vector             :inline :offset-assert  32)
   (string-default                symbol                     :offset-assert  48)
   (string-max-length             meters                     :offset-assert  52)
   (string-min-length             meters                     :offset-assert  56)
   (string-max-height             meters                     :offset-assert  60)
   (string-min-height             meters                     :offset-assert  64)
   (string-cliff-height           meters                     :offset-assert  68)
   (string-camera-ceiling         meters                     :offset-assert  72)
   (gun-max-height                meters                     :offset-assert  76)
   (gun-min-height                meters                     :offset-assert  80)
   (string-local-down             vector             :inline :offset-assert  96)
   (slave-options                 cam-slave-options          :offset-assert 112)
   (matrix-blend-max-angle        degrees                    :offset-assert 120)
   (matrix-blend-max-partial      float                      :offset-assert 124)
   (string-spline-max-move        meters                     :offset-assert 128)
   (string-spline-accel           meters                     :offset-assert 132)
   (string-spline-max-move-player meters                     :offset-assert 136)
   (string-spline-accel-player    meters                     :offset-assert 140)
   (string-startup-vector         vector             :inline :offset-assert 144)
   (string-use-startup-vector     symbol                     :offset-assert 160)
   (look-at-point                 vector             :inline :offset-assert 176)
   (use-look-at-point             symbol                     :offset-assert 192)
   (target-height                 meters                     :offset-assert 196)
   (foot-offset                   meters                     :offset-assert 200)
   (head-offset                   meters                     :offset-assert 204)
   (teleport-on-entity-change     symbol                     :offset-assert 208)
   (entity-name                   string                     :offset-assert 212)
   (entity-or-mode-changed        symbol                     :offset-assert 216)
   (master-options                cam-master-options         :offset-assert 224)
   (entity-mask                   uint32                     :offset-assert 232)
   (mode-name                     symbol                     :offset-assert 236)
   (real-entity-name              string                     :offset-assert 240)
   (cam-mode                      symbol                     :offset-assert 244)
   (interp-time                   uint32                     :offset-assert 248)
   (no-intro                      symbol                     :offset-assert 252)
   (use-point-of-interest         symbol                     :offset-assert 256)
   (point-of-interest             vector             :inline :offset-assert 272)
   (handle-of-interest            handle                     :offset-assert 288)
   (mouse-tumble-point            vector             :inline :offset-assert 304)
   (use-mouse-tumble-point        symbol                     :offset-assert 320)
   (mouse-input                   symbol                     :offset-assert 324)
   (cpad1-skip-buttons            symbol                     :offset-assert 328)
   (butt-handle                   handle                     :offset-assert 336)
   (butt-angle                    float                      :offset-assert 344)
   (extra-follow-height           float                      :offset-assert 348)
   (1Tinterp-time-priority        uint32                     :offset-assert 352)
   (string-max-length-default     symbol                     :offset-assert 356)
   (string-min-length-default     symbol                     :offset-assert 360)
   (string-max-height-default     symbol                     :offset-assert 364)
   (string-min-height-default     symbol                     :offset-assert 368)
   (dummy                         object             102     :offset-assert 372)
   )
  :method-count-assert 11
  :size-assert         #x30c
  :flag-assert         #xb0000030c
  (:methods
    (cam-setting-data-method-9 () none 9)
    (cam-setting-data-method-10 () none 10)
    )
  )

(deftype setting-control (basic)
  ((user-current                 user-setting-data :inline :offset-assert  16)
   (user-target                  user-setting-data :inline :offset-assert 544)
   (user-default                 user-setting-data :inline :offset-assert 1072)
   (cam-current                  cam-setting-data  :inline :offset-assert 1600)
   (cam-target                   cam-setting-data  :inline :offset-assert 2384)
   (cam-default                  cam-setting-data  :inline :offset-assert 3168)
   (engine                       engine                    :offset-assert 3948)
   (engine-pers                  basic                     :offset-assert 3952)
   (engine-hi                    basic                     :offset-assert 3956)
   (sound-stinger-time           time-frame                :offset-assert 3960)
   (sound-stinger-change-time    time-frame        4       :offset-assert 3968)
   (sound-excitement-change-time time-frame                :offset-assert 4000)
   (sound-excitement-targ        float                     :offset-assert 4008)
   (sound-excitement-level       uint32                    :offset-assert 4012)
   )
  :method-count-assert 19
  :size-assert         #xfb0
  :flag-assert         #x1300000fb0
  (:methods
    (new (symbol type int) _type_ 0)
    (setting-control-method-9 () none 9)
    (setting-control-method-10 () none 10)
    (set-setting (_type_ process symbol object object object) none 11)
    (setting-control-method-12 () none 12)
    (setting-control-method-13 () none 13)
    (setting-control-method-14 () none 14)
    (setting-control-method-15 () none 15)
    (setting-control-method-16 () none 16)
    (setting-control-method-17 () none 17)
    (update (_type_) none 18)
    )
  )


(defmethod new setting-control ((allocation symbol) (type-to-make type) (arg0 int))
  (let ((s4-0 (object-new allocation type-to-make (the-as int (-> type-to-make size)))))
    (set! (-> s4-0 engine) ((method-of-type engine new) allocation engine 'setting-control arg0 connection))
    (set! (-> s4-0 engine-hi) ((method-of-type engine new) allocation engine 'setting-control arg0 connection))
    (set! (-> s4-0 engine-pers)
          ((method-of-type engine-pers new) allocation engine-pers 'setting-control arg0 connection-pers)
          )
    s4-0
    )
  )

;; DECOMP ENDS
(define-extern *setting-control* setting-control)


(defmacro setting-control-func! (func s &rest args)
  (let ((argb #f)
        (argi 0)
        (argf 0.0)
        (setting (car s)))
    (cond
      (#t
        (set! argb (car args))
        (set! argf (cadr args))
        (set! argi (caddr args))
        )
      )
    `(,func *setting-control* (with-pp pp) ,s ,argb ,argf ,argi)
    )
  )

(defmacro add-setting! (s &rest args)
  `(setting-control-func! add-setting ,s ,@args)
  )
(defmacro set-setting! (s &rest args)
  `(setting-control-func! set-setting ,s ,@args)
  )
(defmacro remove-setting! (s)
  `(remove-setting *setting-control* (with-pp pp) ,s)
  )