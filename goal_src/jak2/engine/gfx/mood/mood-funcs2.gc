;;-*-Lisp-*-
(in-package goal)

;; name: mood-funcs2.gc
;; name in dgo: mood-funcs2
;; dgos: ENGINE, GAME

;; DECOMP BEGINS

(deftype default-interior-states (structure)
  ()
  :method-count-assert 9
  :size-assert         #x0
  :flag-assert         #x900000000
  )


(defbehavior update-mood-default-interior time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (-> arg0 state)
      (set! (-> arg0 times 0 w) 1.0)
      (set! (-> arg0 times 1 w) 1.0)
      (set! (-> arg0 times 2 w) 1.0)
      (set! (-> arg0 times 3 w) 1.0)
      (set! (-> arg0 times 4 w) 1.0)
      (set! (-> arg0 times 5 w) 1.0)
      (set! (-> arg0 times 6 w) 1.0)
      (set! (-> arg0 times 7 w) 1.0)
      )
    )
  0
  (none)
  )

(deftype vinroom-states (structure)
  ((main     float  :offset-assert   0)
   (flicker1 float  :offset-assert   4)
   (flicker2 float  :offset-assert   8)
   (warp     float  :offset-assert  12)
   )
  :method-count-assert 9
  :size-assert         #x10
  :flag-assert         #x900000010
  )


(defun update-vinroom-lights ((arg0 mood-context))
  (let ((v1-0 (-> arg0 light-group)))
    (set-vector! (-> arg0 current-env-color) 48.0 60.0 96.0 255.0)
    (set-vector! (-> v1-0 0 dir0 color) 0.061 0.854 1.0 1.0)
    (set-vector! (-> v1-0 0 dir1 color) 0.858 0.932 1.0 1.0)
    (let ((a0-4 (-> v1-0 0 dir1)))
      (set! (-> a0-4 direction x) -0.6499)
      (set! (-> a0-4 direction y) 0.7134)
      (set! (-> a0-4 direction z) -0.2619)
      (set! (-> a0-4 direction w) 1.0)
      )
    (set-vector! (-> v1-0 0 dir2 color) 0.858 0.932 1.0 1.0)
    (let ((a0-6 (-> v1-0 0 dir2)))
      (set! (-> a0-6 direction x) 0.4634)
      (set! (-> a0-6 direction y) 0.7718)
      (set! (-> a0-6 direction z) -0.4352)
      (set! (-> a0-6 direction w) 1.0)
      )
    (set-vector! (-> v1-0 0 ambi color) 0.282 0.42 0.637 1.0)
    (set! (-> v1-0 0 dir1 extra x) 1.0)
    (set! (-> v1-0 0 dir2 extra x) 1.0)
    )
  0
  (none)
  )

(defbehavior update-mood-vinroom time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-vinroom-lights arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (let ((gp-0 (the-as (pointer float) (-> arg0 state))))
        (let ((s4-0 (-> arg0 light-group)))
          (set! (-> arg0 times 1 w) (+ 0.875 (* 0.175 (cos (-> gp-0 0)))))
          (set! (-> arg0 times 0 w) 1.0)
          (set! (-> s4-0 0 dir0 extra x) (-> arg0 times 1 w))
          (set! (-> arg0 times 2 w) (if (< 36408.89 (-> gp-0 1))
                                        0.475
                                        0.5
                                        )
                )
          (set! (-> s4-0 0 dir1 extra x) (-> arg0 times 2 w))
          (set! (-> arg0 times 3 w) (if (< 21845.334 (-> gp-0 2))
                                        0.475
                                        0.5
                                        )
                )
          (set! (-> s4-0 0 dir2 extra x) (-> arg0 times 3 w))
          )
        (set! (-> arg0 times 4 w) (+ 1.2 (* 0.2 (cos (-> gp-0 3)))))
        (when (not (paused?))
          (let ((f0-17 (+ (-> gp-0 0) (* 18204.445 (-> self clock seconds-per-frame)))))
            (set! (-> gp-0 0) (- f0-17 (* (the float (the int (/ f0-17 65536.0))) 65536.0)))
            )
          (let ((f0-20 (+ (-> gp-0 1) (* 196608.0 (-> self clock seconds-per-frame)))))
            (set! (-> gp-0 1) (- f0-20 (* (the float (the int (/ f0-20 65536.0))) 65536.0)))
            )
          (let ((f0-23 (+ (-> gp-0 2) (* 163840.0 (-> self clock seconds-per-frame)))))
            (set! (-> gp-0 2) (- f0-23 (* (the float (the int (/ f0-23 65536.0))) 65536.0)))
            )
          (let ((f0-26 (+ (-> gp-0 3) (* 32768.0 (-> self clock seconds-per-frame)))))
            (set! (-> gp-0 3) (- f0-26 (* (the float (the int (/ f0-26 65536.0))) 65536.0)))
            )
          )
        )
      )
    )
  0
  (none)
  )

(deftype hideout-states (structure)
  ((flame0 flames-state :inline :offset-assert   0)
   (flame1 flames-state :inline :offset-assert   8)
   )
  :method-count-assert 9
  :size-assert         #xf
  :flag-assert         #x90000000f
  )


(defun update-hideout-lights ((arg0 mood-context))
  (let ((a2-0 (-> arg0 light-group))
        (a1-0 (-> arg0 light-group 1))
        (v1-0 (-> arg0 light-group 2))
        )
    (set-vector! (-> a2-0 0 dir0 color) 0.0 0.0 0.0 1.0)
    (set-vector! (-> a2-0 0 ambi color) 0.22 0.219 0.35 1.0)
    (let ((a0-3 (-> a1-0 dir0)))
      (set! (-> a0-3 direction x) 0.0)
      (set! (-> a0-3 direction y) -1.0)
      (set! (-> a0-3 direction z) 0.0)
      (set! (-> a0-3 direction w) 1.0)
      )
    (set-vector! (-> a1-0 dir0 color) 1.0 0.8 0.4 1.0)
    (set! (-> a1-0 dir0 extra x) 1.0)
    (set-vector! (-> a1-0 ambi color) 0.22 0.219 0.35 1.0)
    (set! (-> a1-0 ambi extra x) 1.0)
    (let ((a0-8 (-> v1-0 dir0)))
      (set! (-> a0-8 direction x) 0.331)
      (set! (-> a0-8 direction y) 0.943)
      (set! (-> a0-8 direction z) 0.0)
      (set! (-> a0-8 direction w) 1.0)
      )
    (set-vector! (-> v1-0 dir0 color) 0.256 0.685 0.573 1.0)
    (set! (-> v1-0 dir0 extra x) 1.0)
    (let ((a0-11 (-> v1-0 dir1)))
      (set! (-> a0-11 direction x) -1.0)
      (set! (-> a0-11 direction y) 0.0)
      (set! (-> a0-11 direction z) 0.0)
      (set! (-> a0-11 direction w) 1.0)
      )
    (set-vector! (-> v1-0 dir1 color) 0.202 0.205 0.15 1.0)
    (set! (-> v1-0 dir1 extra x) 1.0)
    (set-vector! (-> v1-0 ambi color) 0.22 0.219 0.35 1.0)
    (set! (-> v1-0 ambi extra x) 1.0)
    )
  0
  (none)
  )

(defbehavior update-mood-hideout time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-hideout-lights arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (set! (-> arg0 times 0 w) 1.0)
      (cond
        ((movie?)
         (update-mood-flames arg0 1 2 0 0.333 0.0005859375 2.0)
         (update-mood-flames arg0 3 2 8 0.333 0.0005859375 3.0)
         )
        (else
          (update-mood-flames arg0 1 2 0 0.333 0.001953125 2.0)
          (update-mood-flames arg0 3 2 8 0.333 0.001953125 3.0)
          )
        )
      (let ((a0-10 (new 'stack-no-clear 'sphere))
            (a1-4 (-> *math-camera* trans))
            )
        (set-vector! a0-10 4898816.0 32768.0 245760.0 1.0)
        (let ((f0-5 (get-sphere-interp a0-10 a1-4 61440.0 69632.0)))
          (set-vector! (-> arg0 times 0) 1.0 1.0 1.0 1.0)
          (vector-lerp!
            (the-as vector (-> arg0 times))
            (the-as vector (-> arg0 times))
            (the-as vector (-> *level* default-level mood-context times))
            f0-5
            )
          )
        )
      )
    )
  0
  (none)
  )

(defbehavior update-mood-copy-hideout time-of-day-proc ((arg0 mood-context))
  (let ((v1-1 (level-get *level* 'hideout)))
    (if (and v1-1 (= (-> v1-1 status) 'active))
        (mem-copy! (the-as pointer arg0) (the-as pointer (-> v1-1 mood-context)) 1968)
        )
    )
  0
  (none)
  )

(deftype hiphog-states (structure)
  ((spec-m-on        sp-field-init-spec  :offset-assert   0)
   (spec-o-on        sp-field-init-spec  :offset-assert   4)
   (spec-r-on        sp-field-init-spec  :offset-assert   8)
   (spec-g-on        sp-field-init-spec  :offset-assert  12)
   (spec-a-on        sp-field-init-spec  :offset-assert  16)
   (spec-n-on        sp-field-init-spec  :offset-assert  20)
   (spec-m-off       sp-field-init-spec  :offset-assert  24)
   (spec-o-off       sp-field-init-spec  :offset-assert  28)
   (spec-r-off       sp-field-init-spec  :offset-assert  32)
   (spec-g-off       sp-field-init-spec  :offset-assert  36)
   (spec-a-off       sp-field-init-spec  :offset-assert  40)
   (spec-n-off       sp-field-init-spec  :offset-assert  44)
   (spec-hog-1-on    sp-field-init-spec  :offset-assert  48)
   (spec-hog-2-on    sp-field-init-spec  :offset-assert  52)
   (spec-hiphog-on   sp-field-init-spec  :offset-assert  56)
   (spec-hiphog-off  sp-field-init-spec  :offset-assert  60)
   (spec-hiphog-on2  sp-field-init-spec  :offset-assert  64)
   (spec-hiphog-off2 sp-field-init-spec  :offset-assert  68)
   (spec-clock-sun   sp-field-init-spec  :offset-assert  72)
   (spec-clock-moon  sp-field-init-spec  :offset-assert  76)
   (door             entity              :offset-assert  80)
   (m-on             uint8               :offset-assert  84)
   (o-on             uint8               :offset-assert  85)
   (r-on             uint8               :offset-assert  86)
   (g-on             uint8               :offset-assert  87)
   (a-on             uint8               :offset-assert  88)
   (n-on             uint8               :offset-assert  89)
   (m-off            uint8               :offset-assert  90)
   (o-off            uint8               :offset-assert  91)
   (r-off            uint8               :offset-assert  92)
   (g-off            uint8               :offset-assert  93)
   (a-off            uint8               :offset-assert  94)
   (n-off            uint8               :offset-assert  95)
   (hog-on           uint8               :offset-assert  96)
   (hiphog-on        uint8               :offset-assert  97)
   (hiphog-off       uint8               :offset-assert  98)
   (clock-sun        uint8               :offset-assert  99)
   (clock-moon       uint8               :offset-assert 100)
   )
  :method-count-assert 9
  :size-assert         #x65
  :flag-assert         #x900000065
  )


;; WARN: Return type mismatch entity vs none.
(defun init-mood-hiphog ((arg0 mood-context))
  (let ((gp-0 (the-as hiphog-states (-> arg0 state))))
    (let ((a0-1 (-> *part-id-table* 19)))
      (set! (-> gp-0 spec-m-on) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-1)
          (set! (-> gp-0 spec-m-on) (get-field-spec-by-id a0-1 (sp-field-id spt-r)))
          )
      )
    (let ((a0-2 (-> *part-id-table* 20)))
      (set! (-> gp-0 spec-o-on) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-2)
          (set! (-> gp-0 spec-o-on) (get-field-spec-by-id a0-2 (sp-field-id spt-r)))
          )
      )
    (let ((a0-3 (-> *part-id-table* 21)))
      (set! (-> gp-0 spec-r-on) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-3)
          (set! (-> gp-0 spec-r-on) (get-field-spec-by-id a0-3 (sp-field-id spt-r)))
          )
      )
    (let ((a0-4 (-> *part-id-table* 22)))
      (set! (-> gp-0 spec-g-on) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-4)
          (set! (-> gp-0 spec-g-on) (get-field-spec-by-id a0-4 (sp-field-id spt-r)))
          )
      )
    (let ((a0-5 (-> *part-id-table* 23)))
      (set! (-> gp-0 spec-a-on) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-5)
          (set! (-> gp-0 spec-a-on) (get-field-spec-by-id a0-5 (sp-field-id spt-r)))
          )
      )
    (let ((a0-6 (-> *part-id-table* 24)))
      (set! (-> gp-0 spec-n-on) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-6)
          (set! (-> gp-0 spec-n-on) (get-field-spec-by-id a0-6 (sp-field-id spt-r)))
          )
      )
    (let ((a0-7 (-> *part-id-table* 25)))
      (set! (-> gp-0 spec-m-off) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-7)
          (set! (-> gp-0 spec-m-off) (get-field-spec-by-id a0-7 (sp-field-id spt-r)))
          )
      )
    (let ((a0-8 (-> *part-id-table* 26)))
      (set! (-> gp-0 spec-o-off) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-8)
          (set! (-> gp-0 spec-o-off) (get-field-spec-by-id a0-8 (sp-field-id spt-r)))
          )
      )
    (let ((a0-9 (-> *part-id-table* 27)))
      (set! (-> gp-0 spec-r-off) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-9)
          (set! (-> gp-0 spec-r-off) (get-field-spec-by-id a0-9 (sp-field-id spt-r)))
          )
      )
    (let ((a0-10 (-> *part-id-table* 28)))
      (set! (-> gp-0 spec-g-off) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-10)
          (set! (-> gp-0 spec-g-off) (get-field-spec-by-id a0-10 (sp-field-id spt-r)))
          )
      )
    (let ((a0-11 (-> *part-id-table* 29)))
      (set! (-> gp-0 spec-a-off) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-11)
          (set! (-> gp-0 spec-a-off) (get-field-spec-by-id a0-11 (sp-field-id spt-r)))
          )
      )
    (let ((a0-12 (-> *part-id-table* 30)))
      (set! (-> gp-0 spec-n-off) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-12)
          (set! (-> gp-0 spec-n-off) (get-field-spec-by-id a0-12 (sp-field-id spt-r)))
          )
      )
    (let ((a0-13 (-> *part-id-table* 31)))
      (set! (-> gp-0 spec-hog-1-on) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-13)
          (set! (-> gp-0 spec-hog-1-on) (get-field-spec-by-id a0-13 (sp-field-id spt-r)))
          )
      )
    (let ((a0-14 (-> *part-id-table* 32)))
      (set! (-> gp-0 spec-hog-2-on) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-14)
          (set! (-> gp-0 spec-hog-2-on) (get-field-spec-by-id a0-14 (sp-field-id spt-r)))
          )
      )
    (let ((a0-15 (-> *part-id-table* 33)))
      (set! (-> gp-0 spec-hiphog-on) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-15)
          (set! (-> gp-0 spec-hiphog-on) (get-field-spec-by-id a0-15 (sp-field-id spt-r)))
          )
      )
    (let ((a0-16 (-> *part-id-table* 34)))
      (set! (-> gp-0 spec-hiphog-off) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-16)
          (set! (-> gp-0 spec-hiphog-off) (get-field-spec-by-id a0-16 (sp-field-id spt-r)))
          )
      )
    (let ((a0-17 (-> *part-id-table* 35)))
      (set! (-> gp-0 spec-hiphog-on2) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-17)
          (set! (-> gp-0 spec-hiphog-on2) (get-field-spec-by-id a0-17 (sp-field-id spt-r)))
          )
      )
    (let ((a0-18 (-> *part-id-table* 36)))
      (set! (-> gp-0 spec-hiphog-off2) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-18)
          (set! (-> gp-0 spec-hiphog-off2) (get-field-spec-by-id a0-18 (sp-field-id spt-r)))
          )
      )
    (let ((a0-19 (-> *part-id-table* 37)))
      (set! (-> gp-0 spec-clock-sun) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-19)
          (set! (-> gp-0 spec-clock-sun) (get-field-spec-by-id a0-19 (sp-field-id spt-r)))
          )
      )
    (let ((a0-20 (-> *part-id-table* 38)))
      (set! (-> gp-0 spec-clock-moon) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-20)
          (set! (-> gp-0 spec-clock-moon) (get-field-spec-by-id a0-20 (sp-field-id spt-r)))
          )
      )
    (set! (-> gp-0 m-on) (the-as uint 128))
    (set! (-> gp-0 o-on) (the-as uint 128))
    (set! (-> gp-0 r-on) (the-as uint 128))
    (set! (-> gp-0 g-on) (the-as uint 128))
    (set! (-> gp-0 a-on) (the-as uint 128))
    (set! (-> gp-0 n-on) (the-as uint 128))
    (set! (-> gp-0 m-off) (the-as uint 128))
    (set! (-> gp-0 o-off) (the-as uint 128))
    (set! (-> gp-0 r-off) (the-as uint 128))
    (set! (-> gp-0 g-off) (the-as uint 128))
    (set! (-> gp-0 a-off) (the-as uint 128))
    (set! (-> gp-0 n-off) (the-as uint 128))
    (set! (-> gp-0 hog-on) (the-as uint 128))
    (set! (-> gp-0 hiphog-on) (the-as uint 128))
    (set! (-> gp-0 hiphog-off) (the-as uint 128))
    (set! (-> gp-0 clock-sun) (the-as uint 128))
    (set! (-> gp-0 clock-moon) (the-as uint 128))
    (set! (-> gp-0 door) (entity-by-name "hip-door-b-1"))
    )
  (none)
  )

(defun update-hiphog-lights ((arg0 mood-context))
  (let ((t1-0 (-> arg0 light-group))
        (t0-0 (-> arg0 light-group 1))
        (a3-0 (-> arg0 light-group 2))
        (a2-0 (-> arg0 light-group 3))
        (a1-0 (-> arg0 light-group 4))
        (v1-0 (-> arg0 light-group 5))
        )
    (set-vector! (-> t1-0 0 dir0 color) 0.0 0.0 0.0 1.0)
    (set-vector! (-> t1-0 0 ambi color) 0.11 0.109 0.175 1.0)
    (set-vector! (-> t0-0 dir0 color) 0.945 0.648 0.523 1.0)
    (let ((a0-4 (-> t0-0 dir0)))
      (set! (-> a0-4 direction x) 0.0)
      (set! (-> a0-4 direction y) 1.0)
      (set! (-> a0-4 direction z) 0.0)
      (set! (-> a0-4 direction w) 1.0)
      )
    (set! (-> t0-0 dir0 extra x) 1.0)
    (set-vector! (-> t0-0 ambi color) 0.197 0.124 0.062 1.0)
    (set! (-> t0-0 ambi extra x) 1.0)
    (set-vector! (-> a3-0 dir0 color) 0.945 0.648 0.523 1.0)
    (set-vector! (-> a3-0 dir1 color) 1.0 0.237 0.386 1.0)
    (set-vector! (-> a3-0 ambi color) 0.197 0.124 0.062 1.0)
    (let ((a0-11 (-> a3-0 dir0)))
      (set! (-> a0-11 direction x) 0.0)
      (set! (-> a0-11 direction y) 1.0)
      (set! (-> a0-11 direction z) 0.0)
      (set! (-> a0-11 direction w) 1.0)
      )
    (let ((a0-12 (-> a3-0 dir1)))
      (set! (-> a0-12 direction x) 0.0)
      (set! (-> a0-12 direction y) -1.0)
      (set! (-> a0-12 direction z) 0.0)
      (set! (-> a0-12 direction w) 1.0)
      )
    (set! (-> a3-0 dir0 extra x) 1.0)
    (set! (-> a3-0 dir1 extra x) 1.0)
    (set! (-> a3-0 ambi extra x) 1.0)
    (set-vector! (-> a2-0 dir0 color) 0.945 0.648 0.523 1.0)
    (set-vector! (-> a2-0 dir1 color) 0.02 0.97 0.0 1.0)
    (set-vector! (-> a2-0 dir2 color) 1.0 0.237 0.386 1.0)
    (set-vector! (-> a2-0 ambi color) 0.197 0.124 0.062 1.0)
    (let ((a0-20 (-> a2-0 dir0)))
      (set! (-> a0-20 direction x) 0.0)
      (set! (-> a0-20 direction y) 1.0)
      (set! (-> a0-20 direction z) 0.0)
      (set! (-> a0-20 direction w) 1.0)
      )
    (let ((a0-21 (-> a2-0 dir1)))
      (set! (-> a0-21 direction x) 0.0)
      (set! (-> a0-21 direction y) -1.0)
      (set! (-> a0-21 direction z) 0.0)
      (set! (-> a0-21 direction w) 1.0)
      )
    (let ((a0-22 (-> a2-0 dir2)))
      (set! (-> a0-22 direction x) 1.0)
      (set! (-> a0-22 direction y) 0.0)
      (set! (-> a0-22 direction z) 0.0)
      (set! (-> a0-22 direction w) 1.0)
      )
    (set! (-> a2-0 dir0 extra x) 1.0)
    (set! (-> a2-0 dir1 extra x) 1.0)
    (set! (-> a2-0 dir2 extra x) 1.0)
    (set! (-> a2-0 ambi extra x) 1.0)
    (set-vector! (-> a1-0 dir0 color) 0.945 0.648 0.523 1.0)
    (set-vector! (-> a1-0 dir1 color) 0.02 0.97 0.0 1.0)
    (set-vector! (-> a1-0 dir2 color) 1.0 0.237 0.386 1.0)
    (set-vector! (-> a1-0 ambi color) 0.197 0.124 0.062 1.0)
    (let ((a0-31 (-> a1-0 dir0)))
      (set! (-> a0-31 direction x) 0.0)
      (set! (-> a0-31 direction y) 1.0)
      (set! (-> a0-31 direction z) 0.0)
      (set! (-> a0-31 direction w) 1.0)
      )
    (let ((a0-32 (-> a1-0 dir1)))
      (set! (-> a0-32 direction x) 0.0)
      (set! (-> a0-32 direction y) -1.0)
      (set! (-> a0-32 direction z) 0.0)
      (set! (-> a0-32 direction w) 1.0)
      )
    (let ((a0-33 (-> a1-0 dir2)))
      (set! (-> a0-33 direction x) -1.0)
      (set! (-> a0-33 direction y) 0.0)
      (set! (-> a0-33 direction z) 0.0)
      (set! (-> a0-33 direction w) 1.0)
      )
    (set! (-> a1-0 dir0 extra x) 1.0)
    (set! (-> a1-0 dir1 extra x) 1.0)
    (set! (-> a1-0 dir2 extra x) 1.0)
    (set! (-> a1-0 ambi extra x) 1.0)
    (set-vector! (-> v1-0 dir0 color) 0.9992 0.6868 0.7258 1.0)
    (set-vector! (-> v1-0 dir1 color) 0.9992 0.6868 0.7258 1.0)
    (set-vector! (-> v1-0 dir2 color) 0.9 0.9 0.9 1.0)
    (set-vector! (-> v1-0 ambi color) 0.197 0.124 0.062 1.0)
    (let ((a0-42 (-> v1-0 dir0)))
      (set! (-> a0-42 direction x) 0.028)
      (set! (-> a0-42 direction y) 0.731)
      (set! (-> a0-42 direction z) -0.681)
      (set! (-> a0-42 direction w) 1.0)
      )
    (let ((a0-43 (-> v1-0 dir1)))
      (set! (-> a0-43 direction x) -0.472)
      (set! (-> a0-43 direction y) 0.719)
      (set! (-> a0-43 direction z) 0.519)
      (set! (-> a0-43 direction w) 1.0)
      )
    (let ((a0-44 (-> v1-0 dir2)))
      (set! (-> a0-44 direction x) 0.242)
      (set! (-> a0-44 direction y) 0.786)
      (set! (-> a0-44 direction z) 0.567)
      (set! (-> a0-44 direction w) 1.0)
      )
    (set! (-> v1-0 dir0 extra x) 1.0)
    (set! (-> v1-0 dir1 extra x) 0.75)
    (set! (-> v1-0 dir2 extra x) 0.0)
    (set! (-> v1-0 ambi extra x) 1.0)
    )
  0
  (none)
  )

(defbehavior update-mood-hiphog time-of-day-proc ((arg0 mood-context) (arg1 float))
  (update-mood-interior arg0)
  (update-hiphog-lights arg0)
  (set! (-> arg0 light-group 0 dir0 extra x) 0.0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (set! (-> arg0 times 1 w) 1.0)
      (let ((v1-5 (-> *display* part-clock frame-counter))
            (s5-0 (the-as hiphog-states (-> arg0 state)))
            )
        (let ((f6-0 (the float (-> s5-0 m-on)))
              (f5-0 (the float (-> s5-0 o-on)))
              (f3-0 (the float (-> s5-0 r-on)))
              (f2-0 (the float (-> s5-0 g-on)))
              (f1-0 (the float (-> s5-0 a-on)))
              (f0-8 (the float (-> s5-0 n-on)))
              )
          (if (nonzero? (-> s5-0 spec-m-on))
              (set! (-> s5-0 spec-hog-1-on initial-valuef) f6-0)
              )
          (if (nonzero? (-> s5-0 spec-o-on))
              (set! (-> s5-0 spec-hog-1-on initial-valuef) f5-0)
              )
          (if (nonzero? (-> s5-0 spec-r-on))
              (set! (-> s5-0 spec-hog-1-on initial-valuef) f3-0)
              )
          (if (nonzero? (-> s5-0 spec-g-on))
              (set! (-> s5-0 spec-hog-1-on initial-valuef) f2-0)
              )
          (if (nonzero? (-> s5-0 spec-a-on))
              (set! (-> s5-0 spec-hog-1-on initial-valuef) f1-0)
              )
          (if (nonzero? (-> s5-0 spec-n-on))
              (set! (-> s5-0 spec-hog-1-on initial-valuef) f0-8)
              )
          (let ((a0-37 (mod v1-5 800))
                (f4-0 0.0)
                )
            (if (or (and (>= a0-37 100) (< a0-37 400)) (>= a0-37 500))
                (+! f4-0 f6-0)
                )
            (if (or (and (>= a0-37 150) (< a0-37 400)) (>= a0-37 500))
                (+! f4-0 f5-0)
                )
            (if (or (and (>= a0-37 200) (< a0-37 400)) (>= a0-37 500))
                (+! f4-0 f3-0)
                )
            (if (or (and (>= a0-37 250) (< a0-37 400)) (>= a0-37 500))
                (+! f4-0 f2-0)
                )
            (if (or (and (>= a0-37 300) (< a0-37 400)) (>= a0-37 500))
                (+! f4-0 f1-0)
                )
            (if (or (and (>= a0-37 350) (< a0-37 400)) (>= a0-37 500))
                (+! f4-0 f0-8)
                )
            (let ((f0-10 (* 0.0006510417 f4-0)))
              (set! (-> arg0 times 2 w) f0-10)
              (set! (-> arg0 light-group 3 dir1 extra x) f0-10)
              )
            )
          )
        (let ((f5-1 (the float (-> s5-0 m-off)))
              (f4-1 (the float (-> s5-0 o-off)))
              (f3-1 (the float (-> s5-0 r-off)))
              (f2-1 (the float (-> s5-0 g-off)))
              (f1-1 (the float (-> s5-0 a-off)))
              (f0-17 (the float (-> s5-0 n-off)))
              )
          (if (nonzero? (-> s5-0 spec-m-off))
              (set! (-> s5-0 spec-hog-1-on initial-valuef) f5-1)
              )
          (if (nonzero? (-> s5-0 spec-o-off))
              (set! (-> s5-0 spec-hog-1-on initial-valuef) f4-1)
              )
          (if (nonzero? (-> s5-0 spec-r-off))
              (set! (-> s5-0 spec-hog-1-on initial-valuef) f3-1)
              )
          (if (nonzero? (-> s5-0 spec-g-off))
              (set! (-> s5-0 spec-hog-1-on initial-valuef) f2-1)
              )
          (if (nonzero? (-> s5-0 spec-a-off))
              (set! (-> s5-0 spec-hog-1-on initial-valuef) f1-1)
              )
          (if (nonzero? (-> s5-0 spec-n-off))
              (set! (-> s5-0 spec-hog-1-on initial-valuef) f0-17)
              )
          )
        (let ((f0-19 (the float (-> s5-0 hog-on))))
          (if (nonzero? (-> s5-0 spec-hog-1-on))
              (set! (-> s5-0 spec-hog-1-on initial-valuef) f0-19)
              )
          (if (nonzero? (-> s5-0 spec-hog-2-on))
              (set! (-> s5-0 spec-hog-2-on initial-valuef) f0-19)
              )
          (set! (-> arg0 times 3 w) (+ 0.5 (* 0.0009765625 f0-19)))
          )
        (set! (-> arg0 light-group 4 dir1 extra x) (-> arg0 times 3 w))
        (let ((v1-6 (mod v1-5 600)))
          (cond
            ((< 300 v1-6)
             (let ((f0-24 (the float (-> s5-0 hiphog-on))))
               (if (nonzero? (-> s5-0 spec-hiphog-on))
                   (set! (-> s5-0 spec-hiphog-on initial-valuef) f0-24)
                   )
               (if (nonzero? (-> s5-0 spec-hiphog-on2))
                   (set! (-> s5-0 spec-hiphog-on2 initial-valuef) f0-24)
                   )
               (set! (-> arg0 times 4 w) (* 0.001953125 f0-24))
               )
             )
            (else
              (let ((f0-27 (the float (-> s5-0 hiphog-off))))
                (if (nonzero? (-> s5-0 spec-hiphog-off))
                    (set! (-> s5-0 spec-hiphog-off initial-valuef) f0-27)
                    )
                (if (nonzero? (-> s5-0 spec-hiphog-off2))
                    (set! (-> s5-0 spec-hiphog-off2 initial-valuef) f0-27)
                    )
                )
              )
            )
          )
        (cond
          ((or (>= arg1 18.0) (>= 6.0 arg1))
           (let ((f0-31 (the float (-> s5-0 clock-moon))))
             (if (nonzero? (-> s5-0 spec-clock-moon))
                 (set! (-> s5-0 spec-clock-moon initial-valuef) f0-31)
                 )
             (set-vector! (-> arg0 times 5) 0.471 0.722 1.0 (+ 0.5 (* 0.001953125 f0-31)))
             )
           )
          (else
            (let ((f0-35 (the float (-> s5-0 clock-sun))))
              (if (nonzero? (-> s5-0 spec-clock-sun))
                  (set! (-> s5-0 spec-clock-sun initial-valuef) f0-35)
                  )
              (set-vector! (-> arg0 times 5) 1.0 0.99 0.54 (+ 0.5 (* 0.0009765625 f0-35)))
              )
            )
          )
        (when (not (paused?))
          (set! (-> s5-0 m-on) (the-as uint (the int (rand-vu-float-range 64.0 192.0))))
          (set! (-> s5-0 o-on) (the-as uint (the int (rand-vu-float-range 64.0 192.0))))
          (set! (-> s5-0 r-on) (the-as uint (the int (rand-vu-float-range 64.0 192.0))))
          (set! (-> s5-0 g-on) (the-as uint (the int (rand-vu-float-range 64.0 192.0))))
          (set! (-> s5-0 a-on) (the-as uint (the int (rand-vu-float-range 64.0 192.0))))
          (set! (-> s5-0 n-on) (the-as uint (the int (rand-vu-float-range 64.0 192.0))))
          (set! (-> s5-0 m-off) (the-as uint (the int (rand-vu-float-range 116.0 132.0))))
          (set! (-> s5-0 o-off) (the-as uint (the int (rand-vu-float-range 116.0 132.0))))
          (set! (-> s5-0 r-off) (the-as uint (the int (rand-vu-float-range 116.0 132.0))))
          (set! (-> s5-0 g-off) (the-as uint (the int (rand-vu-float-range 116.0 132.0))))
          (set! (-> s5-0 a-off) (the-as uint (the int (rand-vu-float-range 116.0 132.0))))
          (set! (-> s5-0 n-off) (the-as uint (the int (rand-vu-float-range 116.0 132.0))))
          (set! (-> s5-0 hog-on) (the-as uint (the int (rand-vu-float-range 64.0 192.0))))
          (set! (-> s5-0 hiphog-on) (the-as uint (the int (rand-vu-float-range 64.0 192.0))))
          (set! (-> s5-0 hiphog-off) (the-as uint (the int (rand-vu-float-range 116.0 132.0))))
          (set! (-> s5-0 clock-sun) (the-as uint (the int (rand-vu-float-range 64.0 192.0))))
          (set! (-> s5-0 clock-moon) (the-as uint (the int (rand-vu-float-range 64.0 192.0))))
          )
        (if (and (-> s5-0 door) (not (logtest? (-> s5-0 door extra perm status) (entity-perm-status subtask-complete))))
            (set! (-> arg0 times 0 quad) (-> *level* default-level mood-context times 0 quad))
            )
        )
      (let ((a0-121 (new 'stack-no-clear 'sphere))
            (a1-40 (-> *math-camera* trans))
            )
        (set-vector! a0-121 -364544.0 0.0 5324800.0 1.0)
        (let ((f0-76 (get-sphere-interp a0-121 a1-40 139264.0 24576.0)))
          (vector-lerp!
            (the-as vector (-> arg0 times))
            (the-as vector (-> arg0 times))
            (the-as vector (-> *level* default-level mood-context times))
            f0-76
            )
          )
        )
      )
    )
  0
  (none)
  )

(defbehavior update-mood-copy-hiphog time-of-day-proc ((arg0 mood-context))
  (let ((v1-1 (level-get *level* 'hiphog)))
    (if (and v1-1 (= (-> v1-1 status) 'active))
        (mem-copy! (the-as pointer arg0) (the-as pointer (-> v1-1 mood-context)) 1968)
        )
    )
  0
  (none)
  )

(deftype sewer-states (structure)
  ((light-flag        symbol              :offset-assert   0)
   (light-count       uint32              :offset-assert   4)
   (turret-value      float               :offset-assert   8)
   (spec-light-center sp-field-init-spec  :offset-assert  12)
   (spec-light        sp-field-init-spec  :offset-assert  16)
   (explosion         float               :offset-assert  20)
   )
  :method-count-assert 9
  :size-assert         #x18
  :flag-assert         #x900000018
  )


(defun update-sewer-lights ((arg0 mood-context))
  (let ((v1-0 (-> arg0 light-group)))
    (set-vector! (-> v1-0 0 dir0 color) 0.822 0.694 0.613 1.0)
    (set-vector! (-> v1-0 0 ambi color) 0.083 0.139 0.157 1.0)
    )
  (let ((a3-0 (-> arg0 light-group 1))
        (a2-4 (-> arg0 light-group 2))
        (a1-5 (-> arg0 light-group 3))
        (v1-2 (-> arg0 light-group 4))
        )
    (set-vector! (-> a3-0 ambi color) 0.083 0.139 0.157 1.0)
    (set! (-> a3-0 ambi extra x) 1.0)
    (let ((a0-3 (-> a3-0 dir0)))
      (set! (-> a0-3 direction x) 0.0)
      (set! (-> a0-3 direction y) 1.0)
      (set! (-> a0-3 direction z) 0.0)
      (set! (-> a0-3 direction w) 1.0)
      )
    (set-vector! (-> a3-0 dir0 color) 0.822 0.694 0.613 1.0)
    (set! (-> a3-0 dir0 extra x) 1.0)
    (set-vector! (-> a2-4 ambi color) 0.8 0.8 0.8 1.0)
    (set! (-> a2-4 ambi extra x) 1.0)
    (let ((a0-8 (-> a2-4 dir0)))
      (set! (-> a0-8 direction x) 0.0)
      (set! (-> a0-8 direction y) 1.0)
      (set! (-> a0-8 direction z) 0.0)
      (set! (-> a0-8 direction w) 1.0)
      )
    (set-vector! (-> a2-4 dir0 color) 0.822 0.694 0.613 1.0)
    (set! (-> a2-4 dir0 extra x) 1.0)
    (let ((a0-11 (-> a2-4 dir1)))
      (set! (-> a0-11 direction x) -0.751)
      (set! (-> a0-11 direction y) 0.658)
      (set! (-> a0-11 direction z) -0.035)
      (set! (-> a0-11 direction w) 1.0)
      )
    (set-vector! (-> a2-4 dir1 color) 1.0 0.65 0.65 1.0)
    (set! (-> a2-4 dir1 extra x) 0.6)
    (set-vector! (-> a1-5 ambi color) 0.35 0.35 0.35 1.0)
    (set! (-> a1-5 ambi extra x) 1.0)
    (let ((a0-16 (-> a1-5 dir0)))
      (set! (-> a0-16 direction x) 0.0)
      (set! (-> a0-16 direction y) 1.0)
      (set! (-> a0-16 direction z) 0.0)
      (set! (-> a0-16 direction w) 1.0)
      )
    (set-vector! (-> a1-5 dir0 color) 0.822 0.694 0.613 1.0)
    (set! (-> a1-5 dir0 extra x) 1.0)
    (let ((a0-19 (-> v1-2 dir0)))
      (set! (-> a0-19 direction x) 0.0)
      (set! (-> a0-19 direction y) 1.0)
      (set! (-> a0-19 direction z) 0.0)
      (set! (-> a0-19 direction w) 1.0)
      )
    (set-vector! (-> v1-2 dir0 color) 0.725 0.924 0.982 1.0)
    (set! (-> v1-2 dir0 extra x) 0.4)
    )
  0
  (none)
  )

;; WARN: Return type mismatch sp-field-init-spec vs none.
(defun init-mood-sewer ((arg0 mood-context))
  (let ((gp-0 (the-as sewer-states (-> arg0 state))))
    (let ((a0-1 (-> *part-id-table* 39)))
      (set! (-> gp-0 spec-light-center) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-1)
          (set! (-> gp-0 spec-light-center) (get-field-spec-by-id a0-1 (sp-field-id spt-a)))
          )
      )
    (let ((a0-2 (-> *part-id-table* 40)))
      (set! (-> gp-0 spec-light) (the-as sp-field-init-spec 0))
      (if (nonzero? a0-2)
          (set! (-> gp-0 spec-light) (get-field-spec-by-id a0-2 (sp-field-id spt-a)))
          )
      )
    )
  (none)
  )

(defbehavior update-mood-sewer time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-sewer-lights arg0)
  (let ((s5-0 (-> arg0 light-group 2)))
    (set! (-> arg0 light-group 0 dir0 extra x) 0.0)
    (cond
      ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
       (palette-select-special arg0)
       )
      (else
        (set! (-> arg0 times 0 w) 1.0)
        (set! (-> arg0 times 2 w) 1.0)
        (let ((s4-0 (the-as sewer-states (-> arg0 state))))
          (when (-> s4-0 light-flag)
            (let ((v1-6 (-> s4-0 light-count)))
              (cond
                ((> v1-6 0)
                 (let ((f0-4 (+ 0.2 (* 0.0066666673 (the float v1-6))))
                       (f1-3 (+ 0.4 (* 0.013333335 (the float v1-6))))
                       )
                   (set! (-> arg0 times 1 w) (rand-vu-float-range f0-4 f1-3))
                   )
                 (+! (-> s4-0 light-count) -1)
                 (set! (-> *display* force-sync) (the-as uint 2))
                 )
                (else
                  (set! (-> arg0 times 1 w) 1.0)
                  )
                )
              )
            )
          (let ((f0-7 (-> arg0 times 1 w)))
            (if (nonzero? (-> s4-0 spec-light-center))
                (set! (-> s4-0 spec-light-center initial-valuef) (* 12.0 f0-7))
                )
            (if (nonzero? (-> s4-0 spec-light))
                (set! (-> s4-0 spec-light initial-valuef) (* 12.0 f0-7))
                )
            (if *ocean-map-sewer*
                (set! (-> *ocean-map-sewer* ocean-colors colors 1271)
                      (the-as
                        rgba
                        (logior (logand (logior (logand (logior (logand (logior (logand 0 -256) (shr (shl (the int (* 19.0 f0-7)) 56) 56)) -65281)
                                                                (shr (shl (the int (* 24.5 f0-7)) 56) 48)
                                                                )
                                                        -16711681
                                                        )
                                                (shr (shl (the int (* 16.0 f0-7)) 56) 40)
                                                )
                                        (-> (new 'static 'array uint64 1 #xffffffff00ffffff) 0)
                                        )
                                (shl #x8000 16)
                                )
                        )
                      )
                )
            )
          (set! (-> arg0 times 6 w) (-> s4-0 explosion))
          (set! (-> arg0 times 7 w) (-> s4-0 turret-value))
          (when (not (paused?))
            (set! (-> s4-0 turret-value) (fmax 0.0 (+ -0.2 (-> s4-0 turret-value))))
            (seek! (-> s4-0 explosion) 0.0 (* 2.5 (-> self clock seconds-per-frame)))
            )
          )
        (when *ocean-map-sewer*
          (let ((f0-18 (-> *ocean-map-sewer* start-corner y)))
            (let ((f1-19 (fmax 0.0 (fmin 1.0 (- 1.0 (* 0.000020345053 (+ 314802.2 f0-18)))))))
              (set! (-> arg0 times 3 w) (fmax 0.0 (fmin 1.0 (- 1.0 (* 0.000020345053 (+ 265650.2 f0-18))))))
              (set! (-> arg0 times 4 w) f1-19)
              (set! (-> s5-0 dir0 extra x) f1-19)
              (set! (-> s5-0 ambi extra x) f1-19)
              )
            (set! (-> arg0 times 5 w) (fmax 0.0 (fmin 1.0 (- 1.0 (* 0.000018780049 (+ 368050.2 f0-18))))))
            )
          )
        )
      )
    )
  0
  (none)
  )

(defbehavior update-mood-copy-sewerb time-of-day-proc ((arg0 mood-context))
  (let ((v1-1 (level-get *level* 'sewerb)))
    (if (and v1-1 (= (-> v1-1 status) 'active))
        (mem-copy! (the-as pointer arg0) (the-as pointer (-> v1-1 mood-context)) 1968)
        )
    )
  0
  (none)
  )

(defbehavior update-mood-copy-sewescb time-of-day-proc ((arg0 mood-context))
  (let ((v1-1 (level-get *level* 'sewescb)))
    (if (and v1-1 (= (-> v1-1 status) 'active))
        (mem-copy! (the-as pointer arg0) (the-as pointer (-> v1-1 mood-context)) 1968)
        )
    )
  0
  (none)
  )

(defun set-sewer-lights-flag! ((arg0 symbol))
  (let ((v1-1 (level-get *level* 'sewerb)))
    (when v1-1
      (let ((v1-2 (the-as sewer-states (-> v1-1 mood-context state))))
        (if (and (not (-> v1-2 light-flag)) arg0)
            (set! (-> v1-2 light-count) (the-as uint 30))
            )
        (set! (-> v1-2 light-flag) arg0)
        )
      arg0
      )
    )
  )

(defun set-sewer-turret-flash! ()
  (let ((v1-1 (level-get *level* 'sewerb)))
    (when v1-1
      (let ((v1-2 (the-as sewer-states (-> v1-1 mood-context state))))
        (set! (-> v1-2 turret-value) 1.0)
        )
      )
    )
  )

(defun set-sewesc-explosion! ()
  (let ((v1-1 (level-get *level* 'sewescb)))
    (when v1-1
      (let ((v1-2 (the-as sewer-states (-> v1-1 mood-context state))))
        (set! (-> v1-2 explosion) 1.9921875)
        )
      )
    )
  )

(deftype onintent-states (structure)
  ((flame0      flames-state :inline :offset-assert   0)
   (flame1      flames-state :inline :offset-assert   8)
   (flame2      flames-state :inline :offset-assert  16)
   (green-flame flames-state :inline :offset-assert  24)
   (totem0      flames-state :inline :offset-assert  32)
   (totem1      flames-state :inline :offset-assert  40)
   )
  :method-count-assert 9
  :size-assert         #x2f
  :flag-assert         #x90000002f
  )


(defun update-onintent-lights ((arg0 mood-context))
  (let ((v1-0 (-> arg0 light-group)))
    (set-vector! (-> v1-0 0 dir0 color) 0.822 0.694 0.613 1.0)
    (set-vector! (-> v1-0 0 ambi color) 0.21 0.188 0.163 1.0)
    )
  0
  (none)
  )

(defbehavior update-mood-onintent time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-onintent-lights arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (set! (-> arg0 times 0 w) 1.0)
      (set! (-> arg0 times 1 w) 1.0)
      (update-mood-flames arg0 2 1 0 0.75 0.0009765625 2.0)
      (update-mood-flames arg0 3 1 8 0.75 0.0009765625 3.0)
      (update-mood-flames arg0 4 1 16 0.75 0.0009765625 4.0)
      (update-mood-flames arg0 5 1 24 0.75 0.0009765625 2.0)
      (update-mood-flames arg0 6 1 32 0.333 0.001953125 2.0)
      (update-mood-flames arg0 7 1 40 0.75 0.0009765625 2.0)
      )
    )
  0
  (none)
  )

(deftype oracle-states (structure)
  ((flame0       flames-state :inline :offset-assert   0)
   (flame1       flames-state :inline :offset-assert   8)
   (flame2       flames-state :inline :offset-assert  16)
   (blue-flame   flames-state :inline :offset-assert  24)
   (door-entity  entity               :offset-assert  32)
   (door-current float                :offset-assert  36)
   (door-target  float                :offset-assert  40)
   (purple-flag  symbol               :offset-assert  44)
   (purple       float                :offset-assert  48)
   (purple-noise float                :offset-assert  52)
   )
  :method-count-assert 9
  :size-assert         #x38
  :flag-assert         #x900000038
  )


(defun init-mood-oracle ((arg0 mood-context))
  (let ((v1-0 (the-as oracle-states (-> arg0 state))))
    (set! (-> v1-0 door-entity) #f)
    (set! (-> v1-0 door-current) 0.0)
    (set! (-> v1-0 door-target) 0.0)
    (set! (-> v1-0 purple-flag) #f)
    )
  #f
  )

(defbehavior update-mood-oracle time-of-day-proc ((arg0 mood-context))
  (copy-mood-exterior-ambi arg0 #f)
  (update-mood-interior arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (let ((s5-0 (the-as oracle-states (-> arg0 state))))
        (cond
          ((-> s5-0 door-entity)
           (if (logtest? (-> s5-0 door-entity extra perm status) (entity-perm-status subtask-complete))
               (set! (-> s5-0 door-target) 1.0)
               (set! (-> s5-0 door-target) 0.0)
               )
           )
          (else
            (set! (-> s5-0 door-entity) (entity-by-name "oracle-door-1"))
            )
          )
        (when (not (paused?))
          (seek! (-> s5-0 door-current) (-> s5-0 door-target) (* 4.0 (-> self clock seconds-per-frame)))
          (cond
            ((-> s5-0 purple-flag)
             (set! (-> s5-0 purple) (fmin 1.9 (+ (-> s5-0 purple) (* 2.0 (-> self clock seconds-per-frame)))))
             (set! (-> s5-0 purple-noise) (rand-vu-float-range 0.0 (-> s5-0 purple)))
             )
            (else
              (set! (-> s5-0 purple) (fmax 0.0 (- (-> s5-0 purple) (* 2.0 (-> self clock seconds-per-frame)))))
              (set! (-> s5-0 purple-noise) 0.0)
              )
            )
          )
        (set! (-> arg0 times 0 w) (-> s5-0 door-current))
        (set! (-> arg0 times 1 w) 1.0)
        (update-mood-flames arg0 2 1 0 0.75 0.0009765625 2.0)
        (update-mood-flames arg0 3 1 8 0.75 0.0009765625 3.0)
        (update-mood-flames arg0 4 1 16 0.75 0.0009765625 4.0)
        (update-mood-flames arg0 5 1 24 0.75 0.0009765625 2.0)
        (set! (-> arg0 times 6 w) (+ (-> s5-0 purple) (-> s5-0 purple-noise)))
        )
      )
    )
  0
  (none)
  )

(defun set-oracle-purple-flag! ((arg0 symbol))
  (let ((v1-1 (level-get *level* 'oracle)))
    (when v1-1
      (set! (-> (the-as oracle-states (-> v1-1 mood-context state)) purple-flag) arg0)
      arg0
      )
    )
  )

(deftype tomba-states (structure)
  ((flame0    flames-state :inline :offset-assert   0)
   (flame1    flames-state :inline :offset-assert   8)
   (flame2    flames-state :inline :offset-assert  16)
   (light     light-state  :inline :offset-assert  24)
   (gem-light float                :offset-assert  32)
   )
  :method-count-assert 9
  :size-assert         #x24
  :flag-assert         #x900000024
  )


(defun update-tomba-lights ((arg0 mood-context))
  (let ((v1-0 (-> arg0 current-fog)))
    (set! (-> v1-0 fog-color x) 0.0)
    (set! (-> v1-0 fog-color y) 0.0)
    (set! (-> v1-0 fog-color z) 0.0)
    (set! (-> v1-0 fog-color w) 128.0)
    )
  (let ((a1-0 (-> arg0 light-group))
        (s5-0 (-> arg0 light-group 1))
        )
    (let ((v1-1 (-> a1-0 0)))
      (set! (-> v1-1 dir0 direction x) -0.69)
      (set! (-> v1-1 dir0 direction y) 0.487)
      (set! (-> v1-1 dir0 direction z) -0.53)
      (set! (-> v1-1 dir0 direction w) 0.0)
      )
    (set-vector! (-> a1-0 0 dir0 color) 0.878 0.7656 0.6875 1.0)
    (set! (-> a1-0 0 dir0 extra x) 1.0)
    (let ((v1-4 (-> a1-0 0 dir1)))
      (set! (-> v1-4 direction x) 0.743)
      (set! (-> v1-4 direction y) 0.51)
      (set! (-> v1-4 direction z) 0.431)
      (set! (-> v1-4 direction w) 0.0)
      )
    (set-vector! (-> a1-0 0 dir1 color) 1.0 0.8046 0.648 1.0)
    (set! (-> a1-0 0 dir1 extra x) 0.8)
    (set-vector! (-> a1-0 0 ambi color) 0.3 0.2 0.1 1.0)
    (set! (-> a1-0 0 ambi extra x) 0.55)
    (mem-copy! (the-as pointer s5-0) (the-as pointer a1-0) 192)
    (set! (-> s5-0 ambi extra x) 0.35)
    )
  (cond
    ((task-node-closed? (game-task-node tomb-boss-torches))
     )
    (else
      (set-vector! (-> arg0 current-env-color) 0.0 0.0 0.0 0.0)
      )
    )
  0
  (none)
  )

(defbehavior update-mood-tomba time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-tomba-lights arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (-> arg0 state)
      (set! (-> arg0 times 0 w) 1.0)
      (set! (-> arg0 times 1 w) 1.0)
      (when (not (task-node-closed? (game-task-node tomb-boss-torches)))
        (update-mood-flames arg0 2 1 0 0.75 0.0009765625 2.0)
        (update-mood-flames arg0 3 1 8 0.75 0.0009765625 2.0)
        )
      (update-mood-flames arg0 4 2 16 0.5 0.001953125 2.0)
      (update-mood-light arg0 6 24 0.8 0.2 19.0 0.0 1.0)
      )
    )
  0
  (none)
  )

(deftype tombb-states (structure)
  ((flame0 flames-state :inline :offset-assert   0)
   (flame1 flames-state :inline :offset-assert   8)
   (flame2 flames-state :inline :offset-assert  16)
   (light  light-state  :inline :offset-assert  24)
   )
  :method-count-assert 9
  :size-assert         #x20
  :flag-assert         #x900000020
  )


(defun update-tombb-lights ((arg0 mood-context))
  (update-tomba-lights arg0)
  (let ((v1-0 (-> arg0 light-group 1)))
    (let ((a0-2 (-> v1-0 dir0)))
      (set! (-> a0-2 direction x) 0.0)
      (set! (-> a0-2 direction y) 0.0)
      (set! (-> a0-2 direction z) 1.0)
      (set! (-> a0-2 direction w) 0.0)
      )
    (set-vector! (-> v1-0 dir0 color) 1.6 1.07 0.725 1.0)
    (set! (-> v1-0 dir0 extra x) 0.5)
    (let ((a0-5 (-> v1-0 dir1)))
      (set! (-> a0-5 direction x) -0.473)
      (set! (-> a0-5 direction y) 0.707)
      (set! (-> a0-5 direction z) -0.523)
      (set! (-> a0-5 direction w) 0.0)
      )
    (set-vector! (-> v1-0 dir1 color) 1.4 0.9 0.5 1.0)
    (set! (-> v1-0 dir1 extra x) 0.55)
    (let ((a0-8 (-> v1-0 dir2)))
      (set! (-> a0-8 direction x) 0.473)
      (set! (-> a0-8 direction y) 0.707)
      (set! (-> a0-8 direction z) -0.523)
      (set! (-> a0-8 direction w) 0.0)
      )
    (set-vector! (-> v1-0 dir2 color) 1.4 0.9 0.7 1.0)
    (set! (-> v1-0 dir2 extra x) 0.55)
    (set-vector! (-> v1-0 ambi color) 0.4 0.2 0.2 1.0)
    (set! (-> v1-0 ambi extra x) 0.2)
    )
  0
  (none)
  )

(defbehavior update-mood-tombb time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-tombb-lights arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (set! (-> arg0 times 0 w) 1.0)
      (set! (-> arg0 times 1 w) 1.0)
      (update-mood-flames arg0 2 1 0 0.75 0.0009765625 2.0)
      (update-mood-flames arg0 3 1 8 0.75 0.0009765625 2.0)
      (update-mood-flames arg0 4 2 16 0.5 0.001953125 2.0)
      (update-mood-light arg0 6 24 0.75 0.5 19.0 0.0 1.0)
      )
    )
  0
  (none)
  )

(deftype tombc-states (structure)
  ((flame0      flames-state      :inline :offset-assert   0)
   (flame1      flames-state      :inline :offset-assert   8)
   (flame2      flames-state      :inline :offset-assert  16)
   (electricity electricity-state :inline :offset-assert  24)
   )
  :method-count-assert 9
  :size-assert         #x20
  :flag-assert         #x900000020
  )


(defun init-mood-tombc ((arg0 mood-context))
  (let ((v1-0 (the-as tombc-states (-> arg0 state))))
    (set! (-> v1-0 electricity scale) 1.0)
    )
  )

(defbehavior update-mood-tombc time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-tomba-lights arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (set! (-> arg0 times 0 w) 1.0)
      (set! (-> arg0 times 1 w) 1.0)
      (update-mood-flames arg0 2 1 0 0.75 0.0009765625 2.0)
      (update-mood-flames arg0 3 1 8 0.75 0.0009765625 2.0)
      (update-mood-flames arg0 4 2 16 0.5 0.001953125 2.0)
      (update-mood-electricity arg0 6 24 0.8 1.0)
      )
    )
  0
  (none)
  )

(defun set-tombc-electricity-scale! ((arg0 float))
  (let ((v1-1 (level-get *level* 'tombc)))
    (when v1-1
      (let ((v1-2 (the-as tombc-states (-> v1-1 mood-context state))))
        (set! (-> v1-2 electricity scale) arg0)
        )
      )
    )
  )

(deftype tombd-states (structure)
  ((flame0    flames-state :inline :offset-assert   0)
   (flame1    flames-state :inline :offset-assert   8)
   (flame2    flames-state :inline :offset-assert  16)
   (light     light-state  :inline :offset-assert  24)
   (gem-light float                :offset-assert  32)
   )
  :method-count-assert 9
  :size-assert         #x24
  :flag-assert         #x900000024
  )


(defun update-tombd-lights ((arg0 mood-context))
  (let ((v1-0 (-> arg0 current-fog)))
    (set! (-> v1-0 fog-color x) 0.0)
    (set! (-> v1-0 fog-color y) 0.0)
    (set! (-> v1-0 fog-color z) 0.0)
    (set! (-> v1-0 fog-color w) 128.0)
    )
  (let ((a1-1 (-> arg0 light-group))
        (gp-0 (-> arg0 light-group 1))
        )
    (let ((v1-1 (-> a1-1 0)))
      (set! (-> v1-1 dir0 direction x) -0.69)
      (set! (-> v1-1 dir0 direction y) 0.487)
      (set! (-> v1-1 dir0 direction z) -0.53)
      (set! (-> v1-1 dir0 direction w) 0.0)
      )
    (set-vector! (-> a1-1 0 dir0 color) 0.85 0.7656 0.6875 1.0)
    (set! (-> a1-1 0 dir0 extra x) 1.0)
    (let ((v1-4 (-> a1-1 0 dir1)))
      (set! (-> v1-4 direction x) 0.743)
      (set! (-> v1-4 direction y) 0.51)
      (set! (-> v1-4 direction z) 0.431)
      (set! (-> v1-4 direction w) 0.0)
      )
    (set-vector! (-> a1-1 0 dir1 color) 0.85 0.8046 0.7 1.0)
    (set! (-> a1-1 0 dir1 extra x) 0.8)
    (set-vector! (-> a1-1 0 ambi color) 0.3 0.2 0.1 1.0)
    (set! (-> a1-1 0 ambi extra x) 0.55)
    (mem-copy! (the-as pointer gp-0) (the-as pointer a1-1) 192)
    (set! (-> gp-0 ambi extra x) 0.35)
    )
  0
  (none)
  )

(defbehavior update-mood-tombd time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-tombd-lights arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (-> arg0 state)
      (set! (-> arg0 times 0 w) 1.0)
      (set! (-> arg0 times 1 w) 1.0)
      (when (not (task-node-closed? (game-task-node tomb-boss-torches)))
        (update-mood-flames arg0 2 1 0 0.75 0.0009765625 2.0)
        (update-mood-flames arg0 3 1 8 0.75 0.0009765625 2.0)
        )
      (update-mood-flames arg0 4 2 16 0.5 0.001953125 2.0)
      (update-mood-light arg0 6 24 0.8 0.2 19.0 0.0 1.0)
      )
    )
  0
  (none)
  )

(deftype tombe-states (structure)
  ((flame0    flames-state :inline :offset-assert   0)
   (flame1    flames-state :inline :offset-assert   8)
   (flame2    flames-state :inline :offset-assert  16)
   (light     light-state  :inline :offset-assert  24)
   (gem-light float                :offset-assert  32)
   )
  :method-count-assert 9
  :size-assert         #x24
  :flag-assert         #x900000024
  )


(defbehavior update-mood-tombe time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-tomba-lights arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (-> arg0 state)
      (set! (-> arg0 times 0 w) 1.0)
      (set! (-> arg0 times 1 w) 1.0)
      (update-mood-flames arg0 2 1 0 0.75 0.0009765625 2.0)
      (update-mood-flames arg0 3 1 8 0.75 0.0009765625 2.0)
      (update-mood-flames arg0 4 2 16 0.5 0.001953125 2.0)
      (update-mood-light arg0 6 24 0.8 0.2 19.0 0.0 1.0)
      )
    )
  0
  (none)
  )

(deftype tombboss-states (structure)
  ((flame0    flames-state :inline :offset-assert   0)
   (flame1    flames-state :inline :offset-assert   8)
   (flame2    flames-state :inline :offset-assert  16)
   (light     light-state  :inline :offset-assert  24)
   (gem-light float                :offset-assert  32)
   )
  :method-count-assert 9
  :size-assert         #x24
  :flag-assert         #x900000024
  )


(defun update-tombboss-lights ((arg0 mood-context))
  (let ((v1-0 (-> arg0 light-group)))
    (let ((a1-0 (-> v1-0 0)))
      (set! (-> a1-0 dir0 direction x) -0.671)
      (set! (-> a1-0 dir0 direction y) 0.568)
      (set! (-> a1-0 dir0 direction z) -0.474)
      (set! (-> a1-0 dir0 direction w) 0.0)
      )
    (set-vector! (-> v1-0 0 dir0 color) 0.7 0.5 0.25 1.0)
    (set! (-> v1-0 0 dir0 extra x) 1.2)
    (let ((a1-3 (-> v1-0 0 dir1)))
      (set! (-> a1-3 direction x) 0.734)
      (set! (-> a1-3 direction y) 0.678)
      (set! (-> a1-3 direction z) -0.019)
      (set! (-> a1-3 direction w) 0.0)
      )
    (set-vector! (-> v1-0 0 dir1 color) 0.7 0.5 0.25 1.0)
    (set! (-> v1-0 0 dir1 extra x) 0.9)
    (set-vector! (-> v1-0 0 ambi color) 0.2 0.2 0.4 1.0)
    (set! (-> v1-0 0 ambi extra x) 0.8)
    )
  (let ((v1-2 (-> arg0 light-group 1)))
    (let ((a1-8 (-> v1-2 dir0)))
      (set! (-> a1-8 direction x) -0.823)
      (set! (-> a1-8 direction y) 0.491)
      (set! (-> a1-8 direction z) -0.283)
      (set! (-> a1-8 direction w) 0.0)
      )
    (set-vector! (-> v1-2 dir0 color) 0.878 0.7656 0.6875 1.0)
    (set! (-> v1-2 dir0 extra x) 1.0)
    (let ((a1-11 (-> v1-2 dir1)))
      (set! (-> a1-11 direction x) 0.661)
      (set! (-> a1-11 direction y) 0.411)
      (set! (-> a1-11 direction z) -0.626)
      (set! (-> a1-11 direction w) 0.0)
      )
    (set-vector! (-> v1-2 dir1 color) 1.0 0.8046 0.648 1.0)
    (set! (-> v1-2 dir1 extra x) 0.8)
    (set-vector! (-> v1-2 ambi color) 0.375 0.0 0.2 1.0)
    (set! (-> v1-2 ambi extra x) 0.332)
    )
  (let ((v1-4 (-> arg0 light-group 2)))
    (let ((a1-16 (-> v1-4 dir0)))
      (set! (-> a1-16 direction x) -0.671)
      (set! (-> a1-16 direction y) 0.568)
      (set! (-> a1-16 direction z) -0.474)
      (set! (-> a1-16 direction w) 0.0)
      )
    (set-vector! (-> v1-4 dir0 color) 0.7 0.5 0.25 1.0)
    (set! (-> v1-4 dir0 extra x) 1.0)
    (let ((a1-19 (-> v1-4 dir1)))
      (set! (-> a1-19 direction x) 0.734)
      (set! (-> a1-19 direction y) 0.678)
      (set! (-> a1-19 direction z) -0.019)
      (set! (-> a1-19 direction w) 0.0)
      )
    (set-vector! (-> v1-4 dir1 color) 0.7 0.5 0.25 1.0)
    (set! (-> v1-4 dir1 extra x) 0.7)
    (set-vector! (-> v1-4 ambi color) 0.2 0.2 0.4 1.0)
    (set! (-> v1-4 ambi extra x) 0.4)
    )
  (let ((v1-6 (-> arg0 light-group 3)))
    (let ((a1-24 (-> v1-6 dir0)))
      (set! (-> a1-24 direction x) -0.671)
      (set! (-> a1-24 direction y) 0.568)
      (set! (-> a1-24 direction z) -0.474)
      (set! (-> a1-24 direction w) 0.0)
      )
    (set-vector! (-> v1-6 dir0 color) 0.7 0.5 0.25 1.0)
    (set! (-> v1-6 dir0 extra x) 1.2)
    (let ((a1-27 (-> v1-6 dir1)))
      (set! (-> a1-27 direction x) 0.734)
      (set! (-> a1-27 direction y) 0.678)
      (set! (-> a1-27 direction z) -0.019)
      (set! (-> a1-27 direction w) 0.0)
      )
    (set-vector! (-> v1-6 dir1 color) 0.7 0.5 0.25 1.0)
    (set! (-> v1-6 dir1 extra x) 0.9)
    (set-vector! (-> v1-6 ambi color) 0.2 0.2 0.4 1.0)
    (set! (-> v1-6 ambi extra x) 0.8)
    )
  (let ((v1-8 (-> arg0 light-group 4)))
    (let ((a0-1 (-> v1-8 dir0)))
      (set! (-> a0-1 direction x) -0.69)
      (set! (-> a0-1 direction y) 0.487)
      (set! (-> a0-1 direction z) -0.53)
      (set! (-> a0-1 direction w) 0.0)
      )
    (set-vector! (-> v1-8 dir0 color) 0.878 0.7656 0.6875 1.0)
    (set! (-> v1-8 dir0 extra x) 1.0)
    (let ((a0-4 (-> v1-8 dir1)))
      (set! (-> a0-4 direction x) 0.743)
      (set! (-> a0-4 direction y) 0.51)
      (set! (-> a0-4 direction z) 0.431)
      (set! (-> a0-4 direction w) 0.0)
      )
    (set-vector! (-> v1-8 dir1 color) 1.0 0.8046 0.648 1.0)
    (set! (-> v1-8 dir1 extra x) 0.8)
    (set-vector! (-> v1-8 ambi color) 0.4 0.2 0.2 1.0)
    (set! (-> v1-8 ambi extra x) 0.4)
    )
  0
  (none)
  )

(defbehavior update-mood-tombboss time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-tombboss-lights arg0)
  (let ((s5-0 (new 'static 'vector :x 790528.0 :y -262144.0 :z 6053888.0 :w 274432.0)))
    (if (< (vector-vector-distance (target-pos 0) s5-0) (-> s5-0 w))
        (mem-copy! (the-as pointer (-> arg0 light-group)) (the-as pointer (-> arg0 light-group 3)) 192)
        (mem-copy! (the-as pointer (-> arg0 light-group)) (the-as pointer (-> arg0 light-group 4)) 192)
        )
    )
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (let ((v1-4 (-> arg0 state)))
        (set! (-> arg0 times 0 w) 1.0)
        (set! (-> arg0 times 1 w) 1.0)
        (set! (-> arg0 times 7 w) (the-as float (-> v1-4 8)))
        )
      (update-mood-flames arg0 2 1 0 0.75 0.0009765625 2.0)
      (update-mood-flames arg0 3 1 8 0.75 0.0009765625 2.0)
      (update-mood-flames arg0 4 2 16 0.5 0.001953125 2.0)
      (update-mood-light arg0 6 24 0.8 0.2 19.0 0.0 1.0)
      )
    )
  0
  (none)
  )

(defun set-tombboss-gem-light! ((arg0 float))
  (let ((v1-1 (level-get *level* 'tombboss)))
    (when v1-1
      (let ((v1-2 (the-as tombboss-states (-> v1-1 mood-context state))))
        (set! (-> v1-2 gem-light) arg0)
        )
      )
    )
  )

(deftype fortress-states (structure)
  ((pulse pulse-state :inline :offset-assert   0)
   )
  :method-count-assert 9
  :size-assert         #x4
  :flag-assert         #x900000004
  )


(defun update-fortress-lights ((arg0 mood-context))
  (let ((a3-0 (-> arg0 light-group))
        (a2-0 (-> arg0 light-group 1))
        (a1-0 (-> arg0 light-group 2))
        (v1-0 (-> arg0 light-group 3))
        )
    (set-vector! (-> a3-0 0 dir0 color) 0.822 0.694 0.65 1.0)
    (set-vector! (-> a3-0 0 ambi color) 0.35 0.425 0.4 1.0)
    (set! (-> a3-0 0 ambi extra x) 0.8)
    (let ((a0-4 (-> a2-0 dir0)))
      (set! (-> a0-4 direction x) 0.0)
      (set! (-> a0-4 direction y) 1.0)
      (set! (-> a0-4 direction z) 0.0)
      (set! (-> a0-4 direction w) 0.0)
      )
    (set-vector! (-> a2-0 dir0 color) 0.822 0.694 0.65 1.0)
    (set-vector! (-> a2-0 ambi color) 0.35 0.425 0.4 1.0)
    (set! (-> a2-0 dir0 extra x) 0.7)
    (set! (-> a2-0 ambi extra x) 0.8)
    (let ((a0-9 (-> a1-0 dir0)))
      (set! (-> a0-9 direction x) 0.0)
      (set! (-> a0-9 direction y) 1.0)
      (set! (-> a0-9 direction z) 0.0)
      (set! (-> a0-9 direction w) 0.0)
      )
    (set-vector! (-> a1-0 dir0 color) 0.822 0.694 0.65 1.0)
    (set-vector! (-> a1-0 ambi color) 0.35 0.425 0.4 1.0)
    (set! (-> a1-0 dir0 extra x) 0.4)
    (set! (-> a1-0 ambi extra x) 0.4)
    (let ((a0-14 (-> v1-0 dir0)))
      (set! (-> a0-14 direction x) 0.0)
      (set! (-> a0-14 direction y) 1.0)
      (set! (-> a0-14 direction z) 0.0)
      (set! (-> a0-14 direction w) 0.0)
      )
    (set-vector! (-> v1-0 dir0 color) 0.822 0.5 0.65 1.0)
    (set-vector! (-> v1-0 ambi color) 0.35 0.425 0.4 1.0)
    (set! (-> v1-0 dir0 extra x) 0.25)
    (set! (-> v1-0 ambi extra x) 0.2)
    )
  0
  (none)
  )

(defbehavior update-mood-fortress time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-fortress-lights arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (set! (-> arg0 times 0 w) 1.0)
      (set! (-> arg0 times 1 w) 1.0)
      (update-mood-pulse arg0 7 0 0.75 0.25 (* 65536.0 (-> self clock seconds-per-frame)) 0.0)
      )
    )
  0
  (none)
  )

(deftype fordumpa-states (structure)
  ((turret-value float             4       :offset-assert   0)
   (pulse        pulse-state       :inline :offset-assert  16)
   (electricity  electricity-state :inline :offset-assert  20)
   )
  :method-count-assert 9
  :size-assert         #x1c
  :flag-assert         #x90000001c
  )


(defun init-mood-fordumpa ((arg0 mood-context))
  (let ((v1-0 (the-as fordumpa-states (-> arg0 state))))
    (set! (-> v1-0 electricity scale) 0.0)
    )
  )

(defbehavior update-mood-fordumpa time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-fortress-lights arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (set! (-> arg0 times 0 w) 1.0)
      (set! (-> arg0 times 1 w) 1.0)
      (update-mood-pulse arg0 7 16 0.75 0.25 (* 65536.0 (-> self clock seconds-per-frame)) 0.0)
      (update-mood-electricity arg0 6 20 0.8 1.0)
      (let ((s5-0 (the-as fordumpa-states (-> arg0 state))))
        (set! (-> arg0 times 2 w) (-> s5-0 turret-value 0))
        (set! (-> arg0 times 3 w) (-> s5-0 turret-value 1))
        (set! (-> arg0 times 4 w) (-> s5-0 turret-value 2))
        (set! (-> arg0 times 5 w) (-> s5-0 turret-value 3))
        (when (not (paused?))
          (dotimes (v1-7 4)
            (set! (-> s5-0 turret-value v1-7) (fmax 0.0 (+ -0.2 (-> s5-0 turret-value v1-7))))
            )
          )
        )
      )
    )
  0
  (none)
  )

(defun set-fordumpa-turret-flash! ((arg0 int))
  (let ((v1-1 (level-get *level* 'fordumpa)))
    (when v1-1
      (let ((v1-2 (the-as fordumpa-states (-> v1-1 mood-context state))))
        (set! (-> v1-2 turret-value arg0) 1.0)
        )
      )
    )
  )

(defun set-fordumpa-electricity-scale! ((arg0 float))
  (let ((v1-1 (level-get *level* 'fordumpa)))
    (when v1-1
      (let ((v1-2 (the-as fordumpa-states (-> v1-1 mood-context state))))
        (set! (-> v1-2 electricity scale) arg0)
        )
      )
    )
  )

(deftype fordumpc-states (structure)
  ((light-flag symbol               :offset-assert   0)
   (pulse0     pulse-state  :inline :offset-assert   4)
   (pulse1     pulse-state  :inline :offset-assert   8)
   (strobe     strobe-state :inline :offset-assert  12)
   )
  :method-count-assert 9
  :size-assert         #x10
  :flag-assert         #x900000010
  )


(defun init-mood-fordumpc ((arg0 mood-context))
  (set! (-> (the-as fordumpc-states (-> arg0 state)) light-flag) #f)
  #f
  )

(defbehavior update-mood-fordumpc time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-fortress-lights arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    ((begin
       (set! (-> arg0 times 0 w) 1.0)
       (set! (-> arg0 times 1 w) 1.0)
       (update-mood-pulse arg0 3 4 0.75 0.25 (* 65536.0 (-> self clock seconds-per-frame)) 0.0)
       (-> arg0 state 0)
       )
     (set! (-> arg0 times 2 w) 0.0)
     (update-mood-pulse arg0 4 8 0.75 0.25 (* 65536.0 (-> self clock seconds-per-frame)) 16384.0)
     (update-mood-strobe arg0 5 12 85 (* 16.0 (-> self clock seconds-per-frame)))
     )
    (else
      (set! (-> arg0 times 2 w) 1.0)
      (set! (-> arg0 times 4 w) 0.0)
      (set! (-> arg0 times 5 w) 0.0)
      )
    )
  0
  (none)
  )

(defun set-fordumpc-light-flag! ((arg0 symbol))
  (let ((v1-1 (level-get *level* 'fordumpc)))
    (when v1-1
      (set! (-> (the-as fordumpc-states (-> v1-1 mood-context state)) light-flag) arg0)
      arg0
      )
    )
  )

(deftype forresca-states (structure)
  ((pulse       pulse-state       :inline   :offset-assert   0)
   (electricity electricity-state 2 :inline :offset          4)
   )
  :method-count-assert 9
  :size-assert         #x24
  :flag-assert         #x900000024
  )


(defun init-mood-forresca ((arg0 mood-context))
  (let ((v1-0 (the-as forresca-states (-> arg0 state))))
    (set! (-> v1-0 electricity 0 scale) 1.0)
    (set! (-> v1-0 electricity 1 scale) 1.0)
    )
  )

(defbehavior update-mood-forresca time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-fortress-lights arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (set! (-> arg0 times 0 w) 1.0)
      (set! (-> arg0 times 1 w) 1.0)
      (update-mood-electricity arg0 5 4 0.8 1.0)
      (update-mood-electricity arg0 6 20 0.8 1.0)
      (update-mood-pulse arg0 7 0 0.75 0.25 (* 65536.0 (-> self clock seconds-per-frame)) 0.0)
      )
    )
  0
  (none)
  )

(defun set-forresca-electricity-scale! ((arg0 float) (arg1 int))
  (let ((v1-1 (level-get *level* 'forresca)))
    (when v1-1
      (let ((v1-2 (the-as object (-> v1-1 mood-context state))))
        (set! (-> (the-as forresca-states v1-2) electricity arg1 scale) arg0)
        )
      )
    )
  )

(deftype forrescb-states (structure)
  ((electricity electricity-state 2 :inline :offset-assert   0)
   (turret      float             4         :offset-assert  32)
   )
  :method-count-assert 9
  :size-assert         #x30
  :flag-assert         #x900000030
  )


(defun init-mood-forrescb ((arg0 mood-context))
  (let ((v1-0 (the-as forrescb-states (-> arg0 state))))
    (set! (-> v1-0 electricity 0 scale) 1.0)
    (set! (-> v1-0 electricity 1 scale) 1.0)
    )
  )

(defbehavior update-mood-forrescb time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-fortress-lights arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (let ((gp-0 (the-as forrescb-states (-> arg0 state))))
        (set! (-> arg0 times 0 w) 1.0)
        (set! (-> arg0 times 1 w) 1.0)
        (update-mood-electricity arg0 6 0 0.8 1.0)
        (update-mood-electricity arg0 7 16 0.8 1.0)
        (set! (-> arg0 times 2 w) (-> gp-0 turret 0))
        (set! (-> arg0 times 3 w) (-> gp-0 turret 1))
        (set! (-> arg0 times 4 w) (-> gp-0 turret 2))
        (set! (-> arg0 times 5 w) (-> gp-0 turret 3))
        (when (not (paused?))
          (dotimes (v1-5 4)
            (set! (-> gp-0 turret v1-5) (fmax 0.0 (+ -0.2 (-> gp-0 turret v1-5))))
            )
          )
        )
      )
    )
  0
  (none)
  )

(defun set-forrescb-turret-flash! ((arg0 int))
  (let ((v1-1 (level-get *level* 'forrescb)))
    (when v1-1
      (let ((v1-2 (-> v1-1 mood-context state)))
        (set! (-> (the-as forrescb-states (+ (* arg0 4) (the-as int v1-2))) turret 0) 1.0)
        )
      )
    )
  )

(defun set-forrescb-electricity-scale! ((arg0 float) (arg1 int))
  (let ((v1-1 (level-get *level* 'forrescb)))
    (when v1-1
      (let ((v1-2 (the-as object (-> v1-1 mood-context state))))
        (set! (-> (the-as forrescb-states v1-2) electricity arg1 scale) arg0)
        )
      )
    )
  )

(deftype prison-states (structure)
  ((pulse        float   :offset-assert   0)
   (angle        float   :offset-assert   4)
   (torture      float   :offset-assert   8)
   (torture-flag symbol  :offset-assert  12)
   )
  :method-count-assert 9
  :size-assert         #x10
  :flag-assert         #x900000010
  )


(defun update-prison-lights ((arg0 mood-context))
  (let ((v1-0 (-> arg0 light-group)))
    (set-vector! (-> v1-0 0 dir0 color) 0.0 0.0 0.0 1.0)
    (set-vector! (-> v1-0 0 ambi color) 0.2 0.2 0.2 1.0)
    )
  (set! (-> arg0 light-group 0 dir0 extra x) 0.0)
  0
  (none)
  )

(defun init-mood-prison ((arg0 mood-context))
  (let ((v1-0 (the-as prison-states (-> arg0 state))))
    (set! (-> v1-0 torture-flag) #f)
    (set! (-> v1-0 torture) 0.0)
    )
  )

(defbehavior update-mood-prison time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-prison-lights arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (let ((gp-0 (the-as prison-states (-> arg0 state))))
        (set! (-> arg0 times 0 w) 1.0)
        (set! (-> arg0 times 1 w) 1.0)
        (set! (-> arg0 times 3 w) 1.0)
        (set! (-> arg0 times 4 w) 1.0)
        (set! (-> arg0 times 5 w) 1.0)
        (set! (-> arg0 times 6 w) (-> gp-0 pulse))
        (if (task-node-closed? (game-task-node fortress-save-friends-resolution))
            (set! (-> arg0 times 7 w) 1.0)
            (set! (-> arg0 times 7 w) 0.0)
            )
        (set! (-> arg0 times 2 w) (-> gp-0 torture))
        (when (not (paused?))
          (set! (-> gp-0 pulse) (+ 1.125 (* 0.125 (cos (-> gp-0 angle)))))
          (let ((f0-14 (+ (-> gp-0 angle) (* 32768.0 (-> self clock seconds-per-frame)))))
            (set! (-> gp-0 angle) (- f0-14 (* (the float (the int (/ f0-14 65536.0))) 65536.0)))
            )
          (if (-> gp-0 torture-flag)
              (seek! (-> gp-0 torture) 1.0 (-> self clock seconds-per-frame))
              (seek! (-> gp-0 torture) 0.0 (-> self clock seconds-per-frame))
              )
          )
        )
      )
    )
  0
  (none)
  )

(defbehavior update-mood-copy-prison time-of-day-proc ((arg0 mood-context))
  (let ((v1-1 (level-get *level* 'prison)))
    (if (and v1-1 (= (-> v1-1 status) 'active))
        (mem-copy! (the-as pointer arg0) (the-as pointer (-> v1-1 mood-context)) 1968)
        )
    )
  0
  (none)
  )

(defun set-prison-torture-flag! ((arg0 symbol))
  (let ((v1-1 (level-get *level* 'prison)))
    (when v1-1
      (set! (-> (the-as prison-states (-> v1-1 mood-context state)) torture-flag) arg0)
      arg0
      )
    )
  )

(deftype under-states (structure)
  ((flame0     flames-state :inline :offset-assert   0)
   (flame1     flames-state :inline :offset-assert   8)
   (rot        float                :offset-assert  16)
   (rot2       float                :offset-assert  20)
   (time       float                :offset-assert  24)
   (laser      float                :offset-assert  28)
   (fog-interp float                :offset-assert  32)
   (flicker    float                :offset-assert  36)
   )
  :method-count-assert 9
  :size-assert         #x28
  :flag-assert         #x900000028
  )


(defun update-under-lights ((arg0 mood-context))
  (local-vars (sv-80 vector))
  (rlet ((vf0 :class vf)
         (vf4 :class vf)
         (vf5 :class vf)
         (vf6 :class vf)
         )
    (init-vf0-vector)
    (let* ((v1-0 (the-as under-states (-> arg0 state)))
           (a2-0 (new 'stack-no-clear 'matrix))
           (a1-0 (-> arg0 current-fog))
           (f0-0 (-> v1-0 fog-interp))
           )
      (set-vector! (-> a2-0 vector 0) 0.0 40.2343 59.5468 128.0)
      (set-vector! (-> a2-0 vector 1) 0.0 524288.0 200.0 8.0)
      (set-vector! (-> a2-0 vector 2) 0.0 40.2343 59.5468 128.0)
      (set-vector! (-> a1-0 fog-color) 0.0 40.2343 59.5468 128.0)
      (set-vector! (-> a1-0 fog-dists) 524288.0 1048576.0 255.0 8.0)
      (set-vector! (-> a1-0 erase-color) 0.0 40.2343 59.5468 128.0)
      (set-vector! (-> a1-0 erase-color) 0.0 40.2343 59.5468 128.0)
      (vector4-array-lerp!
        (the-as (inline-array vector4) a1-0)
        (the-as (inline-array vector4) a1-0)
        (the-as (inline-array vector4) a2-0)
        f0-0
        3
        )
      )
    (let ((s2-0 (-> arg0 light-group))
          (s3-0 (-> arg0 light-group 1))
          (s4-0 (-> arg0 light-group 2))
          (s5-0 (-> arg0 light-group 3))
          (gp-1 (-> arg0 light-group 4))
          )
      (let ((s1-0 (new 'static 'vector :x 0.8645 :z -0.5294)))
        (set! sv-80 (new 'static 'vector :x -2.0 :z 1950.0))
        (let ((v0-1 (target-pos 0))
              (s0-0 (new 'stack-no-clear 'vector))
              )
          (let ((v1-10 s0-0))
            (.lvf vf4 (&-> v0-1 quad))
            (.lvf vf5 (&-> sv-80 quad))
            (.mov.vf vf6 vf0 :mask #b1000)
            (.sub.vf vf6 vf4 vf5 :mask #b111)
            (.svf (&-> v1-10 quad) vf6)
            )
          (vector-normalize! s0-0 1.0)
          (cond
            ((>= (vector-dot s1-0 s0-0) 0.0)
             (set-vector! (-> s2-0 0 dir0 color) 0.6 0.5 0.7 1.0)
             (set-vector! (-> s2-0 0 ambi color) 0.3 0.3 0.3 1.0)
             )
            (else
              (set-vector! (-> s2-0 0 dir0 color) 0.2 0.2 0.4 1.0)
              (set-vector! (-> s2-0 0 ambi color) 0.2 0.2 0.2 1.0)
              )
            )
          )
        )
      (let ((v1-16 (-> s3-0 dir0)))
        (set! (-> v1-16 direction x) 0.0)
        (set! (-> v1-16 direction y) 1.0)
        (set! (-> v1-16 direction z) 0.0)
        (set! (-> v1-16 direction w) 0.0)
        )
      (set-vector! (-> s3-0 dir0 color) 0.0 0.0 0.0 1.0)
      (set-vector! (-> s3-0 ambi color) 1.0 1.0 1.0 1.0)
      (set! (-> s3-0 dir0 extra x) 0.0)
      (set! (-> s3-0 dir1 extra x) 0.0)
      (set! (-> s3-0 dir2 extra x) 0.0)
      (set! (-> s3-0 ambi extra x) 1.0)
      (let ((v1-20 (-> s4-0 dir0)))
        (set! (-> v1-20 direction x) 0.0)
        (set! (-> v1-20 direction y) -1.0)
        (set! (-> v1-20 direction z) 0.0)
        (set! (-> v1-20 direction w) 0.0)
        )
      (let ((v1-21 (-> s4-0 dir1)))
        (set! (-> v1-21 direction x) 0.0)
        (set! (-> v1-21 direction y) 1.0)
        (set! (-> v1-21 direction z) 0.0)
        (set! (-> v1-21 direction w) 0.0)
        )
      (set-vector! (-> s4-0 dir0 color) 0.3 0.4 0.6 1.0)
      (set-vector! (-> s4-0 dir1 color) 0.3 0.4 0.6 1.0)
      (set-vector! (-> s4-0 ambi color) 0.15 0.3 0.6 1.0)
      (set! (-> s4-0 dir0 extra x) 1.0)
      (set! (-> s4-0 dir1 extra x) 1.0)
      (set! (-> s4-0 dir2 extra x) 0.0)
      (set! (-> s4-0 ambi extra x) 1.0)
      (let ((v1-28 (-> s5-0 dir0)))
        (set! (-> v1-28 direction x) 0.0)
        (set! (-> v1-28 direction y) 1.0)
        (set! (-> v1-28 direction z) 0.0)
        (set! (-> v1-28 direction w) 0.0)
        )
      (set-vector! (-> s5-0 dir0 color) 0.3 0.25 0.35 1.0)
      (set-vector! (-> s5-0 ambi color) 0.3 0.3 0.3 1.0)
      (set! (-> s5-0 dir0 extra x) 0.65)
      (set! (-> s5-0 dir1 extra x) 0.0)
      (set! (-> s5-0 dir2 extra x) 0.0)
      (set! (-> s5-0 ambi extra x) 1.0)
      (let ((v1-33 (-> gp-1 dir0)))
        (set! (-> v1-33 direction x) 0.0)
        (set! (-> v1-33 direction y) 1.0)
        (set! (-> v1-33 direction z) 0.0)
        (set! (-> v1-33 direction w) 0.0)
        )
      (set-vector! (-> gp-1 dir0 color) 0.3 0.25 0.45 1.0)
      (set-vector! (-> gp-1 ambi color) 0.3 0.3 0.3 1.0)
      (set! (-> gp-1 dir0 extra x) 0.5)
      (set! (-> gp-1 dir1 extra x) 0.0)
      (set! (-> gp-1 dir2 extra x) 0.0)
      (set! (-> gp-1 ambi extra x) 0.5)
      )
    )
  )

(defbehavior update-mood-under time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-under-lights arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (let ((gp-0 (the-as under-states (-> arg0 state))))
        (set! (-> arg0 times 0 w) 1.0)
        (set! (-> arg0 times 1 w) 1.0)
        (update-mood-caustics arg0 6 (-> gp-0 rot) 0.0 0.75 0.5)
        (update-mood-caustics arg0 7 (-> gp-0 rot) 21845.334 0.75 0.5)
        (update-mood-caustics arg0 3 (-> gp-0 rot2) 43690.668 0.75 0.25)
        (update-mood-flames arg0 2 1 0 0.75 0.0009765625 2.0)
        (let ((f0-6 (fmin 1.0 (+ (-> gp-0 flicker) (-> gp-0 laser)))))
          (set! (-> arg0 times 4 w) f0-6)
          (set! (-> arg0 times 5 w) (- 1.0 f0-6))
          )
        (when (movie?)
          (set! (-> arg0 times 4 w) 0.0)
          (set! (-> arg0 times 5 w) 0.0)
          )
        (when (not (paused?))
          (+! (-> gp-0 time) (* 300.0 (-> self clock seconds-per-frame)))
          (+! (-> gp-0 rot) (* 32768.0 (-> self clock seconds-per-frame)))
          (+! (-> gp-0 rot2) (* 16384.0 (-> self clock seconds-per-frame)))
          (set! (-> gp-0 flicker) (rand-vu-float-range 0.0 0.1))
          )
        )
      )
    )
  0
  (none)
  )

(defbehavior update-mood-copy-underb time-of-day-proc ((arg0 mood-context))
  (let ((v1-1 (level-get *level* 'underb)))
    (if (and v1-1 (= (-> v1-1 status) 'active))
        (mem-copy! (the-as pointer arg0) (the-as pointer (-> v1-1 mood-context)) 1968)
        )
    )
  0
  (none)
  )

(defun set-under-laser! ((arg0 float))
  (let ((v1-1 (level-get *level* 'under)))
    (when v1-1
      (let ((v1-2 (the-as object (-> v1-1 mood-context state))))
        (set! (-> (the-as under-states v1-2) laser) arg0)
        )
      )
    )
  (let ((v1-4 (level-get *level* 'underb)))
    (when v1-4
      (let ((v1-5 (the-as object (-> v1-4 mood-context state))))
        (set! (-> (the-as under-states v1-5) laser) arg0)
        )
      )
    )
  )

(defun set-under-fog-interp! ((arg0 float))
  (let ((v1-1 (level-get *level* 'under)))
    (when v1-1
      (let ((v1-2 (the-as object (-> v1-1 mood-context state))))
        (set! (-> (the-as under-states v1-2) fog-interp) arg0)
        )
      )
    )
  (let ((v1-4 (level-get *level* 'underb)))
    (when v1-4
      (let ((v1-5 (the-as object (-> v1-4 mood-context state))))
        (set! (-> (the-as under-states v1-5) fog-interp) arg0)
        )
      )
    )
  )

(deftype gungame-states (structure)
  ((florescent florescent-state :inline :offset-assert   0)
   )
  :method-count-assert 9
  :size-assert         #x6
  :flag-assert         #x900000006
  )


(defun update-gungame-lights ((arg0 mood-context))
  (let ((v1-0 (-> arg0 light-group)))
    (let ((a0-1 (-> v1-0 0)))
      (set! (-> a0-1 dir0 direction x) 0.0)
      (set! (-> a0-1 dir0 direction y) 0.955)
      (set! (-> a0-1 dir0 direction z) 0.3)
      (set! (-> a0-1 dir0 direction w) 1.0)
      )
    (set-vector! (-> v1-0 0 dir0 color) 1.0 1.0 0.7 1.0)
    (set-vector! (-> v1-0 0 ambi color) 0.65 0.589 0.406 1.0)
    )
  0
  (none)
  )

(defbehavior update-mood-gungame time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-gungame-lights arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (set! (-> arg0 times 0 w) 1.0)
      (set! (-> arg0 times 1 w) 1.0)
      )
    )
  0
  (none)
  )

(deftype dig1-states (structure)
  ((pulse0    pulse-state :inline :offset-assert   0)
   (pulse1    pulse-state :inline :offset-assert   4)
   (explosion float               :offset-assert   8)
   (drillbit  float               :offset-assert  12)
   )
  :method-count-assert 9
  :size-assert         #x10
  :flag-assert         #x900000010
  )


(defun init-mood-dig1 ((arg0 mood-context))
  (let ((v1-0 (the-as object (-> arg0 state))))
    (set! (-> (the-as dig1-states v1-0) explosion) 0.0)
    )
  )

(defun update-dig1-lights ((arg0 mood-context))
  (let ((v1-0 (-> arg0 current-fog)))
    (set-vector! (-> v1-0 fog-color) 205.0 90.0 90.0 128.0)
    (set-vector! (-> v1-0 fog-dists) 294912.0 1802240.0 255.0 187.5)
    (set-vector! (-> v1-0 erase-color) 54.2635 23.823 23.823 128.0)
    )
  (set-vector! (-> arg0 current-env-color) 0.0 0.0 0.0 0.0)
  (let ((t2-0 (-> arg0 light-group))
        (t1-0 (-> arg0 light-group 1))
        (t0-0 (-> arg0 light-group 2))
        (a3-0 (-> arg0 light-group 3))
        (a2-8 (-> arg0 light-group 4))
        (a1-6 (-> arg0 light-group 5))
        (v1-3 (-> arg0 light-group 6))
        )
    (let ((a0-1 (-> t2-0 0)))
      (set! (-> a0-1 dir0 direction x) 0.0)
      (set! (-> a0-1 dir0 direction y) 0.955)
      (set! (-> a0-1 dir0 direction z) 0.3)
      (set! (-> a0-1 dir0 direction w) 1.0)
      )
    (set-vector! (-> t2-0 0 dir0 color) 0.9 0.6 0.6 1.0)
    (let ((a0-3 (-> t2-0 0 dir1)))
      (set! (-> a0-3 direction x) 0.0)
      (set! (-> a0-3 direction y) -1.0)
      (set! (-> a0-3 direction z) 0.0)
      (set! (-> a0-3 direction w) 1.0)
      )
    (set-vector! (-> t2-0 0 dir1 color) 0.9 0.3 0.3 1.0)
    (set-vector! (-> t2-0 0 ambi color) 0.65 0.589 0.406 1.0)
    (set! (-> t2-0 0 dir0 extra x) 0.9)
    (set! (-> t2-0 0 dir1 extra x) 0.3)
    (set! (-> t2-0 0 ambi extra x) 0.45)
    (let ((a0-9 (-> t1-0 dir0)))
      (set! (-> a0-9 direction x) 0.0)
      (set! (-> a0-9 direction y) 0.955)
      (set! (-> a0-9 direction z) 0.3)
      (set! (-> a0-9 direction w) 1.0)
      )
    (set-vector! (-> t1-0 dir0 color) 1.0 0.6 0.6 1.0)
    (let ((a0-11 (-> t1-0 dir1)))
      (set! (-> a0-11 direction x) 0.0)
      (set! (-> a0-11 direction y) -0.955)
      (set! (-> a0-11 direction z) -0.3)
      (set! (-> a0-11 direction w) 1.0)
      )
    (set-vector! (-> t1-0 dir1 color) 0.9 0.4 0.3 1.0)
    (set-vector! (-> t1-0 ambi color) 0.65 0.55 0.25 1.0)
    (set! (-> t1-0 dir0 extra x) 0.2)
    (set! (-> t1-0 dir1 extra x) 0.85)
    (set! (-> t1-0 ambi extra x) 0.5)
    (let ((a0-17 (-> t0-0 dir0)))
      (set! (-> a0-17 direction x) 0.0)
      (set! (-> a0-17 direction y) 0.955)
      (set! (-> a0-17 direction z) 0.3)
      (set! (-> a0-17 direction w) 1.0)
      )
    (set-vector! (-> t0-0 dir0 color) 0.8 0.5 0.4 1.0)
    (set-vector! (-> t0-0 ambi color) 0.6 0.4 0.3 1.0)
    (set! (-> t0-0 dir0 extra x) 0.5)
    (set! (-> t0-0 ambi extra x) 0.4)
    (let ((a0-22 (-> a3-0 dir0)))
      (set! (-> a0-22 direction x) 0.5299)
      (set! (-> a0-22 direction y) 0.8479)
      (set! (-> a0-22 direction z) 0.0)
      (set! (-> a0-22 direction w) 1.0)
      )
    (set-vector! (-> a3-0 dir0 color) 1.0 1.0 1.0 1.0)
    (let ((a0-24 (-> a3-0 dir1)))
      (set! (-> a0-24 direction x) 0.0)
      (set! (-> a0-24 direction y) -1.0)
      (set! (-> a0-24 direction z) 0.0)
      (set! (-> a0-24 direction w) 1.0)
      )
    (set-vector! (-> a3-0 dir1 color) 0.9 0.3 0.3 1.0)
    (set-vector! (-> a3-0 ambi color) 0.5 0.5 0.5 1.0)
    (set! (-> a3-0 dir0 extra x) 1.0)
    (set! (-> a3-0 dir1 extra x) 0.5)
    (set! (-> a3-0 ambi extra x) 0.6)
    (let ((a0-30 (-> a2-8 dir0)))
      (set! (-> a0-30 direction x) 0.3)
      (set! (-> a0-30 direction y) 0.955)
      (set! (-> a0-30 direction z) 0.0)
      (set! (-> a0-30 direction w) 1.0)
      )
    (set-vector! (-> a2-8 dir0 color) 1.0 1.0 1.0 1.0)
    (let ((a0-32 (-> a2-8 dir1)))
      (set! (-> a0-32 direction x) 0.0)
      (set! (-> a0-32 direction y) -1.0)
      (set! (-> a0-32 direction z) 0.0)
      (set! (-> a0-32 direction w) 1.0)
      )
    (set-vector! (-> a2-8 dir1 color) 0.9 0.3 0.3 1.0)
    (set-vector! (-> a2-8 ambi color) 0.5 0.5 0.5 1.0)
    (set! (-> a2-8 dir0 extra x) 1.0)
    (set! (-> a2-8 dir1 extra x) 0.5)
    (set! (-> a2-8 ambi extra x) 0.6)
    (let ((a0-38 (-> a1-6 dir0)))
      (set! (-> a0-38 direction x) 0.3)
      (set! (-> a0-38 direction y) 0.955)
      (set! (-> a0-38 direction z) 0.0)
      (set! (-> a0-38 direction w) 1.0)
      )
    (set-vector! (-> a1-6 dir0 color) 1.0 1.0 1.0 1.0)
    (let ((a0-40 (-> a1-6 dir1)))
      (set! (-> a0-40 direction x) 0.0)
      (set! (-> a0-40 direction y) -1.0)
      (set! (-> a0-40 direction z) 0.0)
      (set! (-> a0-40 direction w) 1.0)
      )
    (set-vector! (-> a1-6 dir1 color) 0.8 0.5 0.3 1.0)
    (set-vector! (-> a1-6 ambi color) 0.5 0.4 0.4 1.0)
    (set! (-> a1-6 dir0 extra x) 1.0)
    (set! (-> a1-6 dir1 extra x) 1.4)
    (set! (-> a1-6 ambi extra x) 0.6)
    (let ((a0-46 (-> v1-3 dir0)))
      (set! (-> a0-46 direction x) 0.3)
      (set! (-> a0-46 direction y) 0.955)
      (set! (-> a0-46 direction z) 0.0)
      (set! (-> a0-46 direction w) 1.0)
      )
    (set-vector! (-> v1-3 dir0 color) 0.8 0.9 0.5 1.0)
    (let ((a0-48 (-> v1-3 dir1)))
      (set! (-> a0-48 direction x) 0.5299)
      (set! (-> a0-48 direction y) 0.8479)
      (set! (-> a0-48 direction z) 0.0)
      (set! (-> a0-48 direction w) 1.0)
      )
    (set-vector! (-> v1-3 dir1 color) 0.6 0.4 0.3 1.0)
    (set-vector! (-> v1-3 ambi color) 0.6 0.5 0.4 1.0)
    (set! (-> v1-3 dir0 extra x) 0.6)
    (set! (-> v1-3 dir1 extra x) 0.55)
    (set! (-> v1-3 ambi extra x) 0.5)
    )
  0
  (none)
  )

;; ERROR: Stack slot load at 16 mismatch: defined as size 4, got size 16
;; ERROR: Stack slot load at 32 mismatch: defined as size 4, got size 16
;; ERROR: Stack slot load at 16 mismatch: defined as size 4, got size 16
;; ERROR: Stack slot load at 32 mismatch: defined as size 4, got size 16
;; ERROR: Stack slot load at 16 mismatch: defined as size 4, got size 16
;; ERROR: Stack slot load at 32 mismatch: defined as size 4, got size 16
(defbehavior update-mood-dig1 time-of-day-proc ((arg0 mood-context))
  (local-vars (sv-16 float) (sv-32 float))
  (update-mood-interior arg0)
  (update-dig1-lights arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (let ((gp-0 (the-as dig1-states (-> arg0 state))))
        (set! (-> arg0 times 0 w) 1.0)
        (set! (-> arg0 times 1 w) 1.0)
        (let ((s4-0 update-mood-pulse)
              (s3-0 arg0)
              (s2-0 2)
              (s1-0 0)
              (s0-0 0.85)
              )
          (set! sv-16 0.15)
          (let ((t1-0 (* 182.04445 (-> self clock seconds-per-frame) (rand-vu-float-range 60.0 200.0)))
                (t2-0 0.0)
                )
            (s4-0 s3-0 s2-0 s1-0 s0-0 sv-16 t1-0 t2-0)
            )
          )
        (let ((s4-1 update-mood-pulse)
              (s3-1 arg0)
              (s2-1 3)
              (s1-1 4)
              (s0-1 0.85)
              )
          (set! sv-32 0.15)
          (let ((t1-1 (* 182.04445 (-> self clock seconds-per-frame) (rand-vu-float-range 120.0 180.0)))
                (t2-1 16384.0)
                )
            (s4-1 s3-1 s2-1 s1-1 s0-1 sv-32 t1-1 t2-1)
            )
          )
        (set! (-> arg0 times 6 w) 1.0)
        (if (not (task-node-closed? (game-task-node dig-knock-down-resolution)))
            (set! (-> arg0 times 5 w) (-> gp-0 drillbit))
            )
        (when (!= (-> gp-0 explosion) 0.0)
          (set! (-> arg0 times 7 w) (-> gp-0 explosion))
          (let ((f0-15 (- 1.0 (* 0.5 (-> gp-0 explosion)))))
            (set! (-> arg0 times 2 w) (* (-> arg0 times 2 w) f0-15))
            (set! (-> arg0 times 3 w) (* (-> arg0 times 3 w) f0-15))
            (set! (-> arg0 times 0 w) (* (-> arg0 times 0 w) f0-15))
            (set! (-> arg0 times 1 w) (* (-> arg0 times 1 w) f0-15))
            )
          )
        (when (not (paused?))
          (set! (-> gp-0 drillbit) (rand-vu-float-range 0.5 1.0))
          (seek! (-> gp-0 explosion) 0.0 (* 2.5 (-> self clock seconds-per-frame)))
          )
        )
      )
    )
  0
  (none)
  )

(defun set-dig1-explosion! ((arg0 float))
  (let ((v1-1 (level-get *level* 'dig1)))
    (when v1-1
      (let ((v1-2 (the-as object (-> v1-1 mood-context state))))
        (set! (-> (the-as dig1-states v1-2) explosion) 1.9921875)
        )
      )
    )
  )

(deftype vortex-states (structure)
  ((time        float          :offset-assert   0)
   (level       float          :offset-assert   4)
   (delta       float          :offset-assert   8)
   (scale       float          :offset-assert  12)
   (flash       float          :offset-assert  16)
   (num         int32          :offset-assert  20)
   (white       symbol         :offset-assert  24)
   (white-count float          :offset-assert  28)
   (pos         vector :inline :offset-assert  32)
   (dir         vector :inline :offset-assert  48)
   )
  :method-count-assert 9
  :size-assert         #x40
  :flag-assert         #x900000040
  )


(defun update-vortex-lights ((arg0 mood-context))
  (set-vector! (-> arg0 current-env-color) 96.0 48.0 196.0 255.0)
  0
  (none)
  )

(defbehavior update-mood-vortex time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (update-vortex-lights arg0)
  (let ((a1-0 (-> arg0 light-group))
        (s5-0 (-> arg0 light-group 1))
        (gp-1 (the-as vortex-states (-> arg0 state)))
        )
    (set-vector! (-> a1-0 0 ambi color) 0.2 0.2 0.5 1.0)
    (set! (-> a1-0 0 ambi extra x) 1.0)
    (set-vector! (-> a1-0 0 dir0 color) 0.5 0.4 0.8 1.0)
    (set! (-> a1-0 0 dir0 direction quad) (-> gp-1 dir quad))
    (set! (-> a1-0 0 dir0 extra x) (-> gp-1 level))
    (set-vector! (-> a1-0 0 dir1 color) 0.0 0.0 0.0 0.0)
    (let ((v1-5 (-> a1-0 0 dir1)))
      (set! (-> v1-5 direction x) 0.0)
      (set! (-> v1-5 direction y) 0.0)
      (set! (-> v1-5 direction z) 1.0)
      (set! (-> v1-5 direction w) 0.0)
      )
    (set! (-> a1-0 0 dir1 extra x) 0.0)
    (set! (-> a1-0 0 dir2 extra x) 0.0)
    (mem-copy! (the-as pointer s5-0) (the-as pointer a1-0) 192)
    (cond
      ((-> gp-1 white)
       (set-vector! (-> s5-0 dir1 color) 1.0 1.0 1.0 1.0)
       (set-vector! (-> s5-0 dir2 color) 1.0 1.0 1.0 1.0)
       (let ((v1-9 (-> s5-0 dir1)))
         (set! (-> v1-9 direction x) 0.0)
         (set! (-> v1-9 direction y) -0.707)
         (set! (-> v1-9 direction z) 0.707)
         (set! (-> v1-9 direction w) 0.0)
         )
       (let ((v1-10 (-> s5-0 dir2)))
         (set! (-> v1-10 direction x) 0.0)
         (set! (-> v1-10 direction y) 0.707)
         (set! (-> v1-10 direction z) 0.707)
         (set! (-> v1-10 direction w) 0.0)
         )
       (set! (-> s5-0 dir1 extra x) (fmin 1.0 (* 0.21739131 (-> gp-1 white-count))))
       (set! (-> s5-0 dir2 extra x) (-> s5-0 dir1 extra x))
       )
      (else
        (set-vector! (-> s5-0 dir1 color) 0.1 0.3 0.5 1.0)
        (let ((v1-15 (-> s5-0 dir1)))
          (set! (-> v1-15 direction x) 0.0)
          (set! (-> v1-15 direction y) -0.177)
          (set! (-> v1-15 direction z) 0.984)
          (set! (-> v1-15 direction w) 0.0)
          )
        (set! (-> s5-0 dir1 extra x) 1.0)
        )
      )
    (when (not (paused?))
      (if (-> gp-1 white)
          (+! (-> gp-1 white-count) (-> *display* base-clock seconds-per-frame))
          )
      (cond
        ((< 0.0 (-> gp-1 flash))
         (set! (-> gp-1 level) (-> gp-1 flash))
         (set-vector! (-> gp-1 dir) 0.0 0.0 1.0 0.0)
         (set! (-> gp-1 flash) (- (-> gp-1 flash) (* 0.5 (-> *display* base-clock seconds-per-frame))))
         (set! (-> gp-1 time) 0.0)
         )
        (else
          (when (>= 0.0 (-> gp-1 time))
            (set! (-> gp-1 num) (the int (rand-vu-float-range 0.0 4.0)))
            (set! (-> gp-1 scale) (rand-vu-float-range 0.75 1.5))
            (if (< (-> gp-1 num) 3)
                (set! (-> gp-1 time) (rand-vu-float-range 0.25 0.5))
                (set! (-> gp-1 time) (rand-vu-float-range 0.0 0.5))
                )
            (set-vector!
              (-> gp-1 pos)
              (rand-vu-float-range -8192.0 8192.0)
              (rand-vu-float-range -8192.0 8192.0)
              102400.0
              0.0
              )
            (set! (-> gp-1 delta) (/ 204800.0 (-> gp-1 time)))
            )
          (when (< (-> gp-1 num) 3)
            (let ((f30-0 (vector-length (-> gp-1 pos))))
              (set! (-> gp-1 dir quad) (-> gp-1 pos quad))
              (vector-normalize! (-> gp-1 dir) 1.0)
              (set! (-> gp-1 level) (* (-> gp-1 scale) (- 1.0 (fmin 1.0 (* 0.000009765625 f30-0)))))
              )
            (set! (-> gp-1 pos z) (- (-> gp-1 pos z) (* (-> gp-1 delta) (-> *display* base-clock seconds-per-frame))))
            )
          (set! (-> gp-1 time) (- (-> gp-1 time) (-> *display* base-clock seconds-per-frame)))
          )
        )
      )
    )
  0
  (none)
  )

(defun set-vortex-flash! ((arg0 float))
  (let ((v1-1 (level-get *level* 'introcst)))
    (when v1-1
      (let ((v1-2 (the-as object (-> v1-1 mood-context state))))
        (set! (-> (the-as vortex-states v1-2) flash) 1.0)
        )
      )
    )
  (let ((v1-4 (level-get *level* 'lintcstb)))
    (when v1-4
      (let ((v1-5 (the-as object (-> v1-4 mood-context state))))
        (set! (-> (the-as vortex-states v1-5) flash) 1.0)
        )
      )
    )
  )

(defun set-vortex-white! ((arg0 symbol))
  (let ((v1-1 (level-get *level* 'introcst)))
    (when v1-1
      (let ((v1-2 (the-as vortex-states (-> v1-1 mood-context state))))
        (set! (-> v1-2 white) arg0)
        (set! (-> v1-2 white-count) 0.0)
        )
      )
    )
  (let ((v1-4 (level-get *level* 'lintcstb)))
    (when v1-4
      (let ((v1-5 (the-as vortex-states (-> v1-4 mood-context state))))
        (set! (-> v1-5 white) arg0)
        (set! (-> v1-5 white-count) 0.0)
        )
      )
    )
  )

(deftype nestb-states (structure)
  ((pulse        pulse-state :inline :offset-assert   0)
   (rot          float               :offset-assert   4)
   (purple       float               :offset-assert   8)
   (purple-noise float               :offset-assert  12)
   )
  :method-count-assert 9
  :size-assert         #x10
  :flag-assert         #x900000010
  )


;; WARN: Return type mismatch pointer vs none.
(defun update-nestb-lights ((arg0 mood-context))
  (let ((gp-0 (-> arg0 light-group 1)))
    (let ((v1-0 (-> arg0 current-fog)))
      (set! (-> v1-0 fog-color x) 37.5625)
      (set! (-> v1-0 fog-color y) 18.875)
      (set! (-> v1-0 fog-color z) 70.0)
      (set! (-> v1-0 fog-color w) 128.0)
      )
    (set-vector! (-> arg0 current-fog fog-dists) 0.0 819200.0 255.0 16.0)
    (set-vector! (-> arg0 current-fog erase-color) 33.806248 16.9875 63.0 128.0)
    (let ((v1-4 (level-get *level* 'nest)))
      (if v1-4
          (mem-copy! (the-as pointer gp-0) (the-as pointer (-> v1-4 mood-context light-group)) 192)
          (mem-copy! (the-as pointer gp-0) (the-as pointer (-> *level* default-level mood-context light-group)) 192)
          )
      )
    )
  (none)
  )

(defbehavior update-mood-nestb time-of-day-proc ((arg0 mood-context) (arg1 object) (arg2 int))
  (copy-mood-exterior-ambi arg0 #f)
  (update-mood-interior arg0)
  (update-nestb-lights arg0)
  (when (and (= (-> *level* level arg2 status) 'active)
             (< (the-as uint (-> *time-of-day-context* mode)) (the-as uint 9))
             )
    (let ((gp-1 (the-as nestb-states (-> arg0 state))))
      (set! (-> arg0 times 1 w) 1.0)
      (update-mood-caustics arg0 2 (-> gp-1 rot) 10922.667 0.75 0.25)
      (update-mood-caustics arg0 3 (-> gp-1 rot) 0.0 0.75 0.25)
      ;; note : updated for pc port for nest revisit
      (#if PC_PORT
          (if (process-by-name "blocking-plane-nestb" *active-pool*)
              (set! (-> arg0 times 4 w) 0.0)
              (update-mood-pulse arg0 4 0 0.875 0.125 (* 196608.0 (-> self clock seconds-per-frame)) 0.0))
          (update-mood-pulse arg0 4 0 0.875 0.125 (* 196608.0 (-> self clock seconds-per-frame)) 0.0))
      (set! (-> arg0 times 5 w) (+ (-> gp-1 purple) (-> gp-1 purple-noise)))
      (when (not (paused?))
        (seek! (-> gp-1 purple) 0.0 (* 4.0 (-> self clock seconds-per-frame)))
        (set! (-> gp-1 purple-noise) (rand-vu-float-range 0.0 (* 0.2 (-> gp-1 purple))))
        (+! (-> gp-1 rot) (* 16384.0 (-> self clock seconds-per-frame)))
        )
      )
    )
  0
  (none)
  )

(defun set-nestb-purple! ((arg0 float))
  (let ((v1-1 (level-get *level* 'nestb)))
    (when v1-1
      (let ((v1-2 (the-as object (-> v1-1 mood-context state))))
        (set! (-> (the-as nestb-states v1-2) purple) arg0)
        )
      )
    )
  )

(defun get-nestb-purple ()
  (let ((v1-1 (level-get *level* 'nestb)))
    (if v1-1
        (-> (the-as nestb-states (-> v1-1 mood-context state)) purple)
        0.0
        )
    )
  )

(deftype consiteb-states (structure)
  ((flicker       float  :offset-assert   0)
   (flicker-count float  :offset-assert   4)
   (flicker-state int32  :offset-assert   8)
   )
  :method-count-assert 9
  :size-assert         #xc
  :flag-assert         #x90000000c
  )


(defun init-mood-consiteb ((arg0 mood-context))
  (let ((v1-0 (the-as consiteb-states (-> arg0 state))))
    (set! (-> v1-0 flicker) 1.0)
    (set! (-> v1-0 flicker-state) 0)
    )
  0
  (none)
  )

(defbehavior update-mood-consiteb time-of-day-proc ((arg0 mood-context) (arg1 object) (arg2 int))
  (copy-mood-exterior-ambi arg0 #f)
  (update-mood-interior arg0)
  (when (and (= (-> *level* level arg2 status) 'active)
             (< (the-as uint (-> *time-of-day-context* mode)) (the-as uint 9))
             )
    (let ((gp-1 (the-as consiteb-states (-> arg0 state))))
      (set! (-> arg0 times 0 w) 0.0)
      (set! (-> arg0 times 1 w) 1.0)
      (set! (-> arg0 times 2 w) (-> gp-1 flicker))
      (when (not (paused?))
        (let ((v1-9 (-> gp-1 flicker-state)))
          (cond
            ((zero? v1-9)
             (set! (-> gp-1 flicker) (rand-vu-float-range 0.2 0.4))
             (set! (-> gp-1 flicker-count) (- (-> gp-1 flicker-count) (-> self clock seconds-per-frame)))
             (when (>= 0.0 (-> gp-1 flicker-count))
               (set! (-> gp-1 flicker-count) (rand-vu-float-range 0.25 1.0))
               (set! (-> gp-1 flicker-state) 1)
               )
             )
            ((= v1-9 1)
             (set! (-> gp-1 flicker-count) (- (-> gp-1 flicker-count) (-> self clock seconds-per-frame)))
             (when (>= 0.0 (-> gp-1 flicker-count))
               (set! (-> gp-1 flicker-count) (rand-vu-float-range 0.1 0.5))
               (set! (-> gp-1 flicker-state) 2)
               )
             )
            ((= v1-9 2)
             (set! (-> gp-1 flicker) (rand-vu-float-range 0.25 0.75))
             (set! (-> gp-1 flicker-count) (- (-> gp-1 flicker-count) (-> self clock seconds-per-frame)))
             (when (>= 0.0 (-> gp-1 flicker-count))
               (set! (-> gp-1 flicker-count) (rand-vu-float-range 0.25 1.0))
               (set! (-> gp-1 flicker-state) 3)
               )
             )
            (else
              (set! (-> gp-1 flicker-count) (- (-> gp-1 flicker-count) (-> self clock seconds-per-frame)))
              (when (>= 0.0 (-> gp-1 flicker-count))
                (set! (-> gp-1 flicker-count) (rand-vu-float-range 0.1 0.5))
                (set! (-> gp-1 flicker-state) 0)
                0
                )
              )
            )
          )
        )
      )
    )
  0
  (none)
  )

(deftype castle-states (structure)
  ((electricity electricity-state :inline   :offset-assert   0)
   (pulse       pulse-state       2 :inline :offset-assert   8)
   (rot         float                       :offset-assert  40)
   (robot-rot   float                       :offset-assert  44)
   )
  :method-count-assert 9
  :size-assert         #x30
  :flag-assert         #x900000030
  )


(defun update-castle-lights ((arg0 mood-context))
  (let ((a2-0 (-> arg0 light-group))
        (a1-0 (-> arg0 light-group 1))
        (v1-0 (-> arg0 light-group 2))
        )
    (let ((a3-0 (-> arg0 current-fog)))
      (set! (-> a3-0 fog-color x) 95.625)
      (set! (-> a3-0 fog-color y) 135.4687)
      (set! (-> a3-0 fog-color z) 69.0625)
      (set! (-> a3-0 fog-color w) 1.0)
      )
    (set-vector! (-> arg0 current-fog fog-dists) 253952.0 901120.0 255.0 147.0)
    (set-vector! (-> arg0 current-fog erase-color) 0.0 0.0 0.0 128.0)
    (set-vector! (-> arg0 current-env-color) 96.0 96.0 96.0 255.0)
    (let ((a3-4 (-> a2-0 0)))
      (set! (-> a3-4 dir0 direction x) 0.6499)
      (set! (-> a3-4 dir0 direction y) 0.7134)
      (set! (-> a3-4 dir0 direction z) 0.2619)
      (set! (-> a3-4 dir0 direction w) 1.0)
      )
    (set-vector! (-> a2-0 0 dir0 color) 0.65 0.575 0.575 1.0)
    (let ((a3-6 (-> a2-0 0 dir1)))
      (set! (-> a3-6 direction x) -0.6499)
      (set! (-> a3-6 direction y) 0.7134)
      (set! (-> a3-6 direction z) -0.2619)
      (set! (-> a3-6 direction w) 1.0)
      )
    (set-vector! (-> a2-0 0 dir1 color) 0.75 0.6 0.5 1.0)
    (set-vector! (-> a2-0 0 ambi color) 0.2 0.2 0.25 1.0)
    (set! (-> a2-0 0 dir0 extra x) 0.65)
    (set! (-> a2-0 0 dir1 extra x) 1.0)
    (set! (-> a2-0 0 ambi extra x) 0.7)
    (let ((a2-1 (-> a1-0 dir0)))
      (set! (-> a2-1 direction x) 0.0)
      (set! (-> a2-1 direction y) 1.0)
      (set! (-> a2-1 direction z) 0.0)
      (set! (-> a2-1 direction w) 1.0)
      )
    (set-vector! (-> a1-0 dir0 color) 0.7 0.8 0.5 1.0)
    (let ((a2-3 (-> a1-0 dir1)))
      (set! (-> a2-3 direction x) 0.5299)
      (set! (-> a2-3 direction y) -0.8479)
      (set! (-> a2-3 direction z) 0.0)
      (set! (-> a2-3 direction w) 1.0)
      )
    (set-vector! (-> a1-0 dir1 color) 0.5 0.6 0.0 1.0)
    (let ((a2-5 (-> a1-0 dir2)))
      (set! (-> a2-5 direction x) -0.5299)
      (set! (-> a2-5 direction y) -0.8479)
      (set! (-> a2-5 direction z) 0.0)
      (set! (-> a2-5 direction w) 1.0)
      )
    (set-vector! (-> a1-0 dir2 color) 0.5 0.6 0.0 1.0)
    (set-vector! (-> a1-0 ambi color) 0.2 0.2 0.25 1.0)
    (set! (-> a1-0 dir0 extra x) 0.7)
    (set! (-> a1-0 dir1 extra x) 0.8)
    (set! (-> a1-0 dir2 extra x) 0.8)
    (set! (-> a1-0 ambi extra x) 0.7)
    (let ((a1-1 (-> v1-0 dir0)))
      (set! (-> a1-1 direction x) 0.0)
      (set! (-> a1-1 direction y) 0.717)
      (set! (-> a1-1 direction z) 0.717)
      (set! (-> a1-1 direction w) 1.0)
      )
    (set-vector! (-> v1-0 dir0 color) 0.5 0.5 0.7 1.0)
    (let ((a1-3 (-> v1-0 dir1)))
      (set! (-> a1-3 direction x) 0.0)
      (set! (-> a1-3 direction y) 0.717)
      (set! (-> a1-3 direction z) -0.717)
      (set! (-> a1-3 direction w) 1.0)
      )
    (set-vector! (-> v1-0 dir1 color) 0.5 0.5 0.8 1.0)
    (set-vector! (-> v1-0 ambi color) 0.2 0.2 0.25 1.0)
    (set! (-> v1-0 dir0 extra x) (-> arg0 times 4 w))
    (set! (-> v1-0 dir1 extra x) (-> arg0 times 5 w))
    (set! (-> v1-0 ambi extra x) 0.75)
    )
  0
  (none)
  )

(defun init-mood-castle ((arg0 mood-context))
  (let ((v1-0 (the-as object (-> arg0 state))))
    (set! (-> (the-as castle-states v1-0) electricity scale) 1.0)
    )
  )

(defbehavior update-mood-castle time-of-day-proc ((arg0 mood-context))
  (update-mood-interior arg0)
  (cond
    ((< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
     (palette-select-special arg0)
     )
    (else
      (let ((s5-0 (the-as castle-states (-> arg0 state))))
        (set! (-> arg0 times 0 w) 1.0)
        (set! (-> arg0 times 1 w) 1.0)
        (update-mood-caustics arg0 2 (-> s5-0 rot) 0.0 0.8 0.5)
        (update-mood-caustics arg0 3 (-> s5-0 rot) 32768.0 0.8 0.5)
        (let ((f0-7 (+ 0.75 (* 0.25 (sin (-> s5-0 robot-rot))))))
          (set! (-> arg0 times 6 x) f0-7)
          (set! (-> arg0 times 6 y) f0-7)
          )
        (set! (-> arg0 times 6 w) 1.0)
        (update-mood-pulse arg0 4 8 1.15 0.15 (* 43690.668 (-> self clock seconds-per-frame)) 0.0)
        (update-mood-pulse arg0 5 24 1.3 0.2 (* 54613.332 (-> self clock seconds-per-frame)) 0.0)
        (update-mood-electricity arg0 7 0 0.9 1.0)
        (when (not (paused?))
          (+! (-> s5-0 rot) (* 13107.2 (-> self clock seconds-per-frame)))
          (+! (-> s5-0 robot-rot) (* 32768.0 (-> self clock seconds-per-frame)))
          )
        )
      )
    )
  (update-castle-lights arg0)
  0
  (none)
  )

(defun set-castle-electricity-scale! ((arg0 float))
  (let ((v1-1 (level-get *level* 'castle)))
    (when v1-1
      (let ((v1-2 (the-as object (-> v1-1 mood-context state))))
        (set! (-> (the-as castle-states v1-2) electricity scale) arg0)
        )
      )
    )
  )

(deftype garage-states (structure)
  ()
  :method-count-assert 9
  :size-assert         #x0
  :flag-assert         #x900000000
  )


(defun init-mood-garage ((arg0 mood-context))
  (-> arg0 state)
  #f
  )

(defun update-garage-lights ((arg0 mood-context))
  (let ((a1-0 (-> *level* default-level mood-context))
        (a0-1 (-> arg0 current-fog))
        )
    (mem-copy! (the-as pointer a0-1) (the-as pointer a1-0) 48)
    )
  (let ((s4-0 (-> *level* default-level mood-context light-group))
        (a1-1 (-> arg0 light-group))
        (s5-0 (-> arg0 light-group 1))
        (gp-1 (-> arg0 light-group 2))
        )
    (mem-copy! (the-as pointer s5-0) (the-as pointer a1-1) 192)
    (set! (-> s5-0 dir0 extra x) 0.5)
    (set! (-> s5-0 ambi extra x) 0.0)
    (mem-copy! (the-as pointer gp-1) (the-as pointer s4-0) 192)
    (set! (-> gp-1 dir0 extra x) 0.0)
    (set! (-> gp-1 dir1 extra x) 0.0)
    (set! (-> gp-1 dir2 extra x) 0.0)
    )
  0
  (none)
  )

(defbehavior update-mood-garage time-of-day-proc ((arg0 mood-context) (arg1 object) (arg2 int))
  (copy-mood-exterior-ambi arg0 #f)
  (update-mood-interior arg0)
  (update-garage-lights arg0)
  (when (and (= (-> *level* level arg2 status) 'active)
             (< (the-as uint (-> *time-of-day-context* mode)) (the-as uint 9))
             )
    (-> arg0 state)
    (set! (-> arg0 times 6 w) 0.75)
    (set! (-> arg0 times 1 w) 1.0)
    (set! (-> arg0 times 7 w) 1.0)
    )
  0
  (none)
  )

(defbehavior update-mood-copy-garage time-of-day-proc ((arg0 mood-context))
  (let ((v1-1 (level-get *level* 'garage)))
    (if (and v1-1 (= (-> v1-1 status) 'active))
        (mem-copy! (the-as pointer arg0) (the-as pointer (-> v1-1 mood-context)) 1968)
        )
    )
  0
  (none)
  )

(deftype palshaft-states (structure)
  ()
  :method-count-assert 9
  :size-assert         #x0
  :flag-assert         #x900000000
  )


(defbehavior update-mood-palshaft time-of-day-proc ((arg0 mood-context))
  (copy-mood-exterior-ambi arg0 #f)
  (update-mood-interior arg0)
  (if (< (the-as uint 8) (the-as uint (-> *time-of-day-context* mode)))
      (palette-select-special arg0)
      (set! (-> arg0 times 1 w) 1.0)
      )
  0
  (none)
  )
