;;-*-Lisp-*-
(in-package goal)

;; name: gun-yellow-shot.gc
;; name in dgo: gun-yellow-shot
;; dgos: ENGINE, GAME

;; DECOMP BEGINS

(defmethod init-proj-settings! guard-shot ((this guard-shot))
  "Init relevant settings for the [[projectile]] such as gravity, speed, timeout, etc"
  (set! (-> this tail-pos quad) (-> this root trans quad))
  (cpad-set-buzz! (-> *cpad-list* cpads 0) 1 204 (seconds 0.1))
  (set! (-> this attack-mode) 'turret)
  (set! (-> this max-speed) 1228800.0)
  (set! (-> this move) guard-shot-move)
  (set! (-> this damage) 1.0)
  (logior! (-> this options) (projectile-options deal-damage))
  (none)
  )

(defbehavior target-gun-fire-yellow target ()
  (let ((s5-0 (-> self gun))
        (gp-0 (new 'stack-no-clear 'projectile-init-by-other-params))
        )
    (set! (-> gp-0 ent) (-> self entity))
    (set! (-> gp-0 options) (projectile-options account-for-target-velocity deal-damage proj-options-8000))
    (set! (-> gp-0 pos quad) (-> s5-0 fire-point quad))
    (set! (-> gp-0 notify-handle) (the-as handle #f))
    (set! (-> gp-0 owner-handle) (the-as handle #f))
    (set! (-> gp-0 ignore-handle) (process->handle (the-as process (send-event self 'get-vehicle))))
    (let* ((v1-9 *game-info*)
           (a0-9 (+ (-> v1-9 attack-id) 1))
           )
      (set! (-> v1-9 attack-id) a0-9)
      (set! (-> gp-0 attack-id) a0-9)
      )
    (set! (-> gp-0 timeout) (seconds 4))
    (vector-float*! (-> gp-0 vel) (-> s5-0 fire-dir-out) 819200.0)
    (when (!= guard-shot-int 1)
      (spawn-projectile gun-yellow-shot gp-0 (ppointer->process (-> s5-0 gun)) *default-dead-pool*)           ;;;;;;;;;;;;;;;;;;;;
      (when (= bounce-shot #t)                                                                ;bounce-shot
        (+ bounces-left 3)
      )
    )
    (when (and (= leg-random-int 1)(= leg-random-shot #t))                                    ;random shot
        (set! wm-rand-shot #t)
      )
      (when (and (rand-vu-percent? 0.3)(= double-tap-option #t)(= double-tap-int 1))                    ;double-tap
      (set! dt-frame-start #t)
      )
    (when (and (and (= guard-shot-option #t)(= guard-shot-int 1)))          ;guard-shot
    ;ctywide ctyport dig1 forresca prison consite
;      (when (not (or (or (or (or (or (or (= (-> (level-get-target-inside *level*) name) 'ctywide)(= (-> (level-get-target-inside *level*) name) 'ctyport)(= (-> (level-get-target-inside *level*) name) 'dig1)(= (-> (level-get-target-inside *level*) name) 'forresca)(= (-> (level-get-target-inside *level*) name) 'prison)(= (-> (level-get-target-inside *level*) name) 'consite)))))))))
;        (sound-play "drl-turret-fire")
;      )
      (set! inv-frame-start-g #t)
          (let ((s4-1 (new 'stack-no-clear 'projectile-init-by-other-params)))
            (set! (-> s4-1 ent) (-> *target* entity))
            (set! (-> s4-1 charge) 1.0)
            (set! (-> s4-1 options) (projectile-options account-for-target-velocity proj-options-8000))
            (set! (-> s4-1 pos quad) (-> *target* gun fire-point quad))
            (set! (-> s4-1 vel quad) (-> *target* gun fire-dir-out quad))
            (set! (-> s4-1 notify-handle) (the-as handle #f))
            (set! (-> s4-1 owner-handle) (the-as handle #f))
            (set! (-> s4-1 ignore-handle) (the-as handle #f))
            (let* ((a0-13 *game-info*)
            (a1-12 (+ (-> a0-13 attack-id) 1))
            )
        (set! (-> a0-13 attack-id) a1-12)
        (set! (-> s4-1 attack-id) a1-12)
        )
      (set! (-> s4-1 timeout) (seconds 4))
      (vector-normalize! (-> s4-1 vel) 819200.0)
      (when (not (logtest? (-> *game-info* secrets) (game-secrets hero-mode)))
    (set! (-> *game-info* secrets) (game-secrets invulnerable)) ;this also makes it so that theres no game secrets allowed when using predator/guard shot. I could be lazy and make it for all of them
  )
  (when (logtest? (-> *game-info* secrets) (game-secrets hero-mode))
    (set! (-> *game-info* secrets) (game-secrets invulnerable hero-mode)) ;this also makes it so that theres no game secrets allowed when using predator/guard shot. I could be lazy and make it for all of them
  )
      (spawn-projectile guard-shot s4-1 (ppointer->process (-> *target* gun gun)) *default-dead-pool*)
      )
    )
    (when (and (and (= predator-shot-option #t)(= predator-shot-int 1)))  ;predator-shot
    (set! inv-frame-start #t)
    (defmethod init-proj-settings! metalhead-predator-shot ((this metalhead-predator-shot))
  "Init relevant settings for the [[projectile]] such as gravity, speed, timeout, etc"
  (set! (-> this tail-pos quad) (-> this root trans quad))
  (set! (-> this attack-mode) 'eco-yellow)
  (set! (-> this max-speed) 532480.0)
  (set! (-> this move) metalhead-shot-move)
  (set! (-> this update-velocity) projectile-update-velocity-space-wars)
  (set! (-> this timeout) (seconds 0.767))
  (set! (-> this sound-id) (new-sound-id))
  (set-gravity-length (-> this root dynam) 573440.0)
  (none)
  ) 
      (let ((s5-0 (-> *target* gun))
          (gp-0 (new 'stack-no-clear 'projectile-init-by-other-params)))
          (set! (-> gp-0 ent) (-> *target* entity))
          (set! (-> gp-0 charge) (-> s5-0 fire-charge))
          (set! (-> gp-0 options) (projectile-options))
          (set! (-> gp-0 pos quad) (-> *target* gun fire-point quad))
          (set! (-> gp-0 vel quad) (-> *target* gun fire-dir-out quad))
          (set! (-> gp-0 notify-handle) (the-as handle #f))
          (set! (-> gp-0 owner-handle) (the-as handle #f))
          (set! (-> gp-0 ignore-handle) (process->handle (the-as process (send-event *target* 'get-vehicle))))
          (set! (-> gp-0 timeout) (seconds 4))
          (when (not (logtest? (-> *game-info* secrets) (game-secrets hero-mode)))
    (set! (-> *game-info* secrets) (game-secrets invulnerable)) ;this also makes it so that theres no game secrets allowed when using predator/guard shot. I could be lazy and make it for all of them
  )
  (when (logtest? (-> *game-info* secrets) (game-secrets hero-mode))
    (set! (-> *game-info* secrets) (game-secrets invulnerable hero-mode)) ;this also makes it so that theres no game secrets allowed when using predator/guard shot. I could be lazy and make it for all of them
  )
          (spawn-projectile metalhead-predator-shot gp-0 (ppointer->process (-> *target* gun gun)) *default-dead-pool*)
    )
    )
      (when (and (and (= pm-extra-shot-option #t) (= pm-extra-shot-int 1)(rand-vu-percent? 0.4)))   ;chanced-extra-peacemaker-shot
        (let ((s5-0 (-> self gun))
          (gp-0 (new 'stack-no-clear 'projectile-init-by-other-params))
          )
      (set! (-> gp-0 ent) (-> self entity))
      (set! (-> gp-0 charge) (-> s5-0 fire-charge))
      (set! (-> gp-0 options) (projectile-options))
      (set! (-> gp-0 pos quad) (-> s5-0 fire-point quad))
      (set! (-> gp-0 vel quad) (-> s5-0 fire-dir-out quad))
      (set! (-> gp-0 notify-handle) (the-as handle #f))
      (set! (-> gp-0 owner-handle) (the-as handle #f))
      (set! (-> gp-0 ignore-handle) (process->handle (the-as process (send-event self 'get-vehicle))))
      (let* ((v1-8 *game-info*)
            (a0-11 (+ (-> v1-8 attack-id) 1))
            )
        (set! (-> v1-8 attack-id) a0-11)
        (set! (-> gp-0 attack-id) a0-11)
        )
      (set! (-> gp-0 timeout) (seconds 4))
      (let ((v0-1 (spawn-projectile gun-dark-shot gp-0 (ppointer->process (-> s5-0 gun)) *default-dead-pool*)))
        (when v0-1
          (set! (-> (the-as gun-dark-shot (-> v0-1 0)) track-target) (-> self gun track-target 0 handle))
          (set! (-> self gun charge-active?) (ppointer->handle v0-1))
          )
        v0-1
      )
        )
      )
  )
)

(define bounced-vec (new 'static 'vector :x (meters 0) :y (meters 2) :z (meters 0) :w 1.0))

(defun someone-fire-yellow ((arg0 process-drawable) (arg1 vector) (arg2 vector))
  (let ((gp-0 (new 'stack-no-clear 'projectile-init-by-other-params)))
    (set! (-> gp-0 ent) (-> arg0 entity))
    (set! (-> gp-0 charge) 1.0)
    (set! (-> gp-0 options) (projectile-options account-for-target-velocity proj-options-8000))
    (set! (-> gp-0 pos quad) (-> arg1 quad))
    (set! (-> gp-0 notify-handle) (the-as handle #f))
    (set! (-> gp-0 owner-handle) (the-as handle #f))
    (set! (-> gp-0 ignore-handle) (process->handle arg0))
    (let* ((v1-7 *game-info*)
           (a0-8 (+ (-> v1-7 attack-id) 1))
           )
      (set! (-> v1-7 attack-id) a0-8)
      (set! (-> gp-0 attack-id) a0-8)
      )
    (set! (-> gp-0 timeout) (seconds 4))
    (vector-normalize-copy! (-> gp-0 vel) arg2 819200.0)
    (spawn-projectile gun-yellow-shot gp-0 arg0 *default-dead-pool*)
    )
  )

(deftype gun-yellow-shot (projectile)
  ((hit-actor? symbol         :offset-assert 472)
   (tail-pos   vector :inline :offset-assert 480)
   (hit-pos    vector :inline :offset-assert 496)
   )
  :heap-base #x180
  :method-count-assert 40
  :size-assert         #x200
  :flag-assert         #x2801800200
  )


(defmethod draw-laser-sight gun-yellow-shot ((this gun-yellow-shot))
  "TODO - confirm If applicable, draw the laser sight particles"
  (draw-beam (-> *part-id-table* 227) (-> this tail-pos) (-> this starting-dir) #f #t)
  0
  (none)
  )

(defmethod spawn-impact-particles gun-yellow-shot ((this gun-yellow-shot))
  "Spawns associated particles with the projectile if applicable"
    (when (and (made-impact? this) (= bounce-shot-int 1)(= bounce-shot #t))
    (let ((bounces-left? (+ bounces-left 1)))
      (when (> bounces-left 0)
        (let ((svec-pos (-> this hit-pos))        ;;;;;;;;;;rotates fire-point
          (tpoz (-> *target* gun fire-point))
          (tpoz-out (-> *target* gun fire-dir-out))
          (rot1x (vector-copy! (-> (new 'stack-no-clear 'projectile-init-by-other-params) pos) (vector-rotate-x! (-> this hit-pos) (-> *target* gun fire-point) 180.0)))
          (rot1y (vector-copy! (-> (new 'stack-no-clear 'projectile-init-by-other-params) pos) (vector-rotate-y! (-> this hit-pos) (-> *target* gun fire-point) 180.0)))
          (rot1z (vector-copy! (-> (new 'stack-no-clear 'projectile-init-by-other-params) pos) (vector-rotate-z! (-> this hit-pos) (-> *target* gun fire-point) 180.0)))
          (rot2x (vector-copy! (-> (new 'stack-no-clear 'projectile-init-by-other-params) vel) (vector-rotate-x! (-> this hit-pos) (-> *target* gun fire-dir-out) 180.0)))
          (rot2y (vector-copy! (-> (new 'stack-no-clear 'projectile-init-by-other-params) vel) (vector-rotate-y! (-> this hit-pos) (-> *target* gun fire-dir-out) 180.0)))
          (rot2z (vector-copy! (-> (new 'stack-no-clear 'projectile-init-by-other-params) vel) (vector-rotate-z! (-> this hit-pos) (-> *target* gun fire-dir-out) 180.0)))
          )


          (print "bounced")
          (-! bounces-left 1)
          (when (!= guard-shot-int 1)
            (someone-fire-yellow *target* svec-pos (target-pos 0))           ;;;;;;;;;;;;;;;;;;;;
          )
        )
      )
    )
    (when (<= bounces-left 0)
      (print "shot dead")
    )
  )
  (rlet ((acc :class vf)
         (vf0 :class vf)
         (vf4 :class vf)
         (vf5 :class vf)
         (vf6 :class vf)
         (vf7 :class vf)
         )
    (init-vf0-vector)
    (let* ((s4-0 (-> this root trans))
           (a1-0 (-> this tail-pos))
           (s5-1 (vector-! (new 'stack-no-clear 'vector) s4-0 a1-0))
           (f30-0 (vector-length s5-1))
           (gp-0 (new 'stack-no-clear 'vector))
           )
      (let ((v1-4 a1-0))
        (let ((a0-2 s5-1))
          (let ((a2-1 0.8))
            (.mov vf7 a2-1)
            )
          (.lvf vf5 (&-> a0-2 quad))
          )
        (.lvf vf4 (&-> v1-4 quad))
        )
      (.add.x.vf vf6 vf0 vf0 :mask #b1000)
      (.mul.x.vf acc vf5 vf7 :mask #b111)
      (.add.mul.w.vf vf6 vf4 vf0 acc :mask #b111)
      (.svf (&-> gp-0 quad) vf6)
      (let ((f28-0 (-> *part-id-table* 223 init-specs 4 initial-valuef)))
        (set! (-> *part-id-table* 223 init-specs 4 initial-valuef) (fmin f28-0 (vector-length s5-1)))
        (draw-beam (-> *part-id-table* 223) a1-0 s5-1 #f #t)
        (set! (-> *part-id-table* 223 init-specs 4 initial-valuef) f28-0)
        )
      (vector-normalize! s5-1 1.0)
      (launch-particles (-> *part-id-table* 224) gp-0)
      (let ((s3-0 (new 'stack-no-clear 'matrix))
            (f28-1 (* 0.000015258789 f30-0))
            (f30-1 (-> *part-id-table* 226 init-specs 3 initial-valuef))
            )
        (forward-up->inv-matrix s3-0 s5-1 *up-vector*)
        (set! (-> s3-0 trans quad) (-> s4-0 quad))
        (set! (-> *part-id-table* 226 init-specs 3 initial-valuef) (* f28-1 f30-1))
        (launch-particles (-> *part-id-table* 226) s3-0 :origin-is-matrix #t)
        (set! (-> *part-id-table* 226 init-specs 3 initial-valuef) f30-1)
        )
      (let ((f0-6 (vector-dot s5-1 (-> (camera-matrix) vector 2))))
        (when (< 0.0 f0-6)
          (let ((f0-7 (* f0-6 f0-6))
                (f30-2 (-> *part-id-table* 225 init-specs 8 initial-valuef))
                (f28-2 (-> *part-id-table* 225 init-specs 8 random-rangef))
                )
            (set! (-> *part-id-table* 225 init-specs 8 initial-valuef) (* f30-2 f0-7))
            (set! (-> *part-id-table* 225 init-specs 8 random-rangef) (* f28-2 f0-7))
            (launch-particles (-> *part-id-table* 225) gp-0)
            (set! (-> *part-id-table* 225 init-specs 8 initial-valuef) f30-2)
            (set! (-> *part-id-table* 225 init-specs 8 random-rangef) f28-2)
            )
          )
        )
      )
    0
    (none)
    )
  )

(defmethod deal-damage! gun-yellow-shot ((this gun-yellow-shot) (arg0 process) (arg1 event-message-block))
  "Constructs an [[attack-info]] according to the projectile's `options`"
  (let ((t9-0 (method-of-type projectile deal-damage!)))
    (when (t9-0 this arg0 arg1)
      (set! (-> this hit-actor?) #t)
      #t
      )
    )
  )

(defmethod spawn-shell-particles gun-yellow-shot ((this gun-yellow-shot))
  "TODO - confirm"
  (cond
    ((-> this hit-actor?)
     (let ((s5-0 (get-process *default-dead-pool* part-tracker #x4000)))
       (when s5-0
         (let ((t9-1 (method-of-type part-tracker activate)))
           (t9-1
             (the-as part-tracker s5-0)
             *entity-pool*
             (symbol->string (-> part-tracker symbol))
             (the-as pointer #x70004000)
             )
           )
         (let ((t9-2 run-function-in-process)
               (a0-3 s5-0)
               (a1-2 part-tracker-init)
               (a2-4 (-> *part-group-id-table* 74))
               (a3-1 0)
               (t0-0 #f)
               (t1-0 #f)
               (t2-0 #f)
               (t3-0 *launch-matrix*)
               )
           (set! (-> t3-0 trans quad) (-> this root trans quad))
           ((the-as (function object object object object object object object object none) t9-2)
            a0-3
            a1-2
            a2-4
            a3-1
            t0-0
            t1-0
            t2-0
            t3-0
            )
           )
         (-> s5-0 ppointer)
         )
       )
     )
    (else
      (let ((s5-1 (get-process *default-dead-pool* part-tracker #x4000)))
        (when s5-1
          (let ((t9-4 (method-of-type part-tracker activate)))
            (t9-4
              (the-as part-tracker s5-1)
              *entity-pool*
              (symbol->string (-> part-tracker symbol))
              (the-as pointer #x70004000)
              )
            )
          (let ((t9-5 run-function-in-process)
                (a0-6 s5-1)
                (a1-5 part-tracker-init)
                (a2-9 (-> *part-group-id-table* 73))
                (a3-3 0)
                (t0-1 #f)
                (t1-1 #f)
                (t2-1 #f)
                (t3-1 *launch-matrix*)
                )
            (set! (-> t3-1 trans quad) (-> this root trans quad))
            ((the-as (function object object object object object object object object none) t9-5)
             a0-6
             a1-5
             a2-9
             a3-3
             t0-1
             t1-1
             t2-1
             t3-1
             )
            )
          (-> s5-1 ppointer)
          )
        )
      )
    )
  0
  (none)
  )

;; WARN: Return type mismatch sound-id vs none.
(defmethod play-impact-sound gun-yellow-shot ((this gun-yellow-shot) (arg0 projectile-options))
  (let ((v1-0 arg0))
    (cond
      ((zero? v1-0)
       (sound-play "yellow-shot-fir")
       )
      ((= v1-0 (projectile-options lose-altitude))
       (sound-play "yellow-gun-burn")
       )
      ((= v1-0 (projectile-options proj-options-2))
       (sound-play "yellow-shot-fiz")
       )
      (else
        (sound-play "yellow-shot-std" :id (-> this sound-id) :position (-> this root trans))
        )
      )
    )
  (none)
  )

(defmethod made-impact? gun-yellow-shot ((this gun-yellow-shot))
  "TODO - queries the collision cache, return true/false"
  (let ((v1-0 (-> this root))
        (t1-0 (new 'stack-no-clear 'collide-query))
        )
    (let ((a0-1 t1-0))
      (set! (-> a0-1 radius) (-> v1-0 root-prim prim-core world-sphere w))
      (set! (-> a0-1 collide-with) (-> v1-0 root-prim prim-core collide-with))
      (set! (-> a0-1 ignore-process0) this)
      (set! (-> a0-1 ignore-process1) (ppointer->process (-> this parent)))
      (set! (-> a0-1 ignore-pat) (-> v1-0 pat-ignore-mask))
      (set! (-> a0-1 action-mask) (collide-action solid))
      )
    (when (fill-and-try-snap-to-surface v1-0 (-> v1-0 transv) -10240.0 12697.6 -4096.0 t1-0)
      (if (logtest? (-> this root status) (collide-status touch-actor))
          (set! (-> this hit-actor?) #t)
          )
      #t
      )
    )
  )

(defun gun-yellow-shot-move ((arg0 gun-yellow-shot))
  (projectile-move-fill-line-sphere arg0)
  (let ((s5-0 (-> arg0 root)))
    (let ((s4-0 (new 'stack-no-clear 'vector)))
      (vector-! s4-0 (-> arg0 tail-pos) (-> s5-0 trans))
      (let ((f0-0 (vector-length s4-0)))
        (when (< 65536.0 f0-0)
          (vector-normalize! s4-0 65536.0)
          (vector+! (-> arg0 tail-pos) (-> s5-0 trans) s4-0)
          )
        )
      )
    (when (logtest? (-> s5-0 status) (collide-status touch-surface))
      (if (logtest? (-> arg0 root status) (collide-status touch-actor))
          (set! (-> arg0 hit-actor?) #t)
          )
      (let ((v1-14 (vector-normalize! (vector-! (new 'stack-no-clear 'vector) (-> arg0 tail-pos) (-> s5-0 trans)) 2048.0))
            (a1-5 (-> arg0 hit-pos))
            )
        (set! (-> a1-5 quad) (-> s5-0 trans quad))
        (vector+! a1-5 a1-5 v1-14)
        (move-to-point! (-> arg0 root) a1-5)
        )
      (go (method-of-object arg0 impact))
      )
    )
  0
  (none)
  )

(defmethod init-proj-collision! gun-yellow-shot ((this gun-yellow-shot))
  "Init the [[projectile]]'s [[collide-shape]]"
  (let ((s5-0 (new 'process 'collide-shape-moving this (collide-list-enum hit-by-player))))
    (set! (-> s5-0 dynam) (copy *standard-dynamics* 'process))
    (set! (-> s5-0 reaction)
          (the-as (function control-info collide-query vector vector collide-status) cshape-reaction-just-move)
          )
    (set! (-> s5-0 no-reaction)
          (the-as (function collide-shape-moving collide-query vector vector object) nothing)
          )
    (set! (-> s5-0 penetrate-using) (penetrate jak-yellow-shot))
    (let ((s4-0 (new 'process 'collide-shape-prim-group s5-0 (the-as uint 2) 0)))
      (set! (-> s5-0 total-prims) (the-as uint 3))
      (set! (-> s4-0 prim-core collide-as) (collide-spec projectile))
      (set! (-> s4-0 prim-core collide-with)
            (collide-spec backgnd bot crate civilian enemy obstacle vehicle-sphere hit-by-others-list player-list pusher)
            )
      (set! (-> s4-0 prim-core action) (collide-action solid))
      (set-vector! (-> s4-0 local-sphere) 0.0 0.0 0.0 4096.0)
      (set! (-> s5-0 root-prim) s4-0)
      )
    (let ((v1-13 (new 'process 'collide-shape-prim-sphere s5-0 (the-as uint 0))))
      (set! (-> v1-13 prim-core collide-as) (collide-spec projectile))
      (set! (-> v1-13 prim-core collide-with)
            (collide-spec backgnd bot crate civilian enemy obstacle vehicle-sphere hit-by-others-list player-list pusher)
            )
      (set! (-> v1-13 prim-core action) (collide-action solid))
      (set-vector! (-> v1-13 local-sphere) 0.0 0.0 0.0 819.2)
      )
    (let ((v1-15 (new 'process 'collide-shape-prim-sphere s5-0 (the-as uint 0))))
      (set! (-> v1-15 prim-core collide-as) (collide-spec projectile))
      (set! (-> v1-15 prim-core collide-with)
            (collide-spec bot crate civilian enemy obstacle vehicle-sphere hit-by-others-list player-list pusher)
            )
      (set-vector! (-> v1-15 local-sphere) 0.0 0.0 0.0 4096.0)
      )
    (set! (-> s5-0 nav-radius) (* 0.75 (-> s5-0 root-prim local-sphere w)))
    (let ((v1-18 (-> s5-0 root-prim)))
      (set! (-> s5-0 backup-collide-as) (-> v1-18 prim-core collide-as))
      (set! (-> s5-0 backup-collide-with) (-> v1-18 prim-core collide-with))
      )
    (set! (-> s5-0 max-iteration-count) (the-as uint 1))
    (set! (-> s5-0 event-self) 'touched)
    (set! (-> this root) s5-0)
    )
  (set! (-> this root pat-ignore-mask)
        (new 'static 'pat-surface :noentity #x1 :nojak #x1 :probe #x1 :noproj #x1 :noendlessfall #x1)
        )
  0
  (none)
  )

(defmethod init-proj-settings! gun-yellow-shot ((this gun-yellow-shot))
  "Init relevant settings for the [[projectile]] such as gravity, speed, timeout, etc"
  (set! (-> this hit-actor?) #f)
  (set! (-> this tail-pos quad) (-> this root trans quad))
  (cpad-set-buzz! (-> *cpad-list* cpads 0) 1 204 (seconds 0.1))
  (set! (-> this attack-mode) 'eco-yellow)
  (set! (-> this max-speed) 819200.0)
  (set! (-> this move) gun-yellow-shot-move)
  (set! (-> this timeout) (seconds 0.5))
  (set! (-> this sound-id) (new-sound-id))
  (when (not (= stored-cp? #t))
              (set! (-> this damage) (if (logtest? (game-feature gun-upgrade-damage) (-> *game-info* features))
                            4.0
                            2.0
                            )
        )
            )
            (when (= stored-cp? #t)
              (set! (-> this damage) 0.8)
            )
  0
  (none)
  )
