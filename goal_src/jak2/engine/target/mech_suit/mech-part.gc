;;-*-Lisp-*-
(in-package goal)

;; name: mech-part.gc
;; name in dgo: mech-part
;; dgos: DRILLMTN, UNB, RUI

;; DECOMP BEGINS

(defpart 939
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :index #x90 :page #xc))
    (sp-func spt-birth-func 'birth-func-set-quat)
    (sp-flt spt-num 1.0)
    (sp-flt spt-y (meters 0))
    (sp-flt spt-scale-x (meters 1))
    (sp-flt spt-scale-y (meters 3))
    (sp-rnd-flt spt-r 128.0 128.0 1.0)
    (sp-rnd-flt spt-g 64.0 64.0 1.0)
    (sp-copy-from-other spt-b -1)
    (sp-rnd-flt spt-a 128.0 64.0 1.0)
    (sp-int spt-timer 5)
    (sp-cpuinfo-flags sp-cpuinfo-flag-2 sp-cpuinfo-flag-3)
    )
  )

(defpart 940
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :index #xbb :page #xc))
    (sp-flt spt-num 1.0)
    (sp-flt spt-y (meters -0.3))
    (sp-rnd-flt spt-scale-x (meters 1.5) (meters 0.1) 1.0)
    (sp-flt spt-rot-x 409.6)
    (sp-copy-from-other spt-scale-y -4)
    (sp-flt spt-r 255.0)
    (sp-rnd-flt spt-g 64.0 64.0 1.0)
    (sp-flt spt-b 0.0)
    (sp-rnd-flt spt-a 16.0 8.0 1.0)
    (sp-int spt-timer 5)
    (sp-cpuinfo-flags sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 glow)
    (sp-flt spt-userdata 409.6)
    )
  )

(defpart 941
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :page #xc))
    (sp-rnd-flt spt-num 1.0 4.0 1.0)
    (sp-rnd-flt spt-y (meters 0) (meters -0.25) 1.0)
    (sp-rnd-flt spt-scale-x (meters 0.2) (meters 0.2) 1.0)
    (sp-rnd-int-flt spt-rot-z (degrees 0.0) 1 32768.0)
    (sp-rnd-flt spt-scale-y (meters 1) (meters 0.6) 1.0)
    (sp-flt spt-r 192.0)
    (sp-flt spt-g 64.0)
    (sp-flt spt-b 0.0)
    (sp-rnd-flt spt-a 0.0 16.0 1.0)
    (sp-rnd-flt spt-vel-y (meters -0.06666667) (meters -0.016666668) 1.0)
    (sp-flt spt-scalevel-x (meters 0.033333335))
    (sp-flt spt-scalevel-y (meters 0.006666667))
    (sp-flt spt-fade-r -2.0)
    (sp-flt spt-fade-g 2.0)
    (sp-flt spt-fade-b 5.0)
    (sp-flt spt-fade-a 0.32)
    (sp-rnd-flt spt-accel-x 0.0 6.826667 1.0)
    (sp-rnd-flt spt-accel-y 0.68266666 2.048 1.0)
    (sp-flt spt-friction 0.94)
    (sp-int spt-timer 300)
    (sp-cpuinfo-flags sp-cpuinfo-flag-2 sp-cpuinfo-flag-12 sp-cpuinfo-flag-14)
    (sp-int spt-next-time 25)
    (sp-launcher-by-id spt-next-launcher 942)
    (sp-rnd-flt spt-rotate-y (degrees 0.0) (degrees 360.0) 1.0)
    )
  )

(defpart 942
  :init-specs ((sp-rnd-flt spt-r 64.0 64.0 1.0)
    (sp-rnd-flt spt-g 64.0 64.0 1.0)
    (sp-rnd-flt spt-b 64.0 64.0 1.0)
    (sp-flt spt-fade-r 0.0)
    (sp-flt spt-fade-g 0.0)
    (sp-flt spt-fade-b 0.0)
    (sp-rnd-flt spt-fade-a -0.128 -0.256 1.0)
    )
  )

(defpart 943
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :index #xc9 :page #xc))
    (sp-rnd-flt spt-num 0.1 0.1 1.0)
    (sp-rnd-flt spt-y (meters 0.25) (meters -0.5) 1.0)
    (sp-flt spt-scale-x (meters 0.05))
    (sp-flt spt-scale-y (meters 0.5))
    (sp-rnd-flt spt-r 192.0 64.0 1.0)
    (sp-rnd-flt spt-g 0.0 128.0 1.0)
    (sp-flt spt-b 0.0)
    (sp-flt spt-a 128.0)
    (sp-rnd-flt spt-vel-y (meters -0.033333335) (meters -0.026666667) 1.0)
    (sp-flt spt-scalevel-x (meters 0.001))
    (sp-flt spt-scalevel-y (meters -0.017))
    (sp-flt spt-fade-g 0.0)
    (sp-rnd-flt spt-accel-x 0.0 6.826667 1.0)
    (sp-rnd-flt spt-accel-y 0.68266666 2.048 1.0)
    (sp-flt spt-friction 0.96)
    (sp-int-plain-rnd spt-timer 50 74 1)
    (sp-cpuinfo-flags sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 sp-cpuinfo-flag-12 sp-cpuinfo-flag-14)
    (sp-int spt-next-time 30)
    (sp-launcher-by-id spt-next-launcher 944)
    (sp-rnd-flt spt-rotate-y (degrees 0.0) (degrees 360.0) 1.0)
    )
  )

(defpart 944
  :init-specs ((sp-flt spt-scalevel-x (meters 0)) (sp-flt spt-scalevel-y (meters 0)))
  )

(defpart 945
  :init-specs ((sp-flt spt-num 0.6)
    (sp-int spt-rot-x 8)
    (sp-flt spt-r 1638.4)
    (sp-flt spt-g 1331.2)
    (sp-flt spt-b 1433.6)
    (sp-rnd-flt spt-vel-y (meters -0.06666667) (meters -0.016666668) 1.0)
    (sp-flt spt-fade-r 32.768)
    (sp-flt spt-fade-g 26.623999)
    (sp-flt spt-fade-b 28.671999)
    (sp-rnd-flt spt-accel-x 0.0 6.826667 1.0)
    (sp-flt spt-friction 0.94)
    (sp-int spt-timer 100)
    (sp-cpuinfo-flags distort)
    (sp-int spt-next-time 50)
    (sp-launcher-by-id spt-next-launcher 946)
    (sp-rnd-flt spt-rotate-y (degrees 0.0) (degrees 360.0) 1.0)
    )
  )

(defpart 946
  :init-specs ((sp-flt spt-fade-r 0.0) (sp-flt spt-fade-g 0.0) (sp-flt spt-fade-b -4.096))
  )

(defun mech-spawn-thruster ((arg0 mech-info) (arg1 vector) (arg2 vector) (arg3 float) (arg4 float))
  "Draws the mech's thrusters"
  (rlet ((acc :class vf)
         (vf0 :class vf)
         (vf4 :class vf)
         (vf5 :class vf)
         (vf6 :class vf)
         (vf7 :class vf)
         )
    (init-vf0-vector)
    (set! (-> arg0 part-thruster) (-> *part-id-table* 939))
    (set! (-> arg0 part-thruster-scale-x) (-> *part-id-table* 939 init-specs 4))
    (set! (-> arg0 part-thruster-scale-y) (-> *part-id-table* 939 init-specs 5))
    (let ((s1-0 (new 'stack-no-clear 'quaternion))
          (s0-0 (new 'stack-no-clear 'vector))
          )
      (forward-up->quaternion s1-0 arg2 (new 'static 'vector :y 1.0 :w 1.0))
      (quaternion-rotate-local-x! s1-0 s1-0 32768.0)
      (let ((a0-3 s0-0))
        (let ((v1-10 arg1))
          (let ((a1-4 (* 0.5 arg4)))
            (.mov vf7 a1-4)
            )
          (.lvf vf5 (&-> arg2 quad))
          (.lvf vf4 (&-> v1-10 quad))
          )
        (.add.x.vf vf6 vf0 vf0 :mask #b1000)
        (.mul.x.vf acc vf5 vf7 :mask #b111)
        (.add.mul.w.vf vf6 vf4 vf0 acc :mask #b111)
        (.svf (&-> a0-3 quad) vf6)
        )
      (set! (-> arg0 part-thruster-scale-x initial-valuef) arg3)
      (set! (-> arg0 part-thruster-scale-y initial-valuef) arg4)
      (dotimes (s4-1 2)
        (quaternion-rotate-local-z! s1-0 s1-0 16384.0)
        (quaternion-copy! (-> arg0 part-quat) s1-0)
        (let ((t9-4 sp-launch-particles-var)
              (a0-6 (-> arg0 particle-system-3d))
              (a1-7 (-> arg0 part-thruster))
              (a2-4 *launch-matrix*)
              )
          (set! (-> a2-4 trans quad) (-> s0-0 quad))
          (t9-4
            (the-as sparticle-system a0-6)
            (the-as sparticle-launcher a1-7)
            a2-4
            (the-as sparticle-launch-state #f)
            (the-as sparticle-launch-control #f)
            1.0
            )
          )
        )
      )
    (let ((t9-5 sp-launch-particles-var)
          (a0-7 *sp-particle-system-2d*)
          (a1-8 (-> *part-id-table* 945))
          (a2-5 *launch-matrix*)
          )
      (set! (-> a2-5 trans quad) (-> arg1 quad))
      (t9-5 a0-7 a1-8 a2-5 (the-as sparticle-launch-state #f) (the-as sparticle-launch-control #f) 1.0)
      )
    (let ((t9-6 sp-launch-particles-var)
          (a0-8 *sp-particle-system-2d*)
          (a1-9 (-> *part-id-table* 940))
          (a2-6 *launch-matrix*)
          )
      (set! (-> a2-6 trans quad) (-> arg1 quad))
      (t9-6 a0-8 a1-9 a2-6 (the-as sparticle-launch-state #f) (the-as sparticle-launch-control #f) 1.0)
      )
    (cond
      ((!= (-> *setting-control* user-current under-water-pitch-mod) 0.0)
       (let ((t9-7 sp-launch-particles-var)
             (a0-9 *sp-particle-system-2d*)
             (a1-10 (-> *part-id-table* 945))
             (a2-7 *launch-matrix*)
             )
         (set! (-> a2-7 trans quad) (-> arg1 quad))
         (t9-7 a0-9 a1-10 a2-7 (the-as sparticle-launch-state #f) (the-as sparticle-launch-control #f) 1.0)
         )
       )
      (else
        (let ((t9-8 sp-launch-particles-var)
              (a0-10 *sp-particle-system-2d*)
              (a1-11 (-> *part-id-table* 941))
              (a2-8 *launch-matrix*)
              )
          (set! (-> a2-8 trans quad) (-> arg1 quad))
          (t9-8 a0-10 a1-11 a2-8 (the-as sparticle-launch-state #f) (the-as sparticle-launch-control #f) 1.0)
          )
        (let ((t9-9 sp-launch-particles-var)
              (a0-11 *sp-particle-system-2d*)
              (a1-12 (-> *part-id-table* 943))
              (a2-9 *launch-matrix*)
              )
          (set! (-> a2-9 trans quad) (-> arg1 quad))
          (t9-9 a0-11 a1-12 a2-9 (the-as sparticle-launch-state #f) (the-as sparticle-launch-control #f) 1.0)
          )
        )
      )
    0
    (none)
    )
  )

(defpart 947
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :page #xc))
    (sp-flt spt-num 3.0)
    (sp-rnd-flt spt-x (meters -16) (meters 32) 1.0)
    (sp-rnd-flt spt-y (meters 0) (meters 12) 1.0)
    (sp-rnd-flt spt-z (meters -16) (meters 32) 1.0)
    (sp-rnd-flt spt-scale-x (meters 0.1) (meters 0.3) 1.0)
    (sp-int spt-rot-x 4)
    (sp-rnd-flt spt-rot-z (degrees 0.0) (degrees 3600.0) 1.0)
    (sp-rnd-flt spt-scale-y (meters 0.1) (meters 0.1) 1.0)
    (sp-rnd-flt spt-r 0.0 64.0 1.0)
    (sp-rnd-flt spt-g 64.0 128.0 1.0)
    (sp-rnd-flt spt-b 64.0 196.0 1.0)
    (sp-flt spt-a 0.0)
    (sp-rnd-flt spt-vel-y (meters -0.0033333334) (meters 0.006666667) 1.0)
    (sp-rnd-flt spt-rotvel-z (degrees -0.4) (degrees 0.8) 1.0)
    (sp-rnd-flt spt-fade-a 0.21333334 0.21333334 1.0)
    (sp-int spt-timer 750)
    (sp-cpuinfo-flags sp-cpuinfo-flag-2)
    (sp-flt spt-userdata 0.0)
    (sp-func spt-func 'check-water-level-above-and-die)
    (sp-int spt-next-time 150)
    (sp-launcher-by-id spt-next-launcher 948)
    (sp-rnd-flt spt-conerot-x (degrees 0.0) (degrees 3600.0) 1.0)
    (sp-rnd-flt spt-conerot-y (degrees 0.0) (degrees 3600.0) 1.0)
    (sp-rnd-flt spt-rotate-y (degrees 0.0) (degrees 3600.0) 1.0)
    (sp-rnd-flt spt-conerot-radius (meters -3) (meters 8) 1.0)
    )
  )

(defpart 948
  :init-specs ((sp-flt spt-fade-a 0.0) (sp-int spt-next-time 300) (sp-launcher-by-id spt-next-launcher 949))
  )

(defpart 949
  :init-specs ((sp-rnd-flt spt-fade-a -0.21333334 -0.21333334 1.0))
  )

(defpart 950
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :index #x21 :page #xc))
    (sp-flt spt-num 0.2)
    (sp-rnd-flt spt-x (meters -24) (meters 48) 1.0)
    (sp-rnd-flt spt-y (meters -4) (meters 4) 1.0)
    (sp-rnd-flt spt-z (meters -24) (meters 48) 1.0)
    (sp-rnd-flt spt-scale-x (meters 0.15) (meters 0.15) 1.0)
    (sp-rnd-flt spt-scale-y (meters 0.1) (meters 0.1) 1.0)
    (sp-flt spt-r 255.0)
    (sp-flt spt-g 255.0)
    (sp-flt spt-b 255.0)
    (sp-flt spt-a 0.0)
    (sp-rnd-flt spt-vel-y (meters 0.008333334) (meters 0.005) 1.0)
    (sp-flt spt-fade-a 0.16)
    (sp-int spt-timer 4800)
    (sp-cpuinfo-flags sp-cpuinfo-flag-0 sp-cpuinfo-flag-2 sp-cpuinfo-flag-3)
    (sp-flt spt-userdata 0.0)
    (sp-func spt-func 'check-water-level-above-and-die)
    (sp-int-plain-rnd spt-next-time 99 197 1)
    (sp-launcher-by-id spt-next-launcher 951)
    (sp-rnd-flt spt-rotate-y (degrees 0.0) (degrees 3600.0) 1.0)
    )
  )

(defpart 951
  :init-specs ((sp-flt spt-fade-a 0.0)
    (sp-int-plain-rnd spt-next-time 300 1799 1)
    (sp-launcher-by-id spt-next-launcher 952)
    )
  )

(defpart 952
  :init-specs ((sp-rnd-flt spt-scalevel-x (meters -0.00033333333) (meters -0.00066666666) 1.0)
    (sp-copy-from-other spt-scalevel-y -4)
    (sp-flt spt-fade-a -0.16)
    (sp-rnd-flt spt-accel-y -0.4096 -0.4096 1.0)
    )
  )

(defpart 953
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :index #x21 :page #xc))
    (sp-flt spt-num 1.0)
    (sp-rnd-flt spt-scale-x (meters 0.15) (meters 0.15) 1.0)
    (sp-rnd-flt spt-scale-y (meters 0.1) (meters 0.1) 1.0)
    (sp-flt spt-r 255.0)
    (sp-flt spt-g 255.0)
    (sp-flt spt-b 255.0)
    (sp-flt spt-a 0.0)
    (sp-rnd-flt spt-vel-y (meters 0.008333334) (meters 0.005) 1.0)
    (sp-flt spt-fade-a 0.16)
    (sp-flt spt-accel-y 0.8192)
    (sp-rnd-flt spt-friction 0.97 0.01 1.0)
    (sp-int spt-timer 1200)
    (sp-cpuinfo-flags sp-cpuinfo-flag-0 sp-cpuinfo-flag-2 sp-cpuinfo-flag-3)
    (sp-flt spt-userdata 0.0)
    (sp-func spt-func 'check-water-level-above-and-die)
    (sp-int-plain-rnd spt-next-time 99 197 1)
    (sp-launcher-by-id spt-next-launcher 954)
    (sp-rnd-flt spt-conerot-x (degrees 0.0) (degrees 3600.0) 1.0)
    (sp-rnd-flt spt-conerot-y (degrees 0.0) (degrees 3600.0) 1.0)
    (sp-rnd-flt spt-conerot-radius (meters 0) (meters 0.5) 1.0)
    )
  )

(defpart 954
  :init-specs ((sp-flt spt-fade-a 0.0) (sp-int-plain-rnd spt-next-time 300 299 1) (sp-launcher-by-id spt-next-launcher 952))
  )

(defpartgroup group-mech-explode-death
  :id 202
  :duration (seconds 0.25)
  :linger-duration (seconds 2)
  :bounds (static-bspherem 0 0 0 2)
  :parts ((sp-item 159) (sp-item 160))
  )

(defpart 955
  :init-specs ((sp-flt spt-num 4.0)
    (sp-rnd-flt spt-x (meters -1) (meters 3) 1.0)
    (sp-rnd-flt spt-y (meters 0) (meters 4) 1.0)
    (sp-int spt-rot-x 6)
    (sp-flt spt-r 4096.0)
    (sp-flt spt-g 2662.4)
    (sp-flt spt-b 2867.2)
    (sp-rnd-flt spt-vel-y (meters 0.0033333334) (meters 0.01) 1.0)
    (sp-rnd-flt spt-accel-y 6.826667 1.3653333 1.0)
    (sp-flt spt-friction 0.9)
    (sp-int spt-timer 120)
    (sp-cpuinfo-flags distort)
    (sp-int-plain-rnd spt-next-time 40 39 1)
    (sp-launcher-by-id spt-next-launcher 956)
    (sp-rnd-flt spt-rotate-y (degrees 0.0) (degrees 3600.0) 1.0)
    )
  )

(defpart 956
  :init-specs ((sp-flt spt-fade-b -5.12))
  )

(defpart 957
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :page #xc))
    (sp-func spt-birth-func 'birth-func-texture-group)
    (sp-rnd-flt spt-num 16.0 4.0 1.0)
    (sp-rnd-flt spt-x (meters -1) (meters 3) 1.0)
    (sp-rnd-flt spt-y (meters 0) (meters 4) 1.0)
    (sp-rnd-flt spt-scale-x (meters 0.5) (meters 0.25) 1.0)
    (sp-rnd-flt spt-scale-y (meters 1) (meters 0.25) 1.0)
    (sp-flt spt-r 255.0)
    (sp-rnd-flt spt-g 0.0 128.0 1.0)
    (sp-flt spt-b 0.0)
    (sp-rnd-flt spt-a 32.0 32.0 1.0)
    (sp-rnd-flt spt-vel-y (meters 0.0033333334) (meters 0.01) 1.0)
    (sp-rnd-flt spt-scalevel-x (meters 0.013333334) (meters 0.006666667) 1.0)
    (sp-copy-from-other spt-scalevel-y -4)
    (sp-rnd-flt spt-accel-y 6.826667 1.3653333 1.0)
    (sp-flt spt-friction 0.9)
    (sp-int spt-timer 110)
    (sp-cpuinfo-flags sp-cpuinfo-flag-2 sp-cpuinfo-flag-3)
    (new 'static 'sp-field-init-spec
      :field (sp-field-id spt-userdata)
      :flags (sp-flag plain-v2)
      :object (new 'static 'boxed-array :type int32 40 1 0 #xc00000 #xc0ca00 #xc0ca00)
      )
    (sp-int spt-next-time 50)
    (sp-launcher-by-id spt-next-launcher 958)
    (sp-rnd-flt spt-rotate-y (degrees 0.0) (degrees 3600.0) 1.0)
    )
  )

(defpart 958
  :init-specs ((sp-rnd-flt spt-fade-a -0.53333336 -0.53333336 1.0))
  )

(defpart 959
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :index #xbb :page #xc))
    (sp-flt spt-num 1.0)
    (sp-rnd-flt spt-scale-x (meters 0.2) (meters 4) 1.0)
    (sp-flt spt-rot-x 2048.0)
    (sp-rnd-flt spt-rot-z (degrees 0.0) (degrees 8.0) 1.0)
    (sp-copy-from-other spt-scale-y -4)
    (sp-flt spt-r 0.0)
    (sp-rnd-flt spt-g 64.0 64.0 1.0)
    (sp-flt spt-b 255.0)
    (sp-rnd-flt spt-a 32.0 64.0 1.0)
    (sp-int spt-timer 5)
    (sp-cpuinfo-flags sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 glow)
    (sp-flt spt-userdata 4096.0)
    (sp-rnd-flt spt-conerot-x (degrees 0.0) (degrees 3600.0) 1.0)
    (sp-rnd-flt spt-conerot-y (degrees 0.0) (degrees 3600.0) 1.0)
    (sp-rnd-flt spt-conerot-radius (meters -0.1) (meters 0.5) 1.0)
    )
  )

(defpart 960
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :index #x92 :page #xc))
    (sp-rnd-flt spt-num 2.0 4.0 1.0)
    (sp-flt spt-scale-x (meters 2.5))
    (sp-int spt-rot-x 4)
    (sp-rnd-flt spt-scale-y (meters 0.04) (meters 0.03) 1.0)
    (sp-flt spt-r 0.0)
    (sp-rnd-flt spt-g 64.0 64.0 1.0)
    (sp-flt spt-b 255.0)
    (sp-flt spt-a 128.0)
    (sp-rnd-flt spt-omega 2.048 2.048 1.0)
    (sp-rnd-flt spt-vel-y (meters 0.1) (meters 0.2) 1.0)
    (sp-rnd-flt spt-fade-g -2.55 -2.55 1.0)
    (sp-flt spt-fade-b -2.0)
    (sp-rnd-flt spt-fade-a -0.64 -0.64 1.0)
    (sp-rnd-flt spt-accel-y -13.653334 -13.653334 1.0)
    (sp-rnd-flt spt-friction 0.8 0.02 1.0)
    (sp-int spt-timer 100)
    (sp-cpuinfo-flags sp-cpuinfo-flag-2 sp-cpuinfo-flag-3)
    (sp-func spt-func 'sparticle-motion-blur)
    (sp-rnd-flt spt-conerot-x (degrees 0.0) (degrees 3600.0) 1.0)
    (sp-rnd-flt spt-conerot-y (degrees 0.0) (degrees 3600.0) 1.0)
    )
  )
