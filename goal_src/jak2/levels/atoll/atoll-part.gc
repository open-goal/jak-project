;;-*-Lisp-*-
(in-package goal)

;; name: atoll-part.gc
;; name in dgo: atoll-part
;; dgos: ATO

;; DECOMP BEGINS

(deftype atoll-part (part-spawner)
  ()
  )


(defpartgroup group-atoll-seal-of-mar
  :id 302
  :bounds (static-bspherem 0 0 0 6)
  :parts ((sp-item 1313 :fade-after (meters 200) :flags (bit6)))
  )

(defpart 1313
  :init-specs ((:texture (new 'static 'texture-id :index #xca :page #xc))
    (:num 1.0)
    (:y (meters -0.15))
    (:scale-x (meters 2.5) (meters 0.1))
    (:rot-x (degrees 2.25))
    (:scale-y :copy scale-x)
    (:r 255.0)
    (:g 220.0)
    (:b 180.0)
    (:a 20.0)
    (:omega (degrees 4511.25))
    (:timer (seconds 0.017))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 glow))
    (:userdata 819.2)
    )
  )

(defpartgroup group-atoll-streetlight
  :id 303
  :bounds (static-bspherem 0 0 0 6)
  :parts ((sp-item 1314 :fade-after (meters 100) :flags (bit6) :hour-mask #b111111111110000000)
    (sp-item 1315 :fade-after (meters 100) :flags (bit6) :hour-mask #b111111111110000000)
    )
  )

(defpart 1314
  :init-specs ((:texture (new 'static 'texture-id :index #xbb :page #xc))
    (:num 1.0)
    (:y (meters -0.15))
    (:scale-x (meters 2) (meters 0.1))
    (:rot-x (degrees 4.5))
    (:scale-y :copy scale-x)
    (:r 255.0)
    (:g 255.0)
    (:b 255.0)
    (:a 32.0)
    (:omega (degrees 2261.25))
    (:timer (seconds 0.017))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 glow))
    (:userdata 1228.8)
    )
  )

(defpart 1315
  :init-specs ((:texture (new 'static 'texture-id :index #xbb :page #xc))
    (:num 1.0)
    (:y (meters -0.15))
    (:scale-x (meters 12) (meters 0.1))
    (:rot-x (degrees 4.5))
    (:scale-y :copy scale-x)
    (:r 255.0)
    (:g 255.0 255.0)
    (:b 255.0)
    (:a 8.0)
    (:omega (degrees 2265.75))
    (:timer (seconds 0.017))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 glow))
    (:userdata 2048.0)
    )
  )

(defpartgroup group-atoll-pipe-drip
  :id 304
  :bounds (static-bspherem 0 0 0 6)
  :parts ((sp-item 1316 :fade-after (meters 50) :falloff-to (meters 50))
    (sp-item 1317 :fade-after (meters 50) :falloff-to (meters 50))
    )
  )

(defpart 1316
  :init-specs ((:texture (new 'static 'texture-id :index #x21 :page #xc))
    (:num 0.0 0.6)
    (:x (meters -0.025) (meters 0.05))
    (:y (meters 0.05))
    (:z (meters -5))
    (:scale-x (meters 0.1) (meters 0.1))
    (:scale-y :copy scale-x)
    (:r 32.0 32.0)
    (:g 32.0 32.0)
    (:b 64.0 32.0)
    (:a 0.0)
    (:vel-z (meters 0.006666667))
    (:fade-a 0.10666667 0.035555556)
    (:timer (seconds 2.917))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3))
    (:next-time (seconds 1.5))
    (:next-launcher 1318)
    )
  )

(defpart 1318
  :init-specs ((:fade-a 0.0 0.10666667) (:next-time (seconds 0.935)) (:next-launcher 1319))
  )

(defpart 1319
  :init-specs ((:vel-x (meters -0.00083333335) (meters 0.0016666667))
    (:scalevel-x (meters -0.00033333333))
    (:scalevel-y (meters 0.006666667))
    (:accel-y (meters -0.001) (meters -0.00016666666))
    (:next-time (seconds 0) (seconds 0.747))
    (:next-launcher 1320)
    )
  )

(defpart 1317
  :init-specs ((:texture (new 'static 'texture-id :index #x21 :page #xc))
    (:num 1.0)
    (:y (meters -2.5))
    (:z (meters 0.75))
    (:scale-x (meters 0.1) (meters 0.05))
    (:rot-x 4)
    (:scale-y :copy scale-x)
    (:r 32.0 32.0)
    (:g 32.0 32.0)
    (:b 64.0 32.0)
    (:a 32.0 32.0)
    (:omega (degrees 0.045))
    (:vel-y (meters 0.016666668) (meters 0.013333334))
    (:accel-y (meters -0.001) (meters -0.00016666666))
    (:friction 0.97)
    (:timer (seconds 0.5))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3))
    (:func 'sparticle-motion-blur)
    (:next-time (seconds 0) (seconds 0.747))
    (:next-launcher 1320)
    (:conerot-x (degrees 0) (degrees 60))
    (:conerot-y (degrees 0) (degrees 360))
    )
  )

(defpartgroup group-atoll-birds-01
  :id 305
  :bounds (static-bspherem 0 0 0 64)
  :parts ((sp-item 1323 :flags (bit7) :period (seconds 8) :length (seconds 1.067) :binding 1321)
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    (sp-item 1322 :flags (is-3d start-dead))
    (sp-item 1321 :flags (bit1 start-dead launch-asap) :binding 1322)
    )
  )

(defpart 1323
  :init-specs ((:texture (new 'static 'texture-id :index #xc9 :page #xc))
    (:num 0.25)
    (:x (meters -5) (meters 10))
    (:y (meters -4) (meters 8))
    (:z (meters -10) (meters 20))
    (:scale-x (meters 1))
    (:scale-y :copy scale-x)
    (:r 128.0)
    (:a 0.0)
    (:vel-x (meters -0.06666667) (meters -0.013333334))
    (:vel-y (meters 0.006666667) (meters 0.006666667))
    (:vel-z (meters 0))
    (:timer (seconds 8))
    (:flags (sp-cpuinfo-flag-3 set-conerot))
    (:rotate-y (degrees 0))
    )
  )

(defpart 1321
  :init-specs ((:texture (new 'static 'texture-id :index #xc9 :page #xc))
    (:num 1.0)
    (:x (meters 0) (meters 16))
    (:y (meters 0) (meters 16))
    (:z (meters 2))
    (:scale-x (meters 0))
    (:rot-z (degrees 90))
    (:r 64.0 128.0)
    (:g :copy r)
    (:b :copy g)
    (:a 128.0)
    (:omega (degrees 0) (degrees 360))
    (:vel-x (meters -0.026666667) 1 (meters 0.053333335))
    (:vel-y (meters -0.026666667) 1 (meters 0.053333335))
    (:vel-z (meters 0))
    (:scalevel-x (meters -0.08))
    (:fade-a -0.053333335)
    (:timer (seconds 8))
    (:flags (sp-cpuinfo-flag-3 ready-to-launch))
    (:next-time (seconds 0.33))
    (:next-launcher 1324)
    )
  )

(defpart 1324
  :init-specs ((:scale-x (meters 8)) (:scalevel-x (meters 0.16)) (:next-time (seconds 0.167)) (:next-launcher 1325))
  )

(defpart 1325
  :init-specs ((:scale-x (meters 0))
    (:vel-z (meters 0))
    (:scalevel-x (meters -0.08))
    (:next-time (seconds 0.33))
    (:next-launcher 1324)
    )
  )

(defun birth-func-atoll-bird-wing ((arg0 sparticle-system)
                          (arg1 sparticle-cpuinfo)
                          (arg2 sprite-vec-data-3d)
                          (arg3 sparticle-launcher)
                          (arg4 sparticle-launch-state)
                          )
  "@TODO - particle docs"
  (local-vars (v1-15 float) (v1-16 float))
  (rlet ((vf0 :class vf)
         (vf1 :class vf)
         (vf2 :class vf)
         )
    (init-vf0-vector)
    (let ((s5-0 (-> arg4 sprite)))
      (let ((v1-0 (the-as sprite-vec-data-2d (-> s5-0 user-float)))
            (s4-0 (new 'stack-no-clear 'quaternion))
            )
        (let* ((a0-1 arg2)
               (f0-0 (-> a0-1 qx-qy-qz-sy x))
               (f1-0 (-> a0-1 qx-qy-qz-sy y))
               (f2-0 (-> a0-1 qx-qy-qz-sy z))
               )
          (set! (-> s4-0 x) f0-0)
          (set! (-> s4-0 y) f1-0)
          (set! (-> s4-0 z) f2-0)
          (set! (-> s4-0 w) (sqrtf (- (- (- 1.0 (* f2-0 f2-0)) (* f1-0 f1-0)) (* f0-0 f0-0))))
          )
        (let ((a1-1 (new-stack-vector0)))
          (set! (-> a1-1 y) (-> v1-0 flag-rot-sy y))
          (set! (-> a1-1 z) (if (logtest? *global-toggle* 1)
                                (the float (sar (shl (the int (- 16384.0 (-> s5-0 sprite x-y-z-sx w))) 48) 48))
                                (the float (sar (shl (the int (+ 16384.0 (-> s5-0 sprite x-y-z-sx w))) 48) 48))
                                )
                )
          (quaternion-zxy! s4-0 a1-1)
          )
        (let ((v1-14 arg2))
          (cond
            ((< (-> s4-0 w) 0.0)
             (.lvf vf1 (&-> v1-14 qx-qy-qz-sy quad))
             (.lvf vf2 (&-> s4-0 quad))
             (.sub.vf vf1 vf0 vf2 :mask #b111)
             (.svf (&-> v1-14 qx-qy-qz-sy quad) vf1)
             (.mov v1-15 vf1)
             )
            (else
              (.lvf vf1 (&-> v1-14 qx-qy-qz-sy quad))
              (.lvf vf2 (&-> s4-0 quad))
              (.add.vf vf1 vf0 vf2 :mask #b111)
              (.svf (&-> v1-14 qx-qy-qz-sy quad) vf1)
              (.mov v1-16 vf1)
              )
            )
          )
        )
      (set! (-> arg2 r-g-b-a x) (-> s5-0 sprite r-g-b-a x))
      (set! (-> arg2 r-g-b-a y) (-> s5-0 sprite r-g-b-a y))
      (set! (-> arg2 r-g-b-a z) (-> s5-0 sprite r-g-b-a z))
      (set! (-> arg2 r-g-b-a w) (-> s5-0 sprite r-g-b-a w))
      )
    (set! *global-toggle* (+ *global-toggle* 1))
    0
    (none)
    )
  )

(defpart 1322
  :init-specs ((:texture (new 'static 'texture-id :page #xa3b))
    (:birth-func 'birth-func-atoll-bird-wing)
    (:num 2.0)
    (:scale-x (meters 3))
    (:scale-y (meters 1.2))
    (:r 128.0)
    (:g :copy r)
    (:b :copy g)
    (:a 128.0)
    (:timer (seconds 0.017))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-12))
    )
  )

(defpartgroup group-atoll-bigvent
  :id 306
  :flags (unk-4)
  :bounds (static-bspherem 0 0 0 2)
  :parts ((sp-item 1326 :fade-after (meters 32) :falloff-to (meters 32) :flags (bit7))
    (sp-item 1327 :fade-after (meters 100) :falloff-to (meters 140) :flags (bit7))
    )
  )

(defpart 1326
  :init-specs ((:texture (new 'static 'texture-id :index #x92 :page #xc))
    (:num 1.0)
    (:x (meters -1))
    (:y (meters 0.5) (meters 2))
    (:z (meters -1) (meters 2))
    (:scale-x (meters 0.05))
    (:rot-x 4)
    (:scale-y :copy scale-x)
    (:r 128.0)
    (:g :copy r)
    (:b :copy g)
    (:a 16.0 32.0)
    (:omega (degrees 0.0225))
    (:vel-x (meters 0.06666667) (meters 0.06666667))
    (:vel-y (meters -0.05) (meters -0.016666668))
    (:fade-a -0.16)
    (:accel-y (meters 0.00083333335))
    (:friction 0.9 0.025)
    (:timer (seconds 0.5))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 sp-cpuinfo-flag-12))
    (:func 'sparticle-motion-blur)
    (:rotate-y (degrees 0))
    )
  )

(defpart 1327
  :init-specs ((:texture (new 'static 'texture-id :page #xc))
    (:num 1.0 1.0)
    (:x (meters 0))
    (:y (meters 0.75) (meters 1))
    (:z (meters -0.75) (meters 1.5))
    (:scale-x (meters 1) (meters 0.5))
    (:rot-z (degrees 0) (degrees 360))
    (:scale-y :copy scale-x)
    (:r 64.0 128.0)
    (:g :copy r)
    (:b :copy g)
    (:a 0.0)
    (:vel-x (meters 0.06666667) (meters 0.06666667))
    (:vel-y (meters -0.05) (meters -0.016666668))
    (:scalevel-x (meters 0.01) (meters 0.006666667))
    (:rotvel-z (degrees -1.2) (degrees 2.4))
    (:scalevel-y :copy scalevel-x)
    (:fade-a 0.96)
    (:accel-y (meters 0.00083333335) (meters 0.00083333335))
    (:friction 0.9 0.025)
    (:timer (seconds 0.5))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 sp-cpuinfo-flag-12))
    (:next-time (seconds 0.085) (seconds 0.08))
    (:next-launcher 1328)
    (:rotate-y (degrees 0))
    )
  )

(defpart 1328
  :init-specs ((:fade-a -0.48))
  )

(defpartgroup group-atoll-smallvent
  :id 307
  :flags (unk-4)
  :bounds (static-bspherem 0 0 0 2)
  :parts ((sp-item 1329 :fade-after (meters 100) :falloff-to (meters 140) :flags (bit7)))
  )

(defpart 1329
  :init-specs ((:texture (new 'static 'texture-id :page #xc))
    (:num 3.0 1.0)
    (:x (meters 0.25))
    (:y (meters 0) (meters 0.75))
    (:z (meters -1) (meters 2))
    (:scale-x (meters 1) (meters 0.5))
    (:rot-z (degrees 0) (degrees 360))
    (:scale-y :copy scale-x)
    (:r 64.0 128.0)
    (:g :copy r)
    (:b :copy g)
    (:a 0.0)
    (:vel-x (meters 0.016666668) (meters 0.01))
    (:vel-y (meters -0.016666668) (meters -0.01))
    (:scalevel-x (meters 0.0033333334) (meters 0.0033333334))
    (:rotvel-z (degrees -0.2) (degrees 0.4))
    (:scalevel-y :copy scalevel-x)
    (:fade-a 0.48)
    (:accel-y (meters 0.00016666666) (meters 0.00016666666))
    (:friction 0.9 0.025)
    (:timer (seconds 0.5))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-12))
    (:next-time (seconds 0.085) (seconds 0.08))
    (:next-launcher 1330)
    (:rotate-y (degrees 0))
    )
  )

(defpart 1330
  :init-specs ((:fade-a -0.24))
  )

(defpartgroup group-atoll-spray
  :id 308
  :flags (unk-4)
  :bounds (static-bspherem 0 -8 0 16)
  :parts ((sp-item 1331 :fade-after (meters 120) :falloff-to (meters 120) :flags (bit7))
    (sp-item 1332 :fade-after (meters 120) :falloff-to (meters 120) :flags (bit7))
    )
  )

(defpart 1331
  :init-specs ((:texture (new 'static 'texture-id :index #x21 :page #xc))
    (:num 1.0 2.0)
    (:z (meters -0.5))
    (:scale-x (meters 0.1) (meters 0.1))
    (:rot-x 4)
    (:scale-y :copy scale-x)
    (:r 32.0 32.0)
    (:g 32.0 32.0)
    (:b 64.0 32.0)
    (:a 128.0)
    (:omega (degrees 0.0225))
    (:vel-z (meters 0.1) (meters 0.013333334))
    (:fade-a -0.28444445 -0.28444445)
    (:accel-y (meters -0.0033333334) (meters 0.00033333333))
    (:friction 0.99)
    (:timer (seconds 1.5))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 sp-cpuinfo-flag-12 use-global-acc))
    (:func 'sparticle-motion-blur)
    (:next-time (seconds 0) (seconds 0.747))
    (:next-launcher 1320)
    (:launchrot-x (degrees -5) (degrees 10))
    (:launchrot-z (degrees -5) (degrees 10))
    )
  )

(defpart 1320
  :init-specs ((:r 255.0) (:g 255.0) (:b 255.0) (:next-time (seconds 0.017)) (:next-launcher 1333))
  )

(defpart 1333
  :init-specs ((:r 32.0 32.0) (:g 32.0 32.0) (:b 64.0 32.0) (:next-time (seconds 0) (seconds 1.497)) (:next-launcher 1320))
  )

(defpart 1332
  :init-specs ((:texture (new 'static 'texture-id :index #x21 :page #xc))
    (:num 0.0 0.5)
    (:z (meters -0.5))
    (:scale-x (meters 0.1) (meters 0.1))
    (:rot-x 4)
    (:scale-y :copy scale-x)
    (:r 32.0 32.0)
    (:g 32.0 32.0)
    (:b 64.0 32.0)
    (:a 128.0)
    (:omega (degrees 0.0225))
    (:vel-z (meters 0.1) (meters 0.013333334))
    (:fade-a -0.28444445 -0.28444445)
    (:accel-y (meters -0.0033333334) (meters 0.00033333333))
    (:friction 0.99)
    (:timer (seconds 1.5))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 sp-cpuinfo-flag-12 use-global-acc))
    (:func 'sparticle-motion-blur)
    (:next-time (seconds 0) (seconds 0.747))
    (:next-launcher 1320)
    (:launchrot-x (degrees -30) (degrees 60))
    (:launchrot-z (degrees -30) (degrees 60))
    )
  )

(defpartgroup group-atoll-spray-check-water
  :id 309
  :flags (unk-4)
  :bounds (static-bspherem 0 -8 0 16)
  :parts ((sp-item 1334 :fade-after (meters 100) :falloff-to (meters 100) :flags (bit7))
    (sp-item 1335 :fade-after (meters 100) :falloff-to (meters 100) :flags (bit7))
    )
  )

(defun check-drop-level-atoll-drop ((arg0 sparticle-system) (arg1 sparticle-cpuinfo) (arg2 matrix))
  "Ensure water drop particle effects don't go below the ocean level, render the splash"
  (let ((f30-0 (get-height *ocean* (the-as vector (-> arg2 vector)) #t)))
    (when (and (!= f30-0 4095996000.0) (< (-> arg2 vector 0 y) f30-0))
      (let ((s3-0 (new 'stack-no-clear 'vector)))
        (sp-kill-particle arg0 arg1)
        (set-vector! s3-0 (-> arg2 vector 0 x) f30-0 (-> arg2 vector 0 z) 1.0)
        (launch-particles (-> *part-id-table* 1336) s3-0)
        (launch-particles :system *sp-particle-system-3d* (-> *part-id-table* 1337) s3-0)
        )
      )
    )
  (sparticle-motion-blur arg0 arg1 (the-as vector arg2))
  (none)
  )

(defpart 1334
  :init-specs ((:texture (new 'static 'texture-id :index #x21 :page #xc))
    (:num 1.0 1.0)
    (:z (meters -0.5))
    (:scale-x (meters 0.1) (meters 0.1))
    (:rot-x 4)
    (:scale-y :copy scale-x)
    (:r 32.0 32.0)
    (:g 32.0 32.0)
    (:b 64.0 32.0)
    (:a 128.0)
    (:omega (degrees 0.0225))
    (:vel-z (meters 0.1) (meters 0.013333334))
    (:fade-a -0.28444445 -0.28444445)
    (:accel-y (meters -0.0033333334) (meters 0.00033333333))
    (:friction 0.99)
    (:timer (seconds 1.5))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 sp-cpuinfo-flag-12 use-global-acc))
    (:func 'check-drop-level-atoll-drop)
    (:next-time (seconds 0) (seconds 0.747))
    (:next-launcher 1320)
    (:launchrot-x (degrees -5) (degrees 10))
    (:launchrot-z (degrees -5) (degrees 10))
    )
  )

(defpart 1335
  :init-specs ((:texture (new 'static 'texture-id :index #x21 :page #xc))
    (:num 0.0 0.5)
    (:z (meters -0.5))
    (:scale-x (meters 0.1) (meters 0.1))
    (:rot-x 4)
    (:scale-y :copy scale-x)
    (:r 32.0 32.0)
    (:g 32.0 32.0)
    (:b 64.0 32.0)
    (:a 128.0)
    (:omega (degrees 0.0225))
    (:vel-z (meters 0.1) (meters 0.013333334))
    (:fade-a -0.28444445 -0.28444445)
    (:accel-y (meters -0.0033333334) (meters 0.00033333333))
    (:friction 0.99)
    (:timer (seconds 1.5))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 sp-cpuinfo-flag-12 use-global-acc))
    (:func 'check-drop-level-atoll-drop)
    (:next-time (seconds 0) (seconds 0.747))
    (:next-launcher 1320)
    (:launchrot-x (degrees -30) (degrees 60))
    (:launchrot-z (degrees -30) (degrees 60))
    )
  )

(defpart 1336
  :init-specs ((:texture (new 'static 'texture-id :index #x21 :page #xc))
    (:num 1.0 1.0)
    (:scale-x (meters 0.1) (meters 0.05))
    (:rot-x 4)
    (:scale-y :copy scale-x)
    (:r 32.0 32.0)
    (:g 32.0 32.0)
    (:b 64.0 32.0)
    (:a 64.0 32.0)
    (:omega (degrees 0.05625))
    (:vel-y (meters 0.01) (meters 0.026666667))
    (:fade-a -0.21333334)
    (:accel-y (meters -0.001) (meters -0.00016666666))
    (:friction 0.97)
    (:timer (seconds 0.5))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3))
    (:func 'sparticle-motion-blur)
    (:next-time (seconds 0) (seconds 0.747))
    (:next-launcher 1320)
    (:conerot-x (degrees 0) (degrees 60))
    (:conerot-y (degrees 0) (degrees 360))
    )
  )

(defpart 1337
  :init-specs ((:texture (new 'static 'texture-id :index #x2c :page #xc))
    (:num 1.0)
    (:y (meters 0.02))
    (:scale-x (meters 1))
    (:scale-y :copy scale-x)
    (:r 32.0 32.0)
    (:g 32.0 32.0)
    (:b 64.0 32.0)
    (:a 64.0 32.0)
    (:scalevel-x (meters 0.02) (meters 0.01))
    (:scalevel-y (meters 0.02) (meters 0.01))
    (:fade-a -0.64)
    (:timer (seconds 0.335))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 sp-cpuinfo-flag-12))
    (:next-time (seconds 0) (seconds 0.747))
    (:next-launcher 1320)
    (:rotate-y (degrees 0) (degrees 360))
    )
  )

(defpartgroup group-atoll-spray-small
  :id 310
  :flags (unk-4)
  :bounds (static-bspherem 0 -4 0 8)
  :parts ((sp-item 1338 :fade-after (meters 120) :falloff-to (meters 120) :flags (bit7)))
  )

(defpart 1338
  :init-specs ((:texture (new 'static 'texture-id :index #x21 :page #xc))
    (:num 0.0 0.5)
    (:z (meters -0.25))
    (:scale-x (meters 0.1) (meters 0.1))
    (:rot-x 4)
    (:scale-y :copy scale-x)
    (:r 32.0 32.0)
    (:g 32.0 32.0)
    (:b 64.0 32.0)
    (:a 128.0)
    (:omega (degrees 0.0225))
    (:vel-z (meters 0.033333335) (meters 0.013333334))
    (:fade-a -0.28444445 -0.28444445)
    (:accel-y (meters -0.0033333334) (meters 0.00033333333))
    (:friction 0.99)
    (:timer (seconds 2))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 sp-cpuinfo-flag-12 use-global-acc))
    (:func 'sparticle-motion-blur)
    (:next-time (seconds 0) (seconds 0.747))
    (:next-launcher 1320)
    (:launchrot-x (degrees -2) (degrees 4))
    (:launchrot-z (degrees -2) (degrees 4))
    )
  )

(defpartgroup group-atoll-spray-check-userdata-1-1
  :id 311
  :flags (unk-4)
  :bounds (static-bspherem 0 -12 0 20)
  :parts ((sp-item 1339 :fade-after (meters 100) :falloff-to (meters 100) :flags (bit7))
    (sp-item 1332 :fade-after (meters 100) :falloff-to (meters 100) :flags (bit7))
    )
  )

(defpartgroup group-atoll-spray-check-userdata-1-4
  :id 312
  :flags (unk-4)
  :bounds (static-bspherem 0 -12 0 20)
  :parts ((sp-item 1340 :fade-after (meters 100) :falloff-to (meters 100) :flags (bit7))
    (sp-item 1332 :fade-after (meters 100) :falloff-to (meters 100) :flags (bit7))
    )
  )

(defpartgroup group-atoll-spray-check-userdata-7
  :id 313
  :flags (unk-4)
  :bounds (static-bspherem 0 -12 0 20)
  :parts ((sp-item 1341 :fade-after (meters 100) :falloff-to (meters 100) :flags (bit7))
    (sp-item 1332 :fade-after (meters 100) :falloff-to (meters 100) :flags (bit7))
    )
  )

(defpartgroup group-atoll-spray-check-userdata-8
  :id 314
  :flags (unk-4)
  :bounds (static-bspherem 0 -12 0 20)
  :parts ((sp-item 1342 :fade-after (meters 100) :falloff-to (meters 100) :flags (bit7))
    (sp-item 1332 :fade-after (meters 100) :falloff-to (meters 100) :flags (bit7))
    )
  )

(defpartgroup group-atoll-spray-check-userdata-13
  :id 315
  :flags (unk-4)
  :bounds (static-bspherem 0 -12 0 30)
  :parts ((sp-item 1343 :fade-after (meters 100) :falloff-to (meters 100) :flags (bit7))
    (sp-item 1344 :fade-after (meters 100) :falloff-to (meters 100) :flags (bit7))
    )
  )

(defun check-drop-level-atoll-drop-userdata ((arg0 sparticle-system) (arg1 sparticle-cpuinfo) (arg2 matrix))
  "Ensure water drop particle effects don't go below the provided y-value, render the splash"
  (when (< (-> arg2 vector 0 y) (-> arg1 user-float))
    (let ((s3-0 (new 'stack-no-clear 'vector)))
      (sp-kill-particle arg0 arg1)
      (set-vector! s3-0 (-> arg2 vector 0 x) (-> arg1 user-float) (-> arg2 vector 0 z) 1.0)
      (launch-particles (-> *part-id-table* 1336) s3-0)
      )
    )
  (sparticle-motion-blur arg0 arg1 (the-as vector arg2))
  (none)
  )

(defpart 1339
  :init-specs ((:texture (new 'static 'texture-id :index #x21 :page #xc))
    (:num 1.0 1.0)
    (:z (meters -0.5))
    (:scale-x (meters 0.1) (meters 0.1))
    (:rot-x 4)
    (:scale-y :copy scale-x)
    (:r 32.0 32.0)
    (:g 32.0 32.0)
    (:b 64.0 32.0)
    (:a 128.0)
    (:omega (degrees 0.0225))
    (:vel-z (meters 0.1) (meters 0.013333334))
    (:fade-a -0.28444445 -0.28444445)
    (:accel-y (meters -0.0033333334) (meters 0.00033333333))
    (:friction 0.99)
    (:timer (seconds 1.5))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 sp-cpuinfo-flag-12 use-global-acc))
    (:userdata 5324.8)
    (:func 'check-drop-level-atoll-drop-userdata)
    (:next-time (seconds 0) (seconds 0.747))
    (:next-launcher 1320)
    (:launchrot-x (degrees -5) (degrees 10))
    (:launchrot-z (degrees -5) (degrees 10))
    )
  )

(defpart 1340
  :init-specs ((:texture (new 'static 'texture-id :index #x21 :page #xc))
    (:num 1.0 1.0)
    (:z (meters -0.5))
    (:scale-x (meters 0.1) (meters 0.1))
    (:rot-x 4)
    (:scale-y :copy scale-x)
    (:r 32.0 32.0)
    (:g 32.0 32.0)
    (:b 64.0 32.0)
    (:a 128.0)
    (:omega (degrees 0.0225))
    (:vel-z (meters 0.1) (meters 0.013333334))
    (:fade-a -0.28444445 -0.28444445)
    (:accel-y (meters -0.0033333334) (meters 0.00033333333))
    (:friction 0.99)
    (:timer (seconds 1.5))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 sp-cpuinfo-flag-12 use-global-acc))
    (:userdata 6553.6)
    (:func 'check-drop-level-atoll-drop-userdata)
    (:next-time (seconds 0) (seconds 0.747))
    (:next-launcher 1320)
    (:launchrot-x (degrees -5) (degrees 10))
    (:launchrot-z (degrees -5) (degrees 10))
    )
  )

(defpart 1341
  :init-specs ((:texture (new 'static 'texture-id :index #x21 :page #xc))
    (:num 1.0 1.0)
    (:z (meters -0.5))
    (:scale-x (meters 0.1) (meters 0.1))
    (:rot-x 4)
    (:scale-y :copy scale-x)
    (:r 32.0 32.0)
    (:g 32.0 32.0)
    (:b 64.0 32.0)
    (:a 128.0)
    (:omega (degrees 0.0225))
    (:vel-z (meters 0.1) (meters 0.013333334))
    (:fade-a -0.28444445 -0.28444445)
    (:accel-y (meters -0.0033333334) (meters 0.00033333333))
    (:friction 0.99)
    (:timer (seconds 1.5))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 sp-cpuinfo-flag-12 use-global-acc))
    (:userdata 28672.0)
    (:func 'check-drop-level-atoll-drop-userdata)
    (:next-time (seconds 0) (seconds 0.747))
    (:next-launcher 1320)
    (:launchrot-x (degrees -5) (degrees 10))
    (:launchrot-z (degrees -5) (degrees 10))
    )
  )

(defpart 1342
  :init-specs ((:texture (new 'static 'texture-id :index #x21 :page #xc))
    (:num 1.0 1.0)
    (:z (meters -0.5))
    (:scale-x (meters 0.1) (meters 0.1))
    (:rot-x 4)
    (:scale-y :copy scale-x)
    (:r 32.0 32.0)
    (:g 32.0 32.0)
    (:b 64.0 32.0)
    (:a 128.0)
    (:omega (degrees 0.0225))
    (:vel-z (meters 0.1) (meters 0.013333334))
    (:fade-a -0.28444445 -0.28444445)
    (:accel-y (meters -0.0033333334) (meters 0.00033333333))
    (:friction 0.99)
    (:timer (seconds 1.5))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 sp-cpuinfo-flag-12 use-global-acc))
    (:userdata 32768.0 20480.0)
    (:func 'check-drop-level-atoll-drop-userdata)
    (:next-time (seconds 0) (seconds 0.747))
    (:next-launcher 1320)
    (:launchrot-x (degrees -5) (degrees 10))
    (:launchrot-z (degrees -5) (degrees 10))
    )
  )

(defpart 1343
  :init-specs ((:texture (new 'static 'texture-id :index #x21 :page #xc))
    (:num 1.0 1.0)
    (:z (meters -0.5))
    (:scale-x (meters 0.1) (meters 0.1))
    (:rot-x 4)
    (:scale-y :copy scale-x)
    (:r 32.0 32.0)
    (:g 32.0 32.0)
    (:b 64.0 32.0)
    (:a 128.0)
    (:omega (degrees 0.0225))
    (:vel-z (meters 0.1) (meters 0.013333334))
    (:fade-a -0.14222223 -0.14222223)
    (:accel-y (meters -0.0033333334) (meters 0.00033333333))
    (:friction 0.99)
    (:timer (seconds 1.5))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 sp-cpuinfo-flag-12 use-global-acc))
    (:userdata 53248.0)
    (:func 'check-drop-level-atoll-drop-userdata)
    (:next-time (seconds 0) (seconds 0.747))
    (:next-launcher 1320)
    (:launchrot-x (degrees -5) (degrees 10))
    (:launchrot-z (degrees -5) (degrees 10))
    )
  )

(defpart 1344
  :init-specs ((:texture (new 'static 'texture-id :index #x21 :page #xc))
    (:num 0.0 0.5)
    (:z (meters -0.5))
    (:scale-x (meters 0.1) (meters 0.1))
    (:rot-x 4)
    (:scale-y :copy scale-x)
    (:r 32.0 32.0)
    (:g 32.0 32.0)
    (:b 64.0 32.0)
    (:a 128.0)
    (:omega (degrees 0.0225))
    (:vel-z (meters 0.1) (meters 0.013333334))
    (:fade-a -0.14222223 -0.14222223)
    (:accel-y (meters -0.0033333334) (meters 0.00033333333))
    (:friction 0.99)
    (:timer (seconds 1.5))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 sp-cpuinfo-flag-12 use-global-acc))
    (:userdata 53248.0)
    (:func 'check-drop-level-atoll-drop-userdata)
    (:next-time (seconds 0) (seconds 0.747))
    (:next-launcher 1320)
    (:launchrot-x (degrees -30) (degrees 60))
    (:launchrot-z (degrees -30) (degrees 60))
    )
  )

(defpartgroup group-atoll-cable-lights
  :id 316
  :bounds (static-bspherem 0 0 0 16)
  :parts ((sp-item 1345 :fade-after (meters 6000) :flags (bit6) :hour-mask #b111111111110000000))
  )

(defpart 1345
  :init-specs ((:texture (new 'static 'texture-id :index #xbb :page #xc))
    (:num 1.0)
    (:y (meters 2))
    (:scale-x (meters 24))
    (:rot-x (degrees 225))
    (:scale-y :copy scale-x)
    (:r 255.0)
    (:g 196.0 64.0)
    (:b 64.0)
    (:a 20.0 4.0)
    (:timer (seconds 0.017))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 glow))
    (:userdata 2048.0)
    )
  )

(defpartgroup group-atoll-stadium-lights
  :id 317
  :bounds (static-bspherem 0 0 0 64)
  :parts ((sp-item 1346 :flags (bit6) :hour-mask #b111111111110000000)
    (sp-item 1347 :flags (bit6) :hour-mask #b111111111110000000)
    )
  )

(defpart 1346
  :init-specs ((:texture (new 'static 'texture-id :index #xbb :page #xc))
    (:num 1.0)
    (:scale-x (meters 48.5) (meters 0.1))
    (:rot-x (degrees 45))
    (:rot-z (degrees -17))
    (:scale-y :copy scale-x)
    (:r 255.0)
    (:g 255.0)
    (:b 255.0)
    (:a 32.0 4.0)
    (:timer (seconds 0.017))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 glow))
    (:userdata 0.0)
    )
  )

(defpart 1347
  :init-specs ((:texture (new 'static 'texture-id :index #xbb :page #xc))
    (:num 1.0)
    (:scale-x (meters 96) (meters 0.1))
    (:rot-x (degrees 78.75))
    (:rot-z (degrees -17))
    (:scale-y :copy scale-x)
    (:r 255.0)
    (:g 255.0 255.0)
    (:b 255.0)
    (:a 8.0 2.0)
    (:timer (seconds 0.017))
    (:flags (sp-cpuinfo-flag-2 sp-cpuinfo-flag-3 glow))
    (:userdata 0.0)
    )
  )
