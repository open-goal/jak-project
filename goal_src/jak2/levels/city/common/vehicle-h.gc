;;-*-Lisp-*-
(in-package goal)

;; name: vehicle-h.gc
;; name in dgo: vehicle-h
;; dgos: CWI

;; +++vehicle-controller-flag
(defenum vehicle-controller-flag
  :type uint32
  :bitfield #t
  (debug)
  (draw-marks)
  (left-turn)
  (on-straightaway)
  (do-turn)
  (blocking-dest-node)
  (attached)
  (off-path)
  (ignore-others)
  (direct-mode)
  (recovery-mode)
  (no-slowing-for-turns))
;; ---vehicle-controller-flag

(declare-type vehicle rigid-body-object)
(declare-type vehicle-physics-work structure)

(deftype mystery-vehicle-type (structure)
  "TODO - What are you! Custom added for decomp"
  ((matrices matrix 3 :inline :offset-assert 0)
   (vectors vector 2 :inline :offset-assert 192)
   (handles handle 2 :offset-assert 224)
   (cquery collide-query :inline :offset-assert 240)
   (floats float 5 :offset-assert 780))
  :method-count-assert 9
  :size-assert         #x320
  :flag-assert         #x900000320)

;; +++vehicle-type
(defenum vehicle-type
  :type int32
  (bikea 0)
  (bikeb 1)
  (bikec 2)
  (cara  3)
  (carb  4)
  (carc  5)
  (guard-bike 6)
  (hellcat 7)
  (evan-test-bike 8)
  (test-bike 9)
  (test-car 10)
  )
;; ---vehicle-type


;; DECOMP BEGINS

(deftype vehicle-lookup-info (structure)
  ((turn-radius       meters  :offset-assert   0)
   (throttle-turning  float   :offset-assert   4)
   (throttle-straight float   :offset-assert   8)
   )
  :method-count-assert 9
  :size-assert         #xc
  :flag-assert         #x90000000c
  )


(deftype vehicle-control-point (structure)
  ((local-pos vector :inline :offset-assert   0)
   (normal    vector :inline :offset-assert  16)
   )
  :method-count-assert 9
  :size-assert         #x20
  :flag-assert         #x900000020
  )


(deftype vehicle-section-info (structure)
  ((damage-seg-array uint64 3 :offset-assert   0)
   (damage-seg-count int8     :offset-assert  24)
   )
  :method-count-assert 9
  :size-assert         #x19
  :flag-assert         #x900000019
  )


(deftype vehicle-seat-info (structure)
  ((data     uint8  16      :offset-assert   0)
   (position vector :inline :offset          0)
   (pos-x    float          :offset          0)
   (pos-y    float          :offset          4)
   (pos-z    float          :offset          8)
   (angle    int16          :offset         12)
   (flags    uint8          :offset         14)
   )
  :method-count-assert 9
  :size-assert         #x10
  :flag-assert         #x900000010
  )


(deftype vehicle-explosion-info (joint-exploder-static-params)
  ((skel      skeleton-group  :offset-assert  16)
   (skel-name string          :offset-assert  20)
   (anim      int32           :offset-assert  24)
   )
  :method-count-assert 9
  :size-assert         #x1c
  :flag-assert         #x90000001c
  )


(deftype vehicle-grab-rail-info (structure)
  ((local-pos vector 2 :inline :offset-assert   0)
   (normal    vector :inline   :offset-assert  32)
   )
  :method-count-assert 9
  :size-assert         #x30
  :flag-assert         #x900000030
  )


(deftype rigid-body-vehicle-constants (rigid-body-object-constants)
  ((flags                             uint32                                          :offset-assert 208)
   (object-type                       uint8                                           :offset-assert 212)
   (guard-type                        uint8                                           :offset-assert 213)
   (max-engine-thrust                 meters                                          :offset-assert 216)
   (inv-max-engine-thrust             float                                           :offset-assert 220)
   (engine-response-rate              float                                           :offset-assert 224)
   (engine-intake-factor              float                                           :offset-assert 228)
   (brake-factor                      float                                           :offset-assert 232)
   (turbo-boost-factor                float                                           :offset-assert 236)
   (max-xz-speed                      meters                                          :offset-assert 240)
   (ground-probe-distance             meters                                          :offset-assert 244)
   (ground-probe-offset               meters                                          :offset-assert 248)
   (cos-ground-effect-angle           float                                           :offset-assert 252)
   (spring-lift-factor                float                                           :offset-assert 256)
   (air-steering-factor               float                                           :offset-assert 260)
   (air-drag-factor                   float                                           :offset-assert 264)
   (steering-fin-angle                float                                           :offset-assert 268)
   (steering-thruster-factor          float                                           :offset-assert 272)
   (steering-thruster-max-gain        float                                           :offset-assert 276)
   (steering-thruster-half-gain-speed meters                                          :offset-assert 280)
   (tire-steering-angle               float                                           :offset-assert 284)
   (tire-friction-factor              float                                           :offset-assert 288)
   (tire-static-friction              float                                           :offset-assert 292)
   (tire-static-friction-speed        meters                                          :offset-assert 296)
   (tire-dynamic-friction             float                                           :offset-assert 300)
   (tire-dynamic-friction-speed       meters                                          :offset-assert 304)
   (tire-inv-max-friction-speed       float                                           :offset-assert 308)
   (airfoil-factor                    float                                           :offset-assert 312)
   (drag-force-factor                 float                                           :offset-assert 316)
   (speed-scrubbing-drag              float                                           :offset-assert 320)
   (speed-limiting-drag               float                                           :offset-assert 324)
   (pitch-control-factor              float                                           :offset-assert 328)
   (roll-control-factor               float                                           :offset-assert 332)
   (roll-angle                        float                                           :offset-assert 336)
   (jump-thrust-factor                float                                           :offset-assert 340)
   (buoyancy-factor                   float                                           :offset-assert 344)
   (player-weight                     float                                           :offset-assert 348)
   (player-shift-x                    meters                                          :offset-assert 352)
   (player-shift-z                    meters                                          :offset-assert 356)
   (target-speed-offset               meters                                          :offset-assert 360)
   (turning-accel                     meters                                          :offset-assert 364)
   (toughness-factor                  float                                           :offset-assert 368)
   (damage-factor                     float                                           :offset-assert 372)
   (camera-string-min-height          meters                                          :offset-assert 376)
   (camera-string-max-height          meters                                          :offset-assert 380)
   (camera-string-min-length          meters                                          :offset-assert 384)
   (camera-string-max-length          meters                                          :offset-assert 388)
   (camera-min-fov                    float                                           :offset-assert 392)
   (camera-max-fov                    float                                           :offset-assert 396)
   (camera-head-offset                float                                           :offset-assert 400)
   (camera-foot-offset                float                                           :offset-assert 404)
   (camera-normal-max-angle-offset    float                                           :offset-assert 408)
   (camera-air-max-angle-offset       float                                           :offset-assert 412)
   (camera-max-lookaround-speed       float                                           :offset-assert 416)
   (seat-count                        int8                                            :offset-assert 420)
   (section-count                     int8                                            :offset-assert 421)
   (rider-stance                      uint8                                           :offset-assert 422)
   (grab-rail-count                   int8                                            :offset-assert 423)
   (grab-rail-array                   (inline-array vehicle-grab-rail-info)           :offset-assert 424)
   (seat-array                        vehicle-seat-info                     4 :inline :offset-assert 432)
   (rider-hand-offset                 vector                                2 :inline :offset-assert 496)
   (section-array                     vehicle-section-info                  4 :inline :offset-assert 528)
   (section-bike-front                vehicle-section-info                  :inline   :offset        528)
   (section-bike-rear                 vehicle-section-info                  :inline   :offset        560)
   (section-car-front-left            vehicle-section-info                  :inline   :offset        528)
   (section-car-rear-left             vehicle-section-info                  :inline   :offset        560)
   (section-car-front-right           vehicle-section-info                  :inline   :offset        592)
   (section-car-rear-right            vehicle-section-info                  :inline   :offset        624)
   (explosion                         vehicle-explosion-info                          :offset-assert 656)
   (engine-pitch-scale                float                                           :offset-assert 660)
   (engine-pitch-offset               float                                           :offset-assert 664)
   (engine-pitch-mod-amp              float                                           :offset-assert 668)
   (engine-sound-select               int8                                            :offset-assert 672)
   (engine-sound                      sound-name                                      :offset-assert 688)
   (thrust-sound                      sound-name                                      :offset-assert 704)
   (scrape-sound                      sound-name                                      :offset-assert 720)
   (glance-sound                      sound-name                                      :offset-assert 736)
   (impact-sound                      sound-name                                      :offset-assert 752)
   (extra-sound                       sound-name                                      :offset-assert 768)
   (explosion-part                    int32                                           :offset-assert 784)
   (headlight-count                   int8                                            :offset-assert 788)
   (taillight-count                   int8                                            :offset-assert 789)
   (thruster-flame-width              meters                                          :offset-assert 792)
   (thruster-flame-length             meters                                          :offset-assert 796)
   (thruster-local-pos                vector                                2 :inline :offset-assert 800)
   (exhaust-local-pos                 vector                                2 :inline :offset-assert 832)
   (exhaust-local-dir                 vector                                2 :inline :offset-assert 864)
   (smoke-local-pos                   vector                                2 :inline :offset-assert 896)
   (smoke-local-vel                   vector                                2 :inline :offset-assert 928)
   (headlight-local-pos               vector                                3 :inline :offset-assert 960)
   (taillight-local-pos               vector                                2 :inline :offset-assert 1008)
   (lift-thruster-count               int8                                            :offset-assert 1040)
   (roll-thruster-count               int8                                            :offset-assert 1041)
   (steering-thruster-count           int8                                            :offset-assert 1042)
   (stabilizer-count                  int8                                            :offset-assert 1043)
   (inv-lift-thruster-count           float                                           :offset-assert 1044)
   (pad                               int8                                  8         :offset-assert 1048)
   (lift-thruster-array               vehicle-control-point                 2 :inline :offset-assert 1056)
   (roll-thruster-array               vehicle-control-point                 2 :inline :offset-assert 1120)
   (steering-thruster-array           vehicle-control-point                 2 :inline :offset-assert 1184)
   (stabilizer-array                  vehicle-control-point                 6 :inline :offset-assert 1248)
   (engine-thrust-local-pos           vector                                :inline   :offset-assert 1440)
   (brake-local-pos                   vector                                :inline   :offset-assert 1456)
   (particle-system-2d                basic                                           :offset-assert 1472)
   (particle-system-3d                basic                                           :offset-assert 1476)
   (part-thruster                     basic                                           :offset-assert 1480)
   (part-thruster-scale-x             sp-field-init-spec                              :offset-assert 1484)
   (part-thruster-scale-y             sp-field-init-spec                              :offset-assert 1488)
   (part-quat                         quaternion                                      :offset-assert 1492)
   (part-vel                          vector                                          :offset-assert 1496)
   (color-option-count                int8                                            :offset-assert 1500)
   (color-option-select               int8                                            :offset-assert 1501)
   (color-option-array                (inline-array vector)                           :offset-assert 1504)
   (sample-dir                        vector                                :inline   :offset-assert 1520)
   (sample-time                       time-frame                                      :offset-assert 1536)
   (sample-index                      int32                                           :offset-assert 1544)
   )
  :method-count-assert 11
  :size-assert         #x60c
  :flag-assert         #xb0000060c
  (:methods
    (rigid-body-vehicle-constants-method-9 (_type_) none 9)
    (rigid-body-vehicle-constants-method-10 () none 10)
    )
  )


(deftype vehicle-controller (structure)
  ((flags                  vehicle-controller-flag                                  :offset-assert   0)
   (traffic                traffic-engine                                           :offset-assert   4)
   (branch                 nav-branch                                               :offset-assert   8)
   (target-speed-offset    meters                                                   :offset-assert  12)
   (target-speed           meters                                                   :offset-assert  16)
   (choose-branch-callback (function vehicle-controller vehicle nav-branch)         :offset-assert  20)
   (turn-accel             meters                                                   :offset-assert  24)
   (max-turn-speed         meters                                                   :offset-assert  28)
   (path-prev-point        vector                                           :inline :offset-assert  32)
   (turn-enter-point       vector                                           :inline :offset-assert  48)
   (turn-exit-point        vector                                           :inline :offset-assert  64)
   (path-dest-point        vector                                           :inline :offset         64)
   (turn-enter-dir         vector                                           :inline :offset-assert  80)
   (turn-exit-dir          vector                                           :inline :offset-assert  96)
   (dest-circle            vector                                           :inline :offset-assert 112)
   (target-point           vector                                           :inline :offset-assert 128)
   )
  :method-count-assert 22
  :size-assert         #x90
  :flag-assert         #x1600000090
  (:methods
    (vehicle-controller-method-9 (_type_) none 9)
    (vehicle-controller-method-10 (_type_ traffic-tracker) none 10)
    (vehicle-controller-method-11 (_type_) none 11)
    (vehicle-controller-method-12 (_type_ rigid-body-vehicle-constants vector float int float) none :behavior vehicle 12)
    (vehicle-controller-method-13 (_type_ nav-branch vector) none 13)
    (vehicle-controller-method-14 (_type_ vehicle) nav-branch 14)
    (vehicle-controller-method-15 (_type_) nav-branch 15)
    (vehicle-controller-method-16 (_type_ vector vector) none 16)
    (draw-debug-info (_type_) none 17)
    (vehicle-controller-method-18 (_type_ vector vector vehicle float) none 18)
    (vehicle-controller-method-19 (_type_ vector object vector vector) none 19)
    (vehicle-controller-method-20 (_type_ object float) none 20)
    (vehicle-controller-method-21 (_type_) none 21)
    )
  )


(deftype vehicle-section (structure)
  ((damage float  :offset-assert   0)
   )
  :method-count-assert 9
  :size-assert         #x4
  :flag-assert         #x900000004
  )


(deftype vehicle (rigid-body-object)
  ((self-override            vehicle                                :offset         32)
   (info-override            rigid-body-vehicle-constants           :offset        204)
   (pad                      uint32                       2         :offset-assert 272)
   (vehicle-jkhn1b23jn1      int64                                  :offset-assert 280)
   (controls                 vehicle-controls             :inline   :offset-assert 288)
   (prev-controls            vehicle-controls             :inline   :offset-assert 304)
   (up-dir                   vector                       :inline   :offset-assert 320)
   (jump-time                float                                  :offset-assert 336)
   (jump-thrust              float                                  :offset-assert 340)
   (engine-thrust            float                                  :offset-assert 344)
   (engine-power-factor      float                                  :offset-assert 348)
   (force-scale              float                                  :offset-assert 352)
   (target-distance2         meters                                 :offset-assert 356)
   (pad0                     uint32                                 :offset-assert 360)
   (target-acceleration      vector                       :inline   :offset-assert 368)
   (impact-pos               vector                       :inline   :offset-assert 384)
   (lin-acceleration         vector                       :inline   :offset-assert 400)
   (hit-points               float                                  :offset-assert 416)
   (damage-factor            float                                  :offset-assert 420)
   (crash-level              int8                                   :offset-assert 424)
   (force-level              int8                                   :offset-assert 425)
   (traffic-hash-id          int8                                   :offset-assert 426)
   (traffic-priority-id      int8                                   :offset-assert 427)
   (power-fluctuation-factor float                                  :offset-assert 428)
   (power-level              float                                  :offset-assert 432)
   (flight-level-index       int8                                   :offset-assert 436)
   (flight-level-index-prev  int8                                   :offset-assert 437)
   (overlap-player-counter   uint8                                  :offset-assert 438)
   (physics-counter          uint8                                  :offset-assert 439)
   (flight-level             float                                  :offset-assert 440)
   (brake-factor             float                                  :offset-assert 444)
   (cam-speed-interp         float                                  :offset-assert 448)
   (camera-dist2             float                                  :offset-assert 452)
   (player-dist2             float                                  :offset-assert 456)
   (bound-radius             float                                  :offset-assert 460)
   (rider-array              handle                       4         :offset-assert 464)
   (lift-thrust              float                        2         :offset-assert 496)
   (roll-thrust              float                        2         :offset-assert 504)
   (sent-attack-time         time-frame                             :offset-assert 512)
   (air-time                 time-frame                             :offset-assert 520)
   (turn-time                time-frame                             :offset-assert 528)
   (crash-time               time-frame                             :offset-assert 536)
   (transition-time          time-frame                             :offset-assert 544)
   (transition-end-time      time-frame                             :offset-assert 552)
   (turbo-boost-time         time-frame                             :offset-assert 560)
   (crash-duration           uint16                                 :offset-assert 568)
   (turbo-boost-duration     uint16                                 :offset-assert 570)
   (turbo-boost-factor       float                                  :offset-assert 572)
   (crash-impulse            float                                  :offset-assert 576)
   (water-height             float                                  :offset-assert 580)
   (lights-factor            float                                  :offset-assert 584)
   (outgoing-attack-id       uint32                                 :offset-assert 588)
   (scrape-sound-id          sound-id                               :offset-assert 592)
   (engine-sound-id          sound-id                               :offset-assert 596)
   (thrust-sound-id          sound-id                               :offset-assert 600)
   (roll-sound-id            sound-id                               :offset-assert 604)
   (damage-pop-sound-id      sound-id                               :offset-assert 608)
   (damage-zap-sound-id      sound-id                               :offset-assert 612)
   (extra-sound-id           sound-id                               :offset-assert 616)
   (fog-fade                 float                                  :offset-assert 620)
   (scrape-sound-envelope    float                                  :offset-assert 624)
   (engine-sound-envelope    float                                  :offset-assert 628)
   (engine-sound-factor      float                                  :offset-assert 632)
   (sputter-sound-envelope   float                                  :offset-assert 636)
   (rudder-sound-envelope    float                                  :offset-assert 640)
   (fins-sound-envelope      float                                  :offset-assert 644)
   (exhaust-part-accum       basic                        2         :offset-assert 648)
   (smoke-part-accum         basic                        2         :offset-assert 656)
   (controller               vehicle-controller           :inline   :offset-assert 672)
   (section-array            vehicle-section              4 :inline :offset-assert 816)
   )
  :heap-base #x2f0
  :method-count-assert 144
  :size-assert         #x370
  :flag-assert         #x9002f00370
  (:methods
    (alloc-and-init-rigid-body-control (_type_ rigid-body-vehicle-constants) none :replace 31)
    (inactive () _type_ :state 53)
    (waiting () _type_ :state 54)
    (vehicle-method-55 () _type_ :state 55)
    (vehicle-method-56 () _type_ :state 56)
    (player-control () _type_ :state 57)
    (crash () _type_ :state 58)
    (explode () _type_ :state 59)
    (die () _type_ :state 60)
    (measure-control-parameters () _type_ :state 61)
    (vehicle-method-62 (_type_ float) none 62)
    (vehicle-method-63 (_type_ float) none 63)
    (vehicle-method-64 () none 64)
    (start-jump (_type_) none 65)
    (vehicle-method-66 (_type_) none 66)
    (get-seat-count (_type_) int 67)
    (compute-seat-position (_type_ vector int) none 68)
    (get-rider-in-seat (_type_ int) process 69)
    (vehicle-method-70 (_type_) process 70)
    (put-rider-in-seat (_type_ int process-focusable) none 71)
    (vehicle-method-72 (_type_) uint 72)
    (get-best-seat-for-vehicle (_type_ vector int int) int 73)
    (remove-rider (_type_ process) none 74)
    (vehicle-method-75 (_type_) float 75)
    (vehicle-method-76 (_type_ int uint) none 76)
    (vehicle-method-77 (_type_) none 77)
    (vehicle-method-78 (_type_ int) none 78)
    (vehicle-method-79 (_type_) none 79)
    (vehicle-method-80 (_type_) none 80)
    (vehicle-method-81 (_type_) none 81)
    (vehicle-method-82 (_type_) none 82)
    (vehicle-method-83 (_type_) none 83)
    (draw-thruster (_type_ vector vector float float) none 84)
    (draw-thrusters (_type_) none 85)
    (update-joint-mods (_type_) none 86)
    (vehicle-method-87 (_type_) none 87)
    (vehicle-method-88 (_type_) none 88)
    (vehicle-method-89 (_type_) none 89)
    (vehicle-method-90 (_type_) none 90)
    (vehicle-method-91 (_type_) none 91)
    (vehicle-method-92 (_type_) none 92)
    (vehicle-method-93 (_type_) none 93)
    (vehicle-method-94 (_type_) none 94)
    (vehicle-method-95 (_type_ vector) none 95)
    (vehicle-method-96 (_type_) none 96)
    (vehicle-method-97 (_type_) none 97)
    (vehicle-method-98 (_type_ float) none 98)
    (vehicle-method-99 (_type_ float) none 99)
    (vehicle-method-100 (_type_ float vehicle-physics-work) none 100)
    (vehicle-method-101 (_type_) none 101)
    (vehicle-method-102 (_type_) none 102)
    (vehicle-method-103 (_type_) none 103)
    (vehicle-method-104 (_type_) none 104)
    (vehicle-method-105 (_type_) symbol 105)
    (vehicle-method-106 (_type_) none 106)
    (vehicle-method-107 (_type_) none 107)
    (vehicle-method-108 (_type_) none 108)
    (vehicle-method-109 (_type_) none 109)
    (vehicle-method-110 (_type_) none 110)
    (vehicle-method-111 (_type_ object target) none 111)
    (vehicle-method-112 (_type_ object) none 112)
    (vehicle-method-113 (_type_) none 113)
    (vehicle-method-114 (_type_) none 114)
    (vehicle-method-115 (_type_ vector) none 115)
    (vehicle-method-116 (_type_ (pointer vehicle-controls)) none 116)
    (vehicle-method-117 (_type_ vector int int) none 117)
    (vehicle-method-118 (_type_ int) none 118)
    (vehicle-method-119 (_type_) none 119)
    (vehicle-method-120 (_type_) none 120)
    (vehicle-method-121 (_type_) none 121)
    (vehicle-method-122 (_type_) none 122)
    (vehicle-method-123 (_type_) none 123)
    (vehicle-method-124 (_type_) none 124)
    (vehicle-method-125 (_type_ float) none 125)
    (vehicle-method-126 (_type_ float) none 126)
    (vehicle-method-127 (_type_) none 127)
    (vehicle-method-128 (_type_) none 128)
    (vehicle-method-129 (_type_) none 129)
    (vehicle-method-130 (_type_ traffic-object-spawn-params) none 130)
    (vehicle-method-131 (_type_) none 131)
    (vehicle-method-132 (_type_) none 132)
    (check-player-get-on (_type_) none 133)
    (vehicle-method-134 (_type_ process) none 134)
    (vehicle-method-135 (_type_ traffic-object-spawn-params) none 135)
    (vehicle-method-136 (_type_ traffic-object-spawn-params) none 136)
    (vehicle-method-137 (_type_ traffic-object-spawn-params) none 137)
    (vehicle-method-138 (_type_) none 138)
    (vehicle-method-139 (_type_) none 139)
    (vehicle-method-140 (_type_) none 140)
    (vehicle-method-141 (_type_) none 141)
    (vehicle-method-142 (_type_) none 142)
    (vehicle-method-143 (_type_) none 143)
    )
  )
