;;-*-Lisp-*-
(in-package goal)

;; name: flitter.gc
;; name in dgo: flitter
;; dgos: GAME, COMMON

;; DECOMP BEGINS

(defpartgroup group-flitter-dust-puff
  :id 144
  :duration (seconds 0.017)
  :flags (use-local-clock)
  :bounds (static-bspherem 0 0 0 8)
  :parts ((sp-item 641))
  )

(defpart 641
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :page #xc))
    (sp-flt spt-num 6.0)
    (sp-rnd-flt spt-scale-x (meters 0.6) (meters 0.4) 1.0)
    (sp-rnd-flt spt-rot-z (degrees 0.0) (degrees 360.0) 1.0)
    (sp-copy-from-other spt-scale-y -4)
    (sp-rnd-flt spt-r 32.0 8.0 1.0)
    (sp-rnd-flt spt-g 16.0 8.0 1.0)
    (sp-rnd-flt spt-b 16.0 8.0 1.0)
    (sp-rnd-flt spt-a 32.0 32.0 1.0)
    (sp-rnd-flt spt-vel-y (meters 0.01) (meters 0.0026666666) 1.0)
    (sp-flt spt-scalevel-x (meters 0.0016666667))
    (sp-rnd-flt spt-rotvel-z (degrees -0.2) (degrees 0.4) 1.0)
    (sp-copy-from-other spt-scalevel-y -4)
    (sp-flt spt-fade-r -0.35555556)
    (sp-flt spt-fade-g -0.35555556)
    (sp-flt spt-fade-b -0.35555556)
    (sp-flt spt-fade-a -0.30476192)
    (sp-flt spt-accel-y -1.3653333)
    (sp-int spt-timer 120)
    (sp-cpuinfo-flags sp-cpuinfo-flag-2)
    (sp-int spt-next-time 60)
    (sp-launcher-by-id spt-next-launcher 642)
    (sp-rnd-flt spt-conerot-x (degrees 60.0) (degrees 30.0) 1.0)
    (sp-rnd-flt spt-conerot-y (degrees 0.0) (degrees 360.0) 1.0)
    (sp-rnd-flt spt-rotate-y (degrees 0.0) (degrees 180.0) 1.0)
    )
  )

(defpartgroup group-flitter-birth
  :id 145
  :duration (seconds 7.335)
  :linger-duration (seconds 4)
  :flags (use-local-clock)
  :bounds (static-bspherem 0 3 0 8)
  :parts ((sp-item 645 :fade-after (meters 100) :falloff-to (meters 100) :period 2200 :length 250 :binding 643)
    (sp-item 645 :fade-after (meters 100) :falloff-to (meters 100) :period 2200 :length 200 :binding 643)
    (sp-item 645 :fade-after (meters 100) :falloff-to (meters 100) :period 2200 :length 150 :binding 643)
    (sp-item 645 :fade-after (meters 100) :falloff-to (meters 100) :period 2200 :length 100 :binding 643)
    (sp-item 646 :fade-after (meters 100) :falloff-to (meters 100) :period 2200 :length 120 :binding 644)
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 644 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 643 :flags (bit1 start-dead))
    (sp-item 647 :fade-after (meters 100) :falloff-to (meters 100) :period 2200 :length 320)
    )
  )

(defpart 647
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :page #xc))
    (sp-rnd-flt spt-num 1.0 1.0 1.0)
    (sp-rnd-flt spt-scale-x (meters 1) (meters 0.5) 1.0)
    (sp-rnd-flt spt-scale-y (meters 1) (meters 0.5) 1.0)
    (sp-rnd-flt spt-r 160.0 16.0 1.0)
    (sp-rnd-flt spt-g 130.0 32.0 1.0)
    (sp-rnd-flt spt-b 110.0 16.0 1.0)
    (sp-rnd-flt spt-a 16.0 48.0 1.0)
    (sp-rnd-flt spt-vel-y (meters 0.026666667) (meters 0.026666667) 1.0)
    (sp-rnd-flt spt-scalevel-x (meters 0.006666667) (meters 0.0016666667) 1.0)
    (sp-rnd-flt spt-scalevel-y (meters 0.0033333334) (meters 0.0016666667) 1.0)
    (sp-rnd-flt spt-fade-a -0.053333335 -0.053333335 1.0)
    (sp-rnd-flt spt-accel-y 0.0 1.3653333 1.0)
    (sp-rnd-flt spt-friction 0.85 0.05 1.0)
    (sp-int spt-timer 2400)
    (sp-cpuinfo-flags sp-cpuinfo-flag-2 sp-cpuinfo-flag-12)
    (sp-rnd-flt spt-conerot-x (degrees 0.0) (degrees 90.0) 1.0)
    (sp-rnd-flt spt-conerot-y (degrees 0.0) (degrees 360.0) 1.0)
    (sp-rnd-flt spt-conerot-radius (meters 0) (meters 0.5) 1.0)
    )
  )

(defun check-drop-level-flitter-dirt-rubble ((arg0 sparticle-system) (arg1 sparticle-cpuinfo) (arg2 vector))
  (let ((f30-0 (-> arg1 key origin trans y)))
    (when (< (-> arg2 y) f30-0)
      (let ((gp-0 (new 'stack-no-clear 'vector)))
        (sp-kill-particle arg0 arg1)
        (set-vector! gp-0 (-> arg2 x) f30-0 (-> arg2 z) 1.0)
        (let ((t9-1 sp-launch-particles-var)
              (a0-2 *sp-particle-system-2d*)
              (a1-1 (-> *part-id-table* 648))
              (a2-1 *launch-matrix*)
              )
          (set! (-> a2-1 trans quad) (-> gp-0 quad))
          (t9-1 a0-2 a1-1 a2-1 (the-as sparticle-launch-state #f) (the-as sparticle-launch-control #f) 1.0)
          )
        (let ((t9-2 sp-launch-particles-var)
              (a0-3 *sp-particle-system-2d*)
              (a1-2 (-> *part-id-table* 649))
              (a2-2 *launch-matrix*)
              )
          (set! (-> a2-2 trans quad) (-> gp-0 quad))
          (t9-2 a0-3 a1-2 a2-2 (the-as sparticle-launch-state #f) (the-as sparticle-launch-control #f) 1.0)
          )
        (let ((t9-3 sp-launch-particles-var)
              (a0-4 *sp-particle-system-2d*)
              (a1-3 (-> *part-id-table* 650))
              (a2-3 *launch-matrix*)
              )
          (set! (-> a2-3 trans quad) (-> gp-0 quad))
          (t9-3 a0-4 a1-3 a2-3 (the-as sparticle-launch-state #f) (the-as sparticle-launch-control #f) 1.0)
          )
        )
      )
    )
  (none)
  )

(defpart 644
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :page #xc))
    (sp-rnd-flt spt-num 0.0 0.2 1.0)
    (sp-sound (static-sound-spec "debris-fall" :num 0.01 :volume 100.0))
    (sp-rnd-flt spt-scale-x (meters 0.3) (meters 0.1) 1.0)
    (sp-rnd-flt spt-scale-y (meters 1) (meters 0.2) 1.0)
    (sp-rnd-flt spt-r 160.0 16.0 1.0)
    (sp-rnd-flt spt-g 130.0 32.0 1.0)
    (sp-rnd-flt spt-b 110.0 16.0 1.0)
    (sp-rnd-flt spt-a 16.0 16.0 1.0)
    (sp-rnd-flt spt-vel-y (meters 0) (meters -0.0033333334) 1.0)
    (sp-rnd-flt spt-scalevel-x (meters 0.0033333334) (meters 0.0016666667) 1.0)
    (sp-rnd-flt spt-scalevel-y (meters 0) (meters 0.00033333333) 1.0)
    (sp-rnd-flt spt-fade-a -0.042666666 -0.064 1.0)
    (sp-rnd-flt spt-accel-y -1.3653333 -1.3653333 1.0)
    (sp-int spt-timer 250)
    (sp-cpuinfo-flags sp-cpuinfo-flag-2 sp-cpuinfo-flag-12)
    (sp-func spt-func 'check-drop-group-center)
    (sp-rnd-flt spt-rotate-y (degrees 0.0) (degrees 360.0) 1.0)
    )
  )

(defpart 643
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :page #xc))
    (sp-rnd-flt spt-num 0.0 0.2 1.0)
    (sp-rnd-flt spt-scale-x (meters 0.3) (meters 0.1) 1.0)
    (sp-rnd-flt spt-scale-y (meters 1) (meters 0.2) 1.0)
    (sp-rnd-flt spt-r 160.0 16.0 1.0)
    (sp-rnd-flt spt-g 130.0 32.0 1.0)
    (sp-rnd-flt spt-b 110.0 16.0 1.0)
    (sp-rnd-flt spt-a 16.0 16.0 1.0)
    (sp-rnd-flt spt-vel-y (meters 0) (meters -0.0033333334) 1.0)
    (sp-rnd-flt spt-scalevel-x (meters 0.0033333334) (meters 0.0016666667) 1.0)
    (sp-rnd-flt spt-scalevel-y (meters 0) (meters 0.00033333333) 1.0)
    (sp-rnd-flt spt-fade-a -0.042666666 -0.064 1.0)
    (sp-rnd-flt spt-accel-y -1.3653333 -1.3653333 1.0)
    (sp-int spt-timer 750)
    (sp-cpuinfo-flags sp-cpuinfo-flag-2 sp-cpuinfo-flag-12)
    (sp-func spt-func 'check-drop-group-center)
    (sp-rnd-flt spt-rotate-y (degrees 0.0) (degrees 360.0) 1.0)
    )
  )

(defpart 646
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :index #x7 :page #x3e8))
    (sp-func spt-birth-func 'birth-func-texture-group)
    (sp-rnd-flt spt-num 0.5 0.5 1.0)
    (sp-rnd-flt spt-x (meters 0) (meters 1) 1.0)
    (sp-rnd-flt spt-scale-x (meters 0.1) (meters 0.1) 1.0)
    (sp-rnd-flt spt-rot-z (degrees 0.0) (degrees 360.0) 1.0)
    (sp-rnd-flt spt-scale-y (meters 0.1) (meters 0.1) 1.0)
    (sp-rnd-flt spt-r 200.0 55.0 1.0)
    (sp-copy-from-other spt-g -1)
    (sp-copy-from-other spt-b -1)
    (sp-flt spt-a 128.0)
    (sp-rnd-flt spt-vel-y (meters 0.033333335) (meters 0.033333335) 1.0)
    (sp-rnd-flt spt-rotvel-z (degrees -1.2) (degrees 2.4) 1.0)
    (sp-rnd-flt spt-accel-y -8.192 -8.192 1.0)
    (sp-flt spt-friction 0.98)
    (sp-int spt-timer 350)
    (sp-cpuinfo-flags sp-cpuinfo-flag-2 sp-cpuinfo-flag-12)
    (new 'static 'sp-field-init-spec
      :field (sp-field-id spt-userdata)
      :flags (sp-flag plain-v2)
      :object (new 'static 'boxed-array :type int32 40 1 0 #x3e800700 #x3e800800 #x3e800900 #x3e800a00 #x3e800b00)
      )
    (sp-func spt-func 'check-drop-level-flitter-dirt-rubble)
    (sp-rnd-flt spt-conerot-x (degrees 0.0) (degrees 45.0) 1.0)
    (sp-rnd-flt spt-conerot-y (degrees 0.0) (degrees 360.0) 1.0)
    (sp-rnd-flt spt-rotate-y (degrees 0.0) (degrees 360.0) 1.0)
    (sp-flt spt-conerot-radius (meters 0.5))
    )
  )

(defpart 645
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :index #x7 :page #x3e8))
    (sp-func spt-birth-func 'birth-func-texture-group)
    (sp-rnd-flt spt-num 0.1 0.5 1.0)
    (sp-rnd-flt spt-x (meters 0) (meters 1) 1.0)
    (sp-rnd-flt spt-scale-x (meters 0.1) (meters 0.1) 1.0)
    (sp-rnd-flt spt-rot-z (degrees 0.0) (degrees 360.0) 1.0)
    (sp-rnd-flt spt-scale-y (meters 0.1) (meters 0.1) 1.0)
    (sp-rnd-flt spt-r 200.0 55.0 1.0)
    (sp-copy-from-other spt-g -1)
    (sp-copy-from-other spt-b -1)
    (sp-flt spt-a 128.0)
    (sp-rnd-flt spt-vel-y (meters 0.06666667) (meters 0.033333335) 1.0)
    (sp-rnd-flt spt-rotvel-z (degrees -1.2) (degrees 2.4) 1.0)
    (sp-rnd-flt spt-accel-y -8.192 -8.192 1.0)
    (sp-flt spt-friction 0.98)
    (sp-int spt-timer 350)
    (sp-cpuinfo-flags sp-cpuinfo-flag-2 sp-cpuinfo-flag-12)
    (new 'static 'sp-field-init-spec
      :field (sp-field-id spt-userdata)
      :flags (sp-flag plain-v2)
      :object (new 'static 'boxed-array :type int32 40 1 0 #x3e800700 #x3e800800 #x3e800900 #x3e800a00 #x3e800b00)
      )
    (sp-func spt-func 'check-drop-level-flitter-dirt-rubble-ruins)
    (sp-rnd-flt spt-conerot-x (degrees 0.0) (degrees 15.0) 1.0)
    (sp-rnd-flt spt-conerot-y (degrees 0.0) (degrees 360.0) 1.0)
    (sp-rnd-flt spt-rotate-y (degrees 0.0) (degrees 360.0) 1.0)
    (sp-flt spt-conerot-radius (meters 0.1))
    )
  )

(defpart 648
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :index #x7 :page #x3e8))
    (sp-func spt-birth-func 'birth-func-texture-group)
    (sp-rnd-flt spt-num 1.0 2.0 1.0)
    (sp-rnd-flt spt-scale-x (meters 0.05) (meters 0.15) 1.0)
    (sp-rnd-flt spt-rot-z (degrees 0.0) (degrees 360.0) 1.0)
    (sp-rnd-flt spt-scale-y (meters 0.05) (meters 0.15) 1.0)
    (sp-rnd-flt spt-r 200.0 55.0 1.0)
    (sp-copy-from-other spt-g -1)
    (sp-copy-from-other spt-b -1)
    (sp-flt spt-a 128.0)
    (sp-rnd-flt spt-vel-y (meters 0.006666667) (meters 0.026666667) 1.0)
    (sp-rnd-flt spt-rotvel-z (degrees -1.2) (degrees 2.4) 1.0)
    (sp-rnd-flt spt-fade-a -0.42666668 -0.85333335 1.0)
    (sp-flt spt-accel-y -2.7306666)
    (sp-int spt-timer 600)
    (sp-cpuinfo-flags sp-cpuinfo-flag-2 sp-cpuinfo-flag-12)
    (new 'static 'sp-field-init-spec
      :field (sp-field-id spt-userdata)
      :flags (sp-flag plain-v2)
      :object (new 'static 'boxed-array :type int32 40 1 0 #x3e800700 #x3e800800 #x3e800900 #x3e800a00 #x3e800b00)
      )
    (sp-rnd-flt spt-conerot-x (degrees 10.0) (degrees 60.0) 1.0)
    (sp-rnd-flt spt-conerot-y (degrees 0.0) (degrees 360.0) 1.0)
    )
  )

(defpart 649
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :index #x7 :page #x3e8))
    (sp-func spt-birth-func 'birth-func-texture-group)
    (sp-rnd-flt spt-num 1.0 1.0 1.0)
    (sp-rnd-flt spt-scale-x (meters 0.05) (meters 0.15) 1.0)
    (sp-rnd-flt spt-rot-z (degrees 0.0) (degrees 360.0) 1.0)
    (sp-rnd-flt spt-scale-y (meters 0.05) (meters 0.15) 1.0)
    (sp-rnd-flt spt-r 200.0 55.0 1.0)
    (sp-copy-from-other spt-g -1)
    (sp-copy-from-other spt-b -1)
    (sp-flt spt-a 128.0)
    (sp-rnd-flt spt-vel-y (meters 0) (meters 0.04) 1.0)
    (sp-rnd-flt spt-rotvel-z (degrees -1.2) (degrees 2.4) 1.0)
    (sp-rnd-flt spt-friction 0.94 0.02 1.0)
    (sp-int spt-timer 2400)
    (sp-cpuinfo-flags sp-cpuinfo-flag-2 sp-cpuinfo-flag-12)
    (new 'static 'sp-field-init-spec
      :field (sp-field-id spt-userdata)
      :flags (sp-flag plain-v2)
      :object (new 'static 'boxed-array :type int32 40 1 0 #x3e800700 #x3e800800 #x3e800900 #x3e800a00 #x3e800b00)
      )
    (sp-int-plain-rnd spt-next-time 450 149 1)
    (sp-launcher-by-id spt-next-launcher 651)
    (sp-flt spt-conerot-x (degrees 90.0))
    (sp-rnd-flt spt-conerot-y (degrees 0.0) (degrees 360.0) 1.0)
    )
  )

(defpart 651
  :init-specs ((sp-flt spt-rotvel-z (degrees 0.0)) (sp-rnd-flt spt-fade-a -0.10666667 -0.10666667 1.0))
  )

(defpart 650
  :init-specs ((sp-tex spt-texture (new 'static 'texture-id :page #xc))
    (sp-flt spt-num 1.0)
    (sp-sound (static-sound-spec "debris-ground" :num 0.01 :volume 100.0))
    (sp-rnd-flt spt-scale-x (meters 1) (meters 0.5) 1.0)
    (sp-rnd-flt spt-scale-y (meters 0.5) (meters 0.5) 1.0)
    (sp-rnd-flt spt-r 160.0 16.0 1.0)
    (sp-rnd-flt spt-g 130.0 32.0 1.0)
    (sp-rnd-flt spt-b 110.0 16.0 1.0)
    (sp-rnd-flt spt-a 16.0 32.0 1.0)
    (sp-rnd-flt spt-vel-y (meters 0.013333334) (meters 0.026666667) 1.0)
    (sp-rnd-flt spt-scalevel-x (meters 0.0033333334) (meters 0.0016666667) 1.0)
    (sp-rnd-flt spt-scalevel-y (meters 0.0033333334) (meters 0.0016666667) 1.0)
    (sp-rnd-flt spt-fade-a -0.026666667 -0.026666667 1.0)
    (sp-rnd-flt spt-accel-y 0.0 1.3653333 1.0)
    (sp-rnd-flt spt-friction 0.9 0.05 1.0)
    (sp-int spt-timer 2400)
    (sp-cpuinfo-flags sp-cpuinfo-flag-2 sp-cpuinfo-flag-12)
    (sp-rnd-flt spt-conerot-x (degrees 70.0) (degrees 20.0) 1.0)
    (sp-rnd-flt spt-conerot-y (degrees 0.0) (degrees 360.0) 1.0)
    )
  )

(deftype flitter (nav-enemy)
  ((move-angle       float                      :offset-assert 604)
   (heading          basic                      :offset-assert 608)
   (change-dir-time  time-frame                 :offset-assert 616)
   (last-change-dir  uint64                     :offset-assert 624)
   (off-screen-timer uint64                     :offset-assert 632)
   (amb-sound-timer  uint64                     :offset-assert 640)
   (attack-time      time-frame                 :offset-assert 648)
   (target-pos       vector             :inline :offset-assert 656)
   (attack-pos       vector             :inline :offset-assert 672)
   (base-height      float                      :offset-assert 688)
   (minimap          connection-minimap         :offset-assert 692)
   )
  :heap-base #x240
  :method-count-assert 184
  :size-assert         #x2b8
  :flag-assert         #xb8024002b8
  (:methods
    (attack () _type_ :state 178)
    (ambush-jumping () _type_ :state 179)
    (flitter-method-180 (_type_) none 180)
    (flitter-method-181 (_type_) none 181)
    (flitter-method-182 (_type_ process-focusable) symbol 182)
    (flitter-method-183 (_type_) float 183)
    )
  )


(defskelgroup skel-flitter flitter flitter-lod0-jg -1
              ((flitter-lod0-mg (meters 20)) (flitter-lod1-mg (meters 40)) (flitter-lod2-mg (meters 999999)))
              :bounds (static-spherem 0 0 0 5.5)
              :shadow flitter-shadow-mg
              :origin-joint-index 3
              )

(define *flitter-nav-enemy-info*
  (new 'static 'nav-enemy-info
    :use-die-falling #t
    :use-victory #f
    :use-jump-blocked #f
    :debug-draw-neck #f
    :jump-debug-draw #f
    :move-to-ground #t
    :hover-if-no-ground #f
    :idle-anim-script (new 'static 'array idle-control-frame 16
      (new 'static 'idle-control-frame :command (ic-cmd push) :param0 #x1e)
      (new 'static 'idle-control-frame :command (ic-cmd play) :anim #x5 :param0 #x3 :param1 #x6)
      (new 'static 'idle-control-frame :command (ic-cmd push) :param0 #x1e)
      (new 'static 'idle-control-frame :command (ic-cmd play) :anim #x6 :param0 #x1 :param1 #x1)
      (new 'static 'idle-control-frame :command (ic-cmd play) :anim #x7 :param0 #xf :param1 #x1e)
      (new 'static 'idle-control-frame :command (ic-cmd push) :param0 #x1e)
      (new 'static 'idle-control-frame :command (ic-cmd play) :anim #x5 :param0 #x2 :param1 #x4)
      (new 'static 'idle-control-frame :command (ic-cmd push) :param0 #x1e)
      (new 'static 'idle-control-frame :command (ic-cmd play) :anim #x8 :param0 #x1 :param1 #x1)
      (new 'static 'idle-control-frame :command (ic-cmd play) :anim #x9 :param0 #xa :param1 #x14)
      (new 'static 'idle-control-frame :command (ic-cmd push) :param0 #x1e)
      (new 'static 'idle-control-frame :command (ic-cmd play) :anim #x5 :param0 #x1 :param1 #x2)
      (new 'static 'idle-control-frame :command (ic-cmd push) :param0 #x1e)
      (new 'static 'idle-control-frame :command (ic-cmd play) :anim #x8 :param0 #x1 :param1 #x1)
      (new 'static 'idle-control-frame :command (ic-cmd play) :anim #x9 :param0 #xf :param1 #x1e)
      (new 'static 'idle-control-frame)
      )
    :idle-anim 5
    :notice-anim 12
    :hostile-anim 14
    :hit-anim 5
    :knocked-anim 20
    :knocked-land-anim 21
    :die-anim 19
    :die-falling-anim 18
    :victory-anim 5
    :jump-wind-up-anim 5
    :jump-in-air-anim 5
    :jump-land-anim 5
    :neck-joint -1
    :look-at-joint 28
    :bullseye-joint 3
    :sound-hit (static-sound-name "flitter-hit")
    :sound-die (static-sound-name "flitter-die")
    :notice-distance (meters 40)
    :notice-distance-delta (meters 10)
    :proximity-notice-distance (meters 20)
    :default-hit-points 1
    :gnd-collide-with (collide-spec backgnd)
    :overlaps-others-collide-with-filter (collide-spec jak bot player-list)
    :penetrate-knocked #x11fffdffa
    :movement-gravity (meters -100)
    :friction 0.8
    :attack-shove-back (meters 6)
    :attack-shove-up (meters 3)
    :attack-mode 'generic
    :attack-damage 1
    :recover-gnd-collide-with (collide-spec backgnd crate obstacle hit-by-others-list pusher)
    :jump-height-min (meters 3)
    :jump-height-factor 0.5
    :knocked-seek-ry-clamp 2730.6667
    :knocked-soft-vxz-lo 72089.6
    :knocked-soft-vxz-hi 108134.4
    :knocked-soft-vy-lo 81920.0
    :knocked-soft-vy-hi 122880.0
    :knocked-medium-vxz-lo 147456.0
    :knocked-medium-vxz-hi 196608.0
    :knocked-medium-vy-lo 135168.0
    :knocked-medium-vy-hi 151552.0
    :knocked-hard-vxz-lo 78643.2
    :knocked-hard-vxz-hi 117964.8
    :knocked-hard-vy-lo 183500.8
    :knocked-hard-vy-hi 275251.2
    :knocked-huge-vxz-lo 164659.2
    :knocked-huge-vxz-hi 249036.8
    :knocked-huge-vy-lo 183500.8
    :knocked-huge-vy-hi 217907.2
    :knocked-yellow-vxz-lo 40960.0
    :knocked-yellow-vxz-hi 49152.0
    :knocked-yellow-vy-lo 57344.0
    :knocked-yellow-vy-hi 81920.0
    :knocked-red-vxz-lo 24576.0
    :knocked-red-vxz-hi 196608.0
    :knocked-red-vy-lo 94208.0
    :knocked-red-vy-hi 151552.0
    :knocked-blue-vxz-lo 40960.0
    :knocked-blue-vxz-hi 49152.0
    :knocked-blue-vy-lo 24576.0
    :knocked-blue-vy-hi 81920.0
    :shadow-size (meters 2)
    :shadow-max-y (meters 1)
    :shadow-min-y (meters -1)
    :shadow-locus-dist (meters 150)
    :gem-joint 28
    :gem-seg #x2
    :gem-no-seg #x4
    :gem-offset (new 'static 'sphere :y 696.32 :z 1843.2 :r 163840.0)
    :callback-info #f
    :use-momentum #f
    :use-frustration #t
    :use-stop-chase #f
    :use-circling #t
    :use-pacing #t
    :walk-anim 13
    :turn-anim 15
    :run-anim 14
    :taunt-anim -1
    :run-travel-speed (meters 12)
    :run-acceleration (meters 8)
    :run-turning-acceleration (meters 120)
    :walk-travel-speed (meters 4)
    :walk-acceleration (meters 1)
    :walk-turning-acceleration (meters 5)
    :maximum-rotation-rate (degrees 720.0)
    :notice-nav-radius (meters 5)
    :frustration-distance (meters 12)
    :frustration-time (seconds 4)
    :blocked-time (seconds 0.3)
    :circle-dist-lo 20480.0
    :circle-dist-hi 61440.0
    :nav-mesh #f
    )
  )

(set! (-> *flitter-nav-enemy-info* fact-defaults) *fact-info-enemy-defaults*)

(defmethod flitter-method-182 flitter ((obj flitter) (arg0 process-focusable))
  (and (logtest? (-> obj draw status) (draw-control-status on-screen))
       (let ((s4-0 (camera-matrix)))
         (camera-pos)
         (let* ((s3-0 (get-trans arg0 0))
                (s5-1 (vector-normalize-copy! (new 'stack-no-clear 'vector) (-> s4-0 vector 2) 1.0))
                (v1-7 (vector-normalize! (vector-! (new 'stack-no-clear 'vector) (-> obj root-override2 trans) s3-0) 1.0))
                )
           (< 0.0 (vector-dot s5-1 v1-7))
           )
         )
       )
  )

(defmethod enemy-method-77 flitter ((obj flitter) (arg0 (pointer float)))
  (case (-> obj incoming knocked-type)
    (((knocked-type knocked-type-4))
     (let ((a0-2 (-> obj skel root-channel 0)))
       (set! (-> a0-2 frame-group) (the-as art-joint-anim (-> obj draw art-group data 20)))
       (set! (-> a0-2 param 0)
             (the float (+ (-> (the-as art-joint-anim (-> obj draw art-group data 20)) frames num-frames) -1))
             )
       (set! (-> a0-2 param 1) (-> arg0 0))
       (set! (-> a0-2 frame-num) 0.0)
       (joint-control-channel-group! a0-2 (the-as art-joint-anim (-> obj draw art-group data 20)) num-func-seek!)
       )
     #t
     )
    (((knocked-type knocked-type-6))
     (let ((v1-17 (if (> (-> obj skel active-channels) 0)
                      (-> obj skel root-channel 0 frame-group)
                      )
                  )
           )
       (if (and v1-17 (= v1-17 (-> obj draw art-group data 21)))
           (ja-channel-push! 1 (seconds 0.17))
           (ja-channel-push! 1 (seconds 0.02))
           )
       )
     (let ((a0-10 (-> obj skel root-channel 0)))
       (set! (-> a0-10 frame-group) (the-as art-joint-anim (-> obj draw art-group data 23)))
       (set! (-> a0-10 param 0)
             (the float (+ (-> (the-as art-joint-anim (-> obj draw art-group data 23)) frames num-frames) -1))
             )
       (set! (-> a0-10 param 1) 1.0)
       (set! (-> a0-10 frame-num) 0.0)
       (joint-control-channel-group! a0-10 (the-as art-joint-anim (-> obj draw art-group data 23)) num-func-seek!)
       )
     #t
     )
    (else
      ((method-of-type nav-enemy enemy-method-77) obj arg0)
      )
    )
  )

(defmethod enemy-method-78 flitter ((obj flitter) (arg0 (pointer float)))
  (case (-> obj incoming knocked-type)
    (((knocked-type knocked-type-6))
     (when (>= (-> obj incoming blue-juggle-count) (the-as uint 2))
       (let ((v1-4 (-> obj skel root-channel 0)))
         (set! (-> v1-4 frame-group) (the-as art-joint-anim (-> obj draw art-group data 22)))
         (set! (-> v1-4 param 0)
               (the float (+ (-> (the-as art-joint-anim (-> obj draw art-group data 22)) frames num-frames) -1))
               )
         (set! (-> v1-4 param 1) 1.0)
         (set! (-> v1-4 frame-num) 0.0)
         (joint-control-channel-group! v1-4 (the-as art-joint-anim (-> obj draw art-group data 22)) num-func-seek!)
         )
       #t
       )
     )
    (else
      ((method-of-type nav-enemy enemy-method-78) obj arg0)
      )
    )
  )

;; WARN: Return type mismatch object vs none.
(defmethod go-stare2 flitter ((obj flitter))
  (if (and (= (-> obj focus aware) (enemy-aware enemy-aware-2))
           (not (nav-enemy-method-163 obj))
           (not (and (-> obj next-state) (= (-> obj next-state name) 'pacing)))
           )
      (go (method-of-object obj pacing))
      (go (method-of-object obj stare))
      )
  (none)
  )

(defstate ambush (flitter)
  :virtual #t
  :enter (behavior ()
    (when (logtest? (-> self enemy-flags) (enemy-flag auto-reset-penetrate))
      (logclear! (-> self enemy-flags) (enemy-flag auto-reset-penetrate))
      (let ((gp-0 (-> self on-notice)))
        (if gp-0
            (eval!
              (new 'stack 'script-context (the-as basic (process->ppointer self)) self (-> self root-override2 trans))
              (the-as pair gp-0)
              )
            )
        )
      )
    (set! (-> self base-height) (-> self root-override2 trans y))
    (let ((v1-13 (-> self root-override2 root-prim)))
      (set! (-> v1-13 prim-core collide-as) (collide-spec))
      (set! (-> v1-13 prim-core collide-with) (collide-spec))
      )
    0
    (logior! (-> self draw status) (draw-control-status no-draw))
    (none)
    )
  :code (behavior ()
    (let ((gp-0 (get-process *default-dead-pool* part-tracker #x4000)))
      (when gp-0
        (let ((t9-1 (method-of-type part-tracker activate)))
          (t9-1
            (the-as part-tracker gp-0)
            *entity-pool*
            (symbol->string (-> part-tracker symbol))
            (the-as pointer #x70004000)
            )
          )
        (let ((t9-2 run-function-in-process)
              (a0-2 gp-0)
              (a1-2 part-tracker-init)
              (a2-4 (-> *part-group-id-table* 145))
              (a3-1 0)
              (t0-0 #f)
              (t1-0 #f)
              (t2-0 #f)
              (t3-0 *launch-matrix*)
              )
          (set! (-> t3-0 trans quad) (-> self root-override2 trans quad))
          ((the-as (function object object object object object object object object none) t9-2)
           a0-2
           a1-2
           a2-4
           a3-1
           t0-0
           t1-0
           t2-0
           t3-0
           )
          )
        (-> gp-0 ppointer)
        )
      )
    (let ((gp-1 (-> self clock frame-counter)))
      (until (>= (- (-> self clock frame-counter) gp-1) (seconds 0.6))
        (suspend)
        )
      )
    (set! (-> self root-override2 trans y) (+ -8192.0 (-> self root-override2 trans y)))
    (enemy-method-129 self)
    (let ((a0-5 (handle->process (-> self focus handle))))
      (when a0-5
        (let* ((gp-2 (-> self root-override2))
               (s3-0
                 (vector-normalize!
                   (vector-! (new 'stack-no-clear 'vector) (get-trans (the-as process-focusable a0-5) 0) (-> gp-2 trans))
                   1.0
                   )
                 )
               (f0-2 (deg-diff (quaternion-y-angle (-> gp-2 quat)) (vector-y-angle s3-0)))
               )
          (quaternion-rotate-y! (-> gp-2 quat) (-> gp-2 quat) f0-2)
          )
        )
      )
    (let ((gp-3 (-> self clock frame-counter)))
      (until (>= (- (-> self clock frame-counter) gp-3) (the int (* 300.0 (get-rand-float-range self 0.0 0.6))))
        (suspend)
        )
      )
    (logclear! (-> self draw status) (draw-control-status no-draw))
    (go-virtual ambush-jumping)
    (none)
    )
  )

(defstate ambush-jumping (flitter)
  :virtual #t
  :event (the-as (function process int symbol event-message-block object :behavior flitter) enemy-event-handler)
  :enter (behavior ()
    (let ((v1-0 self))
      (if (not (logtest? (enemy-flag enemy-flag36) (-> v1-0 enemy-flags)))
          (set! (-> v1-0 enemy-flags) (the-as enemy-flag (logior (enemy-flag enemy-flag38) (-> v1-0 enemy-flags))))
          )
      (set! (-> v1-0 enemy-flags) (the-as enemy-flag (logior (enemy-flag enemy-flag36) (-> v1-0 enemy-flags))))
      (set! (-> v1-0 nav callback-info) (-> v1-0 enemy-info-override callback-info))
      )
    0
    (let ((v1-3 self))
      (set! (-> v1-3 enemy-flags) (the-as enemy-flag (logior (enemy-flag enemy-flag37) (-> v1-3 enemy-flags))))
      )
    0
    (look-at-target! self (enemy-flag lock-focus))
    (set! (-> self state-time) (-> self clock frame-counter))
    (let ((gp-0 (-> self root-override2)))
      (vector-reset! (-> gp-0 transv))
      (set! (-> gp-0 transv y) (* 4096.0 (get-rand-float-range self 34.0 38.0)))
      )
    (none)
    )
  :code (behavior ()
    (ja-channel-push! 1 (seconds 0.1))
    (ja-no-eval :group! flitter-ambush-jump-ja
                :num! (seek! (the float (+ (-> (the-as art-joint-anim flitter-ambush-jump-ja) frames num-frames) -1)))
                )
    (until #f
      (when (< (-> self base-height) (-> self root-override2 trans y))
        (let ((gp-0 (get-process *default-dead-pool* part-tracker #x4000)))
          (when gp-0
            (let ((t9-3 (method-of-type part-tracker activate)))
              (t9-3
                (the-as part-tracker gp-0)
                *entity-pool*
                (symbol->string (-> part-tracker symbol))
                (the-as pointer #x70004000)
                )
              )
            (let ((t9-4 run-function-in-process)
                  (a0-4 gp-0)
                  (a1-4 part-tracker-init)
                  (a2-5 (-> *part-group-id-table* 144))
                  (a3-1 0)
                  (t0-0 #f)
                  (t1-0 #f)
                  (t2-0 #f)
                  (t3-0 *launch-matrix*)
                  )
              (set! (-> t3-0 trans quad) (-> self root-override2 trans quad))
              ((the-as (function object object object object object object object object none) t9-4)
               a0-4
               a1-4
               a2-5
               a3-1
               t0-0
               t1-0
               t2-0
               t3-0
               )
              )
            (-> gp-0 ppointer)
            )
          )
        (goto cfg-10)
        )
      (suspend)
      (ja :num! (seek!))
      )
    #f
    (until #f
      (when (< (+ 204.8 (-> self base-height)) (-> self root-override2 trans y))
        (let ((v1-40 (-> self root-override2 root-prim)))
          (set! (-> v1-40 prim-core collide-as) (-> self root-override2 backup-collide-as))
          (set! (-> v1-40 prim-core collide-with) (-> self root-override2 backup-collide-with))
          )
        (goto cfg-11)
        )
      (label cfg-10)
      (suspend)
      (ja :num! (seek!))
      )
    #f
    (until #f
      (label cfg-11)
      (if (or (and (>= 0.0 (-> self root-override2 transv y))
                   (>= (+ 1638.4 (-> self base-height)) (-> self root-override2 trans y))
                   )
              (logtest? (-> self root-override2 status) (collide-status on-ground))
              )
          (goto cfg-26)
          )
      (suspend)
      (if (not (ja-done? 0))
          (ja :num! (seek!))
          )
      )
    #f
    (label cfg-26)
    (ja-no-eval :group! flitter-ambush-land-ja
                :num! (seek! (the float (+ (-> (the-as art-joint-anim flitter-ambush-land-ja) frames num-frames) -1)))
                :frame-num 0.0
                )
    (until (ja-done? 0)
      (suspend)
      (ja :num! (seek!))
      )
    (until #f
      (if (logtest? (-> self root-override2 status) (collide-status on-ground))
          (goto cfg-33)
          )
      (suspend)
      )
    #f
    (label cfg-33)
    (go-virtual hostile)
    (none)
    )
  :post (the-as (function none :behavior flitter) nav-enemy-falling-post)
  )

(defmethod enemy-method-99 flitter ((obj flitter) (arg0 process-focusable))
  (logtest? (focus-status mech) (-> arg0 focus-status))
  )

(defmethod flitter-method-180 flitter ((obj flitter))
  (with-pp
    (let* ((s5-0 (handle->process (-> obj focus handle)))
           (s3-0 (if (type? s5-0 process-focusable)
                     (the-as process-focusable s5-0)
                     )
                 )
           )
      (when s3-0
        (let* ((s5-1 (get-trans s3-0 0))
               (s4-1 (vector-! (new 'stack-no-clear 'vector) s5-1 (-> obj root-override2 trans)))
               (f30-0 (vector-length s4-1))
               )
          (cond
            ((enemy-method-99 obj s3-0)
             (go-flee obj)
             )
            ((and (< f30-0 32768.0) (not (flitter-method-182 obj s3-0)))
             (go (method-of-object obj circling))
             )
            ((< f30-0 (-> obj enemy-info-override notice-nav-radius))
             (set! (-> obj target-pos quad) (-> s5-1 quad))
             (let ((s3-1 (new 'stack-no-clear 'vector)))
               (set! (-> s3-1 quad) (-> s4-1 quad))
               (let ((s5-2 (new 'stack-no-clear 'vector)))
                 (set! (-> s5-2 quad) (-> obj root-override2 transv quad))
                 (vector-normalize! s5-2 f30-0)
                 (if (>= (vector-dot s3-1 s5-2) 0.98)
                     (go (method-of-object obj attack))
                     )
                 )
               )
             )
            ((< f30-0 32768.0)
             (set! (-> obj target-pos quad) (-> s5-1 quad))
             )
            ((or (>= (- (-> pp clock frame-counter) (the-as int (-> obj last-change-dir))) (-> obj change-dir-time))
                 (< (vector-vector-distance-squared (-> obj root-override2 trans) (-> obj target-pos)) 0.1)
                 )
             (set! (-> obj last-change-dir) (the-as uint (-> pp clock frame-counter)))
             (set! (-> obj change-dir-time) (rand-vu-int-range (seconds 0.5) (seconds 0.7)))
             (let ((s3-2 (new 'stack-no-clear 'vector))
                   (f0-9 (* 0.5 f30-0 (tan (-> obj move-angle))))
                   (s2-0 (new 'stack-no-clear 'vector))
                   )
               (if (-> obj heading)
                   (set-vector! s3-2 (-> s4-1 z) (-> s4-1 y) (- (-> s4-1 x)) 1.0)
                   (set-vector! s3-2 (- (-> s4-1 z)) (-> s4-1 y) (-> s4-1 x) 1.0)
                   )
               (set! (-> obj heading) (the-as basic (not (-> obj heading))))
               (let ((f28-1 (rand-vu-float-range (* 0.75 f0-9) f0-9))
                     (s4-2 (vector-normalize-copy! (new 'stack-no-clear 'vector) s4-1 (* -0.6 f30-0)))
                     )
                 (vector-normalize! s3-2 f28-1)
                 (vector+! s3-2 s3-2 s4-2)
                 )
               (clamp-vector-to-mesh-cross-gaps (-> obj nav state) s3-2)
               (vector+! s2-0 s5-1 s3-2)
               (set! (-> obj target-pos quad) (-> s2-0 quad))
               )
             )
            )
          )
        0
        )
      )
    0
    (none)
    )
  )

;; WARN: Return type mismatch time-frame vs none.
(defmethod flitter-method-181 flitter ((obj flitter))
  (with-pp
    (when (>= (- (-> pp clock frame-counter) (the-as int (-> obj amb-sound-timer)))
              (the int (* 300.0 (rand-vu-float-range 1.5 3.0)))
              )
      (sound-play "flitter-amb" :position (-> obj root-override2 trans))
      (set! (-> obj amb-sound-timer) (the-as uint (-> pp clock frame-counter)))
      )
    (none)
    )
  )

(defbehavior flitter-fall-and-play-death-anim flitter ((arg0 art-joint-anim) (arg1 float) (arg2 time-frame))
  (local-vars (v1-29 symbol))
  (stop-looking-at-target! self)
  (set! (-> self skel root-channel 0 frame-group) arg0)
  (let ((s4-1 (enemy-method-50 self (new 'stack-no-clear 'vector)))
        (s3-0 (-> self root-override2))
        )
    (when (if (type? s3-0 collide-shape-moving)
              s3-0
              )
      (set! (-> self root-override2 transv y) 33775.48)
      (ja :num-func num-func-identity :frame-num 0.0)
      (set! (-> self state-time) (-> self clock frame-counter))
      (logclear! (-> self root-override2 status) (collide-status on-surface on-ground touch-surface))
      (until v1-29
        (let ((f0-2 102400.0))
          (set! (-> self root-override2 transv x) (* (-> s4-1 x) f0-2))
          (set! (-> self root-override2 transv z) (* (-> s4-1 z) f0-2))
          )
        (suspend)
        (ja :num! (seek! max arg1))
        (set! v1-29 (or (ja-done? 0) (>= (- (-> self clock frame-counter) (-> self state-time)) arg2)))
        )
      )
    )
  0
  (none)
  )

(defstate active (flitter)
  :virtual #t
  :post (behavior ()
    (flitter-method-181 self)
    (let ((t9-1 (-> (method-of-type nav-enemy active) post)))
      (if t9-1
          ((the-as (function none) t9-1))
          )
      )
    (none)
    )
  )

(defstate stare (flitter)
  :virtual #t
  :code (behavior ()
    (ja-channel-push! 1 (seconds 0.1))
    (let ((f30-0 (get-rand-float-range self 0.8 1.2)))
      (until #f
        (when (not (enemy-method-96 self 2730.6667 #t))
          (let ((v1-5 self))
            (set! (-> v1-5 enemy-flags) (the-as enemy-flag (logior (enemy-flag enemy-flag37) (-> v1-5 enemy-flags))))
            )
          0
          (ja-no-eval :num! (loop!))
          (ja-channel-push! 1 (seconds 0.2))
          (ja :group! flitter-turn-ja)
          (ja :num-func num-func-identity :frame-num 0.0)
          (until (enemy-method-96 self 1820.4445 #t)
            (ja-blend-eval)
            (suspend)
            (ja :num! (loop! 0.75))
            )
          (let ((v1-25 self))
            (set! (-> v1-25 enemy-flags) (the-as enemy-flag (logclear (-> v1-25 enemy-flags) (enemy-flag enemy-flag37))))
            )
          0
          )
        (let ((v1-29 (ja-group)))
          (if (not (and v1-29 (= v1-29 (-> self draw art-group data (-> self enemy-info-override idle-anim)))))
              (ja-channel-push! 1 (seconds 0.2))
              )
          )
        (ja-no-eval :group! (-> self draw art-group data (-> self enemy-info-override idle-anim))
                    :num! (seek!
                      (the float
                           (+ (-> (the-as art-joint-anim (-> self draw art-group data (-> self enemy-info-override idle-anim)))
                                  frames
                                  num-frames
                                  )
                              -1
                              )
                           )
                      f30-0
                      )
                    :frame-num 0.0
                    )
        (until (ja-done? 0)
          (suspend)
          (ja :num! (seek! max f30-0))
          )
        )
      )
    #f
    (none)
    )
  :post (behavior ()
    (flitter-method-181 self)
    (let ((t9-1 (-> (method-of-type nav-enemy stare) post)))
      (if t9-1
          ((the-as (function none) t9-1))
          )
      )
    (none)
    )
  )

(defstate circling (flitter)
  :virtual #t
  :enter (behavior ()
    (let ((t9-0 (-> (method-of-type nav-enemy circling) enter)))
      (if t9-0
          (t9-0)
          )
      )
    (set! (-> self off-screen-timer) (the-as uint (-> self clock frame-counter)))
    (none)
    )
  :trans (behavior ()
    (let ((gp-0 (handle->process (-> self focus handle))))
      (if gp-0
          (set! (-> self focus-pos quad) (-> (get-trans (the-as process-focusable gp-0) 0) quad))
          )
      (when (>= (- (-> self clock frame-counter) (-> self state-time)) (seconds 0.1))
        (let ((v1-11 (-> self focus aware)))
          (cond
            ((= v1-11 (enemy-aware enemy-aware-3))
             (cond
               ((when gp-0
                  (let* ((gp-1 self)
                         (s5-1 (method-of-object gp-1 flitter-method-182))
                         (s4-0 (handle->process (-> self focus handle)))
                         )
                    (s5-1 gp-1 (the-as process-focusable (if (type? s4-0 process-focusable)
                                                             s4-0
                                                             )
                                       )
                          )
                    )
                  )
                (if (and (get-enemy-target self)
                         (>= (- (-> self clock frame-counter) (the-as int (-> self off-screen-timer))) (seconds 0.3))
                         )
                    (go-hostile self)
                    )
                )
               (else
                 (set! (-> self off-screen-timer) (the-as uint (-> self clock frame-counter)))
                 )
               )
             )
            ((= v1-11 (enemy-aware enemy-aware-2))
             (go-stare self)
             )
            ((>= 1 (the-as int v1-11))
             (go-virtual active)
             )
            )
          )
        (if (or (nav-enemy-method-163 self) (logtest? (enemy-flag enemy-flag41) (-> self enemy-flags)))
            (go-stare2 self)
            )
        )
      )
    (none)
    )
  :code (behavior ()
    (nav-enemy-method-166 self)
    (ja-channel-push! 1 (seconds 0.2))
    (until #f
      (ja-no-eval :group! (-> self draw art-group data (-> self enemy-info-override run-anim))
                  :num! (seek!
                    (the float
                         (+ (-> (the-as art-joint-anim (-> self draw art-group data (-> self enemy-info-override run-anim)))
                                frames
                                num-frames
                                )
                            -1
                            )
                         )
                    (get-rand-float-range self 0.9 1.1)
                    )
                  :frame-num 0.0
                  )
      (until (ja-done? 0)
        (suspend)
        (ja :num! (seek! max (get-rand-float-range self 0.9 1.1)))
        )
      )
    #f
    (none)
    )
  )

(defstate hostile (flitter)
  :virtual #t
  :enter (behavior ()
    (set! (-> self last-change-dir) (the-as uint (-> self clock frame-counter)))
    (set! (-> self change-dir-time) 0)
    (set! (-> self attack-time) (+ (-> self clock frame-counter) (seconds 0.35)))
    (let ((t9-0 (-> (method-of-type nav-enemy hostile) enter)))
      (if t9-0
          (t9-0)
          )
      )
    (none)
    )
  :trans (behavior ()
    (let ((t9-0 (-> (method-of-type nav-enemy hostile) trans)))
      (if t9-0
          (t9-0)
          )
      )
    (flitter-method-180 self)
    (none)
    )
  :post (behavior ()
    (let ((a0-0 (-> self nav state))
          (v1-1 (-> self target-pos))
          )
      (logclear! (-> a0-0 flags) (nav-state-flag directional-mode))
      (logior! (-> a0-0 flags) (nav-state-flag target-poly-dirty))
      (set! (-> a0-0 target-post quad) (-> v1-1 quad))
      )
    0
    (nav-enemy-travel-post)
    (none)
    )
  )

(defstate die (flitter)
  :virtual #t
  :enter (behavior ()
    (sound-play "flitter-die")
    (let ((t9-2 (-> (method-of-type nav-enemy die) enter)))
      (if t9-2
          (t9-2)
          )
      )
    (none)
    )
  :code (behavior ()
    (ja-channel-push! 1 (seconds 0.2))
    (flitter-fall-and-play-death-anim
      (the-as art-joint-anim (-> self draw art-group data (-> self enemy-info-override die-anim)))
      1.0
      (seconds 2)
      )
    (send-event self 'death-end)
    (cleanup-for-death self)
    (none)
    )
  )

(defmethod flitter-method-183 flitter ((obj flitter))
  (lerp-scale 0.0 1.0 (- (-> obj attack-pos y) (-> obj root-override2 trans y)) 13926.4 25600.0)
  )

(defstate attack (flitter)
  :virtual #t
  :event (the-as (function process int symbol event-message-block object :behavior flitter) enemy-event-handler)
  :enter (behavior ()
    (set! (-> self state-time) (-> self clock frame-counter))
    (let ((v1-2 self))
      (if (not (logtest? (enemy-flag enemy-flag36) (-> v1-2 enemy-flags)))
          (set! (-> v1-2 enemy-flags) (the-as enemy-flag (logior (enemy-flag enemy-flag38) (-> v1-2 enemy-flags))))
          )
      (set! (-> v1-2 enemy-flags) (the-as enemy-flag (logior (enemy-flag enemy-flag36) (-> v1-2 enemy-flags))))
      (set! (-> v1-2 nav callback-info) (-> v1-2 enemy-info-override callback-info))
      )
    0
    (sound-play "flitter-attack")
    (set! (-> self amb-sound-timer) (the-as uint 0))
    (logior! (-> self focus-status) (focus-status dangerous))
    (let* ((v1-8 *game-info*)
           (v0-2 (+ (-> v1-8 attack-id) 1))
           )
      (set! (-> v1-8 attack-id) v0-2)
      (set! (-> self attack-id) v0-2)
      )
    (none)
    )
  :exit (behavior ()
    (if (logtest? (-> self enemy-flags) (enemy-flag check-water))
        (logior! (-> self focus-status) (focus-status dangerous))
        (logclear! (-> self focus-status) (focus-status dangerous))
        )
    (none)
    )
  :trans (behavior ()
    (local-vars (s5-2 none))
    (let* ((s5-0 (handle->process (-> self focus handle)))
           (gp-0 (if (type? s5-0 process-focusable)
                     (the-as process-focusable s5-0)
                     )
                 )
           )
      (set! s5-2 (cond
                   ((and gp-0
                         (< (- (-> self clock frame-counter) (-> self state-time)) (seconds 1.5))
                         gp-0
                         (zero? (logand (-> gp-0 focus-status) (focus-status disable dead ignore grabbed)))
                         )
                    (let ((s5-1 (-> self nav state))
                          (v1-10 (get-trans gp-0 0))
                          )
                      (logclear! (-> s5-1 flags) (nav-state-flag directional-mode))
                      (logior! (-> s5-1 flags) (nav-state-flag target-poly-dirty))
                      (set! (-> s5-1 target-post quad) (-> v1-10 quad))
                      )
                    0
                    (set! s5-2 (the-as none (-> self attack-pos)))
                    (set! (-> (the-as vector s5-2) quad) (-> (get-trans gp-0 3) quad))
                    s5-2
                    )
                   (else
                     (go-stare self)
                     )
                   )
            )
      )
    (none)
    )
  :code (behavior ()
    (ja-channel-push! 2 (seconds 0.1))
    (let ((f30-0 (flitter-method-183 self)))
      (ja-no-eval :group! flitter-attack-ja
                  :num! (seek! (the float (+ (-> (the-as art-joint-anim flitter-attack-ja) frames num-frames) -1)) 0.8)
                  :frame-num 0.0
                  )
      (let ((a0-3 (-> self skel root-channel 1)))
        (set! (-> a0-3 frame-interp 1) f30-0)
        (set! (-> a0-3 frame-interp 0) f30-0)
        (set! (-> a0-3 frame-group) (the-as art-joint-anim flitter-attack-high-ja))
        (set! (-> a0-3 param 0) 0.0)
        (set! (-> a0-3 frame-num) 0.0)
        (joint-control-channel-group! a0-3 (the-as art-joint-anim flitter-attack-high-ja) num-func-chan)
        )
      (until (ja-done? 0)
        (suspend)
        (set! f30-0 (seek f30-0 (flitter-method-183 self) (* 0.2 (-> self clock seconds-per-frame))))
        (ja :num! (seek! max 0.8))
        (let ((a0-7 (-> self skel root-channel 1)))
          (set! (-> a0-7 frame-interp 1) f30-0)
          (set! (-> a0-7 frame-interp 0) f30-0)
          (set! (-> a0-7 param 0) 0.0)
          (joint-control-channel-group-eval! a0-7 (the-as art-joint-anim #f) num-func-chan)
          )
        )
      )
    (let ((v1-40 self))
      (set! (-> v1-40 enemy-flags) (the-as enemy-flag (logclear (-> v1-40 enemy-flags) (enemy-flag enemy-flag36))))
      (set! (-> v1-40 nav callback-info) *nav-enemy-null-callback-info*)
      )
    0
    (ja-channel-push! 1 (seconds 0.1))
    (if (logtest? (-> self enemy-flags) (enemy-flag check-water))
        (logior! (-> self focus-status) (focus-status dangerous))
        (logclear! (-> self focus-status) (focus-status dangerous))
        )
    (dotimes (gp-1 (get-rand-int self 3))
      (ja-no-eval :group! flitter-idle-ja
                  :num! (seek! (the float (+ (-> (the-as art-joint-anim flitter-idle-ja) frames num-frames) -1)))
                  :frame-num 0.0
                  )
      (until (ja-done? 0)
        (suspend)
        (ja :num! (seek!))
        )
      )
    (react-to-focus self)
    (none)
    )
  :post (the-as (function none :behavior flitter) nav-enemy-travel-post)
  )

(defstate victory (flitter)
  :virtual #t
  :post (behavior ()
    (flitter-method-181 self)
    (nav-enemy-simple-post)
    (none)
    )
  )

(defmethod dispose! flitter ((obj flitter))
  "Cleans-up the enemy and any associated resources. Potentially spawns skull gems"
  (when (-> obj minimap)
    (logior! (-> obj minimap flags) (minimap-flag fade-out))
    (set! (-> obj minimap) #f)
    )
  ((the-as (function nav-enemy none) (find-parent-method flitter 132)) obj)
  (none)
  )

(defmethod init-enemy-collision! flitter ((obj flitter))
  "Initializes the [[collide-shape-moving]] and any ancillary tasks to make the enemy collide properly"
  (let ((s5-0 (new 'process 'collide-shape-moving obj (collide-list-enum usually-hit-by-player))))
    (set! (-> s5-0 dynam) (copy *standard-dynamics* 'process))
    (set! (-> s5-0 reaction) cshape-reaction-default)
    (set! (-> s5-0 no-reaction)
          (the-as (function collide-shape-moving collide-query vector vector object) nothing)
          )
    (let ((s4-0 (new 'process 'collide-shape-prim-group s5-0 (the-as uint 3) 0)))
      (set! (-> s5-0 total-prims) (the-as uint 4))
      (set! (-> s4-0 prim-core collide-as) (collide-spec enemy))
      (set! (-> s4-0 prim-core collide-with)
            (collide-spec backgnd jak bot crate obstacle hit-by-others-list player-list)
            )
      (set! (-> s4-0 prim-core action) (collide-action solid can-ride deadly no-standon))
      (set-vector! (-> s4-0 local-sphere) 0.0 10240.0 0.0 15360.0)
      (set! (-> s5-0 root-prim) s4-0)
      )
    (let ((v1-12 (new 'process 'collide-shape-prim-sphere s5-0 (the-as uint 0))))
      (set! (-> v1-12 prim-core collide-as) (collide-spec enemy))
      (set! (-> v1-12 prim-core collide-with)
            (collide-spec backgnd jak bot crate obstacle hit-by-others-list player-list)
            )
      (set! (-> v1-12 prim-core action) (collide-action solid can-ride deadly no-standon))
      (set-vector! (-> v1-12 local-sphere) 0.0 5734.4 0.0 5734.4)
      )
    (let ((v1-14 (new 'process 'collide-shape-prim-sphere s5-0 (the-as uint 0))))
      (set! (-> v1-14 prim-core collide-as) (collide-spec enemy))
      (set! (-> v1-14 prim-core collide-with) (collide-spec jak bot player-list))
      (set! (-> v1-14 prim-core action) (collide-action deadly))
      (set! (-> v1-14 transform-index) 34)
      (set-vector! (-> v1-14 local-sphere) 0.0 0.0 0.0 3481.6)
      )
    (let ((v1-16 (new 'process 'collide-shape-prim-sphere s5-0 (the-as uint 0))))
      (set! (-> v1-16 prim-core collide-as) (collide-spec enemy))
      (set! (-> v1-16 prim-core collide-with) (collide-spec jak bot player-list))
      (set! (-> v1-16 prim-core action) (collide-action deadly))
      (set! (-> v1-16 transform-index) 35)
      (set-vector! (-> v1-16 local-sphere) 0.0 0.0 0.0 3481.6)
      )
    (set! (-> s5-0 nav-radius) 3686.4)
    (let ((v1-18 (-> s5-0 root-prim)))
      (set! (-> s5-0 backup-collide-as) (-> v1-18 prim-core collide-as))
      (set! (-> s5-0 backup-collide-with) (-> v1-18 prim-core collide-with))
      )
    (set! (-> s5-0 max-iteration-count) (the-as uint 3))
    (set! (-> obj root-override2) s5-0)
    )
  0
  (none)
  )

;; WARN: Return type mismatch connection-minimap vs none.
(defmethod init-enemy! flitter ((obj flitter))
  "Common method called to initialize the enemy, typically sets up default field values and calls ancillary helper methods"
  (initialize-skeleton
    obj
    (the-as skeleton-group (art-group-get-by-name *level* "skel-flitter" (the-as (pointer uint32) #f)))
    (the-as pair 0)
    )
  (init-enemy-behaviour-and-stats! obj *flitter-nav-enemy-info*)
  (set! (-> obj move-angle) 10922.667)
  (set! (-> obj heading) (the-as basic (if (= (rand-vu-int-range 0 1) 1)
                                           #t
                                           #f
                                           )
                                 )
        )
  (set! (-> obj change-dir-time) 0)
  (set! (-> obj off-screen-timer) (the-as uint 0))
  (set! (-> obj amb-sound-timer) (the-as uint 0))
  (add-connection
    *part-engine*
    obj
    28
    obj
    318
    (new 'static 'vector :x 942.08 :y -860.16 :z 1269.76 :w 163840.0)
    )
  (add-connection
    *part-engine*
    obj
    28
    obj
    318
    (new 'static 'vector :x -942.08 :y -860.16 :z 1269.76 :w 163840.0)
    )
  (set-gravity-length (-> obj root-override2 dynam) 491520.0)
  (let* ((s4-1 "pebble1-ruins")
         (v1-15 (-> obj level name))
         (s5-2
           (cond
             ((= v1-15 'strip)
              (set! s4-1 "pebble1-strip")
              (new 'static 'boxed-array :type int32 40 1 0 #x4f800500 #x4f800600 #x4f800700 #x4f800800 #x4f800900)
              )
             ((= v1-15 'dig3a)
              (set! s4-1 "pebble1-dig")
              (new 'static 'boxed-array :type int32 40 1 0 -1377828352 -1377828096 -1377827840 -1377827584 -1377827328)
              )
             ((= v1-15 'stadblmp)
              (set! s4-1 "pebble1-dig")
              (new 'static 'boxed-array :type int32 40 1 0 -670040064 -670039808 -670039552 -670039296 -670039040)
              )
             (else
               (new 'static 'boxed-array :type int32 40 1 0 #x3e800700 #x3e800800 #x3e800900 #x3e800a00 #x3e800b00)
               )
             )
           )
         )
    (setup-user-array (-> *part-id-table* 646) s4-1)
    (setup-user-array (-> *part-id-table* 645) s4-1)
    (setup-user-array (-> *part-id-table* 648) s4-1)
    (setup-user-array (-> *part-id-table* 649) s4-1)
    (set! (-> (get-field-spec-by-id (-> *part-id-table* 646) (sp-field-id spt-userdata)) initial-valuef)
          (the-as float s5-2)
          )
    (set! (-> (get-field-spec-by-id (-> *part-id-table* 645) (sp-field-id spt-userdata)) initial-valuef)
          (the-as float s5-2)
          )
    (set! (-> (get-field-spec-by-id (-> *part-id-table* 648) (sp-field-id spt-userdata)) initial-valuef)
          (the-as float s5-2)
          )
    (set! (-> (get-field-spec-by-id (-> *part-id-table* 649) (sp-field-id spt-userdata)) initial-valuef)
          (the-as float s5-2)
          )
    )
  (set! (-> obj minimap) (add-icon! *minimap* obj (the-as uint 70) (the-as int #f) (the-as vector #t) 0))
  (none)
  )
