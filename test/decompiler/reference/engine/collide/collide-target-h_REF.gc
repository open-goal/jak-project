;;-*-Lisp-*-
(in-package goal)

;; definition of type collide-history
(deftype collide-history (structure)
  ((intersect      vector      :inline :offset-assert   0)
   (trans          vector      :inline :offset-assert  16)
   (transv         vector      :inline :offset-assert  32)
   (transv-out     vector      :inline :offset-assert  48)
   (local-normal   vector      :inline :offset-assert  64)
   (surface-normal vector      :inline :offset-assert  80)
   (time           uint64              :offset-assert  96)
   (status         uint64              :offset-assert 104)
   (pat            pat-surface         :offset-assert 112)
   (reaction-flag  uint32              :offset-assert 116)
   )
  :method-count-assert 10
  :size-assert         #x78
  :flag-assert         #xa00000078
  (:methods
    (update! (_type_ collide-shape-moving vector vector vector) _type_ 9)
    )
  )

;; definition for method 3 of type collide-history
(defmethod inspect collide-history ((obj collide-history))
  (format #t "[~8x] ~A~%" obj 'collide-history)
  (format #t "~Tintersect: ~`vector`P~%" (-> obj intersect))
  (format #t "~Ttrans: ~`vector`P~%" (-> obj trans))
  (format #t "~Ttransv: ~`vector`P~%" (-> obj transv))
  (format #t "~Ttransv-out: ~`vector`P~%" (-> obj transv-out))
  (format #t "~Tlocal-normal: ~`vector`P~%" (-> obj local-normal))
  (format #t "~Tsurface-normal: ~`vector`P~%" (-> obj surface-normal))
  (format #t "~Ttime: ~D~%" (-> obj time))
  (format #t "~Tstatus: ~D~%" (-> obj status))
  (format #t "~Tpat: ~D~%" (-> obj pat))
  (format #t "~Treaction-flag: ~D~%" (-> obj reaction-flag))
  obj
  )

;; definition of type control-info
(deftype control-info (collide-shape-moving)
  ((unknown-vector00       vector                    :inline     :offset        448)
   (unknown-vector01       vector                    :inline     :offset        464)
   (unknown-vector02       vector                    :inline     :offset        480)
   (unknown-quaternion00   quaternion                :inline     :offset        496)
   (unknown-quaternion01   quaternion                :inline     :offset        512)
   (unknown-float00        float                                 :offset        528)
   (unknown-float01        float                                 :offset        532)
   (unknown-float02        float                                 :offset        536)
   (unknown-vector10       vector                    :inline     :offset        544)
   (unknown-vector11       vector                    :inline     :offset        560)
   (unknown-vector12       vector                    :inline     :offset        576)
   (unknown-vector13       vector                    :inline     :offset        608)
   (unknown-dynamics00     dynamics                              :offset        656)
   (unknown-surface00      surface                               :offset        660)
   (unknown-surface01      surface                               :offset        664)
   (unknown-cpad-info00    cpad-info                             :offset        668)
   (unknown-float05        float                                 :offset        672)
   (unknown-float06        float                                 :offset        676)
   (unknown-float07        float                                 :offset        680)
   (unknown-float08        float                                 :offset        684)
   (unknown-vector15       vector                    :inline     :offset        688)
   (unknown-vector16       vector                    :inline     :offset        704)
   (unknown-vector17       vector                    :inline     :offset        720)
   (unknown-vector18       vector                    :inline     :offset        736)
   (unknown-vector-array00 vector                    7 :inline   :offset        752)
   (unknown-vector190      vector                    :inline     :offset        880)
   (unknown-vector191      vector                    :inline     :offset        896)
   (unknown-float10        float                                 :offset        912)
   (unknown-float11        float                                 :offset        916)
   (unknown-dword00        uint64                                :offset        920)
   (unknown-matrix00       matrix                    :inline     :offset        928)
   (unknown-matrix01       matrix                    :inline     :offset        992)
   (unknown-matrix02       matrix                    :inline     :offset        1056)
   (unknown-qword10        uint128                               :offset        1136)
   (unknown-float932       float                                 :offset        1140)
   (unknown-vector192      vector                    :inline     :offset        1152)
   (unknown-float12        float                                 :offset        1176)
   (unknown-int328123      int32                                 :offset        1180)
   (unknown-float13        float                                 :offset        1168)
   (unknown-vector20       vector                    :inline     :offset        1184)
   (unknown-vector21       vector                    :inline     :offset        1200)
   (unknown-vector22       vector                    :inline     :offset        1216)
   (unknown-vector23       vector                    :inline     :offset        1232)
   (unknown-vector24       vector                    :inline     :offset        1248)
   (unknown-vector25       vector                    :inline     :offset        1264)
   (unknown-dword10        int64                                 :offset        1288)
   (unknown-float20        float                                 :offset        1300)
   (unknown-float21        float                                 :offset        1304)
   (unknown-float22        float                                 :offset        1308)
   (unknown-float232       float                                 :offset        1312)
   (unknown-float2322      float                                 :offset        1316)
   (unknown-dword11        int64                                 :offset        1320)
   (unknown-dword12        int64                                 :offset        1328)
   (unknown-vector30       vector                    :inline     :offset        1456)
   (unknown-vector31       vector                    :inline     :offset        1504)
   (unknown-float23        float                                 :offset        1520)
   (unknown-vector32       vector                    :inline     :offset        1536)
   (unknown-handle1012     handle                                :offset        1600)
   (unknown-sphere00       collide-shape-prim-sphere             :offset        1608)
   (unknown-sphere01       collide-shape-prim-sphere             :offset        1612)
   (unknown-sphere02       collide-shape-prim-sphere             :offset        1616)
   (unknown-sphere10       collide-shape-prim-sphere             :offset        1632)
   (unknown-sphere20       collide-shape-prim-sphere             :offset        1636)
   (unknown-sphere30       collide-shape-prim-sphere             :offset        1640)
   (unknown-dword20        int64                                 :offset        1672)
   (unknown-dword21        int64                                 :offset        1688)
   (unknown-float30        float                                 :offset        1724)
   (unknown-float31        float                                 :offset        1728)
   (unknown-float32        float                                 :offset        1732)
   (unknown-vector33       vector                    :inline     :offset        1744)
   (unknown-cspace00       cspace                    :inline     :offset        1760)
   (unknown-vector34       vector                    :inline     :offset        1776)
   (unknown-vector35       vector                    :inline     :offset        1792)
   (unknown-vector36       vector                    :inline     :offset        1824)
   (unknown-cspace01       cspace                    :inline     :offset        1808)
   (unknown-symbol20       symbol                                :offset        1840)
   (unknown-float35        float                                 :offset        1844)
   (unknown-vector-array   vector                    16 :inline  :offset        1856)
   (unknown-float356       float                                 :offset        2112)
   (unknown-int21          int32                                 :offset        2116)
   (unknown-float36        float                                 :offset        2120)
   (unknown-vector40       vector                    :inline     :offset        2128)
   (unknown-vector41       vector                    :inline     :offset        2144)
   (unknown-dword22        int64                                 :offset        2160)
   (unknown-dword23        int64                                 :offset        2168)
   (unknown-handle01       handle                                :offset        2176)
   (unknown-int00          int32                                 :offset        2188)
   (unknown-vector42       vector                    :inline     :offset        2320)
   (unknown-vector43       vector                    :inline     :offset        2336)
   (unknown-int10          int32                                 :offset        2384)
   (unknown-dword30        int64                                 :offset        2392)
   (unknown-dword31        int64                                 :offset        2400)
   (unknown-symbol30       symbol                                :offset        2428)
   (unknown-halfword50     int16                                 :offset        2488)
   (history-length         int16                                 :offset        2490)
   (history-data           collide-history           128 :inline :offset-assert 2496)
   (unknown-dword40        int64                                 :offset        18952)
   (unknown-int20          int32                                 :offset        18880)
   (unknown-dword41        int64                                 :offset        18888)
   (unknown-dword42        int64                                 :offset        18896)
   (unknown-dword43        int64                                 :offset        18912)
   (pad                    uint32                    7           :offset-assert 18960)
   )
  :method-count-assert 65
  :size-assert         #x4a2c
  :flag-assert         #x4100004a2c
  )

;; definition for method 9 of type collide-history
;; Used lq/sq
(defmethod
  update!
  collide-history
  ((obj collide-history)
   (cshape collide-shape-moving)
   (xs vector)
   (transv vector)
   (transv-out vector)
   )
  (set! (-> obj intersect quad) (-> xs quad))
  (set! (-> obj transv quad) (-> transv quad))
  (set! (-> obj transv-out quad) (-> transv-out quad))
  (set! (-> obj trans quad) (-> cshape trans quad))
  (set! (-> obj local-normal quad) (-> cshape local-normal quad))
  (set! (-> obj surface-normal quad) (-> cshape surface-normal quad))
  (set! (-> obj time) (-> *display* base-frame-counter))
  (set! (-> obj status) (-> cshape status))
  (set! (-> obj reaction-flag) (-> cshape reaction-flag))
  (set! (-> obj pat) (-> cshape cur-pat))
  obj
  )
