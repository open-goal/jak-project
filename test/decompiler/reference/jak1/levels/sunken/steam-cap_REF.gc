;;-*-Lisp-*-
(in-package goal)

;; definition of type steam-cap-control-pt
(deftype steam-cap-control-pt (structure)
  ((trans   vector  :inline)
   (transv  vector  :inline)
   )
  )

;; definition for method 3 of type steam-cap-control-pt
(defmethod inspect ((this steam-cap-control-pt))
  (format #t "[~8x] ~A~%" this 'steam-cap-control-pt)
  (format #t "~Ttrans: #<vector @ #x~X>~%" (-> this trans))
  (format #t "~Ttransv: #<vector @ #x~X>~%" (-> this transv))
  this
  )

;; definition of type steam-cap
(deftype steam-cap (process-drawable)
  ((root               collide-shape-moving :override)
   (do-burst?          symbol)
   (do-falling-sound?  symbol)
   (do-landing-sound?  symbol)
   (begin-travel-up    float)
   (begin-travel-down  float)
   (sync               sync-info             :inline)
   (part2              sparticle-launch-control)
   (part3              sparticle-launch-control)
   (down               vector                :inline)
   (up                 vector                :inline)
   (control-pt         steam-cap-control-pt  3 :inline)
   )
  (:methods
    (steam-cap-method-20 (_type_) none)
    (steam-cap-method-21 (_type_) quaternion)
    )
  (:states
    steam-cap-idle
    )
  )

;; definition for method 3 of type steam-cap
(defmethod inspect ((this steam-cap))
  (let ((t9-0 (method-of-type process-drawable inspect)))
    (t9-0 this)
    )
  (format #t "~T~Tdo-burst?: ~A~%" (-> this do-burst?))
  (format #t "~T~Tdo-falling-sound?: ~A~%" (-> this do-falling-sound?))
  (format #t "~T~Tdo-landing-sound?: ~A~%" (-> this do-landing-sound?))
  (format #t "~T~Tbegin-travel-up: ~f~%" (-> this begin-travel-up))
  (format #t "~T~Tbegin-travel-down: ~f~%" (-> this begin-travel-down))
  (format #t "~T~Tsync: #<sync-info @ #x~X>~%" (-> this sync))
  (format #t "~T~Tpart2: ~A~%" (-> this part2))
  (format #t "~T~Tpart3: ~A~%" (-> this part3))
  (format #t "~T~Tdown: #<vector @ #x~X>~%" (-> this down))
  (format #t "~T~Tup: #<vector @ #x~X>~%" (-> this up))
  (format #t "~T~Tcontrol-pt[3] @ #x~X~%" (-> this control-pt))
  this
  )

;; failed to figure out what this is:
(defpartgroup group-steam-cap-sides
  :id 441
  :bounds (static-bspherem 0 0 0 10)
  :parts ((sp-item 1718 :fade-after (meters 100) :falloff-to (meters 160) :period (seconds 0.6) :length (seconds 0.25))
    (sp-item 1719 :fade-after (meters 100) :falloff-to (meters 160) :period (seconds 0.6) :length (seconds 0.25) :offset 60)
    (sp-item 1720 :fade-after (meters 100) :falloff-to (meters 160) :period (seconds 0.6) :length (seconds 0.25) :offset 120)
    (sp-item 1721 :fade-after (meters 100) :falloff-to (meters 160) :period (seconds 0.6) :length (seconds 0.25))
    (sp-item 1722 :fade-after (meters 100) :falloff-to (meters 160) :period (seconds 0.6) :length (seconds 0.25) :offset 60)
    (sp-item 1723 :fade-after (meters 100) :falloff-to (meters 160) :period (seconds 0.6) :length (seconds 0.25) :offset 120)
    (sp-item 1724 :fade-after (meters 60) :falloff-to (meters 60) :period (seconds 0.6) :length (seconds 0.25) :offset 120)
    )
  )

;; failed to figure out what this is:
(defpart 1724
  :init-specs ((:num 1.0)
    (:rot-x 5)
    (:r 4096.0)
    (:g 2867.2)
    (:b 3276.8)
    (:vel-y (meters 0.016666668) (meters 0.033333335))
    (:accel-y (meters 0.000033333334))
    (:friction 0.92 0.02)
    (:timer (seconds 1))
    (:flags (aux-list))
    (:next-time (seconds 0.5))
    (:next-launcher 1725)
    (:conerot-x (degrees 90))
    (:conerot-y (degrees 0) (degrees 360))
    (:conerot-radius (meters 2.5))
    )
  )

;; failed to figure out what this is:
(defpart 1725
  :init-specs ((:fade-b -2.7306666))
  )

;; failed to figure out what this is:
(defpart 1718
  :init-specs ((:texture (bigpuff effects))
    (:num 0.0 2.0)
    (:y (meters -0.5))
    (:scale-x (meters 0.5) (meters 1.5))
    (:rot-z (degrees 0) (degrees 360))
    (:scale-y :copy scale-x)
    (:r 128.0)
    (:g 128.0)
    (:b 128.0)
    (:a 0.0 16.0)
    (:vel-y (meters 0.016666668) (meters 0.033333335))
    (:scalevel-x (meters 0.01))
    (:rotvel-z (degrees -0.2) (degrees 0.4))
    (:scalevel-y :copy scalevel-x)
    (:fade-a 0.10666667)
    (:accel-y (meters 0.000033333334))
    (:friction 0.92 0.02)
    (:timer (seconds 1))
    (:flags (bit2 bit3))
    (:next-time (seconds 0.5))
    (:next-launcher 1726)
    (:conerot-x (degrees 90))
    (:conerot-y (degrees 0) (degrees 120))
    (:conerot-radius (meters 2.5))
    )
  )

;; failed to figure out what this is:
(defpart 1721
  :init-specs ((:texture (bigpuff effects))
    (:num 0.0 2.0)
    (:y (meters -0.5))
    (:scale-x (meters 0.5) (meters 1.5))
    (:rot-z (degrees 0) (degrees 360))
    (:scale-y :copy scale-x)
    (:r 128.0)
    (:g 128.0)
    (:b 128.0)
    (:a 0.0 16.0)
    (:vel-y (meters 0.016666668) (meters 0.033333335))
    (:scalevel-x (meters 0.01))
    (:rotvel-z (degrees -0.2) (degrees 0.4))
    (:scalevel-y :copy scalevel-x)
    (:fade-a 0.10666667)
    (:accel-y (meters 0.000033333334))
    (:friction 0.92 0.02)
    (:timer (seconds 1))
    (:flags (bit2))
    (:next-time (seconds 0.5))
    (:next-launcher 1726)
    (:conerot-x (degrees 90))
    (:conerot-y (degrees 0) (degrees 120))
    (:conerot-radius (meters 2.5))
    )
  )

;; failed to figure out what this is:
(defpart 1719
  :init-specs ((:texture (bigpuff effects))
    (:num 0.0 2.0)
    (:y (meters -0.5))
    (:scale-x (meters 0.5) (meters 1.5))
    (:rot-z (degrees 0) (degrees 360))
    (:scale-y :copy scale-x)
    (:r 128.0)
    (:g 128.0)
    (:b 128.0)
    (:a 0.0 16.0)
    (:vel-y (meters 0.016666668) (meters 0.033333335))
    (:scalevel-x (meters 0.01))
    (:rotvel-z (degrees -0.2) (degrees 0.4))
    (:scalevel-y :copy scalevel-x)
    (:fade-a 0.10666667)
    (:accel-y (meters 0.000033333334))
    (:friction 0.92 0.02)
    (:timer (seconds 1))
    (:flags (bit2 bit3))
    (:next-time (seconds 0.5))
    (:next-launcher 1726)
    (:conerot-x (degrees 90))
    (:conerot-y (degrees 120) (degrees 120))
    (:conerot-radius (meters 2.5))
    )
  )

;; failed to figure out what this is:
(defpart 1722
  :init-specs ((:texture (bigpuff effects))
    (:num 0.0 2.0)
    (:y (meters -0.5))
    (:scale-x (meters 0.5) (meters 1.5))
    (:rot-z (degrees 0) (degrees 360))
    (:scale-y :copy scale-x)
    (:r 128.0)
    (:g 128.0)
    (:b 128.0)
    (:a 0.0 16.0)
    (:vel-y (meters 0.016666668) (meters 0.033333335))
    (:scalevel-x (meters 0.01))
    (:rotvel-z (degrees -0.2) (degrees 0.4))
    (:scalevel-y :copy scalevel-x)
    (:fade-a 0.10666667)
    (:accel-y (meters 0.000033333334))
    (:friction 0.92 0.02)
    (:timer (seconds 1))
    (:flags (bit2))
    (:next-time (seconds 0.5))
    (:next-launcher 1726)
    (:conerot-x (degrees 90))
    (:conerot-y (degrees 120) (degrees 120))
    (:conerot-radius (meters 2.5))
    )
  )

;; failed to figure out what this is:
(defpart 1720
  :init-specs ((:texture (bigpuff effects))
    (:num 0.0 2.0)
    (:y (meters -0.5))
    (:scale-x (meters 0.5) (meters 1.5))
    (:rot-z (degrees 0) (degrees 360))
    (:scale-y :copy scale-x)
    (:r 128.0)
    (:g 128.0)
    (:b 128.0)
    (:a 0.0 16.0)
    (:vel-y (meters 0.016666668) (meters 0.033333335))
    (:scalevel-x (meters 0.01))
    (:rotvel-z (degrees -0.2) (degrees 0.4))
    (:scalevel-y :copy scalevel-x)
    (:fade-a 0.10666667)
    (:accel-y (meters 0.000033333334))
    (:friction 0.92 0.02)
    (:timer (seconds 1))
    (:flags (bit2 bit3))
    (:next-time (seconds 0.5))
    (:next-launcher 1726)
    (:conerot-x (degrees 90))
    (:conerot-y (degrees 240) (degrees 120))
    (:conerot-radius (meters 2.5))
    )
  )

;; failed to figure out what this is:
(defpart 1723
  :init-specs ((:texture (bigpuff effects))
    (:num 0.0 2.0)
    (:y (meters -0.5))
    (:scale-x (meters 0.5) (meters 1.5))
    (:rot-z (degrees 0) (degrees 360))
    (:scale-y :copy scale-x)
    (:r 128.0)
    (:g 128.0)
    (:b 128.0)
    (:a 0.0 16.0)
    (:vel-y (meters 0.016666668) (meters 0.033333335))
    (:scalevel-x (meters 0.01))
    (:rotvel-z (degrees -0.2) (degrees 0.4))
    (:scalevel-y :copy scalevel-x)
    (:fade-a 0.10666667)
    (:accel-y (meters 0.000033333334))
    (:friction 0.92 0.02)
    (:timer (seconds 1))
    (:flags (bit2))
    (:next-time (seconds 0.5))
    (:next-launcher 1726)
    (:conerot-x (degrees 90))
    (:conerot-y (degrees 240) (degrees 120))
    (:conerot-radius (meters 2.5))
    )
  )

;; failed to figure out what this is:
(defpart 1726
  :init-specs ((:fade-a -0.21333334))
  )

;; failed to figure out what this is:
(defpartgroup group-steam-cap-plume
  :id 442
  :bounds (static-bspherem 0 0 0 32)
  :parts ((sp-item 1727 :fade-after (meters 120) :falloff-to (meters 160))
    (sp-item 1728 :fade-after (meters 120) :falloff-to (meters 160))
    (sp-item 1729 :fade-after (meters 60) :falloff-to (meters 60))
    (sp-item 1730 :fade-after (meters 60) :falloff-to (meters 60) :flags (start-dead))
    )
  )

;; failed to figure out what this is:
(defpartgroup group-steam-cap-plume-spread
  :id 443
  :bounds (static-bspherem 0 0 0 32)
  :parts ((sp-item 1731 :fade-after (meters 120) :falloff-to (meters 160))
    (sp-item 1732 :fade-after (meters 120) :falloff-to (meters 160))
    )
  )

;; failed to figure out what this is:
(defpart 1730
  :init-specs ((:num 0.4)
    (:rot-x 5)
    (:r 6144.0)
    (:g 2867.2)
    (:b 3276.8)
    (:vel-y (meters 0.016666668) (meters 0.033333335))
    (:accel-y (meters 0.000033333334))
    (:friction 0.94 0.02)
    (:timer (seconds 1))
    (:flags (aux-list))
    (:next-time (seconds 0.5))
    (:next-launcher 1725)
    (:conerot-x (degrees 90))
    (:conerot-y (degrees 0) (degrees 360))
    (:conerot-radius (meters 2.5))
    )
  )

;; failed to figure out what this is:
(defpart 1732
  :init-specs ((:texture (bigpuff effects))
    (:num 0.5)
    (:y (meters -0.5))
    (:scale-x (meters 1) (meters 1))
    (:rot-z (degrees 0) (degrees 360))
    (:scale-y :copy scale-x)
    (:r 128.0)
    (:g 128.0)
    (:b 128.0)
    (:a 16.0 32.0)
    (:vel-y (meters 0.026666667) (meters 0.026666667))
    (:scalevel-x (meters 0.013333334))
    (:rotvel-z (degrees -0.2) (degrees 0.4))
    (:scalevel-y :copy scalevel-x)
    (:accel-y (meters 0.000033333334))
    (:friction 0.92 0.02)
    (:timer (seconds 1))
    (:flags (bit2 bit3))
    (:next-time (seconds 0.5))
    (:next-launcher 1735)
    (:conerot-x (degrees 90) (degrees 15))
    (:conerot-y (degrees 0) (degrees 360))
    (:conerot-radius (meters 0.5))
    )
  )

;; failed to figure out what this is:
(defpart 1731
  :init-specs ((:texture (bigpuff effects))
    (:num 0.5)
    (:y (meters -0.5))
    (:scale-x (meters 1) (meters 1))
    (:rot-z (degrees 0) (degrees 360))
    (:scale-y :copy scale-x)
    (:r 128.0)
    (:g 128.0)
    (:b 128.0)
    (:a 16.0 32.0)
    (:vel-y (meters 0.026666667) (meters 0.026666667))
    (:scalevel-x (meters 0.013333334))
    (:rotvel-z (degrees -0.2) (degrees 0.4))
    (:scalevel-y :copy scalevel-x)
    (:accel-y (meters 0.000033333334))
    (:friction 0.92 0.02)
    (:timer (seconds 1))
    (:flags (bit2))
    (:next-time (seconds 0.5))
    (:next-launcher 1735)
    (:conerot-x (degrees 90) (degrees 15))
    (:conerot-y (degrees 0) (degrees 360))
    (:conerot-radius (meters 0.5))
    )
  )

;; failed to figure out what this is:
(defpart 1735
  :init-specs ((:fade-a -0.32))
  )

;; failed to figure out what this is:
(defpart 1727
  :init-specs ((:texture (bigpuff effects))
    (:num 0.5 0.5)
    (:x (meters 0) (meters 1))
    (:y (meters -1))
    (:scale-x (meters 2) (meters 2))
    (:rot-z (degrees 0) (degrees 360))
    (:scale-y :copy scale-x)
    (:r 128.0)
    (:g 128.0)
    (:b 128.0)
    (:a 16.0 16.0)
    (:vel-y (meters 0.053333335))
    (:rotvel-z (degrees -0.2) (degrees 0.4))
    (:accel-y (meters 0.00066666666))
    (:timer (seconds 0.51))
    (:flags (bit2))
    (:conerot-x (degrees 0) (degrees 15))
    (:rotate-y (degrees 0) (degrees 360))
    )
  )

;; failed to figure out what this is:
(defpart 1728
  :init-specs ((:texture (bigpuff effects))
    (:num 0.5 0.5)
    (:x (meters 0) (meters 0.5))
    (:y (meters -1))
    (:scale-x (meters 2) (meters 2))
    (:rot-z (degrees 0) (degrees 360))
    (:scale-y :copy scale-x)
    (:r 128.0)
    (:g 128.0)
    (:b 128.0)
    (:a 32.0 32.0)
    (:vel-y (meters 0.053333335))
    (:rotvel-z (degrees -0.2) (degrees 0.4))
    (:accel-y (meters 0.00066666666))
    (:timer (seconds 0.51))
    (:flags (bit2 bit3))
    (:rotate-y (degrees 0) (degrees 360))
    )
  )

;; failed to figure out what this is:
(defpart 1729
  :init-specs ((:num 0.5)
    (:x (meters 0.5) (meters 0.5))
    (:rot-x 5)
    (:r 6144.0)
    (:g 2457.6)
    (:b 3276.8)
    (:vel-y (meters 0.053333335))
    (:timer (seconds 0.51))
    (:flags (aux-list))
    (:rotate-y (degrees 0) (degrees 360))
    )
  )

;; failed to figure out what this is:
(defskelgroup *steam-cap-sg* steam-cap steam-cap-lod0-jg steam-cap-idle-ja
              ((steam-cap-lod0-mg (meters 999999)))
              :bounds (static-spherem 0 0 0 3)
              )

;; definition for method 20 of type steam-cap
;; INFO: Return type mismatch object vs none.
(defmethod steam-cap-method-20 ((this steam-cap))
  (when *target*
    (let* ((a1-0 (target-pos 0))
           (f0-0 (-> a1-0 y))
           )
      (when (and (>= f0-0 (+ -8192.0 (-> this down y)))
                 (and (>= (+ -4096.0 (-> this root trans y)) f0-0) (zero? (-> this root riders num-riders)))
                 )
        (let ((f0-1 (vector-vector-xz-distance-squared (-> this down) a1-0)))
          (when (>= 104857600.0 f0-1)
            (let ((s5-0 (>= 37748736.0 f0-1)))
              (when (not s5-0)
                (when (>= (- (-> this root trans y) (-> this down y)) 3072.0)
                  (let ((a1-1 (new 'stack-no-clear 'vector)))
                    (set! (-> a1-1 x) (the-as float 1))
                    (set! (-> a1-1 y) (the-as float #f))
                    (if (find-overlapping-shapes (-> this root) (the-as overlaps-others-params a1-1))
                        (set! s5-0 #t)
                        )
                    )
                  )
                )
              (if s5-0
                  (send-event *target* 'shove #f (static-attack-info ((shove-up (meters 0.5)) (shove-back (meters 1.5)))))
                  )
              )
            )
          )
        )
      )
    )
  (none)
  )

;; definition for method 21 of type steam-cap
;; INFO: Used lq/sq
(defmethod steam-cap-method-21 ((this steam-cap))
  (local-vars (at-0 int) (at-1 int) (s5-0 symbol))
  (rlet ((vf0 :class vf)
         (vf1 :class vf)
         (vf2 :class vf)
         )
    (init-vf0-vector)
    (let ((f0-0 (get-current-phase (-> this sync))))
      #t
      (cond
        ((< f0-0 (-> this begin-travel-up))
         (let ((f30-0 (/ f0-0 (-> this begin-travel-up))))
           (set! s5-0 #t)
           (dotimes (s4-0 3)
             (let ((s3-0 (-> this control-pt s4-0)))
               (when (= (-> s3-0 trans y) (-> this down y))
                 (set! (-> this do-burst?) #t)
                 (let ((a0-2 (+ (the int (* 60.0 (- 1.0 f30-0))) 3)))
                   (if (zero? (rand-vu-int-count a0-2))
                       (+! (-> s3-0 transv y) (* (rand-vu-float-range 40960.0 57344.0) f30-0))
                       )
                   )
                 )
               )
             )
           (let ((a0-4 (+ (the int (* 60.0 (- 1.0 f30-0))) 1)))
             (if (zero? (rand-vu-int-count a0-4))
                 (spawn (-> this part) (-> this down))
                 )
             )
           )
         )
        ((< f0-0 (-> this begin-travel-down))
         (let ((f30-1 (/ (- f0-0 (-> this begin-travel-up)) (- (-> this begin-travel-down) (-> this begin-travel-up)))))
           (set! s5-0 #f)
           (set! (-> this do-falling-sound?) #t)
           (when (-> this do-burst?)
             (sound-play "sunk-top-rises")
             (set! (-> this do-burst?) #f)
             (spawn (-> this part) (-> this down))
             (spawn (-> this part) (-> this down))
             (spawn (-> this part) (-> this down))
             (spawn (-> this part) (-> this down))
             )
           (when (< f30-1 0.94)
             (spawn (-> this part2) (-> this down))
             (let ((a1-8 (new 'stack-no-clear 'vector)))
               (set! (-> a1-8 quad) (-> this root trans quad))
               (+! (-> a1-8 y) -3072.0)
               (spawn (-> this part3) a1-8)
               )
             )
           )
         )
        (else
          (set! s5-0 #t)
          (when (-> this do-falling-sound?)
            (set! (-> this do-falling-sound?) #f)
            (sound-play "sunk-top-falls")
            )
          )
        )
      )
    (dotimes (s4-3 3)
      (let ((s2-0 (-> this control-pt s4-3))
            (s3-3 (new 'stack-no-clear 'vector))
            )
        (set! (-> s3-3 quad) (-> s2-0 trans quad))
        (cond
          (s5-0
            (+! (-> s2-0 transv y) (* -819200.0 (seconds-per-frame)))
            (let ((a1-10 s3-3)
                  (v1-42 s3-3)
                  (a0-21 (new 'stack-no-clear 'vector))
                  )
              (.lvf vf1 (&-> (-> s2-0 transv) quad))
              (let ((f0-17 (seconds-per-frame)))
                (.mov at-0 f0-17)
                )
              (.mov vf2 at-0)
              (.mov.vf vf1 vf0 :mask #b1000)
              (.mul.x.vf vf1 vf1 vf2 :mask #b111)
              (.svf (&-> a0-21 quad) vf1)
              (vector+! a1-10 v1-42 a0-21)
              )
            (when (< (-> s3-3 y) (-> this down y))
              (when (-> this do-landing-sound?)
                (set! (-> this do-landing-sound?) #f)
                (sound-play "sunk-top-lands")
                )
              (set! (-> s3-3 y) (-> this down y))
              (let ((f0-20 (-> s2-0 transv y)))
                (when (< f0-20 0.0)
                  (let ((f0-22 (* 0.3 (- f0-20))))
                    (set! (-> s2-0 transv y) f0-22)
                    (if (< 7782.4 f0-22)
                        (sound-play "sunk-top-lands" :vol 60)
                        )
                    )
                  )
                )
              )
            )
          (else
            (set! (-> this do-landing-sound?) #t)
            (let ((f0-24 (* 0.000048828126 (- (-> this up y) (-> s2-0 trans y)))))
              (cond
                ((< 1.0 f0-24)
                 (set! f0-24 1.0)
                 )
                ((< f0-24 -1.0)
                 (set! f0-24 -1.0)
                 )
                )
              (+! (-> s2-0 transv y) (* 819200.0 (seconds-per-frame) f0-24))
              (let ((f1-24 (-> s2-0 transv y)))
                (when (< 122880.0 (fabs f1-24))
                  (if (>= f1-24 0.0)
                      (set! (-> s2-0 transv y) 122880.0)
                      (set! (-> s2-0 transv y) -122880.0)
                      )
                  )
                )
              (let ((a1-14 s3-3)
                    (v1-61 s3-3)
                    (a0-26 (new 'stack-no-clear 'vector))
                    )
                (.lvf vf1 (&-> (-> s2-0 transv) quad))
                (let ((f1-27 (seconds-per-frame)))
                  (.mov at-1 f1-27)
                  )
                (.mov vf2 at-1)
                (.mov.vf vf1 vf0 :mask #b1000)
                (.mul.x.vf vf1 vf1 vf2 :mask #b111)
                (.svf (&-> a0-26 quad) vf1)
                (vector+! a1-14 v1-61 a0-26)
                )
              (let ((f1-29 (- (-> this up y) (-> s3-3 y)))
                    (v1-62 (>= f0-24 0.0))
                    )
                (when (!= v1-62 (>= f1-29 0.0))
                  (let ((f0-26 (-> s2-0 transv y)))
                    (when (< 40960.0 (fabs f0-26))
                      (if (>= f0-26 0.0)
                          (set! (-> s2-0 transv y) 40960.0)
                          (set! (-> s2-0 transv y) -40960.0)
                          )
                      )
                    )
                  (set! (-> s2-0 transv y) (* 0.8 (-> s2-0 transv y)))
                  )
                )
              )
            )
          )
        (set! (-> s2-0 trans quad) (-> s3-3 quad))
        )
      )
    (let ((f0-31 0.0))
      (dotimes (v1-71 3)
        (+! f0-31 (-> this control-pt v1-71 trans y))
        )
      (let ((f0-32 (/ f0-31 3))
            (a1-16 (new 'stack-no-clear 'vector))
            )
        (set! (-> a1-16 quad) (-> this root trans quad))
        (set! (-> a1-16 y) f0-32)
        (move-to-point! (-> this root) a1-16)
        )
      )
    (let ((v1-77 (new 'stack-no-clear 'vector))
          (a0-35 (new 'stack-no-clear 'vector))
          (s5-1 (new 'stack-no-clear 'vector))
          )
      (vector-! v1-77 (the-as vector (&-> this stack 176)) (the-as vector (-> this control-pt)))
      (vector-! a0-35 (the-as vector (&-> this stack 208)) (the-as vector (-> this control-pt)))
      (vector-cross! s5-1 v1-77 a0-35)
      (vector-normalize! s5-1 1.0)
      (forward-up-nopitch->quaternion
        (-> this root quat)
        (vector-z-quaternion! (new-stack-vector0) (-> this root quat))
        s5-1
        )
      )
    )
  )

;; failed to figure out what this is:
(defstate steam-cap-idle (steam-cap)
  :trans rider-trans
  :code (behavior ()
    (loop
      (steam-cap-method-20 self)
      (steam-cap-method-21 self)
      (suspend)
      )
    )
  :post rider-post
  )

;; definition for method 7 of type steam-cap
(defmethod relocate ((this steam-cap) (offset int))
  (if (nonzero? (-> this part2))
      (&+! (-> this part2) offset)
      )
  (if (nonzero? (-> this part3))
      (&+! (-> this part3) offset)
      )
  (call-parent-method this offset)
  )

;; definition for method 10 of type steam-cap
(defmethod deactivate ((this steam-cap))
  (if (nonzero? (-> this part2))
      (kill-and-free-particles (-> this part2))
      )
  (if (nonzero? (-> this part3))
      (kill-and-free-particles (-> this part3))
      )
  ((method-of-type process-drawable deactivate) this)
  (none)
  )

;; definition for method 11 of type steam-cap
;; INFO: Used lq/sq
;; INFO: Return type mismatch object vs none.
(defmethod init-from-entity! ((this steam-cap) (arg0 entity-actor))
  (local-vars (sv-16 res-tag))
  (logior! (-> this mask) (process-mask platform))
  (let ((s4-0 (new 'process 'collide-shape-moving this (collide-list-enum hit-by-player))))
    (set! (-> s4-0 dynam) (copy *standard-dynamics* 'process))
    (set! (-> s4-0 reaction) default-collision-reaction)
    (set! (-> s4-0 no-reaction)
          (the-as (function collide-shape-moving collide-shape-intersect vector vector none) nothing)
          )
    (alloc-riders s4-0 1)
    (let ((s3-0 (new 'process 'collide-shape-prim-mesh s4-0 (the-as uint 0) (the-as uint 0))))
      (set! (-> s3-0 prim-core collide-as) (collide-kind ground-object))
      (set! (-> s3-0 collide-with) (collide-kind target))
      (set! (-> s3-0 prim-core action) (collide-action solid rider-plat-sticky))
      (set! (-> s3-0 prim-core offense) (collide-offense indestructible))
      (set! (-> s3-0 transform-index) 4)
      (set-vector! (-> s3-0 local-sphere) 0.0 0.0 0.0 12288.0)
      (set-root-prim! s4-0 s3-0)
      )
    (set! (-> s4-0 nav-radius) (* 0.75 (-> s4-0 root-prim local-sphere w)))
    (backup-collide-with-as s4-0)
    (set! (-> this root) s4-0)
    )
  (set! (-> this do-burst?) #f)
  (set! (-> this do-falling-sound?) #f)
  (set! (-> this do-landing-sound?) #f)
  (process-drawable-from-entity! this arg0)
  (initialize-skeleton this *steam-cap-sg* '())
  (logior! (-> this skel status) (janim-status inited))
  (ja-channel-set! 1)
  (let ((s4-1 (-> this skel root-channel 0)))
    (joint-control-channel-group-eval!
      s4-1
      (the-as art-joint-anim (-> this draw art-group data 2))
      num-func-identity
      )
    (set! (-> s4-1 frame-num) 0.0)
    )
  (update-transforms! (-> this root))
  (load-params! (-> this sync) this (the-as uint 1800) 0.0 0.15 0.15)
  (let ((f30-0 0.4)
        (f28-0 0.9)
        )
    (set! sv-16 (new 'static 'res-tag))
    (let ((v1-36 (res-lump-data arg0 'percent (pointer float) :tag-ptr (& sv-16))))
      (when v1-36
        (set! f30-0 (-> v1-36 0))
        (set! f28-0 (-> v1-36 1))
        (if (>= 0.01 f30-0)
            (set! f30-0 0.01)
            )
        (if (>= 0.01 f28-0)
            (set! f28-0 0.01)
            )
        (if (>= f30-0 f28-0)
            (set! f28-0 (+ 0.01 f30-0))
            )
        (when (>= f30-0 1.0)
          (set! f28-0 (* 0.9 (/ f28-0 f30-0)))
          (set! f30-0 0.9)
          )
        )
      )
    (set! (-> this begin-travel-up) f30-0)
    (set! (-> this begin-travel-down) f28-0)
    )
  (set! (-> this down quad) (-> this root trans quad))
  (set! (-> this up quad) (-> this root trans quad))
  (+! (-> this up y) 40960.0)
  (set! (-> this part) (create-launch-control (-> *part-group-id-table* 441) this))
  (set! (-> this part2) (create-launch-control (-> *part-group-id-table* 442) this))
  (set! (-> this part3) (create-launch-control (-> *part-group-id-table* 443) this))
  (vector-reset! (-> this root transv))
  (let ((s5-1 (new 'stack-no-clear 'vector))
        (f30-1 0.0)
        )
    (dotimes (s4-2 3)
      (let ((s3-1 (-> this control-pt s4-2)))
        (set-vector! s5-1 0.0 0.0 10240.0 1.0)
        (vector-rotate-around-y! s5-1 s5-1 f30-1)
        (set! f30-1 (+ 21845.334 f30-1))
        (vector+! (-> s3-1 trans) s5-1 (-> this root trans))
        (vector-reset! (-> s3-1 transv))
        )
      )
    )
  (go steam-cap-idle)
  (none)
  )
