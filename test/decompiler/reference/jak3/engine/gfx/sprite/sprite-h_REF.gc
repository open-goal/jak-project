;;-*-Lisp-*-
(in-package goal)

;; definition of type sprite-vec-data-2d
(deftype sprite-vec-data-2d (structure)
  "Per-particle data needed for rendering. This is sent to VU1."
  ((x-y-z-sx     vector    :inline)
   (flag-rot-sy  vector    :inline)
   (r-g-b-a      vector    :inline)
   (x            float             :overlay-at (-> x-y-z-sx data 0))
   (y            float             :overlay-at (-> x-y-z-sx data 1))
   (z            float             :overlay-at (-> x-y-z-sx data 2))
   (sx           float             :overlay-at (-> x-y-z-sx data 3))
   (sy           float             :overlay-at (-> flag-rot-sy data 3))
   (rot          float             :overlay-at (-> flag-rot-sy data 2))
   (flag         int32             :overlay-at (-> flag-rot-sy data 0))
   (matrix       int32             :overlay-at (-> flag-rot-sy data 1))
   (warp-turns   int32             :overlay-at (-> flag-rot-sy data 0))
   (r            float             :overlay-at (-> r-g-b-a data 0))
   (g            float             :overlay-at (-> r-g-b-a data 1))
   (b            float             :overlay-at (-> r-g-b-a data 2))
   (a            float             :overlay-at (-> r-g-b-a data 3))
   (trans        vector3s  :inline :overlay-at (-> x-y-z-sx data 0))
   (color        rgbaf     :inline :overlay-at (-> r-g-b-a data 0))
   (data         uint128   1       :overlay-at (-> x-y-z-sx data 0))
   (data64       uint64    6       :overlay-at (-> x-y-z-sx data 0))
   )
  )

;; definition for method 3 of type sprite-vec-data-2d
(defmethod inspect ((this sprite-vec-data-2d))
  (when (not this)
    (set! this this)
    (goto cfg-4)
    )
  (format #t "[~8x] ~A~%" this 'sprite-vec-data-2d)
  (format #t "~1Tx-y-z-sx: #<vector @ #x~X>~%" (-> this x-y-z-sx))
  (format #t "~1Tflag-rot-sy: #<vector @ #x~X>~%" (&-> this flag))
  (format #t "~1Tr-g-b-a: #<vector @ #x~X>~%" (-> this r-g-b-a))
  (format #t "~1Tx: ~f~%" (-> this x-y-z-sx x))
  (format #t "~1Ty: ~f~%" (-> this x-y-z-sx y))
  (format #t "~1Tz: ~f~%" (-> this x-y-z-sx z))
  (format #t "~1Tsx: ~f~%" (-> this x-y-z-sx w))
  (format #t "~1Tsy: ~f~%" (-> this flag-rot-sy w))
  (format #t "~1Trot: ~f~%" (-> this flag-rot-sy z))
  (format #t "~1Tflag: ~D~%" (-> this flag))
  (format #t "~1Tmatrix: ~D~%" (-> this flag-rot-sy y))
  (format #t "~1Twarp-turns: ~D~%" (-> this flag))
  (format #t "~1Tr: ~f~%" (-> this r-g-b-a x))
  (format #t "~1Tg: ~f~%" (-> this r-g-b-a y))
  (format #t "~1Tb: ~f~%" (-> this r-g-b-a z))
  (format #t "~1Ta: ~f~%" (-> this r-g-b-a w))
  (format #t "~1Ttrans: #<vector3s @ #x~X>~%" (-> this x-y-z-sx))
  (format #t "~1Tcolor: #<rgbaf @ #x~X>~%" (-> this r-g-b-a))
  (format #t "~1Tdata[1] @ #x~X~%" (-> this x-y-z-sx))
  (format #t "~1Tdata64[6] @ #x~X~%" (-> this x-y-z-sx))
  (label cfg-4)
  this
  )

;; definition of type sprite-array-2d
(deftype sprite-array-2d (basic)
  "Array of sprite data for all 2D sprites. There are two groups: normal and HUD."
  ((num-sprites  int32    2)
   (num-valid    int32    2)
   (vec-data     pointer)
   (adgif-data   (inline-array adgif-shader))
   (pad          uint128  4)
   (data         uint128  1)
   )
  (:methods
    (new (symbol type int int) _type_)
    )
  )

;; definition for method 3 of type sprite-array-2d
(defmethod inspect ((this sprite-array-2d))
  (when (not this)
    (set! this this)
    (goto cfg-4)
    )
  (format #t "[~8x] ~A~%" this (-> this type))
  (format #t "~1Tnum-sprites[2] @ #x~X~%" (-> this num-sprites))
  (format #t "~1Tnum-valid[2] @ #x~X~%" (-> this num-valid))
  (format #t "~1Tvec-data: #x~X~%" (-> this vec-data))
  (format #t "~1Tadgif-data: #x~X~%" (-> this adgif-data))
  (format #t "~1Tpad[4] @ #x~X~%" (-> this pad))
  (format #t "~1Tdata[1] @ #x~X~%" (-> this data))
  (label cfg-4)
  this
  )

;; definition of type sprite-vec-data-3d
(deftype sprite-vec-data-3d (structure)
  "Per-particle data needed for rendering. This is sent to VU1."
  ((x-y-z-sx     vector    :inline)
   (qx-qy-qz-sy  vector    :inline)
   (r-g-b-a      vector    :inline)
   (x            float             :overlay-at (-> x-y-z-sx data 0))
   (y            float             :overlay-at (-> x-y-z-sx data 1))
   (z            float             :overlay-at (-> x-y-z-sx data 2))
   (sx           float             :overlay-at (-> x-y-z-sx data 3))
   (sy           float             :overlay-at (-> qx-qy-qz-sy data 3))
   (qx           float             :overlay-at (-> qx-qy-qz-sy data 0))
   (qy           float             :overlay-at (-> qx-qy-qz-sy data 1))
   (qz           float             :overlay-at (-> qx-qy-qz-sy data 2))
   (r            float             :overlay-at (-> r-g-b-a data 0))
   (g            float             :overlay-at (-> r-g-b-a data 1))
   (b            float             :overlay-at (-> r-g-b-a data 2))
   (a            float             :overlay-at (-> r-g-b-a data 3))
   (trans        vector3s  :inline :overlay-at (-> x-y-z-sx data 0))
   (rot          vector3s  :inline :overlay-at (-> qx-qy-qz-sy data 0))
   (color        rgbaf     :inline :overlay-at (-> r-g-b-a data 0))
   (data         uint128   1       :overlay-at (-> x-y-z-sx data 0))
   )
  )

;; definition for method 3 of type sprite-vec-data-3d
(defmethod inspect ((this sprite-vec-data-3d))
  (when (not this)
    (set! this this)
    (goto cfg-4)
    )
  (format #t "[~8x] ~A~%" this 'sprite-vec-data-3d)
  (format #t "~1Tx-y-z-sx: #<vector @ #x~X>~%" (-> this x-y-z-sx))
  (format #t "~1Tqx-qy-qz-sy: #<vector @ #x~X>~%" (-> this qx-qy-qz-sy))
  (format #t "~1Tr-g-b-a: #<vector @ #x~X>~%" (-> this r-g-b-a))
  (format #t "~1Tx: ~f~%" (-> this x-y-z-sx x))
  (format #t "~1Ty: ~f~%" (-> this x-y-z-sx y))
  (format #t "~1Tz: ~f~%" (-> this x-y-z-sx z))
  (format #t "~1Tsx: ~f~%" (-> this x-y-z-sx w))
  (format #t "~1Tsy: ~f~%" (-> this qx-qy-qz-sy w))
  (format #t "~1Tqx: ~f~%" (-> this qx-qy-qz-sy x))
  (format #t "~1Tqy: ~f~%" (-> this qx-qy-qz-sy y))
  (format #t "~1Tqz: ~f~%" (-> this qx-qy-qz-sy z))
  (format #t "~1Tr: ~f~%" (-> this r-g-b-a x))
  (format #t "~1Tg: ~f~%" (-> this r-g-b-a y))
  (format #t "~1Tb: ~f~%" (-> this r-g-b-a z))
  (format #t "~1Ta: ~f~%" (-> this r-g-b-a w))
  (format #t "~1Ttrans: #<vector3s @ #x~X>~%" (-> this x-y-z-sx))
  (format #t "~1Trot: #<vector3s @ #x~X>~%" (-> this qx-qy-qz-sy))
  (format #t "~1Tcolor: #<rgbaf @ #x~X>~%" (-> this r-g-b-a))
  (format #t "~1Tdata[1] @ #x~X~%" (-> this x-y-z-sx))
  (label cfg-4)
  this
  )

;; definition of type sprite-array-3d
(deftype sprite-array-3d (basic)
  "Array of sprite data for all 3D sprites. There are two groups, but only the first is used."
  ((num-sprites  int32    2)
   (num-valid    int32    2)
   (vec-data     pointer)
   (adgif-data   (inline-array adgif-shader))
   (data         uint128  1)
   )
  (:methods
    (new (symbol type int int) _type_)
    )
  )

;; definition for method 3 of type sprite-array-3d
(defmethod inspect ((this sprite-array-3d))
  (when (not this)
    (set! this this)
    (goto cfg-4)
    )
  (format #t "[~8x] ~A~%" this (-> this type))
  (format #t "~1Tnum-sprites[2] @ #x~X~%" (-> this num-sprites))
  (format #t "~1Tnum-valid[2] @ #x~X~%" (-> this num-valid))
  (format #t "~1Tvec-data: #x~X~%" (-> this vec-data))
  (format #t "~1Tadgif-data: #x~X~%" (-> this adgif-data))
  (format #t "~1Tdata[1] @ #x~X~%" (-> this data))
  (label cfg-4)
  this
  )

;; failed to figure out what this is:
0
