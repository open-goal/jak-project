;;-*-Lisp-*-
(in-package goal)

;; definition of type board
(deftype board (process-drawable)
  ((self           board            :override)
   (parent         (pointer target) :override)
   (control        control-info      :overlay-at root)
   (shadow-backup  shadow-geo        :offset 208)
   (main           joint-mod)
   (in-head-time   time-frame)
   )
  (:state-methods
    (idle symbol)
    use
    hidden
    )
  )

;; definition for method 3 of type board
(defmethod inspect ((this board))
  (when (not this)
    (set! this this)
    (goto cfg-4)
    )
  (let ((t9-0 (method-of-type process-drawable inspect)))
    (t9-0 this)
    )
  (format #t "~2Tcontrol: ~A~%" (-> this root))
  (format #t "~2Tstate-time: ~D~%" (-> this state-time))
  (format #t "~2Tshadow-backup: ~A~%" (-> this shadow-backup))
  (format #t "~2Tmain: ~A~%" (-> this main))
  (format #t "~2Tin-head-time: ~D~%" (-> this in-head-time))
  (label cfg-4)
  this
  )

;; definition of type board-info
(deftype board-info (basic)
  ((board                   (pointer board))
   (camera-interp           float)
   (process                 (pointer target))
   (board-trans             vector             :inline)
   (board-quat              vector             :inline)
   (board-scale             vector             :inline)
   (main                    joint-mod)
   (upper-body              joint-mod)
   (mode-sound-bank         connection)
   (sound-bank-knob         float)
   (sound-air-knob          float)
   (wind-sound-id           sound-id)
   (wind-sound-pitch        float)
   (wind-sound-volume       float)
   (engine-sound-id         sound-id)
   (engine-sound-pitch      float)
   (engine-sound-volume     float)
   (bank-sound-id           sound-id)
   (bank-sound-pitch        float)
   (bank-sound-volume       float)
   (ride-sound-id           sound-id)
   (spin-sound-id           sound-id)
   (spin-sound-volume       float)
   (spin-sound-pitch        float)
   (turn-sound-id           sound-id)
   (trick-sound-id          sound-id)
   (jump-sound-id           sound-id)
   (eco-sound-id            sound-id)
   (eco-sound-volume        float)
   (charge-sound-id         sound-id)
   (adjust-time             time-frame)
   (up-vector               vector             2 :inline)
   (slow-transv             vector             :inline)
   (board-time              time-frame)
   (board-get-on-time       time-frame)
   (in-air-time             time-frame)
   (last-jump-time          time-frame)
   (jump-end-time           time-frame)
   (unk-time-frame01        time-frame)
   (stick-lock              symbol)
   (stick-off               symbol)
   (stance-info             ground-tween-info  :inline)
   (mods-backup             surface)
   (attack-id               uint32)
   (latch?                  symbol)
   (probe-intersect         vector             :inline)
   (probe-normal            vector             :inline)
   (probe-pat               pat-surface)
   (probe                   symbol)
   (unstuck-time            time-frame)
   (stuck-count             int32)
   (thrust-scale            float)
   (flip-time               time-frame)
   (transv-max              meters)
   (turn-anim-tilt?         symbol)
   (turn-anim-mag           float)
   (turn-anim-targ          float)
   (turn-anim-frame         float)
   (unk-float000            float)
   (unk-float001            float)
   (turn-anim-vel           float)
   (turn-anim-duck          float)
   (turn-anim-duck-vel      float)
   (tilt-anim-frame         vector             :inline)
   (tilt-anim-targ          vector             :inline)
   (smack-surface-time      time-frame)
   (smack-speed             meters)
   (smack-normal            vector             :inline)
   (glance-time             time-frame)
   (glance-speed            meters)
   (glance-in-transv        vector             :inline)
   (glance-out-transv       vector             :inline)
   (glance-normal           vector             :inline)
   (on-flat-time            time-frame)
   (jump-land-time          time-frame)
   (slip-factor             float)
   (ground-on-dir           vector             :inline)
   (ride-time               time-frame)
   (ride-start-time         time-frame)
   (ride-button-time        time-frame)
   (ride-lean-targ          float)
   (ride-lean               float)
   (ride-leanv              float)
   (ride-lean-mag           float)
   (ride-tilt-targ          float)
   (ride-tilt               float)
   (ride-tiltv              float)
   (ride-tilt-mag           float)
   (ride-lock               symbol)
   (ride-lock-on            symbol)
   (ride-speed              meters)
   (ride-mode               uint32)
   (ride-rot                degrees)
   (ride-rot-old            degrees)
   (ride-rot-abs            degrees            2)
   (ride-rotv-abs           degrees)
   (ride-touch-segment      vector             2 :inline)
   (ride-dir                vector             :inline)
   (ride-vertex-length      int16)
   (ride-vertex-length-old  int16)
   (ride-vertex-base        int16)
   (ride-vertex-base2       int16)
   (ride-vertex-index       float)
   (ride-vertex-index2      float)
   (ride-vertex-index-old   float)
   (ride-vertex             vector             3 :inline)
   (ride-segment            vector             :inline)
   (ride-dir-lean           vector             :inline)
   (ride-pad-vector         vector             1 :inline)
   (ride-vertex-old         vector             3 :inline)
   (ride-segment-old        vector             :inline)
   (ride-vertex-trail       vector             128 :inline)
   (halfpipe-side-time      time-frame)
   (halfpipe-jump-time      time-frame)
   (halfpipe-lip-time       time-frame)
   (halfpipe-time           time-frame)
   (halfpipe-gspot-time     time-frame)
   (halfpipe-lip-event      symbol)
   (spin-check-time         time-frame)
   (spin-time               time-frame)
   (spin-start-time         time-frame)
   (spin-start-dir          vector             :inline)
   (spin-control            float)
   (spin-ground-start-time  time-frame)
   (spin-ground-time        time-frame)
   (spin-ground-press-time  time-frame)
   (flip-control            float)
   (flip-count              int32)
   (unk-time000             time-frame            :offset 3152)
   (tricky-time             time-frame)
   (tricky-exit-time        time-frame)
   (duck-start-time         time-frame)
   (unk-float005            float)
   (unk-float006            float)
   (unk-float007            float)
   (trickx-count            int32)
   (unk-time001             time-frame            :offset 3208)
   (hold-start-time         time-frame)
   (hold-exit-time          time-frame)
   (l2-start-time           time-frame)
   (rotyv-max               degrees)
   (rotyv                   degrees)
   (roty                    degrees)
   (roty-cum                degrees)
   (unk-deg00               degrees)
   (upper-body-rotyv-max    degrees               :offset 3260)
   (upper-body-rotyv        degrees)
   (upper-body-roty         degrees)
   (cushion-base            meters)
   (cushion-offset          meters)
   (shock-offset            meters)
   (shock-offsetv           meters)
   (shock-rotx              meters)
   (effect-part             sparticle-launch-control)
   (charge-part             sparticle-launch-control)
   (trick-count             int32)
   (trick-array             board-tricks       16)
   (trick-points-array      float              16 :offset 3368)
   (trick-list              board-tricks       16 :offset 3432)
   (charge-start-time       time-frame            :offset 3496)
   (charge-time             time-frame)
   (charge-progress         float)
   (zap-start-time          time-frame            :offset 3520)
   )
  (:methods
    (add-to-trick-list (_type_ board-tricks float) none)
    (flush-trick-list (_type_) none)
    )
  )

;; definition for method 3 of type board-info
(defmethod inspect ((this board-info))
  (when (not this)
    (set! this this)
    (goto cfg-19)
    )
  (format #t "[~8x] ~A~%" this (-> this type))
  (format #t "~1Tboard: #x~X~%" (-> this board))
  (format #t "~1Tcamera-interp: ~f~%" (-> this camera-interp))
  (format #t "~1Tprocess: #x~X~%" (-> this process))
  (format #t "~1Tboard-trans: ~`vector`P~%" (-> this board-trans))
  (format #t "~1Tboard-quat: ~`vector`P~%" (-> this board-quat))
  (format #t "~1Tboard-scale: ~`vector`P~%" (-> this board-scale))
  (format #t "~1Tmain: ~A~%" (-> this main))
  (format #t "~1Tupper-body: ~A~%" (-> this upper-body))
  (format #t "~1Tsound-bank-knob: ~f~%" (-> this sound-bank-knob))
  (format #t "~1Tsound-air-knob: ~f~%" (-> this sound-air-knob))
  (format #t "~1Twind-sound-id: ~D~%" (-> this wind-sound-id))
  (format #t "~1Twind-sound-pitch: ~f~%" (-> this wind-sound-pitch))
  (format #t "~1Twind-sound-volume: ~f~%" (-> this wind-sound-volume))
  (format #t "~1Tengine-sound-id: ~D~%" (-> this engine-sound-id))
  (format #t "~1Tengine-sound-pitch: ~f~%" (-> this engine-sound-pitch))
  (format #t "~1Tengine-sound-volume: ~f~%" (-> this engine-sound-volume))
  (format #t "~1Tbank-sound-id: ~D~%" (-> this bank-sound-id))
  (format #t "~1Tbank-sound-pitch: ~f~%" (-> this bank-sound-pitch))
  (format #t "~1Tbank-sound-volume: ~f~%" (-> this bank-sound-volume))
  (format #t "~1Tride-sound-id: ~D~%" (-> this ride-sound-id))
  (format #t "~1Tspin-sound-id: ~D~%" (-> this spin-sound-id))
  (format #t "~1Tspin-sound-volume: ~f~%" (-> this spin-sound-volume))
  (format #t "~1Tspin-sound-pitch: ~f~%" (-> this spin-sound-pitch))
  (format #t "~1Tup-vector[2] @ #x~X~%" (-> this up-vector))
  (format #t "~1Tslow-transv: #<vector @ #x~X>~%" (-> this slow-transv))
  (format #t "~1Tboard-time: ~D~%" (-> this board-time))
  (format #t "~1Tboard-get-on-time: ~D~%" (-> this board-get-on-time))
  (format #t "~1Tin-air-time: ~D~%" (-> this in-air-time))
  (format #t "~1Tstick-lock: ~A~%" (-> this stick-lock))
  (format #t "~1Tstick-off: ~A~%" (-> this stick-off))
  (format #t "~1Tstance-info: #<ground-tween-info @ #x~X>~%" (-> this stance-info))
  (format #t "~1Tmods-backup: ~A~%" (-> this mods-backup))
  (format #t "~1Tattack-id: ~D~%" (-> this attack-id))
  (format #t "~1Tlatch?: ~A~%" (-> this latch?))
  (format #t "~1Tunstuck-time: ~D~%" (-> this unstuck-time))
  (format #t "~1Tstuck-count: ~D~%" (-> this stuck-count))
  (format #t "~1Tthrust-scale: ~f~%" (-> this thrust-scale))
  (format #t "~1Tflip-time: ~D~%" (-> this flip-time))
  (format #t "~1Ttransv-max: (meters ~m)~%" (-> this transv-max))
  (format #t "~1Tturn-anim-tilt?: ~A~%" (-> this turn-anim-tilt?))
  (format #t "~1Tturn-anim-mag: ~f~%" (-> this turn-anim-mag))
  (format #t "~1Tturn-anim-targ: ~f~%" (-> this turn-anim-targ))
  (format #t "~1Tturn-anim-frame: ~f~%" (-> this turn-anim-frame))
  (format #t "~1Tturn-anim-vel: ~f~%" (-> this turn-anim-vel))
  (format #t "~1Tturn-anim-duck: ~f~%" (-> this turn-anim-duck))
  (format #t "~1Tturn-anim-duck-vel: ~f~%" (-> this turn-anim-duck-vel))
  (format #t "~1Ttilt-anim-frame: ~`vector`P~%" (-> this tilt-anim-frame))
  (format #t "~1Ttilt-anim-targ: ~`vector`P~%" (-> this tilt-anim-targ))
  (format #t "~1Tsmack-surface-time: ~D~%" (-> this smack-surface-time))
  (format #t "~1Tsmack-speed: (meters ~m)~%" (-> this smack-speed))
  (format #t "~1Tsmack-normal: ~`vector`P~%" (-> this smack-normal))
  (format #t "~1Tglance-time: ~D~%" (-> this glance-time))
  (format #t "~1Tglance-speed: (meters ~m)~%" (-> this glance-speed))
  (format #t "~1Tglance-in-transv: ~`vector`P~%" (-> this glance-in-transv))
  (format #t "~1Tglance-out-transv: ~`vector`P~%" (-> this glance-out-transv))
  (format #t "~1Tglance-normal: ~`vector`P~%" (-> this glance-normal))
  (format #t "~1Ton-flat-time: ~D~%" (-> this on-flat-time))
  (format #t "~1Tjump-land-time: ~D~%" (-> this jump-land-time))
  (format #t "~1Tslip-factor: ~f~%" (-> this slip-factor))
  (format #t "~1Tground-on-dir: ~`vector`P~%" (-> this ground-on-dir))
  (format #t "~1Tride-time: ~D~%" (-> this ride-time))
  (format #t "~1Tride-start-time: ~D~%" (-> this ride-start-time))
  (format #t "~1Tride-button-time: ~D~%" (-> this ride-button-time))
  (format #t "~1Tride-lean-targ: ~f~%" (-> this ride-lean-targ))
  (format #t "~1Tride-lean: ~f~%" (-> this ride-lean))
  (format #t "~1Tride-leanv: ~f~%" (-> this ride-leanv))
  (format #t "~1Tride-lean-mag: ~f~%" (-> this ride-lean-mag))
  (format #t "~1Tride-tilt-targ: ~f~%" (-> this ride-tilt-targ))
  (format #t "~1Tride-tilt: ~f~%" (-> this ride-tilt))
  (format #t "~1Tride-tiltv: ~f~%" (-> this ride-tiltv))
  (format #t "~1Tride-tilt-mag: ~f~%" (-> this ride-tilt-mag))
  (format #t "~1Tride-lock: ~A~%" (-> this ride-lock))
  (format #t "~1Tride-lock-on: ~A~%" (-> this ride-lock-on))
  (format #t "~1Tride-speed: (meters ~m)~%" (-> this ride-speed))
  (format #t "~1Tride-mode: ~D~%" (-> this ride-mode))
  (format #t "~1Tride-rot: (deg ~r)~%" (-> this ride-rot))
  (format #t "~1Tride-rot-old: (deg ~r)~%" (-> this ride-rot-old))
  (format #t "~1Tride-rot-abs[2] @ #x~X~%" (-> this ride-rot-abs))
  (dotimes (s5-0 2)
    (format #t "~T  [~D]~1Tride-rot-abs: (deg ~r)~%" s5-0 (-> this ride-rot-abs s5-0))
    )
  (format #t "~1Tride-rotv-abs: (deg ~r)~%" (-> this ride-rotv-abs))
  (format #t "~1Tride-touch-segment[2] @ #x~X~%" (-> this ride-touch-segment))
  (dotimes (s5-1 2)
    (format #t "~T  [~D]~1Tride-touch-segment: ~`vector`P~%" s5-1 (-> this ride-touch-segment s5-1))
    )
  (format #t "~1Tride-dir: ~`vector`P~%" (-> this ride-dir))
  (format #t "~1Tride-vertex-length: ~D~%" (-> this ride-vertex-length))
  (format #t "~1Tride-vertex-length-old: ~D~%" (-> this ride-vertex-length-old))
  (format #t "~1Tride-vertex-base: ~D~%" (-> this ride-vertex-base))
  (format #t "~1Tride-vertex-base2: ~D~%" (-> this ride-vertex-base2))
  (format #t "~1Tride-vertex-index: ~f~%" (-> this ride-vertex-index))
  (format #t "~1Tride-vertex-index2: ~f~%" (-> this ride-vertex-index2))
  (format #t "~1Tride-vertex-index-old: ~f~%" (-> this ride-vertex-index-old))
  (format #t "~1Tride-vertex[3] @ #x~X~%" (-> this ride-vertex))
  (dotimes (s5-2 3)
    (format #t "~T  [~D]~1Tride-vertex: ~`vector`P~%" s5-2 (-> this ride-vertex s5-2))
    )
  (format #t "~1Tride-segment: ~`vector`P~%" (-> this ride-segment))
  (format #t "~1Tride-dir-lean: ~`vector`P~%" (-> this ride-dir-lean))
  (format #t "~1Tride-pad-vector[1] @ #x~X~%" (-> this ride-pad-vector))
  (format #t "~1Tride-vertex-old[3] @ #x~X~%" (-> this ride-vertex-old))
  (dotimes (s5-3 3)
    (format #t "~T  [~D]~1Tride-vertex-old: ~`vector`P~%" s5-3 (-> this ride-vertex-old s5-3))
    )
  (format #t "~1Tride-segment-old: ~`vector`P~%" (-> this ride-segment-old))
  (format #t "~1Tride-vertex-trail[128] @ #x~X~%" (-> this ride-vertex-trail))
  (dotimes (s5-4 128)
    (format #t "~T  [~D]~1Tride-vertex-trail: ~`vector`P~%" s5-4 (-> this ride-vertex-trail s5-4))
    )
  (format #t "~1Thalfpipe-side-time: ~D~%" (-> this halfpipe-side-time))
  (format #t "~1Thalfpipe-jump-time: ~D~%" (-> this halfpipe-jump-time))
  (format #t "~1Thalfpipe-lip-time: ~D~%" (-> this halfpipe-lip-time))
  (format #t "~1Thalfpipe-time: ~D~%" (-> this halfpipe-time))
  (format #t "~1Thalfpipe-gspot-time: ~D~%" (-> this halfpipe-gspot-time))
  (format #t "~1Thalfpipe-lip-event: ~A~%" (-> this halfpipe-lip-event))
  (format #t "~1Tspin-check-time: ~D~%" (-> this spin-check-time))
  (format #t "~1Tspin-time: ~D~%" (-> this spin-time))
  (format #t "~1Tspin-start-time: ~D~%" (-> this spin-start-time))
  (format #t "~1Tspin-start-dir: ~`vector`P~%" (-> this spin-start-dir))
  (format #t "~1Tspin-control: ~f~%" (-> this spin-control))
  (format #t "~1Tspin-ground-start-time: ~D~%" (-> this spin-ground-start-time))
  (format #t "~1Tspin-ground-time: ~D~%" (-> this spin-ground-time))
  (format #t "~1Tspin-ground-press-time: ~D~%" (-> this spin-ground-press-time))
  (format #t "~1Tflip-control: ~f~%" (-> this flip-control))
  (format #t "~1Tflip-count: ~D~%" (-> this flip-count))
  (format #t "~1Ttrickx-count: ~D~%" (-> this trickx-count))
  (format #t "~1Trotyv-max: (deg ~r)~%" (-> this rotyv-max))
  (format #t "~1Trotyv: (deg ~r)~%" (-> this rotyv))
  (format #t "~1Troty: (deg ~r)~%" (-> this roty))
  (format #t "~1Troty-cum: (deg ~r)~%" (&-> this roty-cum))
  (format #t "~1Tupper-body-rotyv-max: (deg ~r)~%" (-> this upper-body-rotyv-max))
  (format #t "~1Tupper-body-rotyv: (deg ~r)~%" (-> this upper-body-rotyv))
  (format #t "~1Tupper-body-roty: (deg ~r)~%" (-> this upper-body-roty))
  (format #t "~1Tcushion-base: (meters ~m)~%" (-> this cushion-base))
  (format #t "~1Tcushion-offset: (meters ~m)~%" (-> this cushion-offset))
  (format #t "~1Tshock-offset: (meters ~m)~%" (-> this shock-offset))
  (format #t "~1Tshock-offsetv: (meters ~m)~%" (-> this shock-offsetv))
  (format #t "~1Tshock-rotx: (meters ~m)~%" (-> this shock-rotx))
  (format #t "~1Ttrick-count: ~D~%" (-> this trick-count))
  (format #t "~1Tzap-start-time: ~D~%" (-> this zap-start-time))
  (label cfg-19)
  this
  )

;; definition of type target-board-bank
(deftype target-board-bank (basic)
  ((jump-height-min         meters)
   (jump-height-max         meters)
   (duck-jump-height-min    meters)
   (duck-jump-height-max    meters)
   (turn-frames             float)
   (wall-kick-window        time-frame)
   (cushion                 meters)
   (trickx-jump-height-min  meters)
   (trickx-jump-height-max  meters)
   (tricky-jump-height-min  meters)
   (tricky-jump-height-max  meters)
   (trickz-jump-height-min  meters)
   (trickz-jump-height-max  meters)
   (charge-jump-time        time-frame)
   (charge-jump-fade-time   time-frame)
   (charge-jump-height      meters)
   (zap-duration            time-frame)
   (zap-reset-time          time-frame)
   )
  )

;; definition for method 3 of type target-board-bank
(defmethod inspect ((this target-board-bank))
  (when (not this)
    (set! this this)
    (goto cfg-4)
    )
  (format #t "[~8x] ~A~%" this (-> this type))
  (format #t "~1Tjump-height-min: (meters ~m)~%" (-> this jump-height-min))
  (format #t "~1Tjump-height-max: (meters ~m)~%" (-> this jump-height-max))
  (format #t "~1Tduck-jump-height-min: (meters ~m)~%" (-> this duck-jump-height-min))
  (format #t "~1Tduck-jump-height-max: (meters ~m)~%" (-> this duck-jump-height-max))
  (format #t "~1Tturn-frames: ~f~%" (-> this turn-frames))
  (format #t "~1Twall-kick-window: (seconds ~e)~%" (-> this wall-kick-window))
  (format #t "~1Tcushion: (meters ~m)~%" (-> this cushion))
  (format #t "~1Ttrickx-jump-height-min: (meters ~m)~%" (-> this trickx-jump-height-min))
  (format #t "~1Ttrickx-jump-height-max: (meters ~m)~%" (-> this trickx-jump-height-max))
  (format #t "~1Ttricky-jump-height-min: (meters ~m)~%" (-> this tricky-jump-height-min))
  (format #t "~1Ttricky-jump-height-max: (meters ~m)~%" (-> this tricky-jump-height-max))
  (format #t "~1Ttrickz-jump-height-min: (meters ~m)~%" (-> this trickz-jump-height-min))
  (format #t "~1Ttrickz-jump-height-max: (meters ~m)~%" (-> this trickz-jump-height-max))
  (format #t "~1Tcharge-jump-time: (seconds ~e)~%" (-> this charge-jump-time))
  (format #t "~1Tcharge-jump-fade-time: (seconds ~e)~%" (-> this charge-jump-fade-time))
  (format #t "~1Tcharge-jump-height: (meters ~m)~%" (-> this charge-jump-height))
  (format #t "~1Tzap-duration: ~D~%" (-> this zap-duration))
  (format #t "~1Tzap-reset-time: ~D~%" (-> this zap-reset-time))
  (label cfg-4)
  this
  )

;; definition for symbol *TARGET_BOARD-bank*, type target-board-bank
(define *TARGET_BOARD-bank* (new 'static 'target-board-bank
                              :jump-height-min (meters 1.01)
                              :jump-height-max (meters 3.5)
                              :duck-jump-height-min (meters 2.5)
                              :duck-jump-height-max (meters 5)
                              :turn-frames 10.0
                              :wall-kick-window (seconds 0.05)
                              :cushion (meters 1)
                              :trickx-jump-height-min (meters 0.9)
                              :trickx-jump-height-max (meters 1.2)
                              :tricky-jump-height-min (meters 0.9)
                              :tricky-jump-height-max (meters 1.2)
                              :trickz-jump-height-min (meters 0.9)
                              :trickz-jump-height-max (meters 1.2)
                              :charge-jump-time (seconds 0.7)
                              :charge-jump-fade-time (seconds 0.25)
                              :charge-jump-height (meters 3.5)
                              :zap-duration (seconds 0.25)
                              :zap-reset-time (seconds 0.25)
                              )
        )

;; definition for function want-to-board?
;; INFO: Used lq/sq
(defbehavior want-to-board? target ()
  (and (logtest? (logand (game-feature board) (-> *setting-control* user-current features)) (-> self game features))
       (or (and (cpad-pressed? (-> self control cpad number) r2)
                (or (!= *cheat-mode* 'debug)
                    (not (logtest? (-> *cpad-list* cpads (-> self control cpad number) button0-abs 0) (pad-buttons l2)))
                    )
                (not *pause-lock*)
                (time-elapsed? (-> self control time-of-last-debug-heal) (seconds 0.1))
                (>= (-> self control last-time-on-surface) (-> self control time-of-last-debug-float))
                )
           (or (-> self board latch?) (= (-> *setting-control* user-current board) 'force))
           )
       (not (focus-test? self dead hit grabbed in-head edge-grab pole flut tube board pilot mech indax teleporting))
       (or (zero? (-> self board)) (time-elapsed? (-> self board board-time) (seconds 0.5)))
       (not (logtest? (target-flags prevent-board invisible) (-> self target-flags)))
       (< (-> self board board-time) (-> self control list-time-on-ground))
       (not (logtest? (surface-flag no-board) (-> self control current-surface flags)))
       (or (not (logtest? (-> self control current-surface flags) (surface-flag duck))) (can-exit-duck? self))
       (not (and (logtest? (-> self water flags) (water-flag under-water))
                 (not (logtest? (-> self water flags) (water-flag swim-ground)))
                 )
            )
       (zero? (-> self lightjak shield-start-time))
       (not *artist-fix-visible*)
       (let ((gp-0 (new 'stack-no-clear 'collide-query)))
         (let ((s5-0 (new 'stack-no-clear 'inline-array 'sphere 3)))
           (dotimes (s4-0 3)
             ((method-of-type sphere new) (the-as symbol (-> s5-0 s4-0)) sphere)
             )
           (let ((v1-56 (new 'stack-no-clear 'vector)))
             (set! (-> v1-56 quad) (-> self control trans quad))
             (if (focus-test? self on-water)
                 (set! (-> v1-56 y) (-> self water height))
                 )
             (set! (-> s5-0 0 quad) (-> v1-56 quad))
             (+! (-> s5-0 0 y) 8192.0)
             (set! (-> s5-0 0 r) 2867.2)
             (set! (-> s5-0 1 quad) (-> v1-56 quad))
             (+! (-> s5-0 1 y) 12288.0)
             (set! (-> s5-0 1 r) 2867.2)
             (set! (-> s5-0 2 quad) (-> v1-56 quad))
             )
           (+! (-> s5-0 2 y) 16384.0)
           (set! (-> s5-0 2 r) 2867.2)
           (let ((v1-60 gp-0))
             (set! (-> v1-60 best-dist) (the-as float s5-0))
             (set! (-> v1-60 best-other-prim) (the-as collide-shape-prim 3))
             (set! (-> v1-60 collide-with)
                   (logclear
                     (-> self control root-prim prim-core collide-with)
                     (collide-spec civilian enemy vehicle-sphere projectile)
                     )
                   )
             (set! (-> v1-60 ignore-process0) #f)
             (set! (-> v1-60 ignore-process1) #f)
             (set! (-> v1-60 ignore-pat)
                   (new 'static 'pat-surface :noentity #x1 :nojak #x1 :probe #x1 :noendlessfall #x1 :board #x1)
                   )
             (set! (-> v1-60 best-my-prim) (the-as collide-shape-prim #t))
             (set! (-> v1-60 action-mask) (collide-action solid))
             )
           )
         (and (if (fill-and-probe-using-spheres *collide-cache* gp-0)
                  #f
                  #t
                  )
              (begin (set! (-> self board latch?) #t) (time-elapsed? (-> self gun gun-time) (seconds 0.4)))
              )
         )
       )
  )

;; failed to figure out what this is:
(defskelgroup skel-board board board-lod0-jg board-board-idle-ja
              ((board-lod0-mg (meters 999999)))
              :bounds (static-spherem 0 0 0 3.5)
              :shadow board-shadow-mg
              :sort 1
              :origin-joint-index 3
              )

;; definition for symbol *board-shadow-control*, type shadow-control
(define *board-shadow-control*
  (new 'static 'shadow-control :settings (new 'static 'shadow-settings
                                           :center (new 'static 'vector :w (the-as float #xa))
                                           :shadow-dir (new 'static 'vector :y -1.0 :w 614400.0)
                                           :bot-plane (new 'static 'plane :y 1.0 :w 81920.0)
                                           :top-plane (new 'static 'plane :y 1.0 :w 2048.0)
                                           )
                               )
  )

;; failed to figure out what this is:
0
